<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Agent å­¦ä¹ å®éªŒç¬”è®°ï¼šå·¥ç¨‹åŒ–ä¼˜åŒ–ä¸é«˜çº§ RAG æŠ€æœ¯</title>
      <link href="/2025/12/08/Agent%20Learning/%E5%B7%A5%E7%A8%8B%E5%8C%96%E4%BC%98%E5%8C%96%E4%B8%8E%E9%AB%98%E7%BA%A7%20RAG%20%E6%8A%80%E6%9C%AF%20(%E9%98%B6%E6%AE%B53)/"/>
      <url>/2025/12/08/Agent%20Learning/%E5%B7%A5%E7%A8%8B%E5%8C%96%E4%BC%98%E5%8C%96%E4%B8%8E%E9%AB%98%E7%BA%A7%20RAG%20%E6%8A%80%E6%9C%AF%20(%E9%98%B6%E6%AE%B53)/</url>
      
        <content type="html"><![CDATA[<h1 id="Agent-å­¦ä¹ å®éªŒæ‰‹å†Œï¼šå·¥ç¨‹åŒ–ä¼˜åŒ–ä¸é«˜çº§-RAG-æŠ€æœ¯-é˜¶æ®µ3"><a href="#Agent-å­¦ä¹ å®éªŒæ‰‹å†Œï¼šå·¥ç¨‹åŒ–ä¼˜åŒ–ä¸é«˜çº§-RAG-æŠ€æœ¯-é˜¶æ®µ3" class="headerlink" title="Agent å­¦ä¹ å®éªŒæ‰‹å†Œï¼šå·¥ç¨‹åŒ–ä¼˜åŒ–ä¸é«˜çº§ RAG æŠ€æœ¯ (é˜¶æ®µ3)"></a>Agent å­¦ä¹ å®éªŒæ‰‹å†Œï¼šå·¥ç¨‹åŒ–ä¼˜åŒ–ä¸é«˜çº§ RAG æŠ€æœ¯ (é˜¶æ®µ3)</h1><blockquote><p><strong>æ ¸å¿ƒç†å¿µ</strong>ï¼šä»â€è·‘é€šä»£ç â€åˆ°â€è§£å†³çœŸå®ä¸–ç•Œçš„å¤æ‚è„æ´»â€ï¼ŒæŒæ¡ç”Ÿäº§çº§ RAG ç³»ç»Ÿçš„å·¥ç¨‹åŒ–æ·±åº¦ã€‚</p></blockquote><hr><h2 id="ğŸ“‹-å®éªŒç›®æ ‡"><a href="#ğŸ“‹-å®éªŒç›®æ ‡" class="headerlink" title="ğŸ“‹ å®éªŒç›®æ ‡"></a>ğŸ“‹ å®éªŒç›®æ ‡</h2><ol><li><strong>æŒæ¡é«˜çº§åˆ‡åˆ†ç­–ç•¥</strong>ï¼šç†è§£ä¸åŒåˆ‡åˆ†æ–¹æ³•çš„é€‚ç”¨åœºæ™¯å’Œæ•ˆæœå·®å¼‚</li><li><strong>ä¼˜åŒ–æ£€ç´¢å‡†ç¡®åº¦</strong>ï¼šå­¦ä¹ æ··åˆæ£€ç´¢ã€é‡æ’åºç­‰å…ˆè¿›æŠ€æœ¯</li><li><strong>ç®¡ç†ä¸Šä¸‹æ–‡çª—å£</strong>ï¼šè§£å†³é•¿æ–‡æ¡£ã€æˆæœ¬æ§åˆ¶ç­‰å·¥ç¨‹éš¾é¢˜</li><li><strong>å®æˆ˜é¡¹ç›®</strong>ï¼šæ„å»ºâ€æ™ºèƒ½æŠ•åæŠ¥å‘Šåˆ†æåŠ©æ‰‹â€ï¼Œå¤„ç†çœŸå®å¤æ‚åœºæ™¯</li><li><strong>æ€§èƒ½è°ƒä¼˜</strong>ï¼šå»ºç«‹è¯„ä¼°ä½“ç³»ï¼ŒæŒç»­ä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½</li></ol><hr><h2 id="ğŸ› ï¸-å®éªŒç¯å¢ƒå‡†å¤‡"><a href="#ğŸ› ï¸-å®éªŒç¯å¢ƒå‡†å¤‡" class="headerlink" title="ğŸ› ï¸ å®éªŒç¯å¢ƒå‡†å¤‡"></a>ğŸ› ï¸ å®éªŒç¯å¢ƒå‡†å¤‡</h2><h3 id="å‡çº§ä¾èµ–å®‰è£…"><a href="#å‡çº§ä¾èµ–å®‰è£…" class="headerlink" title="å‡çº§ä¾èµ–å®‰è£…"></a>å‡çº§ä¾èµ–å®‰è£…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ¿€æ´»ç¬¬äºŒé˜¶æ®µç¯å¢ƒ</span><br><span class="hljs-comment"># rag_env\Scripts\activate  # Windows</span><br><span class="hljs-comment"># source rag_env/bin/activate  # Linux/Mac</span><br><br><span class="hljs-comment"># å®‰è£…é«˜çº§ä¾èµ–</span><br>pip install matplotlib seaborn scikit-learn<br>pip install rank_bm25  <span class="hljs-comment"># å…³é”®è¯æ£€ç´¢</span><br>pip install sentence-transformers[visualization]  <span class="hljs-comment"># å¯è§†åŒ–å·¥å…·</span><br>pip install umap-learn  <span class="hljs-comment"># é™ç»´å¯è§†åŒ–</span><br>pip install jieba  <span class="hljs-comment"># ä¸­æ–‡åˆ†è¯</span><br><br><span class="hljs-comment"># å¯é€‰ï¼šé«˜çº§å‘é‡æ•°æ®åº“</span><br>pip install qdrant-client  <span class="hljs-comment"># Qdrant å‘é‡æ•°æ®åº“</span><br>pip install pymilvus  <span class="hljs-comment"># Milvus å‘é‡æ•°æ®åº“</span><br><br><span class="hljs-comment"># æ–‡æ¡£è§£æå·¥å…·</span><br>pip install unstructured<br>pip install pymupdf  <span class="hljs-comment"># PDF å¤„ç†</span><br>pip install pandas openpyxl  <span class="hljs-comment"># è¡¨æ ¼å¤„ç†</span><br></code></pre></td></tr></table></figure><h3 id="ç¯å¢ƒéªŒè¯"><a href="#ç¯å¢ƒéªŒè¯" class="headerlink" title="ç¯å¢ƒéªŒè¯"></a>ç¯å¢ƒéªŒè¯</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_dependencies</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;æµ‹è¯•Stage 3ç¯å¢ƒä¾èµ–&quot;&quot;&quot;</span><br>    deps = &#123;<br>        <span class="hljs-string">&#x27;sentence_transformers&#x27;</span>: <span class="hljs-string">&#x27;sentence-transformers&#x27;</span>,<br>        <span class="hljs-string">&#x27;faiss&#x27;</span>: <span class="hljs-string">&#x27;faiss-cpu&#x27;</span>,<br>        <span class="hljs-string">&#x27;sklearn&#x27;</span>: <span class="hljs-string">&#x27;scikit-learn&#x27;</span>,<br>        <span class="hljs-string">&#x27;matplotlib&#x27;</span>: <span class="hljs-string">&#x27;matplotlib&#x27;</span>,<br>        <span class="hljs-string">&#x27;seaborn&#x27;</span>: <span class="hljs-string">&#x27;seaborn&#x27;</span>,<br>        <span class="hljs-string">&#x27;rank_bm25&#x27;</span>: <span class="hljs-string">&#x27;rank_bm25&#x27;</span>,<br>        <span class="hljs-string">&#x27;umap&#x27;</span>: <span class="hljs-string">&#x27;umap-learn&#x27;</span>,<br>        <span class="hljs-string">&#x27;unstructured&#x27;</span>: <span class="hljs-string">&#x27;unstructured&#x27;</span>,<br>        <span class="hljs-string">&#x27;fitz&#x27;</span>: <span class="hljs-string">&#x27;pymupdf&#x27;</span>,<br>        <span class="hljs-string">&#x27;pandas&#x27;</span>: <span class="hljs-string">&#x27;pandas&#x27;</span>,<br>        <span class="hljs-string">&#x27;jieba&#x27;</span>: <span class="hljs-string">&#x27;jieba&#x27;</span>,<br>    &#125;<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">60</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Stage 3 ä¾èµ–æ£€æŸ¥&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">60</span>)<br><br>    missing = []<br>    <span class="hljs-keyword">for</span> name, package <span class="hljs-keyword">in</span> deps.items():<br>        <span class="hljs-keyword">try</span>:<br>            module = <span class="hljs-built_in">__import__</span>(name)<br>            version = <span class="hljs-built_in">getattr</span>(module, <span class="hljs-string">&#x27;__version__&#x27;</span>, <span class="hljs-string">&#x27;unknown&#x27;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âœ… <span class="hljs-subst">&#123;package:20s&#125;</span> v<span class="hljs-subst">&#123;version&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">except</span> ImportError:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âŒ <span class="hljs-subst">&#123;package:20s&#125;</span> æœªå®‰è£…&quot;</span>)<br>            missing.append(package)<br><br>    <span class="hljs-keyword">if</span> missing:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\nâš ï¸  è¯·å®‰è£…ç¼ºå¤±ä¾èµ–: pip install <span class="hljs-subst">&#123;<span class="hljs-string">&#x27; &#x27;</span>.join(missing)&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nâœ… æ‰€æœ‰ä¾èµ–å·²å°±ç»ªï¼&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    success = test_dependencies()<br>    sys.exit(<span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure><hr><h2 id="å®éªŒä¸€ï¼šé«˜çº§åˆ‡åˆ†ç­–ç•¥-Advanced-Chunking"><a href="#å®éªŒä¸€ï¼šé«˜çº§åˆ‡åˆ†ç­–ç•¥-Advanced-Chunking" class="headerlink" title="å®éªŒä¸€ï¼šé«˜çº§åˆ‡åˆ†ç­–ç•¥ (Advanced Chunking)"></a>å®éªŒä¸€ï¼šé«˜çº§åˆ‡åˆ†ç­–ç•¥ (Advanced Chunking)</h2><h3 id="å®éªŒç›®æ ‡"><a href="#å®éªŒç›®æ ‡" class="headerlink" title="å®éªŒç›®æ ‡"></a>å®éªŒç›®æ ‡</h3><p>æ·±å…¥ç†è§£ä¸åŒåˆ‡åˆ†ç­–ç•¥å¯¹æ£€ç´¢æ•ˆæœçš„å½±å“ï¼ŒæŒæ¡ä½•æ—¶ä½¿ç”¨ä½•ç§åˆ‡åˆ†æ–¹æ³•ã€‚</p><h3 id="ç†è®ºåŸºç¡€"><a href="#ç†è®ºåŸºç¡€" class="headerlink" title="ç†è®ºåŸºç¡€"></a>ç†è®ºåŸºç¡€</h3><h4 id="1-åˆ‡åˆ†ç­–ç•¥å¯¹æ¯”"><a href="#1-åˆ‡åˆ†ç­–ç•¥å¯¹æ¯”" class="headerlink" title="1. åˆ‡åˆ†ç­–ç•¥å¯¹æ¯”"></a>1. åˆ‡åˆ†ç­–ç•¥å¯¹æ¯”</h4><table><thead><tr><th>ç­–ç•¥</th><th>å®ç°éš¾åº¦</th><th>æ£€ç´¢æ•ˆæœ</th><th>ä¸Šä¸‹æ–‡ä¿æŒ</th><th>è®¡ç®—æˆæœ¬</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>å›ºå®šé•¿åº¦</td><td>â­</td><td>â­â­</td><td>â­</td><td>â­â­â­â­â­</td><td>ç®€å•æ–‡æ¡£ã€æ—¥å¿—</td></tr><tr><td>å¥å­çº§</td><td>â­â­</td><td>â­â­â­</td><td>â­â­</td><td>â­â­â­â­</td><td>è®ºæ–‡ã€æ–°é—»</td></tr><tr><td>æ®µè½çº§</td><td>â­â­</td><td>â­â­â­â­</td><td>â­â­â­â­</td><td>â­â­â­</td><td>å¸¸è§„æ–‡æ¡£</td></tr><tr><td>é€’å½’åˆ‡åˆ†</td><td>â­â­â­</td><td>â­â­â­â­</td><td>â­â­â­â­</td><td>â­â­â­</td><td>é€šç”¨åœºæ™¯</td></tr><tr><td>è¯­ä¹‰åˆ‡åˆ†</td><td>â­â­â­â­</td><td>â­â­â­â­â­</td><td>â­â­â­â­â­</td><td>â­â­</td><td>å¤æ‚æ–‡æ¡£</td></tr></tbody></table><h4 id="2-Overlap-çª—å£ç­–ç•¥"><a href="#2-Overlap-çª—å£ç­–ç•¥" class="headerlink" title="2. Overlap çª—å£ç­–ç•¥"></a>2. Overlap çª—å£ç­–ç•¥</h4><p><strong>é—®é¢˜</strong>ï¼šåˆ‡åˆ†æ—¶ä¸¢å¤±è·¨å—ä¸Šä¸‹æ–‡ä¿¡æ¯<br><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šç›¸é‚»å—ä¹‹é—´ä¿ç•™é‡å åŒºåŸŸ</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">å—1</span><span class="hljs-punctuation">:</span> <span class="hljs-string">[AAAAAAAAAA]BBBBBBBBB</span><br><span class="hljs-attribute">å—2</span><span class="hljs-punctuation">:</span> <span class="hljs-string">         [CCCCCCCCCC]DDDDDDDDD</span><br>      <span class="hljs-attribute">â†‘ é‡å åŒºåŸŸ â†‘</span><br><span class="hljs-attribute"></span><br><span class="hljs-attribute">æœ€ä½³å®è·µï¼š</span><br><span class="hljs-attribute">- é‡å æ¯”ä¾‹</span><span class="hljs-punctuation">:</span> <span class="hljs-string">10-20%</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">é‡å è¿‡å°‘: ä¸¢å¤±è¯­ä¹‰</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">é‡å è¿‡å¤š: æµªè´¹å­˜å‚¨</span><br></code></pre></td></tr></table></figure><h3 id="å®éªŒæ­¥éª¤"><a href="#å®éªŒæ­¥éª¤" class="headerlink" title="å®éªŒæ­¥éª¤"></a>å®éªŒæ­¥éª¤</h3><h4 id="Step-1-å®ç°å¤šç§åˆ‡åˆ†ç­–ç•¥"><a href="#Step-1-å®ç°å¤šç§åˆ‡åˆ†ç­–ç•¥" class="headerlink" title="Step 1: å®ç°å¤šç§åˆ‡åˆ†ç­–ç•¥"></a>Step 1: å®ç°å¤šç§åˆ‡åˆ†ç­–ç•¥</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Tuple</span>, <span class="hljs-type">Optional</span>, Generator<br><span class="hljs-keyword">from</span> dataclasses <span class="hljs-keyword">import</span> dataclass<br><br><span class="hljs-meta">@dataclass</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Chunk</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;æ–‡æœ¬å—æ•°æ®ç»“æ„&quot;&quot;&quot;</span><br>    __slots__ = [<span class="hljs-string">&#x27;text&#x27;</span>, <span class="hljs-string">&#x27;start&#x27;</span>, <span class="hljs-string">&#x27;end&#x27;</span>, <span class="hljs-string">&#x27;chunk_id&#x27;</span>, <span class="hljs-string">&#x27;token_count&#x27;</span>]  <span class="hljs-comment"># ä¼˜åŒ–å†…å­˜å ç”¨</span><br>    text: <span class="hljs-built_in">str</span><br>    start: <span class="hljs-built_in">int</span><br>    end: <span class="hljs-built_in">int</span><br>    chunk_id: <span class="hljs-built_in">int</span><br>    token_count: <span class="hljs-built_in">int</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">AdvancedChunker</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;é«˜çº§æ–‡æœ¬åˆ‡åˆ†å™¨ï¼ˆé«˜æ€§èƒ½ç‰ˆï¼‰&quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-variable language_">self</span>.chunk_id_counter = <span class="hljs-number">0</span><br>        <span class="hljs-comment"># é¢„ç¼–è¯‘æ­£åˆ™ï¼Œæé«˜æ€§èƒ½</span><br>        <span class="hljs-variable language_">self</span>.sentence_split_pattern = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&#x27;[ã€‚ï¼ï¼Ÿï¼›.!?;]&#x27;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">count_tokens</span>(<span class="hljs-params">self, text: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>        <span class="hljs-string">&quot;&quot;&quot;ç®€å•tokenè®¡æ•°ï¼ˆä¸­æ–‡æŒ‰å­—ç¬¦ï¼‰&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(text)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_create_chunk</span>(<span class="hljs-params">self, text: <span class="hljs-built_in">str</span>, start: <span class="hljs-built_in">int</span>, end: <span class="hljs-built_in">int</span></span>) -&gt; Chunk:<br>        <span class="hljs-string">&quot;&quot;&quot;å†…éƒ¨è¾…åŠ©æ–¹æ³•ï¼šå¿«é€Ÿåˆ›å»ºChunk&quot;&quot;&quot;</span><br>        chunk = Chunk(<br>            text=text,<br>            start=start,<br>            end=end,<br>            chunk_id=<span class="hljs-variable language_">self</span>.chunk_id_counter,<br>            token_count=<span class="hljs-built_in">len</span>(text)<br>        )<br>        <span class="hljs-variable language_">self</span>.chunk_id_counter += <span class="hljs-number">1</span><br>        <span class="hljs-keyword">return</span> chunk<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">chunk_by_fixed_length</span>(<span class="hljs-params"></span><br><span class="hljs-params">        self,</span><br><span class="hljs-params">        text: <span class="hljs-built_in">str</span>,</span><br><span class="hljs-params">        chunk_size: <span class="hljs-built_in">int</span> = <span class="hljs-number">200</span>,</span><br><span class="hljs-params">        overlap: <span class="hljs-built_in">int</span> = <span class="hljs-number">20</span></span><br><span class="hljs-params">    </span>) -&gt; <span class="hljs-type">List</span>[Chunk]:<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        å›ºå®šé•¿åº¦åˆ‡åˆ†ï¼ˆä¼˜åŒ–ï¼šä½¿ç”¨rangeæ­¥è¿›ï¼Œå‡å°‘åˆ‡ç‰‡å¼€é”€ï¼‰</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        chunks = []<br>        text_len = <span class="hljs-built_in">len</span>(text)<br>        <br>        <span class="hljs-comment"># æ­¥è¿›å¤„ç†ï¼Œé¿å…whileå¾ªç¯ä¸­çš„é‡å¤è®¡ç®—</span><br>        step = chunk_size - overlap <span class="hljs-keyword">if</span> overlap &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> chunk_size<br>        <span class="hljs-keyword">if</span> step &lt;= <span class="hljs-number">0</span>: step = <span class="hljs-number">1</span> <span class="hljs-comment"># é˜²æ­¢æ­»å¾ªç¯</span><br>        <br>        <span class="hljs-keyword">for</span> start <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, text_len, step):<br>            end = <span class="hljs-built_in">min</span>(start + chunk_size, text_len)<br>            <span class="hljs-comment"># å¦‚æœæ˜¯æœ€åä¸€æ®µä¸”ç”±overlapå¯¼è‡´é‡å¤ï¼Œéœ€è¦åˆ¤æ–­ï¼ˆåŸé€»è¾‘ä¿ç•™ï¼‰</span><br>            <span class="hljs-keyword">if</span> start &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> end == text_len <span class="hljs-keyword">and</span> (start + overlap) &gt; text_len:<br>                 <span class="hljs-comment"># è¿™ç§æƒ…å†µä¸‹å¯èƒ½ä¼šäº§ç”Ÿéå¸¸çŸ­çš„å°¾å·´æˆ–è€…é‡å¤ï¼Œæ ¹æ®åŸé€»è¾‘ç›´æ¥åˆ‡åˆ†å³å¯</span><br>                 <span class="hljs-keyword">pass</span><br><br>            chunk_text = text[start:end]<br>            chunks.append(<span class="hljs-variable language_">self</span>._create_chunk(chunk_text, start, end))<br>            <br>            <span class="hljs-keyword">if</span> end == text_len:<br>                <span class="hljs-keyword">break</span><br><br>        <span class="hljs-keyword">return</span> chunks<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">chunk_by_sentences</span>(<span class="hljs-params">self, text: <span class="hljs-built_in">str</span>, min_chunk_size: <span class="hljs-built_in">int</span> = <span class="hljs-number">50</span></span>) -&gt; <span class="hljs-type">List</span>[Chunk]:<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        å¥å­çº§åˆ‡åˆ†ï¼ˆä¼˜åŒ–ï¼šä½¿ç”¨åˆ—è¡¨ç¼“å­˜æ›¿ä»£å­—ç¬¦ä¸²æ‹¼æ¥ï¼‰</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-comment"># ä½¿ç”¨ split åˆ‡åˆ†ï¼Œæ³¨æ„ï¼šåŸé€»è¾‘ä¼šä¸¢å¤±åˆ†éš”ç¬¦ï¼Œè¿™é‡Œä¿æŒåŸé€»è¾‘è¡Œä¸º</span><br>        <span class="hljs-comment"># ä¹Ÿå°±æ˜¯åŸé€»è¾‘ä¼šæŠŠ &#x27;ã€‚&#x27; ä¸¢æ‰ï¼Œç„¶åæ‰‹åŠ¨åŠ å›æ¥</span><br>        sentences = <span class="hljs-variable language_">self</span>.sentence_split_pattern.split(text)<br><br>        chunks = []<br>        current_buffer = []  <span class="hljs-comment"># ä½¿ç”¨åˆ—è¡¨ä»£æ›¿å­—ç¬¦ä¸²+=</span><br>        current_len = <span class="hljs-number">0</span><br>        <br>        <span class="hljs-comment"># è¿½è¸ªæ–‡æœ¬ä½ç½®</span><br>        current_pos = <span class="hljs-number">0</span> <br>        chunk_start = <span class="hljs-number">0</span><br><br>        <span class="hljs-keyword">for</span> sentence <span class="hljs-keyword">in</span> sentences:<br>            sentence = sentence.strip()<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> sentence:<br>                <span class="hljs-keyword">continue</span><br>            <br>            <span class="hljs-comment"># åŸé€»è¾‘ï¼šæ¯ä¸ªå¥å­æ‰‹åŠ¨åŠ å¥å·</span><br>            sentence_with_punct = sentence + <span class="hljs-string">&quot;ã€‚&quot;</span><br>            sent_len = <span class="hljs-built_in">len</span>(sentence_with_punct)<br><br>            <span class="hljs-comment"># å¦‚æœåŠ ä¸Šè¿™ä¸ªå¥å­ä¼šå¤ªé•¿ï¼Œä¿å­˜å½“å‰chunk</span><br>            <span class="hljs-keyword">if</span> current_len + sent_len &gt; <span class="hljs-number">300</span> <span class="hljs-keyword">and</span> current_buffer:<br>                text_content = <span class="hljs-string">&quot;&quot;</span>.join(current_buffer)<br>                chunks.append(<span class="hljs-variable language_">self</span>._create_chunk(<br>                    text=text_content,<br>                    start=chunk_start,<br>                    end=chunk_start + <span class="hljs-built_in">len</span>(text_content)<br>                ))<br>                <br>                <span class="hljs-comment"># é‡ç½®Buffer</span><br>                current_buffer = [sentence_with_punct]<br>                current_len = sent_len<br>                <span class="hljs-comment"># æ›´æ–°ä¸‹ä¸€ä¸ªå—çš„èµ·å§‹ä½ç½®ï¼ˆè¿‘ä¼¼å€¼ï¼Œå› ä¸ºåŸé€»è¾‘é€šè¿‡stripå’ŒåŠ å¥å·ä¿®æ”¹äº†æ–‡æœ¬ï¼Œæ— æ³•ç²¾ç¡®å¯¹åº”åŸæ–‡ä½ç½®ï¼‰</span><br>                <span class="hljs-comment"># è¿™é‡Œä¸ºäº†æ€§èƒ½å’Œé€»è¾‘è¿ç»­æ€§ï¼Œæˆ‘ä»¬ç´¯åŠ é•¿åº¦</span><br>                chunk_start += <span class="hljs-built_in">len</span>(text_content) <br>            <span class="hljs-keyword">else</span>:<br>                current_buffer.append(sentence_with_punct)<br>                current_len += sent_len<br><br>        <span class="hljs-comment"># æ·»åŠ æœ€åä¸€ä¸ªchunk</span><br>        <span class="hljs-keyword">if</span> current_buffer:<br>            text_content = <span class="hljs-string">&quot;&quot;</span>.join(current_buffer)<br>            chunks.append(<span class="hljs-variable language_">self</span>._create_chunk(<br>                text=text_content,<br>                start=chunk_start,<br>                end=chunk_start + <span class="hljs-built_in">len</span>(text_content)<br>            ))<br><br>        <span class="hljs-keyword">return</span> chunks<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">chunk_by_recursive</span>(<span class="hljs-params"></span><br><span class="hljs-params">        self,</span><br><span class="hljs-params">        text: <span class="hljs-built_in">str</span>,</span><br><span class="hljs-params">        chunk_size: <span class="hljs-built_in">int</span> = <span class="hljs-number">300</span>,</span><br><span class="hljs-params">        overlap: <span class="hljs-built_in">int</span> = <span class="hljs-number">30</span>,</span><br><span class="hljs-params">        separators: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span></span><br><span class="hljs-params">    </span>) -&gt; <span class="hljs-type">List</span>[Chunk]:<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        é€’å½’åˆ‡åˆ†ï¼ˆä¼˜åŒ–ï¼šç”Ÿæˆå™¨æ¨¡å¼ + åˆ—è¡¨ç¼“å­˜ï¼Œå¤§å¹…é™ä½å†…å­˜å’ŒCPUæ¶ˆè€—ï¼‰</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">if</span> separators <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>            separators = [<span class="hljs-string">&#x27;\n\n&#x27;</span>, <span class="hljs-string">&#x27;\n&#x27;</span>, <span class="hljs-string">&#x27;ã€‚&#x27;</span>, <span class="hljs-string">&#x27;ï¼›&#x27;</span>, <span class="hljs-string">&#x27;ï¼Œ&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>]<br><br>        <span class="hljs-comment"># å†…éƒ¨ç”Ÿæˆå™¨ï¼šæµå¼äº§ç”Ÿæ–‡æœ¬ç‰‡æ®µï¼Œé¿å…æ„å»ºå·¨å¤§çš„ä¸­é—´åˆ—è¡¨</span><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">_recursive_split_gen</span>(<span class="hljs-params">text_segment: <span class="hljs-built_in">str</span>, seps: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]</span>) -&gt; Generator[<span class="hljs-built_in">str</span>, <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span>]:<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> seps <span class="hljs-keyword">or</span> <span class="hljs-built_in">len</span>(text_segment) &lt;= chunk_size:<br>                <span class="hljs-keyword">if</span> text_segment:<br>                    <span class="hljs-keyword">yield</span> text_segment<br>                <span class="hljs-keyword">return</span><br><br>            separator = seps[<span class="hljs-number">0</span>]<br>            <span class="hljs-comment"># åªæœ‰å½“separatorå­˜åœ¨æ—¶æ‰splitï¼Œå¦åˆ™ç›´æ¥ç”±splitå¤„ç†ï¼ˆsplitç©ºä¸²ä¼šæŠ¥é”™ï¼‰</span><br>            <span class="hljs-keyword">if</span> separator:<br>                parts = text_segment.split(separator)<br>            <span class="hljs-keyword">else</span>:<br>                parts = [text_segment]<br><br>            <span class="hljs-comment"># æ£€æŸ¥æ˜¯å¦éœ€è¦ä¸‹ä¸€çº§åˆ†å‰²</span><br>            <span class="hljs-comment"># ä¼˜åŒ–ï¼šä¸éœ€è¦æ£€æŸ¥æ‰€æœ‰partï¼Œåªè¦å‘ç°æœ‰å¤§çš„å°±å¿…é¡»é€’å½’ï¼ˆæˆ–è€…å…¨éƒ¨é€’å½’ï¼‰</span><br>            <span class="hljs-comment"># åŸé€»è¾‘æ˜¯ï¼šå¦‚æœ any part &gt; chunk_sizeï¼Œåˆ™å…¨éƒ¨è¿›å…¥ä¸‹ä¸€çº§ã€‚</span><br>            <span class="hljs-comment"># è¿™å…¶å®æ¯”è¾ƒä½æ•ˆï¼Œé€šå¸¸æ˜¯åˆ†æ²»ï¼šå¤§çš„ç»§ç»­åˆ†ï¼Œå°çš„ä¿ç•™ã€‚</span><br>            <span class="hljs-comment"># ä½†ä¸ºäº†ä¿æŒå’ŒåŸä»£ç é€»è¾‘ä¸€è‡´ï¼ˆ&quot;å¦‚æœåˆ†å‰²åçš„éƒ¨åˆ†éƒ½å¤ªå¤§...&quot;ï¼‰ï¼Œæˆ‘ä»¬ä¿ç•™åŸæ„ï¼š</span><br>            <span class="hljs-comment"># åŸé€»è¾‘ï¼šif any(...) -&gt; use next separator for ALL text.</span><br>            <br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">any</span>(<span class="hljs-built_in">len</span>(p) &gt; chunk_size <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> parts):<br>                <span class="hljs-keyword">yield</span> <span class="hljs-keyword">from</span> _recursive_split_gen(text_segment, seps[<span class="hljs-number">1</span>:])<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-keyword">for</span> part <span class="hljs-keyword">in</span> parts:<br>                    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(part) &gt; chunk_size:<br>                        <span class="hljs-comment"># ç†è®ºä¸Šä¸Šé¢anyå·²ç»æ‹¦æˆªäº†ï¼Œä½†ä¸ºäº†å®‰å…¨ä¿ç•™</span><br>                        <span class="hljs-keyword">yield</span> <span class="hljs-keyword">from</span> _recursive_split_gen(part, seps[<span class="hljs-number">1</span>:])<br>                    <span class="hljs-keyword">else</span>:<br>                        <span class="hljs-keyword">yield</span> part<br><br>        <span class="hljs-comment"># å¼€å§‹å¤„ç†</span><br>        <span class="hljs-comment"># è¿™é‡Œçš„partsç°åœ¨æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œä¸ä¼šä¸€æ¬¡æ€§å¡æ­»å†…å­˜</span><br>        parts_gen = _recursive_split_gen(text, separators)<br><br>        chunks = []<br>        current_buffer = []<br>        current_len = <span class="hljs-number">0</span><br>        <br>        <span class="hljs-comment"># ç®€å•çš„overlapå¤„ç†ç¼“å­˜</span><br>        <span class="hljs-comment"># åŸé€»è¾‘ overlap æ¯”è¾ƒç®€å•ï¼Œæ˜¯å– current_chunk çš„ååŠéƒ¨åˆ†</span><br>        <span class="hljs-comment"># ä¸ºäº†é«˜æ•ˆï¼Œæˆ‘ä»¬åªåœ¨åˆ‡åˆ†æ—¶è®¡ç®— overlap</span><br>        <br>        <span class="hljs-keyword">for</span> part <span class="hljs-keyword">in</span> parts_gen:<br>            part = part.strip()<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> part:<br>                <span class="hljs-keyword">continue</span><br><br>            part_len = <span class="hljs-built_in">len</span>(part)<br>            <br>            <span class="hljs-keyword">if</span> current_len + part_len &gt; chunk_size <span class="hljs-keyword">and</span> current_buffer:<br>                <span class="hljs-comment"># 1. ç”Ÿæˆå½“å‰å—</span><br>                text_content = <span class="hljs-string">&quot;&quot;</span>.join(current_buffer)<br>                chunks.append(<span class="hljs-variable language_">self</span>._create_chunk(<br>                    text=text_content,<br>                    start=<span class="hljs-number">0</span>, <span class="hljs-comment"># é€’å½’åˆ‡åˆ†æ¯”è¾ƒå¤æ‚ï¼ŒåŸä»£ç ä¹Ÿæ˜¯0ï¼Œè¿™é‡Œæš‚ä¿æŒä¸º0æˆ–éœ€è¦é‡å†™å¤§é‡é€»è¾‘è¿½è¸ªoffset</span><br>                    end=<span class="hljs-built_in">len</span>(text_content)<br>                ))<br><br>                <span class="hljs-comment"># 2. å¤„ç† Overlap</span><br>                <span class="hljs-comment"># ä» text_content æœ«å°¾å– overlap</span><br>                overlap_text = text_content[-overlap:] <span class="hljs-keyword">if</span> overlap &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;&quot;</span><br>                <br>                <span class="hljs-comment"># 3.ä»¥æ­¤ä½œä¸ºæ–°å—çš„å¼€å§‹</span><br>                current_buffer = [overlap_text, part] <span class="hljs-keyword">if</span> overlap_text <span class="hljs-keyword">else</span> [part]<br>                current_len = <span class="hljs-built_in">len</span>(overlap_text) + part_len<br>            <span class="hljs-keyword">else</span>:<br>                current_buffer.append(part)<br>                current_len += part_len<br><br>        <span class="hljs-comment"># æ·»åŠ æœ€åä¸€ä¸ªchunk</span><br>        <span class="hljs-keyword">if</span> current_buffer:<br>            text_content = <span class="hljs-string">&quot;&quot;</span>.join(current_buffer)<br>            chunks.append(<span class="hljs-variable language_">self</span>._create_chunk(<br>                text=text_content,<br>                start=<span class="hljs-number">0</span>,<br>                end=<span class="hljs-built_in">len</span>(text_content)<br>            ))<br><br>        <span class="hljs-keyword">return</span> chunks<br><br><span class="hljs-comment"># æµ‹è¯•ä¸åŒåˆ‡åˆ†ç­–ç•¥</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-comment"># åŠ è½½æµ‹è¯•æ•°æ®</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;../Stage_2/anthropic.txt&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        test_text = f.read()[:<span class="hljs-number">2000</span>]  <span class="hljs-comment"># å–å‰2000å­—ç¬¦æµ‹è¯•</span><br><br>    chunker = AdvancedChunker()<br><br>    <span class="hljs-comment"># ç­–ç•¥1: å›ºå®šé•¿åº¦</span><br>    fixed_chunks = chunker.chunk_by_fixed_length(test_text, <span class="hljs-number">200</span>, <span class="hljs-number">20</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;å›ºå®šé•¿åº¦åˆ‡åˆ†: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(fixed_chunks)&#125;</span> ä¸ªå—&quot;</span>)<br><br>    <span class="hljs-comment"># ç­–ç•¥2: å¥å­çº§</span><br>    sentence_chunks = chunker.chunk_by_sentences(test_text)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;å¥å­çº§åˆ‡åˆ†: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(sentence_chunks)&#125;</span> ä¸ªå—&quot;</span>)<br><br>    <span class="hljs-comment"># ç­–ç•¥3: é€’å½’åˆ‡åˆ†</span><br>    recursive_chunks = chunker.chunk_by_recursive(test_text, <span class="hljs-number">300</span>, <span class="hljs-number">30</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;é€’å½’åˆ‡åˆ†: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(recursive_chunks)&#125;</span> ä¸ªå—&quot;</span>)<br><br>    <span class="hljs-comment"># åˆ†æåˆ‡åˆ†æ•ˆæœ</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n=== åˆ‡åˆ†æ•ˆæœåˆ†æ ===&quot;</span>)<br>    <span class="hljs-keyword">for</span> name, chunks <span class="hljs-keyword">in</span> [<br>        (<span class="hljs-string">&quot;å›ºå®šé•¿åº¦&quot;</span>, fixed_chunks),<br>        (<span class="hljs-string">&quot;å¥å­çº§&quot;</span>, sentence_chunks),<br>        (<span class="hljs-string">&quot;é€’å½’åˆ‡åˆ†&quot;</span>, recursive_chunks)<br>    ]:<br>        avg_tokens = np.mean([c.token_count <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> chunks])<br>        std_tokens = np.std([c.token_count <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> chunks])<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n<span class="hljs-subst">&#123;name&#125;</span>:&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  å¹³å‡Tokenæ•°: <span class="hljs-subst">&#123;avg_tokens:<span class="hljs-number">.1</span>f&#125;</span> Â± <span class="hljs-subst">&#123;std_tokens:<span class="hljs-number">.1</span>f&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  å—æ•°é‡: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(chunks)&#125;</span>&quot;</span>)<br>        <span class="hljs-comment"># å¢åŠ åˆ¤æ–­ï¼Œé˜²æ­¢ç©ºåˆ—è¡¨æŠ¥é”™</span><br>        <span class="hljs-keyword">if</span> chunks:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  ç¤ºä¾‹å—: <span class="hljs-subst">&#123;chunks[<span class="hljs-number">0</span>].text[:<span class="hljs-number">100</span>]&#125;</span>...&quot;</span>)<br></code></pre></td></tr></table></figure><pre><code class="hljs">å›ºå®šé•¿åº¦åˆ‡åˆ†: 11 ä¸ªå—å¥å­çº§åˆ‡åˆ†: 8 ä¸ªå—é€’å½’åˆ‡åˆ†: 9 ä¸ªå—=== åˆ‡åˆ†æ•ˆæœåˆ†æ ===å›ºå®šé•¿åº¦:  å¹³å‡Tokenæ•°: 200.0 Â± 0.0  å—æ•°é‡: 11  ç¤ºä¾‹å—: Anthropicæ˜¯ç”±OpenAIå‰é«˜å±‚ä¸¹å¦®æ‹‰Â·é˜¿è«è¿ªï¼ˆDaniela Amodeiï¼‰å’Œè¾¾é‡Œå¥¥Â·é˜¿è«è¿ªï¼ˆDario Amodeiï¼‰äº2021å¹´åˆ›ç«‹çš„äººå·¥æ™ºèƒ½å…¬å¸ï¼Œæ€»éƒ¨ä½äºç¾å›½åŠ å·æ—§é‡‘å±±ï¼Œè¾¾é‡Œå¥¥Â·é˜¿è«è¿ª...å¥å­çº§:  å¹³å‡Tokenæ•°: 248.9 Â± 59.3  å—æ•°é‡: 8  ç¤ºä¾‹å—: Anthropicæ˜¯ç”±OpenAIå‰é«˜å±‚ä¸¹å¦®æ‹‰Â·é˜¿è«è¿ªï¼ˆDaniela Amodeiï¼‰å’Œè¾¾é‡Œå¥¥Â·é˜¿è«è¿ªï¼ˆDario Amodeiï¼‰äº2021å¹´åˆ›ç«‹çš„äººå·¥æ™ºèƒ½å…¬å¸ï¼Œæ€»éƒ¨ä½äºç¾å›½åŠ å·æ—§é‡‘å±±ï¼Œè¾¾é‡Œå¥¥Â·é˜¿è«è¿ª...é€’å½’åˆ‡åˆ†:  å¹³å‡Tokenæ•°: 244.0 Â± 45.2  å—æ•°é‡: 9  ç¤ºä¾‹å—: Anthropicæ˜¯ç”±OpenAIå‰é«˜å±‚ä¸¹å¦®æ‹‰Â·é˜¿è«è¿ªï¼ˆDaniela Amodeiï¼‰å’Œè¾¾é‡Œå¥¥Â·é˜¿è«è¿ªï¼ˆDario Amodeiï¼‰äº2021å¹´åˆ›ç«‹çš„äººå·¥æ™ºèƒ½å…¬å¸ï¼Œæ€»éƒ¨ä½äºç¾å›½åŠ å·æ—§é‡‘å±±ï¼Œè¾¾é‡Œå¥¥Â·é˜¿è«è¿ª...</code></pre><h4 id="Step-2-åˆ‡åˆ†æ•ˆæœè¯„ä¼°"><a href="#Step-2-åˆ‡åˆ†æ•ˆæœè¯„ä¼°" class="headerlink" title="Step 2: åˆ‡åˆ†æ•ˆæœè¯„ä¼°"></a>Step 2: åˆ‡åˆ†æ•ˆæœè¯„ä¼°</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> sentence_transformers <span class="hljs-keyword">import</span> SentenceTransformer<br><span class="hljs-keyword">from</span> sklearn.metrics.pairwise <span class="hljs-keyword">import</span> cosine_similarity<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">import</span> os<br><br><span class="hljs-comment"># è®¾ç½®ä¸­æ–‡å­—ä½“ä»¥è§£å†³è­¦å‘Šé—®é¢˜</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">setup_chinese_font</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;è®¾ç½®ä¸­æ–‡å­—ä½“æ”¯æŒ&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># æ–¹æ³•1: ä½¿ç”¨ç³»ç»Ÿå­—ä½“</span><br>        <span class="hljs-keyword">import</span> matplotlib<br>        system_fonts = matplotlib.font_manager.get_font_names()<br>        <br>        <span class="hljs-comment"># å¸¸è§ä¸­æ–‡å­—ä½“åˆ—è¡¨ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰</span><br>        chinese_fonts = [<br>            <span class="hljs-string">&#x27;SimHei&#x27;</span>,       <span class="hljs-comment"># Windows é»‘ä½“</span><br>            <span class="hljs-string">&#x27;Microsoft YaHei&#x27;</span>,  <span class="hljs-comment"># Windows å¾®è½¯é›…é»‘</span><br>            <span class="hljs-string">&#x27;STHeiti&#x27;</span>,      <span class="hljs-comment"># Mac é»‘ä½“</span><br>            <span class="hljs-string">&#x27;STXihei&#x27;</span>,      <span class="hljs-comment"># Mac ç»†é»‘</span><br>            <span class="hljs-string">&#x27;STKaiti&#x27;</span>,      <span class="hljs-comment"># Mac æ¥·ä½“</span><br>            <span class="hljs-string">&#x27;STSong&#x27;</span>,       <span class="hljs-comment"># Mac å®‹ä½“</span><br>            <span class="hljs-string">&#x27;STFangsong&#x27;</span>,   <span class="hljs-comment"># Mac ä»¿å®‹</span><br>            <span class="hljs-string">&#x27;SimSun&#x27;</span>,       <span class="hljs-comment"># Windows å®‹ä½“</span><br>            <span class="hljs-string">&#x27;NSimSun&#x27;</span>,      <span class="hljs-comment"># Windows æ–°å®‹ä½“</span><br>            <span class="hljs-string">&#x27;FangSong&#x27;</span>,     <span class="hljs-comment"># Windows ä»¿å®‹</span><br>            <span class="hljs-string">&#x27;KaiTi&#x27;</span>,        <span class="hljs-comment"># Windows æ¥·ä½“</span><br>            <span class="hljs-string">&#x27;Arial Unicode MS&#x27;</span>,  <span class="hljs-comment"># é€šç”¨å­—ä½“</span><br>            <span class="hljs-string">&#x27;DejaVu Sans&#x27;</span>   <span class="hljs-comment"># Linux é»˜è®¤</span><br>        ]<br>        <br>        <span class="hljs-comment"># æ£€æŸ¥ç³»ç»Ÿå¯ç”¨çš„ä¸­æ–‡å­—ä½“</span><br>        available_fonts = []<br>        <span class="hljs-keyword">for</span> font <span class="hljs-keyword">in</span> chinese_fonts:<br>            <span class="hljs-keyword">if</span> font <span class="hljs-keyword">in</span> system_fonts:<br>                available_fonts.append(font)<br>        <br>        <span class="hljs-keyword">if</span> available_fonts:<br>            <span class="hljs-comment"># è®¾ç½®å­—ä½“</span><br>            plt.rcParams[<span class="hljs-string">&#x27;font.sans-serif&#x27;</span>] = available_fonts<br>            plt.rcParams[<span class="hljs-string">&#x27;axes.unicode_minus&#x27;</span>] = <span class="hljs-literal">False</span>  <span class="hljs-comment"># è§£å†³è´Ÿå·æ˜¾ç¤ºé—®é¢˜</span><br>            <br>            <span class="hljs-comment"># æ¸…é™¤matplotlibç¼“å­˜</span><br>            matplotlib.font_manager._rebuild()<br>            <br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âœ“ å·²è®¾ç½®ä¸­æ–‡å­—ä½“: <span class="hljs-subst">&#123;available_fonts[<span class="hljs-number">0</span>]&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-comment"># æ–¹æ³•2: å°è¯•ä¸‹è½½ä¸­æ–‡å­—ä½“</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;âš  æœªæ‰¾åˆ°ç³»ç»Ÿä¸­æ–‡å­—ä½“ï¼Œå°è¯•ä¸‹è½½...&quot;</span>)<br>            <span class="hljs-keyword">return</span> download_chinese_font()<br>            <br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;å­—ä½“è®¾ç½®å¤±è´¥: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">download_chinese_font</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;ä¸‹è½½ä¸­æ–‡å­—ä½“&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">import</span> urllib.request<br>        <span class="hljs-keyword">import</span> zipfile<br>        <span class="hljs-keyword">import</span> tempfile<br>        <br>        <span class="hljs-comment"># ä»GitHubä¸‹è½½å¼€æºä¸­æ–‡å­—ä½“</span><br>        font_url = <span class="hljs-string">&quot;https://github.com/googlefonts/noto-cjk/raw/main/Sans/NotoSansSC-Regular.otf&quot;</span><br>        font_path = os.path.join(tempfile.gettempdir(), <span class="hljs-string">&quot;NotoSansSC-Regular.otf&quot;</span>)<br>        <br>        <span class="hljs-comment"># ä¸‹è½½å­—ä½“æ–‡ä»¶</span><br>        urllib.request.urlretrieve(font_url, font_path)<br>        <br>        <span class="hljs-comment"># æ·»åŠ åˆ°matplotlibå­—ä½“ç®¡ç†å™¨</span><br>        <span class="hljs-keyword">import</span> matplotlib.font_manager <span class="hljs-keyword">as</span> fm<br>        fm.fontManager.addfont(font_path)<br>        <br>        <span class="hljs-comment"># è®¾ç½®å­—ä½“</span><br>        font_name = fm.FontProperties(fname=font_path).get_name()<br>        plt.rcParams[<span class="hljs-string">&#x27;font.sans-serif&#x27;</span>] = [font_name]<br>        plt.rcParams[<span class="hljs-string">&#x27;axes.unicode_minus&#x27;</span>] = <span class="hljs-literal">False</span><br>        <br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âœ“ å·²ä¸‹è½½å¹¶ä½¿ç”¨ä¸­æ–‡å­—ä½“: <span class="hljs-subst">&#123;font_name&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>        <br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ä¸‹è½½å­—ä½“å¤±è´¥: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;âš  å°†ä½¿ç”¨é»˜è®¤å­—ä½“ï¼Œä¸­æ–‡å¯èƒ½æ˜¾ç¤ºä¸ºæ–¹æ¡†&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><span class="hljs-comment"># åœ¨ç±»å®šä¹‰å‰è®¾ç½®å­—ä½“</span><br>setup_chinese_font()<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ChunkingEvaluator</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;åˆ‡åˆ†æ•ˆæœè¯„ä¼°å™¨&quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, embedding_model_name=<span class="hljs-string">&#x27;all-MiniLM-L6-v2&#x27;</span></span>):<br>        <span class="hljs-variable language_">self</span>.model = SentenceTransformer(embedding_model_name)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">compute_coherence_score</span>(<span class="hljs-params">self, chunks: <span class="hljs-type">List</span>[Chunk]</span>) -&gt; <span class="hljs-built_in">float</span>:<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        è®¡ç®—è¯­ä¹‰è¿è´¯æ€§åˆ†æ•°</span><br><span class="hljs-string">        ç›¸é‚»å—ä¹‹é—´çš„ç›¸ä¼¼åº¦è¶Šé«˜ï¼Œè¿è´¯æ€§è¶Šå¥½</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(chunks) &lt; <span class="hljs-number">2</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1.0</span><br><br>        embeddings = <span class="hljs-variable language_">self</span>.model.encode([c.text <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> chunks])<br>        similarities = []<br><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(chunks) - <span class="hljs-number">1</span>):<br>            sim = cosine_similarity([embeddings[i]], [embeddings[i+<span class="hljs-number">1</span>]])[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]<br>            similarities.append(sim)<br><br>        <span class="hljs-keyword">return</span> np.mean(similarities)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">compute_completeness_score</span>(<span class="hljs-params">self, chunks: <span class="hljs-type">List</span>[Chunk], original_text: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">float</span>:<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        è®¡ç®—å®Œæ•´æ€§åˆ†æ•°</span><br><span class="hljs-string">        æ–‡æœ¬è¦†ç›–ç‡</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        total_covered = <span class="hljs-built_in">sum</span>(<span class="hljs-built_in">len</span>(c.text) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> chunks)<br>        overlap = <span class="hljs-built_in">sum</span>(<span class="hljs-built_in">max</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(c.text) - <span class="hljs-number">200</span>) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> chunks[:-<span class="hljs-number">1</span>])  <span class="hljs-comment"># ä¼°ç®—é‡å </span><br>        unique_covered = total_covered - overlap<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">min</span>(unique_covered / <span class="hljs-built_in">len</span>(original_text), <span class="hljs-number">1.0</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">evaluate_chunking_strategy</span>(<span class="hljs-params">self, text: <span class="hljs-built_in">str</span>, strategy_func, **kwargs</span>) -&gt; <span class="hljs-built_in">dict</span>:<br>        <span class="hljs-string">&quot;&quot;&quot;è¯„ä¼°æŸç§åˆ‡åˆ†ç­–ç•¥&quot;&quot;&quot;</span><br>        chunks = strategy_func(text, **kwargs)<br><br>        coherence = <span class="hljs-variable language_">self</span>.compute_coherence_score(chunks)<br>        completeness = <span class="hljs-variable language_">self</span>.compute_completeness_score(chunks, text)<br><br>        <span class="hljs-comment"># è®¡ç®—å¹³å‡å—å¤§å°å’Œæ–¹å·®</span><br>        chunk_sizes = [<span class="hljs-built_in">len</span>(c.text) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> chunks]<br>        avg_size = np.mean(chunk_sizes)<br>        std_size = np.std(chunk_sizes)<br><br>        <span class="hljs-keyword">return</span> &#123;<br>            <span class="hljs-string">&#x27;strategy&#x27;</span>: strategy_func.__name__,<br>            <span class="hljs-string">&#x27;chunk_count&#x27;</span>: <span class="hljs-built_in">len</span>(chunks),<br>            <span class="hljs-string">&#x27;coherence_score&#x27;</span>: coherence,<br>            <span class="hljs-string">&#x27;completeness_score&#x27;</span>: completeness,<br>            <span class="hljs-string">&#x27;avg_chunk_size&#x27;</span>: avg_size,<br>            <span class="hljs-string">&#x27;std_chunk_size&#x27;</span>: std_size,<br>            <span class="hljs-string">&#x27;chunks&#x27;</span>: chunks<br>        &#125;<br><br><span class="hljs-comment"># ç»¼åˆè¯„ä¼°</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-comment"># åŠ è½½æµ‹è¯•æ•°æ®</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;../Stage_2/xyj.txt&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        test_text = f.read()[:<span class="hljs-number">3000</span>]<br><br>    chunker = AdvancedChunker()<br>    evaluator = ChunkingEvaluator()<br><br>    strategies = [<br>        (<span class="hljs-string">&#x27;å›ºå®šé•¿åº¦&#x27;</span>, chunker.chunk_by_fixed_length, &#123;<span class="hljs-string">&#x27;chunk_size&#x27;</span>: <span class="hljs-number">200</span>, <span class="hljs-string">&#x27;overlap&#x27;</span>: <span class="hljs-number">20</span>&#125;),<br>        (<span class="hljs-string">&#x27;å›ºå®šé•¿åº¦(å¤§)&#x27;</span>, chunker.chunk_by_fixed_length, &#123;<span class="hljs-string">&#x27;chunk_size&#x27;</span>: <span class="hljs-number">300</span>, <span class="hljs-string">&#x27;overlap&#x27;</span>: <span class="hljs-number">30</span>&#125;),<br>        (<span class="hljs-string">&#x27;å¥å­çº§&#x27;</span>, chunker.chunk_by_sentences, &#123;&#125;),<br>        (<span class="hljs-string">&#x27;é€’å½’åˆ‡åˆ†&#x27;</span>, chunker.chunk_by_recursive, &#123;<span class="hljs-string">&#x27;chunk_size&#x27;</span>: <span class="hljs-number">300</span>, <span class="hljs-string">&#x27;overlap&#x27;</span>: <span class="hljs-number">30</span>&#125;)<br>    ]<br><br>    results = []<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">80</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;åˆ‡åˆ†ç­–ç•¥ç»¼åˆè¯„ä¼°&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">80</span>)<br><br>    <span class="hljs-keyword">for</span> name, func, params <span class="hljs-keyword">in</span> strategies:<br>        result = evaluator.evaluate_chunking_strategy(test_text, func, **params)<br>        results.append(result)<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\nã€<span class="hljs-subst">&#123;name&#125;</span>ã€‘&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  å—æ•°é‡: <span class="hljs-subst">&#123;result[<span class="hljs-string">&#x27;chunk_count&#x27;</span>]&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  è¯­ä¹‰è¿è´¯æ€§: <span class="hljs-subst">&#123;result[<span class="hljs-string">&#x27;coherence_score&#x27;</span>]:<span class="hljs-number">.3</span>f&#125;</span> (è¶Šé«˜è¶Šå¥½)&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  å®Œæ•´æ€§: <span class="hljs-subst">&#123;result[<span class="hljs-string">&#x27;completeness_score&#x27;</span>]:<span class="hljs-number">.3</span>f&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  å¹³å‡å—å¤§å°: <span class="hljs-subst">&#123;result[<span class="hljs-string">&#x27;avg_chunk_size&#x27;</span>]:<span class="hljs-number">.0</span>f&#125;</span> Â± <span class="hljs-subst">&#123;result[<span class="hljs-string">&#x27;std_chunk_size&#x27;</span>]:<span class="hljs-number">.0</span>f&#125;</span>&quot;</span>)<br><br>    <span class="hljs-comment"># ç”Ÿæˆå¯è§†åŒ–æŠ¥å‘Š</span><br>    fig, axes = plt.subplots(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, figsize=(<span class="hljs-number">12</span>, <span class="hljs-number">8</span>))<br><br>    <span class="hljs-comment"># ç­–ç•¥å¯¹æ¯”</span><br>    names = [r[<span class="hljs-string">&#x27;strategy&#x27;</span>].replace(<span class="hljs-string">&#x27;chunk_by_&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>).replace(<span class="hljs-string">&#x27;_&#x27;</span>, <span class="hljs-string">&#x27; &#x27;</span>) <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> results]<br>    coherence_scores = [r[<span class="hljs-string">&#x27;coherence_score&#x27;</span>] <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> results]<br>    completeness_scores = [r[<span class="hljs-string">&#x27;completeness_score&#x27;</span>] <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> results]<br><br>    axes[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>].bar(names, coherence_scores)<br>    axes[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>].set_title(<span class="hljs-string">&#x27;è¯­ä¹‰è¿è´¯æ€§å¯¹æ¯”&#x27;</span>)<br>    axes[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>].set_ylabel(<span class="hljs-string">&#x27;è¿è´¯æ€§åˆ†æ•°&#x27;</span>)<br>    axes[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>].tick_params(axis=<span class="hljs-string">&#x27;x&#x27;</span>, rotation=<span class="hljs-number">45</span>)<br><br>    axes[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>].bar(names, completeness_scores)<br>    axes[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>].set_title(<span class="hljs-string">&#x27;æ–‡æœ¬å®Œæ•´æ€§å¯¹æ¯”&#x27;</span>)<br>    axes[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>].set_ylabel(<span class="hljs-string">&#x27;å®Œæ•´æ€§åˆ†æ•°&#x27;</span>)<br>    axes[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>].tick_params(axis=<span class="hljs-string">&#x27;x&#x27;</span>, rotation=<span class="hljs-number">45</span>)<br><br>    chunk_counts = [r[<span class="hljs-string">&#x27;chunk_count&#x27;</span>] <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> results]<br>    axes[<span class="hljs-number">1</span>,<span class="hljs-number">0</span>].bar(names, chunk_counts)<br>    axes[<span class="hljs-number">1</span>,<span class="hljs-number">0</span>].set_title(<span class="hljs-string">&#x27;ç”Ÿæˆå—æ•°é‡å¯¹æ¯”&#x27;</span>)<br>    axes[<span class="hljs-number">1</span>,<span class="hljs-number">0</span>].set_ylabel(<span class="hljs-string">&#x27;å—æ•°é‡&#x27;</span>)<br><br>    avg_sizes = [r[<span class="hljs-string">&#x27;avg_chunk_size&#x27;</span>] <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> results]<br>    axes[<span class="hljs-number">1</span>,<span class="hljs-number">1</span>].bar(names, avg_sizes)<br>    axes[<span class="hljs-number">1</span>,<span class="hljs-number">1</span>].set_title(<span class="hljs-string">&#x27;å¹³å‡å—å¤§å°å¯¹æ¯”&#x27;</span>)<br>    axes[<span class="hljs-number">1</span>,<span class="hljs-number">1</span>].set_ylabel(<span class="hljs-string">&#x27;å­—ç¬¦æ•°&#x27;</span>)<br><br>    plt.tight_layout()<br>    plt.savefig(<span class="hljs-string">&#x27;chunking_evaluation.png&#x27;</span>, dpi=<span class="hljs-number">150</span>, bbox_inches=<span class="hljs-string">&#x27;tight&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nâœ… è¯„ä¼°å›¾è¡¨å·²ä¿å­˜ä¸º chunking_evaluation.png&quot;</span>)<br><br>    <span class="hljs-comment"># æ¨èç­–ç•¥</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">80</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç­–ç•¥æ¨è&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">80</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ğŸ“Œ é€šç”¨åœºæ™¯: é€’å½’åˆ‡åˆ†&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;   - å¹³è¡¡äº†è¯­ä¹‰è¿è´¯æ€§å’Œå®Œæ•´æ€§&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;   - è‡ªé€‚åº”ä¸åŒç±»å‹çš„æ–‡æ¡£ç»“æ„&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ğŸ“Œ ç®€å•æ–‡æ¡£: å›ºå®šé•¿åº¦(300å­—ç¬¦, 30é‡å )&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;   - é€Ÿåº¦å¿«ï¼Œå¯é¢„æµ‹&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;   - é€‚åˆæ—¥å¿—ã€ä»£ç ç­‰ç»“æ„åŒ–å†…å®¹&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ğŸ“Œ æ–‡å­¦/å­¦æœ¯æ–‡æœ¬: å¥å­çº§åˆ‡åˆ†&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;   - ä¿æŒå¥å­å®Œæ•´æ€§&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;   - é€‚åˆè¯—æ­Œã€è®ºæ–‡ç­‰éœ€è¦ä¿æŒè¯­ä¹‰å•å…ƒçš„å†…å®¹&quot;</span>)<br></code></pre></td></tr></table></figure><pre><code class="hljs">================================================================================åˆ‡åˆ†ç­–ç•¥ç»¼åˆè¯„ä¼°================================================================================ã€å›ºå®šé•¿åº¦ã€‘  å—æ•°é‡: 17  è¯­ä¹‰è¿è´¯æ€§: 0.772 (è¶Šé«˜è¶Šå¥½)  å®Œæ•´æ€§: 1.000  å¹³å‡å—å¤§å°: 195 Â± 19ã€å›ºå®šé•¿åº¦(å¤§)ã€‘  å—æ•°é‡: 11  è¯­ä¹‰è¿è´¯æ€§: 0.773 (è¶Šé«˜è¶Šå¥½)  å®Œæ•´æ€§: 0.767  å¹³å‡å—å¤§å°: 300 Â± 0ã€å¥å­çº§ã€‘  å—æ•°é‡: 11  è¯­ä¹‰è¿è´¯æ€§: 0.774 (è¶Šé«˜è¶Šå¥½)  å®Œæ•´æ€§: 0.723  å¹³å‡å—å¤§å°: 273 Â± 37ã€é€’å½’åˆ‡åˆ†ã€‘  å—æ•°é‡: 12  è¯­ä¹‰è¿è´¯æ€§: 0.804 (è¶Šé«˜è¶Šå¥½)  å®Œæ•´æ€§: 0.798  å¹³å‡å—å¤§å°: 269 Â± 27âœ… è¯„ä¼°å›¾è¡¨å·²ä¿å­˜ä¸º chunking_evaluation.png================================================================================ç­–ç•¥æ¨è================================================================================ğŸ“Œ é€šç”¨åœºæ™¯: é€’å½’åˆ‡åˆ†   - å¹³è¡¡äº†è¯­ä¹‰è¿è´¯æ€§å’Œå®Œæ•´æ€§   - è‡ªé€‚åº”ä¸åŒç±»å‹çš„æ–‡æ¡£ç»“æ„ğŸ“Œ ç®€å•æ–‡æ¡£: å›ºå®šé•¿åº¦(300å­—ç¬¦, 30é‡å )   - é€Ÿåº¦å¿«ï¼Œå¯é¢„æµ‹   - é€‚åˆæ—¥å¿—ã€ä»£ç ç­‰ç»“æ„åŒ–å†…å®¹ğŸ“Œ æ–‡å­¦/å­¦æœ¯æ–‡æœ¬: å¥å­çº§åˆ‡åˆ†   - ä¿æŒå¥å­å®Œæ•´æ€§   - é€‚åˆè¯—æ­Œã€è®ºæ–‡ç­‰éœ€è¦ä¿æŒè¯­ä¹‰å•å…ƒçš„å†…å®¹</code></pre><p><strong>æµ‹è¯•æ—¥æœŸ</strong>: 2025-12-05</p><h4 id="å›ºå®šé•¿åº¦åˆ‡åˆ†"><a href="#å›ºå®šé•¿åº¦åˆ‡åˆ†" class="headerlink" title="å›ºå®šé•¿åº¦åˆ‡åˆ†"></a>å›ºå®šé•¿åº¦åˆ‡åˆ†</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># é…ç½®å‚æ•°</span><br>chunk_size = <span class="hljs-number">200</span><br>overlap = <span class="hljs-number">20</span><br><br><span class="hljs-comment"># æµ‹è¯•ç»“æœ</span><br>å—æ•°é‡: <span class="hljs-number">17</span><br>å¹³å‡Tokenæ•°: <span class="hljs-number">195.0</span> Â± <span class="hljs-number">19</span><br>è¯­ä¹‰è¿è´¯æ€§åˆ†æ•°: <span class="hljs-number">0.772</span><br></code></pre></td></tr></table></figure><p><strong>è§‚å¯Ÿ</strong>:</p><ul><li>é‡å æ¯”ä¾‹20%æ—¶ï¼Œä¸Šä¸‹ä¸¢å¤±æƒ…å†µ: overlap ä¸º 40 æ—¶æ¯” 20 é«˜4.4%</li><li>æœ€ä¼˜overlapå€¼: 50 -&gt; 0.810</li></ul><h4 id="é€’å½’åˆ‡åˆ†"><a href="#é€’å½’åˆ‡åˆ†" class="headerlink" title="é€’å½’åˆ‡åˆ†"></a>é€’å½’åˆ‡åˆ†</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># é…ç½®å‚æ•°</span><br>chunk_size = <span class="hljs-number">300</span><br>overlap = <span class="hljs-number">30</span><br>separators = [<span class="hljs-string">&#x27;\n\n&#x27;</span>, <span class="hljs-string">&#x27;\n&#x27;</span>, <span class="hljs-string">&#x27;ã€‚&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>]<br><br><span class="hljs-comment"># æµ‹è¯•ç»“æœ</span><br>å—æ•°é‡: <span class="hljs-number">12</span><br>å¹³å‡Tokenæ•°: <span class="hljs-number">269.0</span> Â± <span class="hljs-number">27.0</span><br>è¯­ä¹‰è¿è´¯æ€§åˆ†æ•°: <span class="hljs-number">0.804</span><br></code></pre></td></tr></table></figure><p><strong>è§‚å¯Ÿ</strong>:</p><ul><li>é€’å½’åˆ‡åˆ† vs å›ºå®šé•¿åº¦çš„è¯­ä¹‰è¿è´¯æ€§æå‡: 4.4%</li><li>é€‚ç”¨åœºæ™¯:</li></ul><p>é€šç”¨åœºæ™¯: é€’å½’åˆ‡åˆ†</p><ul><li>å¹³è¡¡äº†è¯­ä¹‰è¿è´¯æ€§å’Œå®Œæ•´æ€§</li><li>è‡ªé€‚åº”ä¸åŒç±»å‹çš„æ–‡æ¡£ç»“æ„</li></ul><p>ç®€å•æ–‡æ¡£: å›ºå®šé•¿åº¦(300å­—ç¬¦, 30é‡å )</p><ul><li>é€Ÿåº¦å¿«ï¼Œå¯é¢„æµ‹</li><li>é€‚åˆæ—¥å¿—ã€ä»£ç ç­‰ç»“æ„åŒ–å†…å®¹</li></ul><p>æ–‡å­¦&#x2F;å­¦æœ¯æ–‡æœ¬: å¥å­çº§åˆ‡åˆ†</p><ul><li>ä¿æŒå¥å­å®Œæ•´æ€§</li><li>é€‚åˆè¯—æ­Œã€è®ºæ–‡ç­‰éœ€è¦ä¿æŒè¯­ä¹‰å•å…ƒçš„å†…å®¹</li></ul><h4 id="å¯¹æ¯”ç»“æœ"><a href="#å¯¹æ¯”ç»“æœ" class="headerlink" title="å¯¹æ¯”ç»“æœ"></a>å¯¹æ¯”ç»“æœ</h4><table><thead><tr><th>ç­–ç•¥</th><th>å—æ•°é‡</th><th>è¯­ä¹‰è¿è´¯æ€§</th><th>å®Œæ•´æ€§</th><th>æ¨èåº¦</th></tr></thead><tbody><tr><td>å›ºå®šé•¿åº¦</td><td>17</td><td>0.772</td><td>1.000</td><td>â­â­</td></tr><tr><td>å¥å­çº§</td><td>11</td><td>0.774</td><td>0.723</td><td>â­â­â­</td></tr><tr><td>é€’å½’åˆ‡åˆ†</td><td>12</td><td>0.804</td><td>0.798</td><td>â­â­â­â­â­</td></tr></tbody></table><h3 id="å®éªŒä¸€ç»ƒä¹ é¢˜"><a href="#å®éªŒä¸€ç»ƒä¹ é¢˜" class="headerlink" title="å®éªŒä¸€ç»ƒä¹ é¢˜"></a>å®éªŒä¸€ç»ƒä¹ é¢˜</h3><ol><li><strong>é‡å çª—å£ä¼˜åŒ–å®éªŒ</strong>ï¼šåˆ†åˆ«æµ‹è¯• overlap &#x3D; 0, 10, 20, 30, 40, 50ï¼Œæ‰¾å‡ºæœ€ä½³é‡å æ¯”ä¾‹</li><li><strong>æ··åˆç­–ç•¥å®éªŒ</strong>ï¼šå¯¹æ–‡æ¡£ä¸åŒéƒ¨åˆ†ä½¿ç”¨ä¸åŒåˆ‡åˆ†ç­–ç•¥ï¼ˆå¦‚æ ‡é¢˜ç”¨å¥å­çº§ï¼Œæ­£æ–‡ç”¨é€’å½’ï¼‰</li><li><strong>é¢†åŸŸç‰¹åŒ–å®éªŒ</strong>ï¼šå¯¹æ³•å¾‹æ–‡ä¹¦ã€åŒ»å­¦è®ºæ–‡ç­‰ç‰¹å®šé¢†åŸŸæ–‡æœ¬ï¼Œè®¾è®¡ä¸“ç”¨åˆ‡åˆ†ç­–ç•¥</li></ol><h3 id="å‘ç°ä¸æ€è€ƒ"><a href="#å‘ç°ä¸æ€è€ƒ" class="headerlink" title="å‘ç°ä¸æ€è€ƒ"></a>å‘ç°ä¸æ€è€ƒ</h3><p><strong>é—®é¢˜1</strong>: å½“æ–‡æ¡£ç»“æ„ä¸è§„å¾‹æ—¶ï¼Œå“ªç§ç­–ç•¥æœ€é²æ£’ï¼Ÿ</p><ul><li>ç­”æ¡ˆ: é€’å½’åˆ‡åˆ†</li><li>è¯æ®: é€šè¿‡å¤šçº§åˆ†éš”ç¬¦ï¼ˆæ®µè½â†’å¥å­â†’è¯è¯­ï¼‰è‡ªåŠ¨é€‚åº”ä¸è§„å¾‹ç»“æ„ï¼Œèƒ½åœ¨è‡ªç„¶è¾¹ç•Œå¤„åˆ‡åˆ†ï¼Œä¿æŒè¯­ä¹‰å®Œæ•´æ€§ï¼Œæœ€é€‚åˆæ··åˆæ ¼å¼æ–‡æ¡£</li></ul><p><strong>é—®é¢˜2</strong>: Overlapæ¯”ä¾‹å¯¹å¬å›ç‡çš„å½±å“ï¼Ÿ</p><ul><li>æµ‹è¯•äº†overlap &#x3D; 0, 10, 20, 30, 50</li><li>æœ€ä½³å€¼: 50</li><li>åŸå› åˆ†æ: é‡å  50 å­—ç¬¦ç¡®ä¿å…³é”®ä¿¡æ¯ä¸ä¼šåœ¨åˆ‡åˆ†å¤„ä¸¢å¤±,å‘é‡æ£€ç´¢æ—¶ï¼Œå³ä½¿éƒ¨åˆ†ä¿¡æ¯åœ¨è¾¹ç•Œå¤„ï¼Œä»æœ‰è¶³å¤Ÿä¸Šä¸‹æ–‡è¢«åŒ¹é…åˆ°</li></ul><p><strong>é—®é¢˜3</strong>: å¦‚ä½•é’ˆå¯¹ç‰¹å®šé¢†åŸŸä¼˜åŒ–åˆ‡åˆ†ï¼Ÿ</p><ul><li>æ³•å¾‹æ–‡æ¡£: æŒ‰æ¡æ¬¾&#x2F;ç« èŠ‚åˆ‡åˆ†ï¼Œä¿æŒæ¡æ¬¾å®Œæ•´æ€§ï¼Œè¯†åˆ«â€ç¬¬Xæ¡â€ã€â€ç¬¬Xæ¬¾â€ç­‰æ³•å¾‹æ ‡è®°</li><li>æŠ€æœ¯æ–‡æ¡£: ä»£ç å—ä¸æ–‡æœ¬åˆ†ç¦»ï¼ŒAPIæ–‡æ¡£æŒ‰æ–¹æ³•&#x2F;ç±»åˆ‡åˆ†ï¼Œä¿ç•™ä»£ç ä¸Šä¸‹æ–‡</li><li>è´¢åŠ¡æŠ¥è¡¨: è¡¨æ ¼ç»“æ„åŒ–åˆ‡åˆ†ï¼ŒæŒ‰ä¼šè®¡ç§‘ç›®&#x2F;æ—¶é—´å‘¨æœŸåˆ’åˆ†ï¼Œä¿ç•™è¡¨å¤´ä¸æ•°æ®å…³è”</li></ul><h2 id="å®éªŒäºŒï¼šæ£€ç´¢å‡†ç¡®åº¦ä¼˜åŒ–-Retrieval-Optimization"><a href="#å®éªŒäºŒï¼šæ£€ç´¢å‡†ç¡®åº¦ä¼˜åŒ–-Retrieval-Optimization" class="headerlink" title="å®éªŒäºŒï¼šæ£€ç´¢å‡†ç¡®åº¦ä¼˜åŒ– (Retrieval Optimization)"></a>å®éªŒäºŒï¼šæ£€ç´¢å‡†ç¡®åº¦ä¼˜åŒ– (Retrieval Optimization)</h2><h3 id="å®éªŒç›®æ ‡-1"><a href="#å®éªŒç›®æ ‡-1" class="headerlink" title="å®éªŒç›®æ ‡"></a>å®éªŒç›®æ ‡</h3><p>æŒæ¡æ··åˆæ£€ç´¢ã€é‡æ’åºç­‰å…ˆè¿›æŠ€æœ¯ï¼Œæ˜¾è‘—æå‡æ£€ç´¢è´¨é‡ã€‚</p><h3 id="ç†è®ºåŸºç¡€-1"><a href="#ç†è®ºåŸºç¡€-1" class="headerlink" title="ç†è®ºåŸºç¡€"></a>ç†è®ºåŸºç¡€</h3><h4 id="1-ä¼ ç»Ÿæ£€ç´¢-vs-è¯­ä¹‰æ£€ç´¢"><a href="#1-ä¼ ç»Ÿæ£€ç´¢-vs-è¯­ä¹‰æ£€ç´¢" class="headerlink" title="1. ä¼ ç»Ÿæ£€ç´¢ vs è¯­ä¹‰æ£€ç´¢"></a>1. ä¼ ç»Ÿæ£€ç´¢ vs è¯­ä¹‰æ£€ç´¢</h4><table><thead><tr><th>ç»´åº¦</th><th>å…³é”®è¯æ£€ç´¢ (BM25)</th><th>è¯­ä¹‰æ£€ç´¢ (Dense)</th><th>æ··åˆæ£€ç´¢</th></tr></thead><tbody><tr><td>åŸç†</td><td>TF-IDFç»Ÿè®¡</td><td>å‘é‡ç›¸ä¼¼åº¦</td><td>åŠ æƒèåˆ</td></tr><tr><td>ä¼˜ç‚¹</td><td>ç²¾ç¡®åŒ¹é…ã€é€Ÿåº¦å¿«</td><td>è¯­ä¹‰ç†è§£ã€é²æ£’æ€§å¥½</td><td>ç»¼åˆä¼˜åŠ¿</td></tr><tr><td>ç¼ºç‚¹</td><td>æ— æ³•ç†è§£è¯­ä¹‰</td><td>å¯èƒ½è¿‡åº¦æ³›åŒ–</td><td>å®ç°å¤æ‚</td></tr><tr><td>é€‚ç”¨</td><td>ç²¾ç¡®æŸ¥è¯¢ã€ä¸“ä¸šæœ¯è¯­</td><td>åŒä¹‰è¡¨è¾¾ã€è¯­ä¹‰ç†è§£</td><td>å¤æ‚æŸ¥è¯¢</td></tr></tbody></table><h4 id="2-é‡æ’åº-Reranking"><a href="#2-é‡æ’åº-Reranking" class="headerlink" title="2. é‡æ’åº (Reranking)"></a>2. é‡æ’åº (Reranking)</h4><p><strong>é—®é¢˜</strong>ï¼šTop-Kæ£€ç´¢å¯èƒ½åŒ…å«ä¸ç›¸å…³ç»“æœ<br><strong>è§£å†³</strong>ï¼šä½¿ç”¨æ›´å¼ºçš„æ¨¡å‹å¯¹åˆæ­¥ç»“æœé‡æ–°æ’åº</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">åˆå§‹æ£€ç´¢ (<span class="hljs-number">100</span>ä¸ªç»“æœ) â†’ é‡æ’åºæ¨¡å‹ â†’ <span class="hljs-attribute">Top</span>-<span class="hljs-number">10</span>æœ€ç»ˆç»“æœ<br></code></pre></td></tr></table></figure><h3 id="å®éªŒæ­¥éª¤-1"><a href="#å®éªŒæ­¥éª¤-1" class="headerlink" title="å®éªŒæ­¥éª¤"></a>å®éªŒæ­¥éª¤</h3><h4 id="Step-1-å®ç°æ··åˆæ£€ç´¢"><a href="#Step-1-å®ç°æ··åˆæ£€ç´¢" class="headerlink" title="Step 1: å®ç°æ··åˆæ£€ç´¢"></a>Step 1: å®ç°æ··åˆæ£€ç´¢</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> rank_bm25 <span class="hljs-keyword">import</span> BM25Okapi<br><span class="hljs-keyword">from</span> sentence_transformers <span class="hljs-keyword">import</span> SentenceTransformer<br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Tuple</span><br><span class="hljs-keyword">import</span> jieba<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">HybridRetriever</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;æ··åˆæ£€ç´¢å™¨ï¼šBM25 + è¯­ä¹‰æ£€ç´¢&quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, semantic_weight=<span class="hljs-number">0.7</span>, bm25_weight=<span class="hljs-number">0.3</span></span>):<br>        <span class="hljs-variable language_">self</span>.semantic_weight = semantic_weight<br>        <span class="hljs-variable language_">self</span>.bm25_weight = bm25_weight<br>        <span class="hljs-variable language_">self</span>.semantic_model = SentenceTransformer(<span class="hljs-string">&#x27;all-MiniLM-L6-v2&#x27;</span>)<br>        <span class="hljs-variable language_">self</span>.chunks = []<br>        <span class="hljs-variable language_">self</span>.chunk_embeddings = <span class="hljs-literal">None</span><br>        <span class="hljs-variable language_">self</span>.bm25 = <span class="hljs-literal">None</span><br>        <span class="hljs-variable language_">self</span>.tokenized_chunks = []<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">fit</span>(<span class="hljs-params">self, chunks: <span class="hljs-type">List</span>[Chunk]</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        æ„å»ºç´¢å¼•</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-variable language_">self</span>.chunks = chunks<br><br>        <span class="hljs-comment"># 1. è¯­ä¹‰ç´¢å¼•</span><br>        <span class="hljs-variable language_">self</span>.chunk_embeddings = <span class="hljs-variable language_">self</span>.semantic_model.encode([c.text <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> chunks])<br><br>        <span class="hljs-comment"># 2. BM25ç´¢å¼•</span><br>        tokenized_texts = []<br>        <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> chunks:<br>            <span class="hljs-comment"># ä¸­æ–‡åˆ†è¯</span><br>            tokens = <span class="hljs-built_in">list</span>(jieba.cut(chunk.text))<br>            tokenized_texts.append(tokens)<br><br>        <span class="hljs-variable language_">self</span>.tokenized_chunks = tokenized_texts<br>        <span class="hljs-variable language_">self</span>.bm25 = BM25Okapi(tokenized_texts)<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âœ… ç´¢å¼•æ„å»ºå®Œæˆ: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(chunks)&#125;</span> ä¸ªæ–‡æ¡£å—&quot;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">search</span>(<span class="hljs-params">self, query: <span class="hljs-built_in">str</span>, k: <span class="hljs-built_in">int</span> = <span class="hljs-number">5</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-type">Tuple</span>[<span class="hljs-built_in">float</span>, Chunk]]:<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        æ··åˆæ£€ç´¢</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-comment"># 1. è¯­ä¹‰æ£€ç´¢</span><br>        query_embedding = <span class="hljs-variable language_">self</span>.semantic_model.encode([query])[<span class="hljs-number">0</span>]<br>        semantic_similarities = np.dot(<span class="hljs-variable language_">self</span>.chunk_embeddings, query_embedding)<br>        semantic_similarities = (semantic_similarities + <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>  <span class="hljs-comment"># å½’ä¸€åŒ–åˆ°[0,1]</span><br><br>        <span class="hljs-comment"># 2. BM25æ£€ç´¢</span><br>        query_tokens = <span class="hljs-built_in">list</span>(jieba.cut(query))<br>        bm25_scores = <span class="hljs-variable language_">self</span>.bm25.get_scores(query_tokens)<br>        bm25_scores = (bm25_scores - np.<span class="hljs-built_in">min</span>(bm25_scores)) / (np.<span class="hljs-built_in">max</span>(bm25_scores) - np.<span class="hljs-built_in">min</span>(bm25_scores) + <span class="hljs-number">1e-8</span>)<br><br>        <span class="hljs-comment"># 3. åŠ æƒèåˆ</span><br>        hybrid_scores = (<br>            <span class="hljs-variable language_">self</span>.semantic_weight * semantic_similarities +<br>            <span class="hljs-variable language_">self</span>.bm25_weight * bm25_scores<br>        )<br><br>        <span class="hljs-comment"># 4. Top-K</span><br>        top_indices = np.argsort(hybrid_scores)[::-<span class="hljs-number">1</span>][:k]<br><br>        results = []<br>        <span class="hljs-keyword">for</span> idx <span class="hljs-keyword">in</span> top_indices:<br>            score = hybrid_scores[idx]<br>            results.append((score, <span class="hljs-variable language_">self</span>.chunks[idx]))<br><br>        <span class="hljs-keyword">return</span> results<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_query</span>(<span class="hljs-params">self, query: <span class="hljs-built_in">str</span>, k: <span class="hljs-built_in">int</span> = <span class="hljs-number">5</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;åˆ†ææ£€ç´¢è¿‡ç¨‹&quot;&quot;&quot;</span><br>        results = <span class="hljs-variable language_">self</span>.search(query, k)<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\nğŸ” æŸ¥è¯¢: <span class="hljs-subst">&#123;query&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">80</span>)<br><br>        <span class="hljs-comment"># è¯­ä¹‰æ£€ç´¢å¾—åˆ†</span><br>        query_embedding = <span class="hljs-variable language_">self</span>.semantic_model.encode([query])[<span class="hljs-number">0</span>]<br>        semantic_similarities = np.dot(<span class="hljs-variable language_">self</span>.chunk_embeddings, query_embedding)<br>        semantic_similarities = (semantic_similarities + <span class="hljs-number">1</span>) / <span class="hljs-number">2</span><br><br>        <span class="hljs-comment"># BM25æ£€ç´¢å¾—åˆ†</span><br>        query_tokens = <span class="hljs-built_in">list</span>(jieba.cut(query))<br>        bm25_scores = <span class="hljs-variable language_">self</span>.bm25.get_scores(query_tokens)<br>        bm25_scores = (bm25_scores - np.<span class="hljs-built_in">min</span>(bm25_scores)) / (np.<span class="hljs-built_in">max</span>(bm25_scores) - np.<span class="hljs-built_in">min</span>(bm25_scores) + <span class="hljs-number">1e-8</span>)<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;<span class="hljs-string">&#x27;æ’å&#x27;</span>:&lt;<span class="hljs-number">4</span>&#125;</span> <span class="hljs-subst">&#123;<span class="hljs-string">&#x27;æ··åˆå¾—åˆ†&#x27;</span>:&lt;<span class="hljs-number">10</span>&#125;</span> <span class="hljs-subst">&#123;<span class="hljs-string">&#x27;è¯­ä¹‰å¾—åˆ†&#x27;</span>:&lt;<span class="hljs-number">10</span>&#125;</span> <span class="hljs-subst">&#123;<span class="hljs-string">&#x27;BM25å¾—åˆ†&#x27;</span>:&lt;<span class="hljs-number">10</span>&#125;</span> <span class="hljs-subst">&#123;<span class="hljs-string">&#x27;æ–‡æœ¬é¢„è§ˆ&#x27;</span>&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;-&quot;</span> * <span class="hljs-number">80</span>)<br><br>        <span class="hljs-keyword">for</span> i, (score, chunk) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(results, <span class="hljs-number">1</span>):<br>            semantic_score = semantic_similarities[chunk.chunk_id]<br>            bm25_score = bm25_scores[chunk.chunk_id]<br>            preview = chunk.text[:<span class="hljs-number">50</span>] + <span class="hljs-string">&quot;...&quot;</span> <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(chunk.text) &gt; <span class="hljs-number">50</span> <span class="hljs-keyword">else</span> chunk.text<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;i:&lt;<span class="hljs-number">4</span>&#125;</span> <span class="hljs-subst">&#123;score:&lt;<span class="hljs-number">10.3</span>f&#125;</span> <span class="hljs-subst">&#123;semantic_score:&lt;<span class="hljs-number">10.3</span>f&#125;</span> <span class="hljs-subst">&#123;bm25_score:&lt;<span class="hljs-number">10.3</span>f&#125;</span> <span class="hljs-subst">&#123;preview&#125;</span>&quot;</span>)<br><br>        <span class="hljs-keyword">return</span> results<br><br><span class="hljs-comment"># æµ‹è¯•æ··åˆæ£€ç´¢</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-comment"># åŠ è½½æ•°æ®</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;../Stage_2/anthropic.txt&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        text = f.read()<br><br>    <span class="hljs-comment"># åˆ‡åˆ†</span><br>    chunker = AdvancedChunker()<br>    chunks = chunker.chunk_by_recursive(text, <span class="hljs-number">300</span>, <span class="hljs-number">30</span>)<br><br>    <span class="hljs-comment"># æ„å»ºæ··åˆæ£€ç´¢å™¨</span><br>    retriever = HybridRetriever(semantic_weight=<span class="hljs-number">0.7</span>, bm25_weight=<span class="hljs-number">0.3</span>)<br>    retriever.fit(chunks)<br><br>    <span class="hljs-comment"># æµ‹è¯•æŸ¥è¯¢</span><br>    test_queries = [<br>        <span class="hljs-string">&quot;Anthropicå…¬å¸çš„å‘å±•å†ç¨‹&quot;</span><br>    ]<br><br>    <span class="hljs-keyword">for</span> query <span class="hljs-keyword">in</span> test_queries:<br>        retriever.analyze_query(query, k=<span class="hljs-number">5</span>)<br>        <span class="hljs-built_in">print</span>()<br></code></pre></td></tr></table></figure><pre><code class="hljs">âœ… ç´¢å¼•æ„å»ºå®Œæˆ: 12 ä¸ªæ–‡æ¡£å—ğŸ” æŸ¥è¯¢: Anthropicå…¬å¸çš„å‘å±•å†ç¨‹================================================================================æ’å   æ··åˆå¾—åˆ†       è¯­ä¹‰å¾—åˆ†       BM25å¾—åˆ†     æ–‡æœ¬é¢„è§ˆ--------------------------------------------------------------------------------1    0.820      0.750      0.983      eçš„åˆ›ä½œï¼Œå¹¶å°†AIç”Ÿæˆçš„å†…å®¹æ— ç¼åœ°é›†æˆåˆ°ä»–ä»¬çš„é¡¹ç›®å’Œå·¥ä½œæµä¸­2024å¹´3æœˆ6æ—¥ï¼Œäºšé©¬é€Šå®£å¸ƒAnthr...2    0.802      0.717      1.000      Anthropicæ˜¯ç”±OpenAIå‰é«˜å±‚ä¸¹å¦®æ‹‰Â·é˜¿è«è¿ªï¼ˆDaniela Amodeiï¼‰å’Œè¾¾é‡Œå¥¥Â·é˜¿è«...3    0.796      0.783      0.826       Forumï¼‰ï¼Œè‡´åŠ›äºç¡®ä¿å®‰å…¨ã€è´Ÿè´£ä»»åœ°å¼€å‘å‰æ²¿äººå·¥æ™ºèƒ½æ¨¡å‹2023å¹´8æœˆ13æ—¥ï¼ŒéŸ©å›½æœ€å¤§ç”µä¿¡è¿è¥å•†...4    0.757      0.675      0.950      äººå·¦å³ï¼Œå¤§éƒ¨åˆ†æˆå‘˜æ›¾ç»å‚ä¸è¿‡GPT-2ã€GPT-3æ¨¡å‹çš„ç ”å‘åŒå¹´3æœˆ15æ—¥ï¼ŒAnthropicæ¨å‡ºèŠ...5    0.744      0.725      0.791      opicå‘å¸ƒäº†Claude 2.1ï¼Œæ‹¥æœ‰200Kçš„ä¸Šä¸‹æ–‡çª—å£åŒæœˆï¼Œæœ‰çŸ¥æƒ…äººå£«è¡¨ç¤ºï¼ŒAnthropic...</code></pre><h3 id="æ··åˆæ£€ç´¢å®éªŒ"><a href="#æ··åˆæ£€ç´¢å®éªŒ" class="headerlink" title="æ··åˆæ£€ç´¢å®éªŒ"></a>æ··åˆæ£€ç´¢å®éªŒ</h3><p><strong>æµ‹è¯•æ—¥æœŸ</strong>: 2025-12-05</p><h4 id="æƒé‡è°ƒä¼˜å®éªŒ"><a href="#æƒé‡è°ƒä¼˜å®éªŒ" class="headerlink" title="æƒé‡è°ƒä¼˜å®éªŒ"></a>æƒé‡è°ƒä¼˜å®éªŒ</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># æµ‹è¯•é…ç½®</span><br>semantic_weight = <span class="hljs-number">0.7</span><br>bm25_weight = <span class="hljs-number">0.3</span><br><br><span class="hljs-comment"># æ£€ç´¢ç»“æœåˆ†æ</span><br>æŸ¥è¯¢: <span class="hljs-string">&quot;Anthropicå…¬å¸å‘å±•å†ç¨‹&quot;</span><br>Top-<span class="hljs-number">5</span>ç»“æœ:<br><span class="hljs-number">1.</span> è¯­ä¹‰æ£€ç´¢å¾—åˆ†: <span class="hljs-number">0.750</span>, BM25å¾—åˆ†: <span class="hljs-number">0.983</span><br><span class="hljs-number">2.</span> è¯­ä¹‰æ£€ç´¢å¾—åˆ†: <span class="hljs-number">0.717</span>, BM25å¾—åˆ†: <span class="hljs-number">1.000</span><br><span class="hljs-number">3.</span> è¯­ä¹‰æ£€ç´¢å¾—åˆ†: <span class="hljs-number">0.783</span>, BM25å¾—åˆ†: <span class="hljs-number">0.826</span><br><span class="hljs-number">4.</span> è¯­ä¹‰æ£€ç´¢å¾—åˆ†: <span class="hljs-number">0.675</span>, BM25å¾—åˆ†: <span class="hljs-number">0.950</span><br><span class="hljs-number">5.</span> è¯­ä¹‰æ£€ç´¢å¾—åˆ†: <span class="hljs-number">0.725</span>, BM25å¾—åˆ†: <span class="hljs-number">0.791</span><br></code></pre></td></tr></table></figure><h4 id="ä¸åŒæƒé‡é…ç½®å¯¹æ¯”"><a href="#ä¸åŒæƒé‡é…ç½®å¯¹æ¯”" class="headerlink" title="ä¸åŒæƒé‡é…ç½®å¯¹æ¯”"></a>ä¸åŒæƒé‡é…ç½®å¯¹æ¯”</h4><ul><li>çº¯è¯­ä¹‰ï¼š(1.0, 0.0)</li><li>çº¯BM25ï¼š(0.0, 1.0)</li><li>æ··åˆæ¯”ä¾‹ï¼š(0.7, 0.3)ã€(0.5, 0.5)ã€(0.3, 0.7)</li></ul><table><thead><tr><th>æ¯”ä¾‹</th><th>æ··åˆå¾—åˆ†</th><th>è¯­ä¹‰å¾—åˆ†</th><th>BM25å¾—åˆ†</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>1.0, 0.0</td><td>0.783</td><td>0.783</td><td>0.826</td><td></td></tr><tr><td>0.0, 1.0</td><td>1.000</td><td>0.717</td><td>1.000</td><td></td></tr><tr><td>0.7, 0.3</td><td>0.670</td><td>0.750</td><td>0.983</td><td></td></tr><tr><td>0.5, 0.5</td><td>0.867</td><td>0.750</td><td>0.983</td><td></td></tr><tr><td>0.3, 0.7</td><td>0.915</td><td>0.717</td><td>1.000</td><td></td></tr></tbody></table><p><strong>æœ€ä½³é…ç½®</strong>: </p><ul><li>Alpha &#x3D; 1.0 (çº¯è¯­ä¹‰)ï¼Œ<br>åœºæ™¯ï¼šæ¨èç³»ç»Ÿã€FAQé—®ç­”ï¼ˆç”¨æˆ·æè¿°é—®é¢˜ï¼Œå¯»æ‰¾æ ‡å‡†ç­”æ¡ˆï¼‰ã€è·¨è¯­è¨€æœç´¢ã€‚<br>ä¾‹å­ï¼šâ€å¦‚ä½•è°ƒæ•´å¿ƒæƒ…ï¼Ÿâ€ -&gt; åŒ¹é…å¿ƒç†å¥åº·æ–‡æ¡£ã€‚</li><li>Alpha &#x3D; 0.0 (çº¯ BM25)ï¼Œ<br>åœºæ™¯ï¼šä»£ç æœç´¢ã€SKU&#x2F;é›¶ä»¶ç¼–å·æœç´¢ã€æ³•å¾‹æ–‡ä¹¦ä¸­çš„ç‰¹å®šæ¡æ¬¾æœç´¢ã€‚<br>ä¾‹å­ï¼šâ€func get_user_id()â€ -&gt; ç²¾ç¡®åŒ¹é…ä»£ç åº“ã€‚</li><li>Alpha &#x3D; 0.5 (å¹³è¡¡ï¼Œå¸¸ç”¨é»˜è®¤å€¼)ï¼Œ<br>åœºæ™¯ï¼šé€šç”¨çŸ¥è¯†åº“ã€RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰ç³»ç»Ÿã€‚<br>åŸç†ï¼šæ—¢æƒ³è¦åŒä¹‰è¯æ‰©å±•ï¼Œåˆæƒ³ç¡®ä¿å…³é”®è¯å°½å¯èƒ½å‡ºç°ã€‚</li><li>åå‘ BM25 (e.g., Semantic 0.3, BM25 0.7)ï¼Œ<br>åœºæ™¯ï¼šç”µå•†æœç´¢ã€‚ç”¨æˆ·æœ â€œè€å…‹ çº¢è‰² è·‘é‹â€ï¼Œé€šå¸¸å¸Œæœ›è¿™ä¸‰ä¸ªè¯éƒ½ä¸¥æ ¼åŒ¹é…ï¼Œè€Œä¸æ˜¯æ¨è â€œé˜¿è¿ªè¾¾æ–¯ çº¢è‰² è·‘é‹â€ï¼ˆè™½ç„¶è¯­ä¹‰ç›¸è¿‘ï¼Œä½†åœ¨ç”µå•†åœºæ™¯æ˜¯é”™è¯¯çš„ï¼‰ã€‚</li></ul><h4 id="Step-2-å®ç°é‡æ’åºæœºåˆ¶"><a href="#Step-2-å®ç°é‡æ’åºæœºåˆ¶" class="headerlink" title="Step 2: å®ç°é‡æ’åºæœºåˆ¶"></a>Step 2: å®ç°é‡æ’åºæœºåˆ¶</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> sentence_transformers <span class="hljs-keyword">import</span> SentenceTransformer, CrossEncoder<br><span class="hljs-keyword">from</span> sklearn.feature_extraction.text <span class="hljs-keyword">import</span> TfidfVectorizer<br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Tuple</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">RerankRetriever</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;å¸¦é‡æ’åºçš„æ£€ç´¢å™¨&quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, cross_encoder_model=<span class="hljs-string">&#x27;cross-encoder/ms-marco-MiniLM-L-6-v2&#x27;</span></span>):<br>        <span class="hljs-variable language_">self</span>.semantic_model = SentenceTransformer(<span class="hljs-string">&#x27;all-MiniLM-L6-v2&#x27;</span>)<br>        <span class="hljs-variable language_">self</span>.rerank_model = CrossEncoder(cross_encoder_model)<br>        <span class="hljs-variable language_">self</span>.chunks = []<br>        <span class="hljs-variable language_">self</span>.chunk_embeddings = <span class="hljs-literal">None</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">fit</span>(<span class="hljs-params">self, chunks: <span class="hljs-type">List</span>[Chunk]</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;æ„å»ºç´¢å¼•&quot;&quot;&quot;</span><br>        <span class="hljs-variable language_">self</span>.chunks = chunks<br>        <span class="hljs-variable language_">self</span>.chunk_embeddings = <span class="hljs-variable language_">self</span>.semantic_model.encode([c.text <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> chunks])<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âœ… ç´¢å¼•æ„å»ºå®Œæˆ: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(chunks)&#125;</span> ä¸ªæ–‡æ¡£å—&quot;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">search</span>(<span class="hljs-params">self, query: <span class="hljs-built_in">str</span>, initial_k: <span class="hljs-built_in">int</span> = <span class="hljs-number">50</span>, final_k: <span class="hljs-built_in">int</span> = <span class="hljs-number">5</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-type">Tuple</span>[<span class="hljs-built_in">float</span>, Chunk]]:<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        ä¸¤é˜¶æ®µæ£€ç´¢ï¼šåˆæ­¥æ£€ç´¢ + é‡æ’åº</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-comment"># é˜¶æ®µ1: åˆæ­¥è¯­ä¹‰æ£€ç´¢</span><br>        query_embedding = <span class="hljs-variable language_">self</span>.semantic_model.encode([query])[<span class="hljs-number">0</span>]<br>        similarities = np.dot(<span class="hljs-variable language_">self</span>.chunk_embeddings, query_embedding)<br>        top_indices = np.argsort(similarities)[::-<span class="hljs-number">1</span>][:initial_k]<br><br>        <span class="hljs-comment"># å‡†å¤‡é‡æ’åºçš„query-document pairs</span><br>        candidate_pairs = [(query, <span class="hljs-variable language_">self</span>.chunks[idx].text) <span class="hljs-keyword">for</span> idx <span class="hljs-keyword">in</span> top_indices]<br><br>        <span class="hljs-comment"># é˜¶æ®µ2: ä½¿ç”¨æ›´å¼ºçš„æ¨¡å‹é‡æ’åº</span><br>        rerank_scores = <span class="hljs-variable language_">self</span>.rerank_model.predict(candidate_pairs)<br><br>        <span class="hljs-comment"># è·å–æœ€ç»ˆTop-K</span><br>        reranked_indices = np.argsort(rerank_scores)[::-<span class="hljs-number">1</span>][:final_k]<br><br>        results = []<br>        <span class="hljs-keyword">for</span> idx <span class="hljs-keyword">in</span> reranked_indices:<br>            original_idx = top_indices[idx]<br>            score = rerank_scores[idx]<br>            results.append((score, <span class="hljs-variable language_">self</span>.chunks[original_idx]))<br><br>        <span class="hljs-keyword">return</span> results<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">search_with_ablation</span>(<span class="hljs-params">self, query: <span class="hljs-built_in">str</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;å¯¹æ¯”æœ‰æ— é‡æ’åºçš„æ•ˆæœ&quot;&quot;&quot;</span><br>        <span class="hljs-comment"># æ— é‡æ’åº</span><br>        query_embedding = <span class="hljs-variable language_">self</span>.semantic_model.encode([query])[<span class="hljs-number">0</span>]<br>        similarities = np.dot(<span class="hljs-variable language_">self</span>.chunk_embeddings, query_embedding)<br>        initial_top5 = np.argsort(similarities)[::-<span class="hljs-number">1</span>][:<span class="hljs-number">5</span>]<br><br>        <span class="hljs-comment"># æœ‰é‡æ’åº</span><br>        results = <span class="hljs-variable language_">self</span>.search(query, initial_k=<span class="hljs-number">20</span>, final_k=<span class="hljs-number">5</span>)<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\nğŸ” æŸ¥è¯¢: <span class="hljs-subst">&#123;query&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">80</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ã€ä»…è¯­ä¹‰æ£€ç´¢ Top-5ã€‘&quot;</span>)<br>        <span class="hljs-keyword">for</span> i, idx <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(initial_top5, <span class="hljs-number">1</span>):<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;i&#125;</span>. <span class="hljs-subst">&#123;self.chunks[idx].text[:<span class="hljs-number">80</span>]&#125;</span>...&quot;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   ç›¸ä¼¼åº¦: <span class="hljs-subst">&#123;similarities[idx]:<span class="hljs-number">.3</span>f&#125;</span>&quot;</span>)<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nã€æ··åˆæ£€ç´¢ + é‡æ’åº Top-5ã€‘&quot;</span>)<br>        <span class="hljs-keyword">for</span> i, (score, chunk) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(results, <span class="hljs-number">1</span>):<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;i&#125;</span>. <span class="hljs-subst">&#123;chunk.text[:<span class="hljs-number">80</span>]&#125;</span>...&quot;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   é‡æ’åºå¾—åˆ†: <span class="hljs-subst">&#123;score:<span class="hljs-number">.3</span>f&#125;</span>&quot;</span>)<br><br>        <span class="hljs-keyword">return</span> results<br><br><span class="hljs-comment"># æµ‹è¯•é‡æ’åº</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-comment"># åŠ è½½ã€Šçº¢æ¥¼æ¢¦ã€‹æ–‡æœ¬ï¼ˆæ›´å¤§çš„æ•°æ®é›†ï¼‰</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;../Stage_2/hlm.txt&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        text = f.read()[:<span class="hljs-number">50000</span>]  <span class="hljs-comment"># å–å‰5ä¸‡å­—ç¬¦æµ‹è¯•</span><br><br>    chunker = AdvancedChunker()<br>    chunks = chunker.chunk_by_recursive(text, <span class="hljs-number">300</span>, <span class="hljs-number">30</span>)<br><br>    retriever = RerankRetriever()<br>    retriever.fit(chunks)<br><br>    <span class="hljs-comment"># æµ‹è¯•æŸ¥è¯¢</span><br>    test_queries = [<br>        <span class="hljs-string">&quot;è´¾å®ç‰å’Œæ—é»›ç‰çš„å…³ç³»&quot;</span>,<br>        <span class="hljs-string">&quot;è–›å®é’—çš„æ€§æ ¼ç‰¹ç‚¹&quot;</span>,<br>        <span class="hljs-string">&quot;çº¢æ¥¼æ¢¦çš„ä¸»é¢˜æ€æƒ³&quot;</span><br>    ]<br><br>    <span class="hljs-keyword">for</span> query <span class="hljs-keyword">in</span> test_queries:<br>        retriever.search_with_ablation(query)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">80</span> + <span class="hljs-string">&quot;\n&quot;</span>)<br></code></pre></td></tr></table></figure><pre><code class="hljs">âœ… ç´¢å¼•æ„å»ºå®Œæˆ: 195 ä¸ªæ–‡æ¡£å—ğŸ” æŸ¥è¯¢: è´¾å®ç‰å’Œæ—é»›ç‰çš„å…³ç³»================================================================================ã€ä»…è¯­ä¹‰æ£€ç´¢ Top-5ã€‘1. å¦æ¢äº†å››ä¸ªçœ‰ç›®ç§€æ´åä¸ƒå…«å²çš„å°å®ä¸Šæ¥æŠ¬ç€è½¿å­ï¼Œä¼—å©†å­æ­¥ä¸‹è·Ÿéšè‡³ä¸€å‚èŠ±é—¨å‰è½ä¸‹ï¼Œä¼—å°å®ä¿±è‚ƒç„¶é€€å‡ºï¼Œä¼—å©†å­ä¸Šå‰æ‰“èµ·è½¿å¸˜ï¼Œæ‰¶é»›ç‰ä¸‹äº†è½¿é»›ç‰æ‰¶ç€å©†å­çš„æ‰‹ï¼Œè¿›äº†å‚èŠ±é—¨ä¸¤è¾¹...   ç›¸ä¼¼åº¦: 0.4912. ......ã€æ··åˆæ£€ç´¢ + é‡æ’åº Top-5ã€‘1. ï¼Œæ¸¸è§ˆå¤©ä¸‹èƒœè¿¹é‚£æ—¥å¶åˆæ¸¸è‡³ç»´æ‰¬åœ°æ–¹ï¼Œé—»å¾—ä»Šå¹´ç›æ”¿ç‚¹çš„æ˜¯æ—å¦‚æµ·è¿™æ—å¦‚æµ·ï¼Œå§“æ—ï¼Œåæµ·ï¼Œè¡¨å­—å¦‚æµ·ï¼Œä¹ƒæ˜¯å‰ç§‘çš„æ¢èŠ±ï¼Œä»Šå·²å‡å…°å°å¯ºå¤§å¤«æœ¬è´¯å§‘è‹äººæ°ï¼Œä»Šé’¦ç‚¹ä¸ºå·¡ç›å¾¡å²ï¼Œåˆ°ä»»...   é‡æ’åºå¾—åˆ†: 8.5312. ......================================================================================</code></pre><p>   çœç•¥</p><pre><code class="hljs">================================================================================ğŸ” æŸ¥è¯¢: çº¢æ¥¼æ¢¦çš„ä¸»é¢˜æ€æƒ³================================================================================ã€ä»…è¯­ä¹‰æ£€ç´¢ Top-5ã€‘1. ç‰æºæ‰‹åŒè¡Œå°¤æ°ç­‰é€è‡³å¤§å…å‰ï¼Œè§ç¯ç«è¾‰ç…Œï¼Œä¼—å°å®ä»¬éƒ½åœ¨ä¸¹å¢€ä¾ç«‹é‚£ç„¦å¤§åˆæƒè´¾çä¸åœ¨å®¶ï¼Œå› è¶ç€é…’å…´ï¼Œå…ˆéª‚å¤§æ€»ç®¡èµ–äºŒï¼Œè¯´ä»–â€œä¸å…¬é“ï¼æ¬ºè½¯æ€•ç¡¬ï¼æœ‰å¥½å·®ä½¿ï¼Œæ´¾äº†åˆ«äººï¼›è¿™æ ·é»‘...   ç›¸ä¼¼åº¦: 0.5012. ......ã€æ··åˆæ£€ç´¢ + é‡æ’åº Top-5ã€‘1. ä¸»è¦äººç‰©çš„æ„Ÿæƒ…çº è‘›ï¼Œæå†™äº†å¤§è§‚å›­å†…å¤–ä¸€ç³»åˆ—é’å¹´ç”·å¥³çš„çˆ±æƒ…æ•…äº‹åŒæ—¶ï¼Œé€šè¿‡å¯¹è¿™äº›çˆ±æƒ…æ‚²å‰§äº§ç”Ÿçš„ç¤¾ä¼šç¯å¢ƒæç»˜ï¼Œç‰µæ¶‰åˆ°å°å»ºç¤¾ä¼šæ”¿æ²»æ³•å¾‹ã€å®—æ³•ã€å¦‡å¥³ã€é“å¾·ã€å©šå§»ç­‰æ–¹é¢çš„é—®...   é‡æ’åºå¾—åˆ†: 8.5982. ......================================================================================</code></pre><h4 id="Step-3-æ£€ç´¢è´¨é‡è¯„ä¼°"><a href="#Step-3-æ£€ç´¢è´¨é‡è¯„ä¼°" class="headerlink" title="Step 3: æ£€ç´¢è´¨é‡è¯„ä¼°"></a>Step 3: æ£€ç´¢è´¨é‡è¯„ä¼°</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict<br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Dict</span>, <span class="hljs-type">Set</span><br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Tuple</span><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> sentence_transformers <span class="hljs-keyword">import</span> SentenceTransformer<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Chunk</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, chunk_id: <span class="hljs-built_in">int</span>, text: <span class="hljs-built_in">str</span></span>):<br>        <span class="hljs-variable language_">self</span>.chunk_id = chunk_id<br>        <span class="hljs-variable language_">self</span>.text = text<br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__repr__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;Chunk(id=<span class="hljs-subst">&#123;self.chunk_id&#125;</span>, text=<span class="hljs-subst">&#123;self.text[:<span class="hljs-number">30</span>]&#125;</span>...)&quot;</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleSemanticRetriever</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    çº¯è¯­ä¹‰æ£€ç´¢å™¨</span><br><span class="hljs-string">    åŸºäº SentenceTransformer ç”Ÿæˆå‘é‡å¹¶è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, model_name: <span class="hljs-built_in">str</span> = <span class="hljs-string">&#x27;all-MiniLM-L6-v2&#x27;</span></span>):<br>        <span class="hljs-comment"># åˆå§‹åŒ–å‘é‡æ¨¡å‹</span><br>        <span class="hljs-variable language_">self</span>.semantic_model = SentenceTransformer(model_name)<br>        <span class="hljs-variable language_">self</span>.chunks: <span class="hljs-type">List</span>[Chunk] = []<br>        <span class="hljs-variable language_">self</span>.chunk_embeddings = <span class="hljs-literal">None</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">fit</span>(<span class="hljs-params">self, chunks: <span class="hljs-type">List</span>[Chunk]</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        æ„å»ºç´¢å¼•ï¼šå°†æ‰€æœ‰æ–‡æ¡£å—è½¬æ¢ä¸ºå‘é‡</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-variable language_">self</span>.chunks = chunks<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> chunks:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;âš ï¸ è­¦å‘Š: æ–‡æ¡£å—åˆ—è¡¨ä¸ºç©º&quot;</span>)<br>            <span class="hljs-keyword">return</span><br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ğŸ”„ æ­£åœ¨ç”Ÿæˆè¯­ä¹‰å‘é‡ç´¢å¼•...&quot;</span>)<br>        <span class="hljs-comment"># encode è¿”å› numpy arrayï¼Œé»˜è®¤ normalize_embeddings=False</span><br>        <span class="hljs-comment"># å¦‚æœéœ€è¦ä½™å¼¦ç›¸ä¼¼åº¦ï¼Œå»ºè®® normalize_embeddings=True æˆ–è€…åœ¨ search æ—¶å½’ä¸€åŒ–</span><br>        <span class="hljs-comment"># è¿™é‡Œä½¿ç”¨ all-MiniLM-L6-v2ï¼Œå®ƒé€šå¸¸é…åˆä½™å¼¦ç›¸ä¼¼åº¦ä½¿ç”¨</span><br>        <span class="hljs-variable language_">self</span>.chunk_embeddings = <span class="hljs-variable language_">self</span>.semantic_model.encode(<br>            [c.text <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> chunks], <br>            show_progress_bar=<span class="hljs-literal">True</span>,<br>            convert_to_numpy=<span class="hljs-literal">True</span>,<br>            normalize_embeddings=<span class="hljs-literal">True</span> <span class="hljs-comment"># å½’ä¸€åŒ–åï¼Œç‚¹ç§¯ç­‰åŒäºä½™å¼¦ç›¸ä¼¼åº¦</span><br>        )<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âœ… è¯­ä¹‰ç´¢å¼•æ„å»ºå®Œæˆ: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(chunks)&#125;</span> ä¸ªæ–‡æ¡£å—&quot;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">search</span>(<span class="hljs-params">self, query: <span class="hljs-built_in">str</span>, k: <span class="hljs-built_in">int</span> = <span class="hljs-number">5</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-type">Tuple</span>[<span class="hljs-built_in">float</span>, Chunk]]:<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        æ£€ç´¢æœ€ç›¸ä¼¼çš„æ–‡æ¡£å—</span><br><span class="hljs-string">        è¿”å›: List[(score, Chunk)]</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-variable language_">self</span>.chunks:<br>            <span class="hljs-keyword">return</span> []<br><br>        <span class="hljs-comment"># 1. ç”ŸæˆæŸ¥è¯¢å‘é‡ (åŒæ ·è¿›è¡Œå½’ä¸€åŒ–)</span><br>        query_embedding = <span class="hljs-variable language_">self</span>.semantic_model.encode(<br>            [query], <br>            convert_to_numpy=<span class="hljs-literal">True</span>, <br>            normalize_embeddings=<span class="hljs-literal">True</span><br>        )[<span class="hljs-number">0</span>]<br><br>        <span class="hljs-comment"># 2. è®¡ç®—ç›¸ä¼¼åº¦ (å½’ä¸€åŒ–å‘é‡çš„ç‚¹ç§¯ = ä½™å¼¦ç›¸ä¼¼åº¦)</span><br>        <span class="hljs-comment"># scores shape: (num_chunks,)</span><br>        scores = np.dot(<span class="hljs-variable language_">self</span>.chunk_embeddings, query_embedding)<br><br>        <span class="hljs-comment"># 3. è·å– Top-K ç´¢å¼•</span><br>        <span class="hljs-comment"># np.argsort ä»å°åˆ°å¤§æ’åºï¼Œ[::-1] åè½¬ä¸ºä»å¤§åˆ°å°</span><br>        top_k_indices = np.argsort(scores)[::-<span class="hljs-number">1</span>][:k]<br><br>        <span class="hljs-comment"># 4. ç»„è£…ç»“æœ</span><br>        results = []<br>        <span class="hljs-keyword">for</span> idx <span class="hljs-keyword">in</span> top_k_indices:<br>            results.append((<span class="hljs-built_in">float</span>(scores[idx]), <span class="hljs-variable language_">self</span>.chunks[idx]))<br><br>        <span class="hljs-keyword">return</span> results<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">RetrievalEvaluator</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;æ£€ç´¢è´¨é‡è¯„ä¼°å™¨&quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-variable language_">self</span>.relevance_judgments = &#123;&#125;  <span class="hljs-comment"># æŸ¥è¯¢ -&gt; ç›¸å…³æ–‡æ¡£IDé›†åˆ</span><br>        <span class="hljs-variable language_">self</span>.retrieval_results = defaultdict(<span class="hljs-built_in">list</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_relevance_judgment</span>(<span class="hljs-params">self, query: <span class="hljs-built_in">str</span>, relevant_chunk_ids: <span class="hljs-type">Set</span>[<span class="hljs-built_in">int</span>]</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;æ·»åŠ äººå·¥ç›¸å…³æ€§æ ‡æ³¨&quot;&quot;&quot;</span><br>        <span class="hljs-variable language_">self</span>.relevance_judgments[query] = relevant_chunk_ids<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">evaluate_retrieval</span>(<span class="hljs-params">self, query: <span class="hljs-built_in">str</span>, retrieved_chunks: <span class="hljs-type">List</span>[Chunk], k: <span class="hljs-built_in">int</span> = <span class="hljs-number">10</span></span>) -&gt; <span class="hljs-type">Dict</span>:<br>        <span class="hljs-string">&quot;&quot;&quot;è¯„ä¼°æ£€ç´¢æ•ˆæœ&quot;&quot;&quot;</span><br>        retrieved_ids = &#123;chunk.chunk_id <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> retrieved_chunks[:k]&#125;<br>        relevant_ids = <span class="hljs-variable language_">self</span>.relevance_judgments.get(query, <span class="hljs-built_in">set</span>())<br><br>        <span class="hljs-comment"># Precision@k: æ£€ç´¢ç»“æœä¸­ç›¸å…³æ–‡æ¡£çš„æ¯”ä¾‹</span><br>        <span class="hljs-keyword">if</span> k == <span class="hljs-number">0</span>:<br>            precision_k = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">else</span>:<br>            precision_k = <span class="hljs-built_in">len</span>(retrieved_ids &amp; relevant_ids) / k<br><br>        <span class="hljs-comment"># Recall@k: æ£€ç´¢å‡ºçš„ç›¸å…³æ–‡æ¡£å æ‰€æœ‰ç›¸å…³æ–‡æ¡£çš„æ¯”ä¾‹</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(relevant_ids) == <span class="hljs-number">0</span>:<br>            recall_k = <span class="hljs-number">1.0</span><br>        <span class="hljs-keyword">else</span>:<br>            recall_k = <span class="hljs-built_in">len</span>(retrieved_ids &amp; relevant_ids) / <span class="hljs-built_in">len</span>(relevant_ids)<br><br>        <span class="hljs-comment"># F1@k</span><br>        <span class="hljs-keyword">if</span> precision_k + recall_k == <span class="hljs-number">0</span>:<br>            f1_k = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">else</span>:<br>            f1_k = <span class="hljs-number">2</span> * precision_k * recall_k / (precision_k + recall_k)<br><br>        <span class="hljs-comment"># Average Precision (AP)</span><br>        ap = <span class="hljs-variable language_">self</span>._compute_ap(retrieved_chunks, relevant_ids, k)<br><br>        <span class="hljs-keyword">return</span> &#123;<br>            <span class="hljs-string">&#x27;precision@k&#x27;</span>: precision_k,<br>            <span class="hljs-string">&#x27;recall@k&#x27;</span>: recall_k,<br>            <span class="hljs-string">&#x27;f1@k&#x27;</span>: f1_k,<br>            <span class="hljs-string">&#x27;ap&#x27;</span>: ap<br>        &#125;<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_compute_ap</span>(<span class="hljs-params">self, retrieved_chunks: <span class="hljs-type">List</span>[Chunk], relevant_ids: <span class="hljs-type">Set</span>[<span class="hljs-built_in">int</span>], k: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">float</span>:<br>        <span class="hljs-string">&quot;&quot;&quot;è®¡ç®—Average Precision&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> relevant_ids <span class="hljs-keyword">or</span> k == <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0.0</span><br><br>        precision_sum = <span class="hljs-number">0.0</span><br>        relevant_retrieved = <span class="hljs-number">0</span><br><br>        <span class="hljs-keyword">for</span> i, chunk <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(retrieved_chunks[:k]):<br>            <span class="hljs-keyword">if</span> chunk.chunk_id <span class="hljs-keyword">in</span> relevant_ids:<br>                relevant_retrieved += <span class="hljs-number">1</span><br>                precision_at_i = relevant_retrieved / (i + <span class="hljs-number">1</span>)<br>                precision_sum += precision_at_i<br><br>        <span class="hljs-keyword">return</span> precision_sum / <span class="hljs-built_in">len</span>(relevant_ids)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">compare_strategies</span>(<span class="hljs-params">self, queries: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>], retrievers: <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">callable</span>]</span>) -&gt; <span class="hljs-type">Dict</span>:<br>        <span class="hljs-string">&quot;&quot;&quot;å¯¹æ¯”ä¸åŒæ£€ç´¢ç­–ç•¥&quot;&quot;&quot;</span><br>        results = defaultdict(<span class="hljs-built_in">dict</span>)<br><br>        <span class="hljs-keyword">for</span> query <span class="hljs-keyword">in</span> queries:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\nè¯„ä¼°æŸ¥è¯¢: <span class="hljs-subst">&#123;query&#125;</span>&quot;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;-&quot;</span> * <span class="hljs-number">60</span>)<br><br>            <span class="hljs-keyword">for</span> strategy_name, retriever_func <span class="hljs-keyword">in</span> retrievers.items():<br>                retrieved = retriever_func(query)<br>                metrics = <span class="hljs-variable language_">self</span>.evaluate_retrieval(query, retrieved, k=<span class="hljs-number">5</span>)<br>                results[strategy_name][query] = metrics<br><br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;strategy_name&#125;</span>:&quot;</span>)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  Precision@5: <span class="hljs-subst">&#123;metrics[<span class="hljs-string">&#x27;precision@k&#x27;</span>]:<span class="hljs-number">.3</span>f&#125;</span>&quot;</span>)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  Recall@5: <span class="hljs-subst">&#123;metrics[<span class="hljs-string">&#x27;recall@k&#x27;</span>]:<span class="hljs-number">.3</span>f&#125;</span>&quot;</span>)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  F1@5: <span class="hljs-subst">&#123;metrics[<span class="hljs-string">&#x27;f1@k&#x27;</span>]:<span class="hljs-number">.3</span>f&#125;</span>&quot;</span>)<br><br>        <span class="hljs-keyword">return</span> results<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">plot_comparison</span>(<span class="hljs-params">self, results: <span class="hljs-type">Dict</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;å¯è§†åŒ–å¯¹æ¯”ç»“æœ&quot;&quot;&quot;</span><br>        strategies = <span class="hljs-built_in">list</span>(results.keys())<br>        metrics = [<span class="hljs-string">&#x27;precision@k&#x27;</span>, <span class="hljs-string">&#x27;recall@k&#x27;</span>, <span class="hljs-string">&#x27;f1@k&#x27;</span>]<br><br>        fig, axes = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, figsize=(<span class="hljs-number">15</span>, <span class="hljs-number">5</span>))<br><br>        <span class="hljs-keyword">for</span> i, metric <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(metrics):<br>            scores = []<br>            <span class="hljs-keyword">for</span> strategy <span class="hljs-keyword">in</span> strategies:<br>                <span class="hljs-comment"># è®¡ç®—æ‰€æœ‰æŸ¥è¯¢çš„å¹³å‡åˆ†æ•°</span><br>                values = [results[strategy][q][metric] <span class="hljs-keyword">for</span> q <span class="hljs-keyword">in</span> results[strategy].keys()]<br>                scores.append(np.mean(values))<br><br>            axes[i].bar(strategies, scores)<br>            axes[i].set_title(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;metric.upper()&#125;</span> å¯¹æ¯”&#x27;</span>)<br>            axes[i].set_ylabel(<span class="hljs-string">&#x27;åˆ†æ•°&#x27;</span>)<br>            axes[i].tick_params(axis=<span class="hljs-string">&#x27;x&#x27;</span>, rotation=<span class="hljs-number">45</span>)<br><br>        plt.tight_layout()<br>        plt.savefig(<span class="hljs-string">&#x27;retrieval_comparison.png&#x27;</span>, dpi=<span class="hljs-number">150</span>, bbox_inches=<span class="hljs-string">&#x27;tight&#x27;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;âœ… å¯¹æ¯”å›¾è¡¨å·²ä¿å­˜ä¸º retrieval_comparison.png&quot;</span>)<br><br><span class="hljs-comment"># è¯„ä¼°å®ä¾‹</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-comment"># å‡†å¤‡æµ‹è¯•æ•°æ®</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;../Stage_2/anthropic.txt&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        text = f.read()<br><br>    chunker = AdvancedChunker()<br>    chunks = chunker.chunk_by_recursive(text, <span class="hljs-number">300</span>, <span class="hljs-number">30</span>)<br><br>    <span class="hljs-comment"># æ„å»ºä¸åŒæ£€ç´¢å™¨</span><br>    semantic_retriever = SimpleSemanticRetriever()<br>    semantic_retriever.fit(chunks)<br><br>    hybrid_retriever = HybridRetriever()<br>    hybrid_retriever.fit(chunks)<br><br>    <span class="hljs-comment"># è¯„ä¼°å™¨</span><br>    evaluator = RetrievalEvaluator()<br><br>    <span class="hljs-comment"># å‡†å¤‡æŸ¥è¯¢å’Œæ ‡æ³¨ï¼ˆè¿™é‡Œç”¨å…³é”®è¯åŒ¹é…æ¨¡æ‹Ÿäººå·¥æ ‡æ³¨ï¼‰</span><br>    test_queries_config = &#123;<br>    <span class="hljs-string">&quot;Anthropicå…¬å¸æˆç«‹æ—¶é—´&quot;</span>: [<span class="hljs-string">&quot;anthropic&quot;</span>, <span class="hljs-string">&quot;æˆç«‹&quot;</span>, <span class="hljs-string">&quot;æ—¶é—´&quot;</span>],<br>    <span class="hljs-string">&quot;Claudeæ¨¡å‹ç‰¹ç‚¹&quot;</span>: [<span class="hljs-string">&quot;claude&quot;</span>, <span class="hljs-string">&quot;ç‰¹ç‚¹&quot;</span>, <span class="hljs-string">&quot;æ¨¡å‹&quot;</span>],<br>    <span class="hljs-string">&quot;AIå®‰å…¨ç ”ç©¶&quot;</span>: [<span class="hljs-string">&quot;å®‰å…¨&quot;</span>, <span class="hljs-string">&quot;safety&quot;</span>, <span class="hljs-string">&quot;research&quot;</span>],<br>    <span class="hljs-string">&quot;èèµ„è½®æ¬¡&quot;</span>: [<span class="hljs-string">&quot;èèµ„&quot;</span>, <span class="hljs-string">&quot;funding&quot;</span>, <span class="hljs-string">&quot;investment&quot;</span>],<br>    <span class="hljs-string">&quot;åˆ›å§‹äººä¿¡æ¯&quot;</span>: [<span class="hljs-string">&quot;åˆ›å§‹äºº&quot;</span>, <span class="hljs-string">&quot;founder&quot;</span>, <span class="hljs-string">&quot;ceo&quot;</span>, <span class="hljs-string">&quot;dario&quot;</span>]<br>    &#125;   <br><br>    <span class="hljs-comment"># ä¸ºæ¯ä¸ªæŸ¥è¯¢æ ‡æ³¨ç›¸å…³æ–‡æ¡£ï¼ˆç®€åŒ–ç‰ˆï¼šåŒ…å«å…³é”®è¯çš„å³ä¸ºç›¸å…³ï¼‰</span><br>    queries = <span class="hljs-built_in">list</span>(test_queries_config.keys()) <span class="hljs-comment"># æå–æŸ¥è¯¢æ–‡æœ¬</span><br>    <br>    <span class="hljs-keyword">for</span> query_text, keywords <span class="hljs-keyword">in</span> test_queries_config.items():<br>        <span class="hljs-comment"># åªè¦æ–‡æ¡£åŒ…å«åˆ—è¡¨ä¸­çš„ *ä»»æ„ä¸€ä¸ª* å…³é”®è¯ï¼Œå°±ç®—ç›¸å…³ï¼ˆæˆ–è€…ä½ å¯ä»¥æ”¹æˆ *æ‰€æœ‰* å…³é”®è¯ï¼‰</span><br>        relevant_ids = &#123;<br>            chunk.chunk_id<br>            <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> chunks<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">any</span>(kw.lower() <span class="hljs-keyword">in</span> chunk.text.lower() <span class="hljs-keyword">for</span> kw <span class="hljs-keyword">in</span> keywords)<br>        &#125;<br>    <br>        <span class="hljs-comment"># å…³é”®ï¼šæ·»åŠ æ‰“å°è°ƒè¯•ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯ç©ºçš„</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æŸ¥è¯¢: &#x27;<span class="hljs-subst">&#123;query_text&#125;</span>&#x27; -&gt; å…³é”®è¯: <span class="hljs-subst">&#123;keywords&#125;</span> -&gt; å‘½ä¸­ç›¸å…³æ–‡æ¡£æ•°: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(relevant_ids)&#125;</span>&quot;</span>)<br>    <br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(relevant_ids) == <span class="hljs-number">0</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âš ï¸ è­¦å‘Š: æŸ¥è¯¢ &#x27;<span class="hljs-subst">&#123;query_text&#125;</span>&#x27; æ²¡æœ‰åŒ¹é…åˆ°ä»»ä½•æ–‡æ¡£ï¼è¯·æ£€æŸ¥å…³é”®è¯æˆ–æ–‡æ¡£å†…å®¹ã€‚&quot;</span>)<br>        <br>        evaluator.add_relevance_judgment(query_text, relevant_ids)<br><br>    <span class="hljs-comment"># å¯¹æ¯”ç­–ç•¥</span><br>    retrievers = &#123;<br>        <span class="hljs-string">&#x27;è¯­ä¹‰æ£€ç´¢&#x27;</span>: <span class="hljs-keyword">lambda</span> q: [x[<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> semantic_retriever.search(q, k=<span class="hljs-number">5</span>)],<br>        <span class="hljs-string">&#x27;æ··åˆæ£€ç´¢&#x27;</span>: <span class="hljs-keyword">lambda</span> q: [x[<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> hybrid_retriever.search(q, k=<span class="hljs-number">5</span>)]<br>    &#125;<br>    <br>    comparison_results = evaluator.compare_strategies(test_queries, retrievers)<br>    evaluator.plot_comparison(comparison_results)<br></code></pre></td></tr></table></figure><h2 id="å®éªŒä¸‰ï¼šä¸Šä¸‹æ–‡çª—å£ä¸æˆæœ¬æ§åˆ¶-Context-Window-Management"><a href="#å®éªŒä¸‰ï¼šä¸Šä¸‹æ–‡çª—å£ä¸æˆæœ¬æ§åˆ¶-Context-Window-Management" class="headerlink" title="å®éªŒä¸‰ï¼šä¸Šä¸‹æ–‡çª—å£ä¸æˆæœ¬æ§åˆ¶ (Context Window Management)"></a>å®éªŒä¸‰ï¼šä¸Šä¸‹æ–‡çª—å£ä¸æˆæœ¬æ§åˆ¶ (Context Window Management)</h2><h3 id="å®éªŒç›®æ ‡-2"><a href="#å®éªŒç›®æ ‡-2" class="headerlink" title="å®éªŒç›®æ ‡"></a>å®éªŒç›®æ ‡</h3><p>è§£å†³é•¿æ–‡æ¡£å¤„ç†å’ŒAPIè°ƒç”¨æˆæœ¬æ§åˆ¶é—®é¢˜ï¼Œå®ç°é«˜æ•ˆçš„ç”Ÿäº§çº§RAGç³»ç»Ÿã€‚</p><h3 id="ç†è®ºåŸºç¡€-2"><a href="#ç†è®ºåŸºç¡€-2" class="headerlink" title="ç†è®ºåŸºç¡€"></a>ç†è®ºåŸºç¡€</h3><h4 id="1-ä¸Šä¸‹æ–‡çª—å£ç®¡ç†é—®é¢˜"><a href="#1-ä¸Šä¸‹æ–‡çª—å£ç®¡ç†é—®é¢˜" class="headerlink" title="1. ä¸Šä¸‹æ–‡çª—å£ç®¡ç†é—®é¢˜"></a>1. ä¸Šä¸‹æ–‡çª—å£ç®¡ç†é—®é¢˜</h4><p><strong>æŒ‘æˆ˜</strong>:</p><ul><li>LLMä¸Šä¸‹æ–‡çª—å£æœ‰é™</li><li>APIè°ƒç”¨æˆæœ¬éštokenæ•°çº¿æ€§å¢é•¿</li><li>æ£€ç´¢å†…å®¹è¿‡å¤šä¼šç¨€é‡Šç›¸å…³ä¿¡æ¯</li></ul><p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">å¤šè½®æ£€ç´¢ â†’ åŠ¨æ€é€‰æ‹© â†’ ä¸Šä¸‹æ–‡å‹ç¼© â†’ æˆæœ¬æ§åˆ¶<br></code></pre></td></tr></table></figure><h4 id="2-æˆæœ¬æ¨¡å‹"><a href="#2-æˆæœ¬æ¨¡å‹" class="headerlink" title="2. æˆæœ¬æ¨¡å‹"></a>2. æˆæœ¬æ¨¡å‹</h4><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gauss">æ€»æˆæœ¬ = (Prompt Tokens + Context Tokens + <span class="hljs-keyword">Output</span> Tokens) Ã— å•<span class="hljs-built_in">Token</span>ä»·æ ¼<br></code></pre></td></tr></table></figure><h3 id="å®éªŒæ­¥éª¤-2"><a href="#å®éªŒæ­¥éª¤-2" class="headerlink" title="å®éªŒæ­¥éª¤"></a>å®éªŒæ­¥éª¤</h3><h4 id="Step-1-å®ç°åŠ¨æ€ä¸Šä¸‹æ–‡é€‰æ‹©"><a href="#Step-1-å®ç°åŠ¨æ€ä¸Šä¸‹æ–‡é€‰æ‹©" class="headerlink" title="Step 1: å®ç°åŠ¨æ€ä¸Šä¸‹æ–‡é€‰æ‹©"></a>Step 1: å®ç°åŠ¨æ€ä¸Šä¸‹æ–‡é€‰æ‹©</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> dataclasses <span class="hljs-keyword">import</span> dataclass<br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Dict</span>, <span class="hljs-type">Tuple</span><br><span class="hljs-keyword">import</span> math<br><br><span class="hljs-meta">@dataclass</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TokenCount</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;Tokenè®¡æ•°å™¨&quot;&quot;&quot;</span><br>    prompt_base = <span class="hljs-number">50</span>  <span class="hljs-comment"># åŸºç¡€prompt tokenæ•°</span><br>    output_estimate = <span class="hljs-number">100</span>  <span class="hljs-comment"># é¢„ä¼°è¾“å‡ºtokenæ•°</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">count_chunks</span>(<span class="hljs-params">self, chunks: <span class="hljs-type">List</span>[Chunk]</span>) -&gt; <span class="hljs-built_in">int</span>:<br>        <span class="hljs-string">&quot;&quot;&quot;ä¼°ç®—chunkçš„tokenæ•°&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">sum</span>(<span class="hljs-built_in">len</span>(c.text) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> chunks)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_context_cost</span>(<span class="hljs-params"></span><br><span class="hljs-params">        self,</span><br><span class="hljs-params">        chunks: <span class="hljs-type">List</span>[Chunk],</span><br><span class="hljs-params">        max_context_tokens: <span class="hljs-built_in">int</span> = <span class="hljs-number">8000</span>,</span><br><span class="hljs-params">        min_chunks: <span class="hljs-built_in">int</span> = <span class="hljs-number">1</span>,</span><br><span class="hljs-params">        max_chunks: <span class="hljs-built_in">int</span> = <span class="hljs-number">20</span></span><br><span class="hljs-params">    </span>) -&gt; <span class="hljs-type">Dict</span>:<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        è®¡ç®—ä¸Šä¸‹æ–‡ä½¿ç”¨æƒ…å†µ</span><br><span class="hljs-string">        æ³¨æ„ï¼šè¾“å…¥çš„ chunks å¿…é¡»å·²ç»æŒ‰ä¼˜å…ˆçº§ï¼ˆåˆ†æ•°ï¼‰æ’å¥½åº</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> chunks:<br>            <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&#x27;selected_chunks&#x27;</span>: [], <span class="hljs-string">&#x27;total_tokens&#x27;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;chunk_count&#x27;</span>: <span class="hljs-number">0</span>&#125;<br><br>        <span class="hljs-comment"># ã€ä¿®å¤ç‚¹ã€‘ï¼šç§»é™¤ sorted() è°ƒç”¨</span><br>        <span class="hljs-comment"># åŸå› ï¼šchunks æ˜¯ Chunk å¯¹è±¡åˆ—è¡¨ï¼Œæ²¡æœ‰ .get() æ–¹æ³•ï¼Œä¸”è°ƒç”¨æ–¹å·²ä¿è¯é¡ºåº</span><br>        sorted_chunks = chunks <br><br>        <span class="hljs-comment"># è´ªå¿ƒé€‰æ‹©ï¼šæŒ‰é¡ºåºæ·»åŠ ï¼Œç›´åˆ° Token è€—å°½</span><br>        selected = []<br>        total_tokens = <span class="hljs-variable language_">self</span>.prompt_base<br><br>        <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> sorted_chunks:<br>            <span class="hljs-comment"># è¿™é‡Œç®€å•ç”¨å­—ç¬¦é•¿åº¦ä¼°ç®— Tokenï¼Œå®é™…ç”Ÿäº§ç¯å¢ƒå¯ç”¨ tiktoken</span><br>            chunk_tokens = <span class="hljs-built_in">len</span>(chunk.text) <br>            potential_total = total_tokens + chunk_tokens + <span class="hljs-variable language_">self</span>.output_estimate<br><br>            <span class="hljs-comment"># æ£€æŸ¥æ˜¯å¦è¶…å‡ºé™åˆ¶</span><br>            <span class="hljs-keyword">if</span> potential_total &lt;= max_context_tokens <span class="hljs-keyword">and</span> <span class="hljs-built_in">len</span>(selected) &lt; max_chunks:<br>                selected.append(chunk)<br>                total_tokens += chunk_tokens<br>            <br>            <span class="hljs-comment"># å¦‚æœå·²ç»æ»¡è¶³æœ€å° chunk æ•°ï¼Œä¸” token ç”¨é‡å·²è¾¾ 80%ï¼Œæå‰ç»“æŸ</span><br>            <span class="hljs-comment"># (è¿™ä¸ªé€»è¾‘æ˜¯å¯é€‰çš„ï¼Œçœ‹æ˜¯å¦æƒ³å°½å¯èƒ½å¡«æ»¡çª—å£)</span><br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(selected) &gt;= min_chunks <span class="hljs-keyword">and</span> total_tokens &gt; max_context_tokens * <span class="hljs-number">0.8</span>:<br>                <span class="hljs-keyword">break</span><br><br>        <span class="hljs-keyword">return</span> &#123;<br>            <span class="hljs-string">&#x27;selected_chunks&#x27;</span>: selected,<br>            <span class="hljs-string">&#x27;total_tokens&#x27;</span>: total_tokens + <span class="hljs-variable language_">self</span>.output_estimate,<br>            <span class="hljs-string">&#x27;chunk_count&#x27;</span>: <span class="hljs-built_in">len</span>(selected),<br>            <span class="hljs-string">&#x27;compression_ratio&#x27;</span>: <span class="hljs-built_in">len</span>(chunks) / <span class="hljs-built_in">len</span>(selected) <span class="hljs-keyword">if</span> selected <span class="hljs-keyword">else</span> <span class="hljs-number">0</span><br>        &#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">IntelligentContextSelector</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;æ™ºèƒ½ä¸Šä¸‹æ–‡é€‰æ‹©å™¨&quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, max_context_tokens=<span class="hljs-number">8000</span></span>):<br>        <span class="hljs-variable language_">self</span>.max_context_tokens = max_context_tokens<br>        <span class="hljs-variable language_">self</span>.token_counter = TokenCount()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">select_optimal_context</span>(<span class="hljs-params"></span><br><span class="hljs-params">        self,</span><br><span class="hljs-params">        query: <span class="hljs-built_in">str</span>,</span><br><span class="hljs-params">        retrieval_results: <span class="hljs-type">List</span>[<span class="hljs-type">Tuple</span>[<span class="hljs-built_in">float</span>, Chunk]],</span><br><span class="hljs-params">        min_chunks: <span class="hljs-built_in">int</span> = <span class="hljs-number">2</span>,</span><br><span class="hljs-params">        max_chunks: <span class="hljs-built_in">int</span> = <span class="hljs-number">10</span></span><br><span class="hljs-params">    </span>) -&gt; <span class="hljs-type">Dict</span>:<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        åŸºäºå¤šæ ·æ€§å’Œç›¸å…³æ€§çš„ä¸Šä¸‹æ–‡é€‰æ‹©</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> retrieval_results:<br>            <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&#x27;context&#x27;</span>: <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;selected_chunks&#x27;</span>: [], <span class="hljs-string">&#x27;reasoning&#x27;</span>: <span class="hljs-string">&#x27;No results&#x27;</span>&#125;<br><br>        <span class="hljs-comment"># å°†æ£€ç´¢ç»“æœè½¬æ¢ä¸ºdictæ ¼å¼ï¼ˆåŒ…å«åˆ†æ•°ï¼‰</span><br>        chunks_with_scores = [<br>            &#123;<span class="hljs-string">&#x27;chunk&#x27;</span>: chunk, <span class="hljs-string">&#x27;score&#x27;</span>: score&#125;<br>            <span class="hljs-keyword">for</span> score, chunk <span class="hljs-keyword">in</span> retrieval_results<br>        ]<br><br>        <span class="hljs-comment"># å¤šæ ·æ€§é€‰æ‹©ï¼šé¿å…é€‰æ‹©è¿‡äºç›¸ä¼¼çš„chunk</span><br>        <span class="hljs-keyword">from</span> sentence_transformers <span class="hljs-keyword">import</span> SentenceTransformer<br>        model = SentenceTransformer(<span class="hljs-string">&#x27;all-MiniLM-L6-v2&#x27;</span>)<br><br>        embeddings = model.encode([c[<span class="hljs-string">&#x27;chunk&#x27;</span>].text <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> chunks_with_scores])<br>        similarity_matrix = np.dot(embeddings, embeddings.T)<br><br>        <span class="hljs-comment"># åŸºäºå¤šæ ·æ€§çš„é€‰æ‹©</span><br>        selected_indices = []<br>        selected_embeddings = []<br><br>        <span class="hljs-comment"># ä¼˜å…ˆé€‰æ‹©é«˜åˆ†chunk</span><br>        chunks_sorted = <span class="hljs-built_in">sorted</span>(chunks_with_scores, key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-string">&#x27;score&#x27;</span>], reverse=<span class="hljs-literal">True</span>)<br><br>        <span class="hljs-keyword">for</span> chunk_info <span class="hljs-keyword">in</span> chunks_sorted:<br>            idx = chunks_with_scores.index(chunk_info)<br><br>            <span class="hljs-comment"># æ£€æŸ¥ä¸å·²é€‰æ‹©chunkçš„ç›¸ä¼¼åº¦</span><br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> selected_embeddings:<br>                selected_indices.append(idx)<br>                selected_embeddings.append(embeddings[idx])<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-comment"># è®¡ç®—ä¸å·²é€‰æ‹©chunkçš„æœ€å¤§ç›¸ä¼¼åº¦</span><br>                max_sim = <span class="hljs-built_in">max</span>(<br>                    np.dot(embeddings[idx], emb) / (<br>                        np.linalg.norm(embeddings[idx]) * np.linalg.norm(emb)<br>                    )<br>                    <span class="hljs-keyword">for</span> emb <span class="hljs-keyword">in</span> selected_embeddings<br>                )<br><br>                <span class="hljs-comment"># å¦‚æœç›¸ä¼¼åº¦ä½äºé˜ˆå€¼ï¼ˆ0.8ï¼‰ï¼Œåˆ™é€‰æ‹©</span><br>                <span class="hljs-keyword">if</span> max_sim &lt; <span class="hljs-number">0.8</span>:<br>                    selected_indices.append(idx)<br>                    selected_embeddings.append(embeddings[idx])<br><br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(selected_indices) &gt;= max_chunks:<br>                <span class="hljs-keyword">break</span><br><br>        <span class="hljs-comment"># é‡æ–°æ’åºï¼ˆæŒ‰åˆ†æ•°ï¼‰</span><br>        selected_indices = <span class="hljs-built_in">sorted</span>(<br>            selected_indices,<br>            key=<span class="hljs-keyword">lambda</span> i: chunks_with_scores[i][<span class="hljs-string">&#x27;score&#x27;</span>],<br>            reverse=<span class="hljs-literal">True</span><br>        )<br><br>        selected_chunks = [chunks_with_scores[i][<span class="hljs-string">&#x27;chunk&#x27;</span>] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> selected_indices]<br><br>        <span class="hljs-comment"># è®¡ç®—tokenä½¿ç”¨æƒ…å†µ</span><br>        cost_info = <span class="hljs-variable language_">self</span>.token_counter.calculate_context_cost(<br>            selected_chunks,<br>            max_context_tokens=<span class="hljs-variable language_">self</span>.max_context_tokens,<br>            min_chunks=min_chunks<br>        )<br><br>        <span class="hljs-comment"># æ„å»ºæœ€ç»ˆä¸Šä¸‹æ–‡</span><br>        context_parts = []<br>        <span class="hljs-keyword">for</span> i, chunk <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(cost_info[<span class="hljs-string">&#x27;selected_chunks&#x27;</span>], <span class="hljs-number">1</span>):<br>            context_parts.append(<span class="hljs-string">f&quot;[<span class="hljs-subst">&#123;i&#125;</span>] <span class="hljs-subst">&#123;chunk.text&#125;</span>&quot;</span>)<br><br>        context = <span class="hljs-string">&quot;\n\n&quot;</span>.join(context_parts)<br><br>        <span class="hljs-keyword">return</span> &#123;<br>            <span class="hljs-string">&#x27;context&#x27;</span>: context,<br>            <span class="hljs-string">&#x27;selected_chunks&#x27;</span>: cost_info[<span class="hljs-string">&#x27;selected_chunks&#x27;</span>],<br>            <span class="hljs-string">&#x27;total_tokens&#x27;</span>: cost_info[<span class="hljs-string">&#x27;total_tokens&#x27;</span>],<br>            <span class="hljs-string">&#x27;chunk_count&#x27;</span>: cost_info[<span class="hljs-string">&#x27;chunk_count&#x27;</span>],<br>            <span class="hljs-string">&#x27;compression_ratio&#x27;</span>: cost_info[<span class="hljs-string">&#x27;compression_ratio&#x27;</span>],<br>            <span class="hljs-string">&#x27;diversity_score&#x27;</span>: <span class="hljs-built_in">len</span>(selected_indices) / <span class="hljs-built_in">len</span>(chunks_with_scores)<br>        &#125;<br><br><span class="hljs-comment"># æµ‹è¯•ä¸Šä¸‹æ–‡é€‰æ‹©</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-comment"># åŠ è½½æµ‹è¯•æ•°æ®</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;../Stage_2/anthropic.txt&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        text = f.read()<br><br>    chunker = AdvancedChunker()<br>    chunks = chunker.chunk_by_recursive(text, <span class="hljs-number">300</span>, <span class="hljs-number">30</span>)<br><br>    retriever = SimpleSemanticRetriever()<br>    retriever.fit(chunks)<br><br>    selector = IntelligentContextSelector(max_context_tokens=<span class="hljs-number">4000</span>)<br><br>    <span class="hljs-comment"># æµ‹è¯•æŸ¥è¯¢</span><br>    test_queries = [<br>        <span class="hljs-string">&quot;Anthropicçš„èèµ„å’Œä¼°å€¼æ˜¯å¤šå°‘ï¼Ÿ&quot;</span>,<br>        <span class="hljs-string">&quot;Claude 3.5æœ‰ä»€ä¹ˆæ–°åŠŸèƒ½ï¼Ÿ&quot;</span>,<br>        <span class="hljs-string">&quot;AIå®‰å…¨æ–¹é¢ä»–ä»¬åšäº†ä»€ä¹ˆï¼Ÿ&quot;</span><br>    ]<br><br>    <span class="hljs-keyword">for</span> query <span class="hljs-keyword">in</span> test_queries:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n<span class="hljs-subst">&#123;<span class="hljs-string">&#x27;=&#x27;</span>*<span class="hljs-number">80</span>&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æŸ¥è¯¢: <span class="hljs-subst">&#123;query&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;=&#x27;</span>*<span class="hljs-number">80</span>)<br><br>        <span class="hljs-comment"># æ£€ç´¢æ›´å¤šç»“æœç”¨äºé€‰æ‹©</span><br>        retrieval_results = retriever.search(query, k=<span class="hljs-number">20</span>)<br><br>        <span class="hljs-comment"># æ™ºèƒ½é€‰æ‹©ä¸Šä¸‹æ–‡</span><br>        context_info = selector.select_optimal_context(<br>            query,<br>            retrieval_results,<br>            min_chunks=<span class="hljs-number">2</span>,<br>            max_chunks=<span class="hljs-number">5</span><br>        )<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\nğŸ“Š ä¸Šä¸‹æ–‡ç»Ÿè®¡:&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  é€‰æ‹©chunkæ•°: <span class="hljs-subst">&#123;context_info[<span class="hljs-string">&#x27;chunk_count&#x27;</span>]&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  æ€»Tokenæ•°: <span class="hljs-subst">&#123;context_info[<span class="hljs-string">&#x27;total_tokens&#x27;</span>]&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  å‹ç¼©æ¯”: <span class="hljs-subst">&#123;context_info[<span class="hljs-string">&#x27;compression_ratio&#x27;</span>]:<span class="hljs-number">.2</span>f&#125;</span>x&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  å¤šæ ·æ€§å¾—åˆ†: <span class="hljs-subst">&#123;context_info[<span class="hljs-string">&#x27;diversity_score&#x27;</span>]:<span class="hljs-number">.3</span>f&#125;</span>&quot;</span>)<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\nğŸ“„ é€‰æ‹©çš„ä¸Šä¸‹æ–‡:&quot;</span>)<br>        <span class="hljs-built_in">print</span>(context_info[<span class="hljs-string">&#x27;context&#x27;</span>][:<span class="hljs-number">50</span>] + <span class="hljs-string">&quot;...&quot;</span> <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(context_info[<span class="hljs-string">&#x27;context&#x27;</span>]) &gt; <span class="hljs-number">50</span> <span class="hljs-keyword">else</span> context_info[<span class="hljs-string">&#x27;context&#x27;</span>])<br></code></pre></td></tr></table></figure><pre><code class="hljs">ğŸ”„ æ­£åœ¨ç”Ÿæˆè¯­ä¹‰å‘é‡ç´¢å¼•...âœ… è¯­ä¹‰ç´¢å¼•æ„å»ºå®Œæˆ: 2 ä¸ªæ–‡æ¡£å—================================================================================æŸ¥è¯¢: Anthropicçš„èèµ„å’Œä¼°å€¼æ˜¯å¤šå°‘ï¼Ÿ================================================================================ğŸ“Š ä¸Šä¸‹æ–‡ç»Ÿè®¡:  é€‰æ‹©chunkæ•°: 1  æ€»Tokenæ•°: 3722  å‹ç¼©æ¯”: 2.00x  å¤šæ ·æ€§å¾—åˆ†: 1.000ğŸ“„ é€‰æ‹©çš„ä¸Šä¸‹æ–‡:[1] Anthropic ä¸ Claudeï¼šäººå·¥æ™ºèƒ½å®‰å…¨ä¸å¤§æ¨¡å‹æ¼”è¿›æ·±åº¦æŠ¥å‘Š ç‰ˆæœ¬æ—¥æœŸï¼š2024å¹´...================================================================================æŸ¥è¯¢: Claude 3.5æœ‰ä»€ä¹ˆæ–°åŠŸèƒ½ï¼Ÿ================================================================================çœç•¥</code></pre><h4 id="Step-2-å®ç°æˆæœ¬è·Ÿè¸ªä¸é¢„ç®—æ§åˆ¶"><a href="#Step-2-å®ç°æˆæœ¬è·Ÿè¸ªä¸é¢„ç®—æ§åˆ¶" class="headerlink" title="Step 2: å®ç°æˆæœ¬è·Ÿè¸ªä¸é¢„ç®—æ§åˆ¶"></a>Step 2: å®ç°æˆæœ¬è·Ÿè¸ªä¸é¢„ç®—æ§åˆ¶</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime<br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Dict</span>, <span class="hljs-type">List</span><br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CostTracker</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;APIè°ƒç”¨æˆæœ¬è·Ÿè¸ªå™¨&quot;&quot;&quot;</span><br><br>    <span class="hljs-comment"># ä¸»æµLLMå®šä»·ï¼ˆæ¯1K tokensï¼‰</span><br>    PRICING = &#123;<br>        <span class="hljs-string">&#x27;gpt-4&#x27;</span>: &#123;<span class="hljs-string">&#x27;input&#x27;</span>: <span class="hljs-number">0.03</span>, <span class="hljs-string">&#x27;output&#x27;</span>: <span class="hljs-number">0.06</span>&#125;,<br>        <span class="hljs-string">&#x27;gpt-3.5-turbo&#x27;</span>: &#123;<span class="hljs-string">&#x27;input&#x27;</span>: <span class="hljs-number">0.001</span>, <span class="hljs-string">&#x27;output&#x27;</span>: <span class="hljs-number">0.002</span>&#125;,<br>        <span class="hljs-string">&#x27;claude-3&#x27;</span>: &#123;<span class="hljs-string">&#x27;input&#x27;</span>: <span class="hljs-number">0.015</span>, <span class="hljs-string">&#x27;output&#x27;</span>: <span class="hljs-number">0.075</span>&#125;,<br>        <span class="hljs-string">&#x27;deepseek-chat&#x27;</span>: &#123;<span class="hljs-string">&#x27;input&#x27;</span>: <span class="hljs-number">0.00014</span>, <span class="hljs-string">&#x27;output&#x27;</span>: <span class="hljs-number">0.00028</span>&#125;,<br>        <span class="hljs-string">&#x27;deepseek-coder&#x27;</span>: &#123;<span class="hljs-string">&#x27;input&#x27;</span>: <span class="hljs-number">0.00014</span>, <span class="hljs-string">&#x27;output&#x27;</span>: <span class="hljs-number">0.00028</span>&#125;<br>    &#125;<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, budget_limit: <span class="hljs-built_in">float</span> = <span class="hljs-number">10.0</span></span>):<br>        <span class="hljs-variable language_">self</span>.budget_limit = budget_limit  <span class="hljs-comment"># ç¾å…ƒ</span><br>        <span class="hljs-variable language_">self</span>.total_spent = <span class="hljs-number">0.0</span><br>        <span class="hljs-variable language_">self</span>.call_history = []<br>        <span class="hljs-variable language_">self</span>.daily_spending = defaultdict(<span class="hljs-built_in">float</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">log_api_call</span>(<span class="hljs-params"></span><br><span class="hljs-params">        self,</span><br><span class="hljs-params">        model: <span class="hljs-built_in">str</span>,</span><br><span class="hljs-params">        input_tokens: <span class="hljs-built_in">int</span>,</span><br><span class="hljs-params">        output_tokens: <span class="hljs-built_in">int</span>,</span><br><span class="hljs-params">        query: <span class="hljs-built_in">str</span></span><br><span class="hljs-params">    </span>):<br>        <span class="hljs-string">&quot;&quot;&quot;è®°å½•ä¸€æ¬¡APIè°ƒç”¨&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">if</span> model <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.PRICING:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âš ï¸ è­¦å‘Š: æœªçŸ¥æ¨¡å‹ <span class="hljs-subst">&#123;model&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">return</span><br><br>        pricing = <span class="hljs-variable language_">self</span>.PRICING[model]<br>        cost = (<br>            input_tokens / <span class="hljs-number">1000</span> * pricing[<span class="hljs-string">&#x27;input&#x27;</span>] +<br>            output_tokens / <span class="hljs-number">1000</span> * pricing[<span class="hljs-string">&#x27;output&#x27;</span>]<br>        )<br><br>        <span class="hljs-variable language_">self</span>.total_spent += cost<br><br>        call_info = &#123;<br>            <span class="hljs-string">&#x27;timestamp&#x27;</span>: datetime.now().isoformat(),<br>            <span class="hljs-string">&#x27;model&#x27;</span>: model,<br>            <span class="hljs-string">&#x27;input_tokens&#x27;</span>: input_tokens,<br>            <span class="hljs-string">&#x27;output_tokens&#x27;</span>: output_tokens,<br>            <span class="hljs-string">&#x27;cost&#x27;</span>: cost,<br>            <span class="hljs-string">&#x27;query&#x27;</span>: query[:<span class="hljs-number">100</span>]  <span class="hljs-comment"># æˆªæ–­ä¿å­˜</span><br>        &#125;<br><br>        <span class="hljs-variable language_">self</span>.call_history.append(call_info)<br><br>        <span class="hljs-comment"># æŒ‰æ—¥ç»Ÿè®¡</span><br>        date = datetime.now().strftime(<span class="hljs-string">&#x27;%Y-%m-%d&#x27;</span>)<br>        <span class="hljs-variable language_">self</span>.daily_spending[date] += cost<br><br>        <span class="hljs-comment"># æ£€æŸ¥é¢„ç®—</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.total_spent &gt; <span class="hljs-variable language_">self</span>.budget_limit:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âš ï¸ è­¦å‘Š: å·²è¶…å‡ºé¢„ç®—é™åˆ¶ $<span class="hljs-subst">&#123;self.budget_limit:<span class="hljs-number">.2</span>f&#125;</span>&quot;</span>)<br><br>        <span class="hljs-keyword">return</span> cost<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">estimate_query_cost</span>(<span class="hljs-params"></span><br><span class="hljs-params">        self,</span><br><span class="hljs-params">        query: <span class="hljs-built_in">str</span>,</span><br><span class="hljs-params">        context_chunks: <span class="hljs-type">List</span>[Chunk],</span><br><span class="hljs-params">        model: <span class="hljs-built_in">str</span> = <span class="hljs-string">&#x27;deepseek-chat&#x27;</span></span><br><span class="hljs-params">    </span>) -&gt; <span class="hljs-type">Dict</span>:<br>        <span class="hljs-string">&quot;&quot;&quot;ä¼°ç®—æŸ¥è¯¢æˆæœ¬&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">if</span> model <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.PRICING:<br>            <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&#x27;error&#x27;</span>: <span class="hljs-string">f&#x27;æœªçŸ¥æ¨¡å‹: <span class="hljs-subst">&#123;model&#125;</span>&#x27;</span>&#125;<br><br>        <span class="hljs-comment"># ä¼°ç®—tokenæ•°</span><br>        prompt_tokens = <span class="hljs-number">50</span>  <span class="hljs-comment"># åŸºç¡€prompt</span><br>        query_tokens = <span class="hljs-built_in">len</span>(query)<br>        context_tokens = <span class="hljs-built_in">sum</span>(<span class="hljs-built_in">len</span>(c.text) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> context_chunks)<br>        output_tokens = <span class="hljs-number">100</span>  <span class="hljs-comment"># é¢„ä¼°è¾“å‡º</span><br><br>        input_tokens = prompt_tokens + query_tokens + context_tokens<br><br>        pricing = <span class="hljs-variable language_">self</span>.PRICING[model]<br>        cost = (<br>            input_tokens / <span class="hljs-number">1000</span> * pricing[<span class="hljs-string">&#x27;input&#x27;</span>] +<br>            output_tokens / <span class="hljs-number">1000</span> * pricing[<span class="hljs-string">&#x27;output&#x27;</span>]<br>        )<br><br>        <span class="hljs-keyword">return</span> &#123;<br>            <span class="hljs-string">&#x27;model&#x27;</span>: model,<br>            <span class="hljs-string">&#x27;input_tokens&#x27;</span>: input_tokens,<br>            <span class="hljs-string">&#x27;output_tokens&#x27;</span>: output_tokens,<br>            <span class="hljs-string">&#x27;estimated_cost&#x27;</span>: cost,<br>            <span class="hljs-string">&#x27;cost_breakdown&#x27;</span>: &#123;<br>                <span class="hljs-string">&#x27;prompt&#x27;</span>: prompt_tokens,<br>                <span class="hljs-string">&#x27;query&#x27;</span>: query_tokens,<br>                <span class="hljs-string">&#x27;context&#x27;</span>: context_tokens,<br>                <span class="hljs-string">&#x27;output&#x27;</span>: output_tokens<br>            &#125;<br>        &#125;<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">optimize_for_budget</span>(<span class="hljs-params"></span><br><span class="hljs-params">        self,</span><br><span class="hljs-params">        query: <span class="hljs-built_in">str</span>,</span><br><span class="hljs-params">        retrieval_results: <span class="hljs-type">List</span>[<span class="hljs-type">Tuple</span>[<span class="hljs-built_in">float</span>, Chunk]],</span><br><span class="hljs-params">        target_cost: <span class="hljs-built_in">float</span>,</span><br><span class="hljs-params">        model: <span class="hljs-built_in">str</span> = <span class="hljs-string">&#x27;deepseek-chat&#x27;</span></span><br><span class="hljs-params">    </span>) -&gt; <span class="hljs-type">List</span>[Chunk]:<br>        <span class="hljs-string">&quot;&quot;&quot;åœ¨é¢„ç®—çº¦æŸä¸‹ä¼˜åŒ–æŸ¥è¯¢&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">if</span> model <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.PRICING:<br>            <span class="hljs-keyword">return</span> []<br><br>        pricing = <span class="hljs-variable language_">self</span>.PRICING[model]<br>        max_input_tokens = <span class="hljs-built_in">int</span>(<br>            target_cost * <span class="hljs-number">1000</span> / pricing[<span class="hljs-string">&#x27;input&#x27;</span>] - <span class="hljs-number">100</span>  <span class="hljs-comment"># é¢„ç•™è¾“å‡ºç©ºé—´</span><br>        )<br><br>        <span class="hljs-comment"># æŒ‰åˆ†æ•°æ’åº</span><br>        chunks_sorted = <span class="hljs-built_in">sorted</span>(retrieval_results, key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">0</span>], reverse=<span class="hljs-literal">True</span>)<br><br>        selected_chunks = []<br>        total_tokens = <span class="hljs-number">50</span>  <span class="hljs-comment"># prompt + query</span><br><br>        <span class="hljs-keyword">for</span> score, chunk <span class="hljs-keyword">in</span> chunks_sorted:<br>            chunk_tokens = <span class="hljs-built_in">len</span>(chunk.text)<br>            <span class="hljs-keyword">if</span> total_tokens + chunk_tokens &lt;= max_input_tokens:<br>                selected_chunks.append(chunk)<br>                total_tokens += chunk_tokens<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-keyword">break</span><br><br>        <span class="hljs-keyword">return</span> selected_chunks<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_report</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">str</span>:<br>        <span class="hljs-string">&quot;&quot;&quot;ç”Ÿæˆæˆæœ¬æŠ¥å‘Š&quot;&quot;&quot;</span><br>        report = <span class="hljs-string">f&quot;\n<span class="hljs-subst">&#123;<span class="hljs-string">&#x27;=&#x27;</span>*<span class="hljs-number">60</span>&#125;</span>\n&quot;</span><br>        report += <span class="hljs-string">f&quot;ğŸ“Š APIè°ƒç”¨æˆæœ¬æŠ¥å‘Š\n&quot;</span><br>        report += <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;<span class="hljs-string">&#x27;=&#x27;</span>*<span class="hljs-number">60</span>&#125;</span>\n\n&quot;</span><br><br>        report += <span class="hljs-string">f&quot;ğŸ’° æ€»æ”¯å‡º: $<span class="hljs-subst">&#123;self.total_spent:<span class="hljs-number">.4</span>f&#125;</span>\n&quot;</span><br>        report += <span class="hljs-string">f&quot;ğŸ’° é¢„ç®—é™åˆ¶: $<span class="hljs-subst">&#123;self.budget_limit:<span class="hljs-number">.2</span>f&#125;</span>\n&quot;</span><br>        report += <span class="hljs-string">f&quot;ğŸ’° é¢„ç®—ä½¿ç”¨ç‡: <span class="hljs-subst">&#123;(self.total_spent/self.budget_limit)*<span class="hljs-number">100</span>:<span class="hljs-number">.1</span>f&#125;</span>%\n\n&quot;</span><br><br>        report += <span class="hljs-string">f&quot;ğŸ“ æ€»è°ƒç”¨æ¬¡æ•°: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(self.call_history)&#125;</span>\n\n&quot;</span><br><br>        <span class="hljs-comment"># æ¨¡å‹ä½¿ç”¨ç»Ÿè®¡</span><br>        model_usage = &#123;&#125;<br>        <span class="hljs-keyword">for</span> call <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.call_history:<br>            model = call[<span class="hljs-string">&#x27;model&#x27;</span>]<br>            <span class="hljs-keyword">if</span> model <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> model_usage:<br>                model_usage[model] = &#123;<span class="hljs-string">&#x27;count&#x27;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;cost&#x27;</span>: <span class="hljs-number">0</span>&#125;<br>            model_usage[model][<span class="hljs-string">&#x27;count&#x27;</span>] += <span class="hljs-number">1</span><br>            model_usage[model][<span class="hljs-string">&#x27;cost&#x27;</span>] += call[<span class="hljs-string">&#x27;cost&#x27;</span>]<br><br>        report += <span class="hljs-string">f&quot;ğŸ“ˆ æ¨¡å‹ä½¿ç”¨ç»Ÿè®¡:\n&quot;</span><br>        <span class="hljs-keyword">for</span> model, stats <span class="hljs-keyword">in</span> <span class="hljs-built_in">sorted</span>(model_usage.items(), key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>][<span class="hljs-string">&#x27;cost&#x27;</span>], reverse=<span class="hljs-literal">True</span>):<br>            report += <span class="hljs-string">f&quot;  <span class="hljs-subst">&#123;model&#125;</span>: <span class="hljs-subst">&#123;stats[<span class="hljs-string">&#x27;count&#x27;</span>]&#125;</span>æ¬¡, $<span class="hljs-subst">&#123;stats[<span class="hljs-string">&#x27;cost&#x27;</span>]:<span class="hljs-number">.4</span>f&#125;</span>\n&quot;</span><br><br>        report += <span class="hljs-string">f&quot;\nğŸ“… æ¯æ—¥æ”¯å‡º:\n&quot;</span><br>        <span class="hljs-keyword">for</span> date, amount <span class="hljs-keyword">in</span> <span class="hljs-built_in">sorted</span>(<span class="hljs-variable language_">self</span>.daily_spending.items()):<br>            report += <span class="hljs-string">f&quot;  <span class="hljs-subst">&#123;date&#125;</span>: $<span class="hljs-subst">&#123;amount:<span class="hljs-number">.4</span>f&#125;</span>\n&quot;</span><br><br>        <span class="hljs-keyword">return</span> report<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">plot_spending</span>(<span class="hljs-params">self, save_path: <span class="hljs-built_in">str</span> = <span class="hljs-string">&#x27;cost_analysis.png&#x27;</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;ç»˜åˆ¶æ”¯å‡ºåˆ†æå›¾&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-variable language_">self</span>.call_history:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;âš ï¸ æ²¡æœ‰è°ƒç”¨è®°å½•&quot;</span>)<br>            <span class="hljs-keyword">return</span><br><br>        <span class="hljs-comment"># ç´¯ç§¯æ”¯å‡º</span><br>        dates = [call[<span class="hljs-string">&#x27;timestamp&#x27;</span>][:<span class="hljs-number">10</span>] <span class="hljs-keyword">for</span> call <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.call_history]<br>        costs = [call[<span class="hljs-string">&#x27;cost&#x27;</span>] <span class="hljs-keyword">for</span> call <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.call_history]<br>        cumulative_costs = np.cumsum(costs)<br><br>        fig, axes = plt.subplots(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, figsize=(<span class="hljs-number">12</span>, <span class="hljs-number">8</span>))<br><br>        <span class="hljs-comment"># ç´¯ç§¯æ”¯å‡ºè¶‹åŠ¿</span><br>        axes[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>].plot(<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(cumulative_costs)), cumulative_costs)<br>        axes[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>].set_title(<span class="hljs-string">&#x27;ç´¯ç§¯æ”¯å‡ºè¶‹åŠ¿&#x27;</span>)<br>        axes[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>].set_xlabel(<span class="hljs-string">&#x27;è°ƒç”¨æ¬¡æ•°&#x27;</span>)<br>        axes[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>].set_ylabel(<span class="hljs-string">&#x27;ç´¯ç§¯æˆæœ¬ ($)&#x27;</span>)<br><br>        <span class="hljs-comment"># æ¯æ¬¡è°ƒç”¨æˆæœ¬åˆ†å¸ƒ</span><br>        axes[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>].hist(costs, bins=<span class="hljs-number">20</span>, edgecolor=<span class="hljs-string">&#x27;black&#x27;</span>)<br>        axes[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>].set_title(<span class="hljs-string">&#x27;å•æ¬¡è°ƒç”¨æˆæœ¬åˆ†å¸ƒ&#x27;</span>)<br>        axes[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>].set_xlabel(<span class="hljs-string">&#x27;æˆæœ¬ ($)&#x27;</span>)<br>        axes[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>].set_ylabel(<span class="hljs-string">&#x27;é¢‘æ¬¡&#x27;</span>)<br><br>        <span class="hljs-comment"># æŒ‰æ¨¡å‹åˆ†ç»„çš„æˆæœ¬</span><br>        models = [call[<span class="hljs-string">&#x27;model&#x27;</span>] <span class="hljs-keyword">for</span> call <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.call_history]<br>        unique_models = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">set</span>(models))<br>        model_costs = [<span class="hljs-built_in">sum</span>(call[<span class="hljs-string">&#x27;cost&#x27;</span>] <span class="hljs-keyword">for</span> call <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.call_history <span class="hljs-keyword">if</span> call[<span class="hljs-string">&#x27;model&#x27;</span>] == m) <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> unique_models]<br><br>        axes[<span class="hljs-number">1</span>,<span class="hljs-number">0</span>].bar(unique_models, model_costs)<br>        axes[<span class="hljs-number">1</span>,<span class="hljs-number">0</span>].set_title(<span class="hljs-string">&#x27;å„æ¨¡å‹æˆæœ¬&#x27;</span>)<br>        axes[<span class="hljs-number">1</span>,<span class="hljs-number">0</span>].set_xlabel(<span class="hljs-string">&#x27;æ¨¡å‹&#x27;</span>)<br>        axes[<span class="hljs-number">1</span>,<span class="hljs-number">0</span>].set_ylabel(<span class="hljs-string">&#x27;æ€»æˆæœ¬ ($)&#x27;</span>)<br>        axes[<span class="hljs-number">1</span>,<span class="hljs-number">0</span>].tick_params(axis=<span class="hljs-string">&#x27;x&#x27;</span>, rotation=<span class="hljs-number">45</span>)<br><br>        <span class="hljs-comment"># é¢„ç®—ä½¿ç”¨ç‡</span><br>        budget_used = (<span class="hljs-variable language_">self</span>.total_spent / <span class="hljs-variable language_">self</span>.budget_limit) * <span class="hljs-number">100</span><br>        labels = [<span class="hljs-string">&#x27;å·²ä½¿ç”¨&#x27;</span>, <span class="hljs-string">&#x27;å‰©ä½™&#x27;</span>]<br>        sizes = [budget_used, <span class="hljs-number">100</span> - budget_used]<br>        axes[<span class="hljs-number">1</span>,<span class="hljs-number">1</span>].pie(sizes, labels=labels, autopct=<span class="hljs-string">&#x27;%1.1f%%&#x27;</span>)<br>        axes[<span class="hljs-number">1</span>,<span class="hljs-number">1</span>].set_title(<span class="hljs-string">&#x27;é¢„ç®—ä½¿ç”¨ç‡&#x27;</span>)<br><br>        plt.tight_layout()<br>        plt.savefig(save_path, dpi=<span class="hljs-number">150</span>, bbox_inches=<span class="hljs-string">&#x27;tight&#x27;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âœ… æˆæœ¬åˆ†æå›¾å·²ä¿å­˜ä¸º <span class="hljs-subst">&#123;save_path&#125;</span>&quot;</span>)<br><br><span class="hljs-comment"># æµ‹è¯•æˆæœ¬æ§åˆ¶</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    tracker = CostTracker(budget_limit=<span class="hljs-number">1.0</span>)<br><br>    <span class="hljs-comment"># æ¨¡æ‹ŸAPIè°ƒç”¨</span><br>    sample_calls = [<br>        (<span class="hljs-string">&#x27;deepseek-chat&#x27;</span>, <span class="hljs-number">2000</span>, <span class="hljs-number">500</span>, <span class="hljs-string">&quot;Anthropicå…¬å¸ä»‹ç»&quot;</span>),<br>        (<span class="hljs-string">&#x27;gpt-3.5-turbo&#x27;</span>, <span class="hljs-number">2000</span>, <span class="hljs-number">500</span>, <span class="hljs-string">&quot;Claudeæ¨¡å‹ç‰¹ç‚¹&quot;</span>),<br>        (<span class="hljs-string">&#x27;deepseek-coder&#x27;</span>, <span class="hljs-number">2000</span>, <span class="hljs-number">500</span>, <span class="hljs-string">&quot;RAGç³»ç»ŸåŸç†&quot;</span>),<br>        (<span class="hljs-string">&#x27;gpt-4&#x27;</span>, <span class="hljs-number">2000</span>, <span class="hljs-number">500</span>, <span class="hljs-string">&quot;AIå®‰å…¨ç ”ç©¶è¿›å±•&quot;</span>),<br>        (<span class="hljs-string">&#x27;claude-3&#x27;</span>, <span class="hljs-number">2000</span>, <span class="hljs-number">500</span>, <span class="hljs-string">&quot;Anthropicèèµ„æƒ…å†µ&quot;</span>)<br>    ]<br><br>    <span class="hljs-keyword">for</span> model, input_tokens, output_tokens, query <span class="hljs-keyword">in</span> sample_calls:<br>        cost = tracker.log_api_call(model, input_tokens, output_tokens, query)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;è°ƒç”¨ <span class="hljs-subst">&#123;model&#125;</span>: $<span class="hljs-subst">&#123;cost:<span class="hljs-number">.4</span>f&#125;</span>&quot;</span>)<br><br>    <span class="hljs-comment"># æˆæœ¬ä¼°ç®—</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;../Stage_2/anthropic.txt&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        text = f.read()<br><br>    chunker = AdvancedChunker()<br>    chunks = chunker.chunk_by_recursive(text, <span class="hljs-number">300</span>, <span class="hljs-number">30</span>)<br><br>    cost_info = tracker.estimate_query_cost(<span class="hljs-string">&quot;å…¬å¸å‘å±•å†ç¨‹&quot;</span>, chunks[:<span class="hljs-number">3</span>])<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\nğŸ’¡ æŸ¥è¯¢æˆæœ¬ä¼°ç®—: $<span class="hljs-subst">&#123;cost_info[<span class="hljs-string">&#x27;estimated_cost&#x27;</span>]:<span class="hljs-number">.4</span>f&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   Tokenåˆ†è§£: <span class="hljs-subst">&#123;cost_info[<span class="hljs-string">&#x27;cost_breakdown&#x27;</span>]&#125;</span>&quot;</span>)<br><br>    <span class="hljs-comment"># ç”ŸæˆæŠ¥å‘Š</span><br>    <span class="hljs-built_in">print</span>(tracker.generate_report())<br><br>    <span class="hljs-comment"># ç»˜åˆ¶åˆ†æå›¾</span><br>    tracker.plot_spending()<br></code></pre></td></tr></table></figure><pre><code class="hljs">è°ƒç”¨ deepseek-chat: $0.0004è°ƒç”¨ gpt-3.5-turbo: $0.0030è°ƒç”¨ deepseek-coder: $0.0004è°ƒç”¨ gpt-4: $0.0900è°ƒç”¨ claude-3: $0.0675ğŸ’¡ æŸ¥è¯¢æˆæœ¬ä¼°ç®—: $0.0006   Tokenåˆ†è§£: {&#39;prompt&#39;: 50, &#39;query&#39;: 6, &#39;context&#39;: 4325, &#39;output&#39;: 100}============================================================ğŸ“Š APIè°ƒç”¨æˆæœ¬æŠ¥å‘Š============================================================ğŸ’° æ€»æ”¯å‡º: $0.1613ğŸ’° é¢„ç®—é™åˆ¶: $1.00ğŸ’° é¢„ç®—ä½¿ç”¨ç‡: 16.1%ğŸ“ æ€»è°ƒç”¨æ¬¡æ•°: 5ğŸ“ˆ æ¨¡å‹ä½¿ç”¨ç»Ÿè®¡:  gpt-4: 1æ¬¡, $0.0900  claude-3: 1æ¬¡, $0.0675  gpt-3.5-turbo: 1æ¬¡, $0.0030  deepseek-chat: 1æ¬¡, $0.0004  deepseek-coder: 1æ¬¡, $0.0004ğŸ“… æ¯æ—¥æ”¯å‡º:  2025-12-08: $0.1613âœ… æˆæœ¬åˆ†æå›¾å·²ä¿å­˜ä¸º cost_analysis.png</code></pre><hr><h2 id="å®éªŒå››ï¼šå®æˆ˜é¡¹ç›®-æ™ºèƒ½æŠ•åæŠ¥å‘Šåˆ†æåŠ©æ‰‹"><a href="#å®éªŒå››ï¼šå®æˆ˜é¡¹ç›®-æ™ºèƒ½æŠ•åæŠ¥å‘Šåˆ†æåŠ©æ‰‹" class="headerlink" title="å®éªŒå››ï¼šå®æˆ˜é¡¹ç›® - æ™ºèƒ½æŠ•åæŠ¥å‘Šåˆ†æåŠ©æ‰‹"></a>å®éªŒå››ï¼šå®æˆ˜é¡¹ç›® - æ™ºèƒ½æŠ•åæŠ¥å‘Šåˆ†æåŠ©æ‰‹</h2><h3 id="é¡¹ç›®èƒŒæ™¯"><a href="#é¡¹ç›®èƒŒæ™¯" class="headerlink" title="é¡¹ç›®èƒŒæ™¯"></a>é¡¹ç›®èƒŒæ™¯</h3><p><strong>åœºæ™¯</strong>ï¼šæŠ•èµ„æœºæ„éœ€è¦åˆ†æè¢«æŠ•ä¼ä¸šçš„è´¢æŠ¥å’ŒæŠ•åæŠ¥å‘Šï¼Œå›ç­”å¦‚â€å¯¹æ¯”Aå…¬å¸å’ŒBå…¬å¸çš„è¥æ”¶å¢é•¿ç‡â€ç­‰å¤æ‚é—®é¢˜ã€‚</p><p><strong>æŒ‘æˆ˜</strong>ï¼š</p><ul><li>éç»“æ„åŒ–PDFæ–‡æ¡£ï¼ˆè´¢æŠ¥ã€æŠ¥å‘Šï¼‰</li><li>è·¨æ–‡æ¡£æŸ¥è¯¢</li><li>éœ€è¦æ•°å€¼è®¡ç®—å’Œå¯¹æ¯”åˆ†æ</li><li>å¤šæ ¼å¼æ•°æ®ï¼ˆè¡¨æ ¼ã€æ–‡æœ¬ã€å›¾ç‰‡ï¼‰</li></ul><h3 id="é¡¹ç›®å®ç°"><a href="#é¡¹ç›®å®ç°" class="headerlink" title="é¡¹ç›®å®ç°"></a>é¡¹ç›®å®ç°</h3><h4 id="Step-1-æ–‡æ¡£è§£æä¸é¢„å¤„ç†"><a href="#Step-1-æ–‡æ¡£è§£æä¸é¢„å¤„ç†" class="headerlink" title="Step 1: æ–‡æ¡£è§£æä¸é¢„å¤„ç†"></a>Step 1: æ–‡æ¡£è§£æä¸é¢„å¤„ç†</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Dict</span><br><span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path<br><span class="hljs-keyword">import</span> fitz  <span class="hljs-comment"># PyMuPDF</span><br><span class="hljs-keyword">from</span> unstructured.partition.pdf <span class="hljs-keyword">import</span> partition_pdf<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">InvestmentDocumentParser</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;æŠ•èµ„æ–‡æ¡£è§£æå™¨&quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, data_dir: <span class="hljs-built_in">str</span></span>):<br>        <span class="hljs-variable language_">self</span>.data_dir = Path(data_dir)<br>        <span class="hljs-variable language_">self</span>.extracted_docs = []<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_pdf</span>(<span class="hljs-params">self, file_path: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">Dict</span>:<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        è§£æPDFæ–‡æ¡£ï¼Œæå–æ–‡æœ¬ã€è¡¨æ ¼ã€å›¾ç‰‡</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        doc = fitz.<span class="hljs-built_in">open</span>(file_path)<br>        result = &#123;<br>            <span class="hljs-string">&#x27;filename&#x27;</span>: os.path.basename(file_path),<br>            <span class="hljs-string">&#x27;pages&#x27;</span>: [],<br>            <span class="hljs-string">&#x27;texts&#x27;</span>: [],<br>            <span class="hljs-string">&#x27;tables&#x27;</span>: [],<br>            <span class="hljs-string">&#x27;metadata&#x27;</span>: doc.metadata<br>        &#125;<br><br>        <span class="hljs-keyword">for</span> page_num <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(doc)):<br>            page = doc[page_num]<br><br>            <span class="hljs-comment"># æå–æ–‡æœ¬</span><br>            text = page.get_text()<br>            result[<span class="hljs-string">&#x27;texts&#x27;</span>].append(&#123;<br>                <span class="hljs-string">&#x27;page&#x27;</span>: page_num + <span class="hljs-number">1</span>,<br>                <span class="hljs-string">&#x27;content&#x27;</span>: text,<br>                <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;text&#x27;</span><br>            &#125;)<br><br>            <span class="hljs-comment"># --- ä¿®å¤éƒ¨åˆ†å¼€å§‹ ---</span><br>            <span class="hljs-comment"># æå–è¡¨æ ¼ï¼ˆç®€å•æ–¹æ³•ï¼‰</span><br>            <span class="hljs-keyword">try</span>:<br>                tables = page.find_tables()<br>                <span class="hljs-comment"># å…³é”®ä¿®å¤ï¼šå¢åŠ  if tables åˆ¤æ–­ï¼Œé˜²æ­¢ tables ä¸º None æ—¶æŠ¥é”™</span><br>                <span class="hljs-keyword">if</span> tables: <br>                    <span class="hljs-keyword">for</span> table <span class="hljs-keyword">in</span> tables:<br>                        table_data = table.extract()<br>                        result[<span class="hljs-string">&#x27;tables&#x27;</span>].append(&#123;<br>                            <span class="hljs-string">&#x27;page&#x27;</span>: page_num + <span class="hljs-number">1</span>,<br>                            <span class="hljs-string">&#x27;data&#x27;</span>: table_data,<br>                            <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;table&#x27;</span><br>                        &#125;)<br>            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âš ï¸ è­¦å‘Š: ç¬¬ <span class="hljs-subst">&#123;page_num + <span class="hljs-number">1</span>&#125;</span> é¡µè¡¨æ ¼æå–å¤±è´¥: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>            <span class="hljs-comment"># --- ä¿®å¤éƒ¨åˆ†ç»“æŸ ---</span><br><br>            <span class="hljs-comment"># æå–å›¾ç‰‡</span><br>            image_list = page.get_images()<br>            <span class="hljs-keyword">for</span> img_index, img <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(image_list):<br>                xref = img[<span class="hljs-number">0</span>]<br>                <span class="hljs-keyword">try</span>:<br>                    base_image = doc.extract_image(xref)<br>                    image_bytes = base_image[<span class="hljs-string">&quot;image&quot;</span>]<br><br>                    result[<span class="hljs-string">&#x27;texts&#x27;</span>].append(&#123;<br>                        <span class="hljs-string">&#x27;page&#x27;</span>: page_num + <span class="hljs-number">1</span>,<br>                        <span class="hljs-string">&#x27;content&#x27;</span>: <span class="hljs-string">f&quot;[å›¾ç‰‡ <span class="hljs-subst">&#123;img_index + <span class="hljs-number">1</span>&#125;</span>]&quot;</span>,<br>                        <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;image&#x27;</span>,<br>                        <span class="hljs-string">&#x27;image_data&#x27;</span>: image_bytes<br>                    &#125;)<br>                <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âš ï¸ å›¾ç‰‡æå–è­¦å‘Š: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br><br>        doc.close()<br>        <span class="hljs-keyword">return</span> result<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_directory</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>]:<br>        <span class="hljs-string">&quot;&quot;&quot;æ‰¹é‡å¤„ç†ç›®å½•ä¸­çš„æ‰€æœ‰PDF&quot;&quot;&quot;</span><br>        pdf_files = <span class="hljs-built_in">list</span>(<span class="hljs-variable language_">self</span>.data_dir.glob(<span class="hljs-string">&quot;*.pdf&quot;</span>))<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æ‰¾åˆ° <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(pdf_files)&#125;</span> ä¸ªPDFæ–‡ä»¶&quot;</span>)<br><br>        <span class="hljs-keyword">for</span> pdf_file <span class="hljs-keyword">in</span> pdf_files:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æ­£åœ¨å¤„ç†: <span class="hljs-subst">&#123;pdf_file.name&#125;</span>&quot;</span>)<br>            doc_info = <span class="hljs-variable language_">self</span>.parse_pdf(<span class="hljs-built_in">str</span>(pdf_file))<br>            <span class="hljs-variable language_">self</span>.extracted_docs.append(doc_info)<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âœ… å®Œæˆå¤„ç†ï¼Œå…± <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(self.extracted_docs)&#125;</span> ä¸ªæ–‡æ¡£&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.extracted_docs<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">save_extracted_text</span>(<span class="hljs-params">self, output_dir: <span class="hljs-built_in">str</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;ä¿å­˜æå–çš„æ–‡æœ¬&quot;&quot;&quot;</span><br>        output_path = Path(output_dir)<br>        output_path.mkdir(exist_ok=<span class="hljs-literal">True</span>)<br><br>        <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.extracted_docs:<br>            <span class="hljs-comment"># ä¿å­˜çº¯æ–‡æœ¬</span><br>            text_content = <span class="hljs-string">&quot;\n&quot;</span>.join([<br>                t[<span class="hljs-string">&#x27;content&#x27;</span>] <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> doc[<span class="hljs-string">&#x27;texts&#x27;</span>]<br>            ])<br><br>            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(output_path / <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;doc[<span class="hljs-string">&#x27;filename&#x27;</span>]&#125;</span>.txt&quot;</span>, <span class="hljs-string">&#x27;w&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>                f.write(text_content)<br><br>            <span class="hljs-comment"># ä¿å­˜è¡¨æ ¼CSV</span><br>            <span class="hljs-keyword">if</span> doc[<span class="hljs-string">&#x27;tables&#x27;</span>]:<br>                <span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br>                <span class="hljs-keyword">for</span> i, table <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(doc[<span class="hljs-string">&#x27;tables&#x27;</span>]):<br>                    df = pd.DataFrame(table[<span class="hljs-string">&#x27;data&#x27;</span>])<br>                    df.to_csv(output_path / <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;doc[<span class="hljs-string">&#x27;filename&#x27;</span>]&#125;</span>_table_<span class="hljs-subst">&#123;i&#125;</span>.csv&quot;</span>, index=<span class="hljs-literal">False</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âœ… æ–‡æœ¬å·²ä¿å­˜åˆ° <span class="hljs-subst">&#123;output_path&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure><h4 id="Step-2-æ„å»ºå¤šæ¨¡æ€RAGç³»ç»Ÿ"><a href="#Step-2-æ„å»ºå¤šæ¨¡æ€RAGç³»ç»Ÿ" class="headerlink" title="Step 2: æ„å»ºå¤šæ¨¡æ€RAGç³»ç»Ÿ"></a>Step 2: æ„å»ºå¤šæ¨¡æ€RAGç³»ç»Ÿ</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Dict</span>, <span class="hljs-type">Tuple</span><br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">from</span> sentence_transformers <span class="hljs-keyword">import</span> SentenceTransformer<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> faiss<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MultimodalRAG</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;å¤šæ¨¡æ€RAGç³»ç»Ÿï¼šæ”¯æŒæ–‡æœ¬å’Œè¡¨æ ¼&quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-variable language_">self</span>.text_model = SentenceTransformer(<span class="hljs-string">&#x27;all-MiniLM-L6-v2&#x27;</span>)<br>        <span class="hljs-variable language_">self</span>.text_chunks = []<br>        <span class="hljs-variable language_">self</span>.table_chunks = []<br>        <span class="hljs-variable language_">self</span>.text_index = <span class="hljs-literal">None</span><br>        <span class="hljs-variable language_">self</span>.table_index = <span class="hljs-literal">None</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">index_texts</span>(<span class="hljs-params">self, texts: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>], metadata: <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>] = <span class="hljs-literal">None</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;ç´¢å¼•æ–‡æœ¬&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">if</span> metadata <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>            metadata = [&#123;&#125;] * <span class="hljs-built_in">len</span>(texts)<br><br>        <span class="hljs-variable language_">self</span>.text_chunks = [<br>            &#123;<br>                <span class="hljs-string">&#x27;text&#x27;</span>: text,<br>                <span class="hljs-string">&#x27;metadata&#x27;</span>: meta,<br>                <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;text&#x27;</span><br>            &#125;<br>            <span class="hljs-keyword">for</span> text, meta <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(texts, metadata)<br>        ]<br><br>        embeddings = <span class="hljs-variable language_">self</span>.text_model.encode(texts)<br>        <span class="hljs-variable language_">self</span>.text_index = faiss.IndexFlatIP(embeddings.shape[<span class="hljs-number">1</span>])<br>        <span class="hljs-variable language_">self</span>.text_index.add(embeddings.astype(<span class="hljs-string">&#x27;float32&#x27;</span>))<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âœ… å·²ç´¢å¼• <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(texts)&#125;</span> ä¸ªæ–‡æœ¬å—&quot;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">index_tables</span>(<span class="hljs-params">self, table_files: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;ç´¢å¼•è¡¨æ ¼&quot;&quot;&quot;</span><br>        table_texts = []<br>        table_metadata = []<br><br>        <span class="hljs-keyword">for</span> file_path <span class="hljs-keyword">in</span> table_files:<br>            df = pd.read_csv(file_path)<br>            <span class="hljs-comment"># å°†è¡¨æ ¼è½¬æ¢ä¸ºæ–‡æœ¬æè¿°</span><br>            table_text = <span class="hljs-variable language_">self</span>._table_to_text(df, file_path)<br>            table_texts.append(table_text)<br>            table_metadata.append(&#123;<br>                <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;table&#x27;</span>,<br>                <span class="hljs-string">&#x27;file&#x27;</span>: file_path,<br>                <span class="hljs-string">&#x27;shape&#x27;</span>: df.shape<br>            &#125;)<br><br>        <span class="hljs-variable language_">self</span>.table_chunks = [<br>            &#123;<span class="hljs-string">&#x27;text&#x27;</span>: text, <span class="hljs-string">&#x27;metadata&#x27;</span>: meta, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;table&#x27;</span>&#125;<br>            <span class="hljs-keyword">for</span> text, meta <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(table_texts, table_metadata)<br>        ]<br><br>        <span class="hljs-comment"># ç´¢å¼•è¡¨æ ¼æ–‡æœ¬</span><br>        embeddings = <span class="hljs-variable language_">self</span>.text_model.encode(table_texts)<br>        <span class="hljs-variable language_">self</span>.table_index = faiss.IndexFlatIP(embeddings.shape[<span class="hljs-number">1</span>])<br>        <span class="hljs-variable language_">self</span>.table_index.add(embeddings.astype(<span class="hljs-string">&#x27;float32&#x27;</span>))<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âœ… å·²ç´¢å¼• <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(table_texts)&#125;</span> ä¸ªè¡¨æ ¼&quot;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_table_to_text</span>(<span class="hljs-params">self, df: pd.DataFrame, filename: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>        <span class="hljs-string">&quot;&quot;&quot;å°†è¡¨æ ¼è½¬æ¢ä¸ºæ–‡æœ¬æè¿°&quot;&quot;&quot;</span><br>        <span class="hljs-comment"># ç”Ÿæˆè¡¨æ ¼çš„æ–‡æœ¬è¡¨ç¤º</span><br>        text_parts = [<span class="hljs-string">f&quot;è¡¨æ ¼æ–‡ä»¶: <span class="hljs-subst">&#123;filename&#125;</span>&quot;</span>]<br><br>        <span class="hljs-comment"># æ·»åŠ è¡¨å¤´</span><br>        text_parts.append(<span class="hljs-string">f&quot;åˆ—å: <span class="hljs-subst">&#123;<span class="hljs-string">&#x27;, &#x27;</span>.join(df.columns.tolist())&#125;</span>&quot;</span>)<br><br>        <span class="hljs-comment"># æ·»åŠ å‰å‡ è¡Œæ•°æ®</span><br>        text_parts.append(<span class="hljs-string">&quot;æ•°æ®é¢„è§ˆ:&quot;</span>)<br>        <span class="hljs-keyword">for</span> i, row <span class="hljs-keyword">in</span> df.head(<span class="hljs-number">10</span>).iterrows():<br>            row_text = <span class="hljs-string">&quot;, &quot;</span>.join([<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;col&#125;</span>: <span class="hljs-subst">&#123;val&#125;</span>&quot;</span> <span class="hljs-keyword">for</span> col, val <span class="hljs-keyword">in</span> row.items()])<br>            text_parts.append(row_text)<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;\n&quot;</span>.join(text_parts)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">hybrid_search</span>(<span class="hljs-params"></span><br><span class="hljs-params">        self,</span><br><span class="hljs-params">        query: <span class="hljs-built_in">str</span>,</span><br><span class="hljs-params">        k: <span class="hljs-built_in">int</span> = <span class="hljs-number">5</span>,</span><br><span class="hljs-params">        text_weight: <span class="hljs-built_in">float</span> = <span class="hljs-number">0.7</span>,</span><br><span class="hljs-params">        table_weight: <span class="hljs-built_in">float</span> = <span class="hljs-number">0.3</span></span><br><span class="hljs-params">    </span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>]:<br>        <span class="hljs-string">&quot;&quot;&quot;æ··åˆæ£€ç´¢ï¼šæ–‡æœ¬ + è¡¨æ ¼&quot;&quot;&quot;</span><br>        query_embedding = <span class="hljs-variable language_">self</span>.text_model.encode([query])[<span class="hljs-number">0</span>]<br><br>        results = []<br><br>        <span class="hljs-comment"># æ–‡æœ¬æ£€ç´¢</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.text_index:<br>            text_scores, text_indices = <span class="hljs-variable language_">self</span>.text_index.search(<br>                query_embedding.reshape(<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>).astype(<span class="hljs-string">&#x27;float32&#x27;</span>),<br>                k<br>            )<br>            <span class="hljs-keyword">for</span> score, idx <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(text_scores[<span class="hljs-number">0</span>], text_indices[<span class="hljs-number">0</span>]):<br>                results.append(&#123;<br>                    <span class="hljs-string">&#x27;chunk&#x27;</span>: <span class="hljs-variable language_">self</span>.text_chunks[idx],<br>                    <span class="hljs-string">&#x27;score&#x27;</span>: score * text_weight,<br>                    <span class="hljs-string">&#x27;source&#x27;</span>: <span class="hljs-string">&#x27;text&#x27;</span><br>                &#125;)<br><br>        <span class="hljs-comment"># è¡¨æ ¼æ£€ç´¢</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.table_index:<br>            table_scores, table_indices = <span class="hljs-variable language_">self</span>.table_index.search(<br>                query_embedding.reshape(<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>).astype(<span class="hljs-string">&#x27;float32&#x27;</span>),<br>                k<br>            )<br>            <span class="hljs-keyword">for</span> score, idx <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(table_scores[<span class="hljs-number">0</span>], table_indices[<span class="hljs-number">0</span>]):<br>                results.append(&#123;<br>                    <span class="hljs-string">&#x27;chunk&#x27;</span>: <span class="hljs-variable language_">self</span>.table_chunks[idx],<br>                    <span class="hljs-string">&#x27;score&#x27;</span>: score * table_weight,<br>                    <span class="hljs-string">&#x27;source&#x27;</span>: <span class="hljs-string">&#x27;table&#x27;</span><br>                &#125;)<br><br>        <span class="hljs-comment"># æŒ‰åˆ†æ•°æ’åº</span><br>        results.sort(key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-string">&#x27;score&#x27;</span>], reverse=<span class="hljs-literal">True</span>)<br><br>        <span class="hljs-keyword">return</span> results[:k]<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_company_comparison</span>(<span class="hljs-params"></span><br><span class="hljs-params">        self,</span><br><span class="hljs-params">        query: <span class="hljs-built_in">str</span>,</span><br><span class="hljs-params">        company_a: <span class="hljs-built_in">str</span>,</span><br><span class="hljs-params">        company_b: <span class="hljs-built_in">str</span></span><br><span class="hljs-params">    </span>) -&gt; <span class="hljs-type">Dict</span>:<br>        <span class="hljs-string">&quot;&quot;&quot;åˆ†æä¸¤å®¶å…¬å¸å¯¹æ¯”&quot;&quot;&quot;</span><br>        <span class="hljs-comment"># æ£€ç´¢ç›¸å…³æ–‡æ¡£</span><br>        results = <span class="hljs-variable language_">self</span>.hybrid_search(query, k=<span class="hljs-number">10</span>)<br><br>        <span class="hljs-comment"># æå–ä¸¤å®¶å…¬å¸çš„ä¿¡æ¯</span><br>        company_a_info = []<br>        company_b_info = []<br><br>        <span class="hljs-keyword">for</span> result <span class="hljs-keyword">in</span> results:<br>            text = result[<span class="hljs-string">&#x27;chunk&#x27;</span>][<span class="hljs-string">&#x27;text&#x27;</span>].lower()<br>            <span class="hljs-keyword">if</span> company_a.lower() <span class="hljs-keyword">in</span> text:<br>                company_a_info.append(result)<br>            <span class="hljs-keyword">elif</span> company_b.lower() <span class="hljs-keyword">in</span> text:<br>                company_b_info.append(result)<br><br>        <span class="hljs-comment"># ç”Ÿæˆå¯¹æ¯”æŠ¥å‘Š</span><br>        report = <span class="hljs-variable language_">self</span>._generate_comparison_report(<br>            query, company_a, company_b,<br>            company_a_info, company_b_info<br>        )<br><br>        <span class="hljs-keyword">return</span> &#123;<br>            <span class="hljs-string">&#x27;query&#x27;</span>: query,<br>            <span class="hljs-string">&#x27;company_a&#x27;</span>: company_a,<br>            <span class="hljs-string">&#x27;company_b&#x27;</span>: company_b,<br>            <span class="hljs-string">&#x27;company_a_results&#x27;</span>: company_a_info,<br>            <span class="hljs-string">&#x27;company_b_results&#x27;</span>: company_b_info,<br>            <span class="hljs-string">&#x27;comparison_report&#x27;</span>: report<br>        &#125;<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_generate_comparison_report</span>(<span class="hljs-params"></span><br><span class="hljs-params">        self,</span><br><span class="hljs-params">        query: <span class="hljs-built_in">str</span>,</span><br><span class="hljs-params">        company_a: <span class="hljs-built_in">str</span>,</span><br><span class="hljs-params">        company_b: <span class="hljs-built_in">str</span>,</span><br><span class="hljs-params">        info_a: <span class="hljs-type">List</span>,</span><br><span class="hljs-params">        info_b: <span class="hljs-type">List</span></span><br><span class="hljs-params">    </span>) -&gt; <span class="hljs-built_in">str</span>:<br>        <span class="hljs-string">&quot;&quot;&quot;ç”Ÿæˆå¯¹æ¯”æŠ¥å‘Š&quot;&quot;&quot;</span><br>        report = <span class="hljs-string">f&quot;ğŸ“Š <span class="hljs-subst">&#123;company_a&#125;</span> vs <span class="hljs-subst">&#123;company_b&#125;</span> å¯¹æ¯”åˆ†æ\n&quot;</span><br>        report += <span class="hljs-string">f&quot;æŸ¥è¯¢: <span class="hljs-subst">&#123;query&#125;</span>\n\n&quot;</span><br><br>        report += <span class="hljs-string">f&quot;ã€<span class="hljs-subst">&#123;company_a&#125;</span>ã€‘\n&quot;</span><br>        <span class="hljs-keyword">if</span> info_a:<br>            <span class="hljs-keyword">for</span> result <span class="hljs-keyword">in</span> info_a:<br>                report += <span class="hljs-string">f&quot;- <span class="hljs-subst">&#123;result[<span class="hljs-string">&#x27;chunk&#x27;</span>][<span class="hljs-string">&#x27;text&#x27;</span>][:<span class="hljs-number">200</span>]&#125;</span>...\n&quot;</span><br>        <span class="hljs-keyword">else</span>:<br>            report += <span class="hljs-string">&quot;- æœªæ‰¾åˆ°ç›¸å…³ä¿¡æ¯\n&quot;</span><br><br>        report += <span class="hljs-string">f&quot;\nã€<span class="hljs-subst">&#123;company_b&#125;</span>ã€‘\n&quot;</span><br>        <span class="hljs-keyword">if</span> info_b:<br>            <span class="hljs-keyword">for</span> result <span class="hljs-keyword">in</span> info_b:<br>                report += <span class="hljs-string">f&quot;- <span class="hljs-subst">&#123;result[<span class="hljs-string">&#x27;chunk&#x27;</span>][<span class="hljs-string">&#x27;text&#x27;</span>][:<span class="hljs-number">200</span>]&#125;</span>...\n&quot;</span><br>        <span class="hljs-keyword">else</span>:<br>            report += <span class="hljs-string">&quot;- æœªæ‰¾åˆ°ç›¸å…³ä¿¡æ¯\n&quot;</span><br><br>        report += <span class="hljs-string">&quot;\nå»ºè®®: æ‰‹åŠ¨æŸ¥çœ‹æ£€ç´¢åˆ°çš„æ–‡æ¡£ä»¥è·å–è¯¦ç»†æ•°æ®&quot;</span><br><br>        <span class="hljs-keyword">return</span> report<br><br><span class="hljs-comment"># ä¸»ç¨‹åº</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-comment"># ç¤ºä¾‹ä½¿ç”¨</span><br>    parser = InvestmentDocumentParser(<span class="hljs-string">&quot;C:\\Users\\Admin\\Desktop\\code\\Live_And_Learn\\Agent_Learning\\Stage_3&quot;</span>)<br>    docs = parser.process_directory()<br>    parser.save_extracted_text(<span class="hljs-string">&quot;extracted_texts&quot;</span>)<br><br>    <span class="hljs-comment"># è·å–æå–çš„æ–‡æœ¬æ–‡ä»¶</span><br>    text_files = <span class="hljs-built_in">list</span>(Path(<span class="hljs-string">&quot;extracted_texts&quot;</span>).glob(<span class="hljs-string">&quot;*.txt&quot;</span>))<br>    table_files = <span class="hljs-built_in">list</span>(Path(<span class="hljs-string">&quot;extracted_texts&quot;</span>).glob(<span class="hljs-string">&quot;*.csv&quot;</span>))<br><br>    <span class="hljs-comment"># æ„å»ºRAG</span><br>    rag = MultimodalRAG()<br>    rag.index_texts([<span class="hljs-built_in">open</span>(f, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>).read() <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> text_files[:<span class="hljs-number">10</span>]])<br>    rag.index_tables(table_files)<br><br>    <span class="hljs-comment"># æµ‹è¯•å¯¹æ¯”æŸ¥è¯¢</span><br>    comparison = rag.analyze_company_comparison(<br>        <span class="hljs-string">&quot;è¥æ”¶å¢é•¿ç‡&quot;</span>,<br>        <span class="hljs-string">&quot;é˜¿é‡Œ&quot;</span>,<br>        <span class="hljs-string">&quot;è…¾è®¯&quot;</span><br>    )<br><br>    <span class="hljs-built_in">print</span>(comparison[<span class="hljs-string">&#x27;comparison_report&#x27;</span>])<br></code></pre></td></tr></table></figure><pre><code class="hljs">æ‰¾åˆ° 3 ä¸ªPDFæ–‡ä»¶æ­£åœ¨å¤„ç†: albb.pdfæ­£åœ¨å¤„ç†: anthropic.pdffind_tables: exception occurred: code=4: no font file for digestæ­£åœ¨å¤„ç†: tencent.pdfâœ… å®Œæˆå¤„ç†ï¼Œå…± 3 ä¸ªæ–‡æ¡£âœ… æ–‡æœ¬å·²ä¿å­˜åˆ° extracted_textsâœ… å·²ç´¢å¼• 3 ä¸ªæ–‡æœ¬å—âœ… å·²ç´¢å¼• 34 ä¸ªè¡¨æ ¼ğŸ“Š é˜¿é‡Œ vs è…¾è®¯ å¯¹æ¯”åˆ†ææŸ¥è¯¢: è¥æ”¶å¢é•¿ç‡çœç•¥å»ºè®®: æ‰‹åŠ¨æŸ¥çœ‹æ£€ç´¢åˆ°çš„æ–‡æ¡£ä»¥è·å–è¯¦ç»†æ•°æ®</code></pre>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Agent </tag>
            
            <tag> RAG </tag>
            
            <tag> æ–‡æœ¬åˆ‡åˆ† </tag>
            
            <tag> æ··åˆæ£€ç´¢ </tag>
            
            <tag> é‡æ’åº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Agent å­¦ä¹ å®éªŒç¬”è®°ï¼šæ„å»ºä¸ç‰ˆ RAG ç³»ç»Ÿ</title>
      <link href="/2025/12/02/Agent%20Learning/%E6%9E%84%E5%BB%BA%E4%B8%90%E7%89%88%20RAG%20%E7%B3%BB%E7%BB%9F%20(%E9%98%B6%E6%AE%B52)/"/>
      <url>/2025/12/02/Agent%20Learning/%E6%9E%84%E5%BB%BA%E4%B8%90%E7%89%88%20RAG%20%E7%B3%BB%E7%BB%9F%20(%E9%98%B6%E6%AE%B52)/</url>
      
        <content type="html"><![CDATA[<h1 id="Agent-å­¦ä¹ å®éªŒç¬”è®°ï¼šæ„å»ºä¸ç‰ˆ-RAG-ç³»ç»Ÿ-é˜¶æ®µ2"><a href="#Agent-å­¦ä¹ å®éªŒç¬”è®°ï¼šæ„å»ºä¸ç‰ˆ-RAG-ç³»ç»Ÿ-é˜¶æ®µ2" class="headerlink" title="Agent å­¦ä¹ å®éªŒç¬”è®°ï¼šæ„å»ºä¸ç‰ˆ RAG ç³»ç»Ÿ (é˜¶æ®µ2)"></a>Agent å­¦ä¹ å®éªŒç¬”è®°ï¼šæ„å»ºä¸ç‰ˆ RAG ç³»ç»Ÿ (é˜¶æ®µ2)</h1><blockquote><p><strong>æ ¸å¿ƒç†å¿µ</strong>ï¼šå…ˆæ‰‹åŠ¨é€ è½®å­ï¼ˆå»æ¡†æ¶åŒ–ï¼‰ï¼Œæ·±åº¦ç†è§£æ•°æ®æµè½¬å…¨æµç¨‹ï¼Œå†è°ˆå·¥ç¨‹ä¼˜åŒ–ã€‚</p></blockquote><hr><h2 id="å®éªŒç›®æ ‡"><a href="#å®éªŒç›®æ ‡" class="headerlink" title="å®éªŒç›®æ ‡"></a>å®éªŒç›®æ ‡</h2><ol><li><strong>å®Œå…¨è„±ç¦»æ¡†æ¶</strong>ï¼Œä»é›¶æ­å»ºä¸€ä¸ªå¯å·¥ä½œçš„ RAG ç³»ç»Ÿ</li><li><strong>ç†è§£æ•°æ®æµè½¬é“¾è·¯</strong>ï¼šText â†’ Embedding â†’ Vector Store â†’ Retrieval â†’ Prompt â†’ Generation</li><li><strong>æŒæ¡æ ¸å¿ƒç»„ä»¶</strong>ï¼šEmbeddingæ¨¡å‹ã€å‘é‡æ•°æ®åº“ã€LLM APIè°ƒç”¨</li><li><strong>åŸ¹å…»é—®é¢˜å®šä½èƒ½åŠ›</strong>ï¼šå½“æ£€ç´¢æ•ˆæœä¸ä½³æ—¶ï¼Œèƒ½åˆ†ææ˜¯å“ªä¸ªç¯èŠ‚å‡ºäº†é—®é¢˜</li></ol><hr><h2 id="å®éªŒç¯å¢ƒå‡†å¤‡"><a href="#å®éªŒç¯å¢ƒå‡†å¤‡" class="headerlink" title="å®éªŒç¯å¢ƒå‡†å¤‡"></a>å®éªŒç¯å¢ƒå‡†å¤‡</h2><h3 id="å®‰è£…ä¾èµ–"><a href="#å®‰è£…ä¾èµ–" class="headerlink" title="å®‰è£…ä¾èµ–"></a>å®‰è£…ä¾èµ–</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰</span><br><br><span class="hljs-comment"># å®‰è£…æ ¸å¿ƒä¾èµ–</span><br>pip install sentence-transformers<br>pip install faiss-cpu  <span class="hljs-comment"># æˆ– pip install faiss-gpu (å¦‚æœæœ‰GPU)</span><br>pip install openai<br>pip install numpy<br>pip install pandas<br></code></pre></td></tr></table></figure><h3 id="ç¯å¢ƒæµ‹è¯•"><a href="#ç¯å¢ƒæµ‹è¯•" class="headerlink" title="ç¯å¢ƒæµ‹è¯•"></a>ç¯å¢ƒæµ‹è¯•</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sentence_transformers<br><span class="hljs-keyword">import</span> faiss<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;âœ… ç¯å¢ƒæµ‹è¯•é€šè¿‡ï¼&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;sentence-transformers ç‰ˆæœ¬: <span class="hljs-subst">&#123;sentence_transformers.__version__&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;FAISS ç‰ˆæœ¬: <span class="hljs-subst">&#123;faiss.__version__&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;NumPy ç‰ˆæœ¬: <span class="hljs-subst">&#123;np.__version__&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure><pre><code class="hljs">âœ… ç¯å¢ƒæµ‹è¯•é€šè¿‡ï¼sentence-transformers ç‰ˆæœ¬: 5.1.2FAISS ç‰ˆæœ¬: 1.13.0NumPy ç‰ˆæœ¬: 2.2.5</code></pre><h2 id="å®éªŒä¸€ï¼šæ•°æ®åˆ‡åˆ†ä¸å‘é‡åŒ–"><a href="#å®éªŒä¸€ï¼šæ•°æ®åˆ‡åˆ†ä¸å‘é‡åŒ–" class="headerlink" title="å®éªŒä¸€ï¼šæ•°æ®åˆ‡åˆ†ä¸å‘é‡åŒ–"></a>å®éªŒä¸€ï¼šæ•°æ®åˆ‡åˆ†ä¸å‘é‡åŒ–</h2><h2 id="å®éªŒç›®æ ‡ï¼š"><a href="#å®éªŒç›®æ ‡ï¼š" class="headerlink" title="å®éªŒç›®æ ‡ï¼š"></a>å®éªŒç›®æ ‡ï¼š</h2><p>å°†æ–‡æ¡£åˆ‡åˆ†æˆå¯ç®¡ç†çš„æ–‡æœ¬å—ï¼ˆChunksï¼‰ï¼Œå¹¶è½¬æ¢ä¸ºå‘é‡è¡¨ç¤ºã€‚</p><h3 id="ç†è®ºåŸºç¡€"><a href="#ç†è®ºåŸºç¡€" class="headerlink" title="ç†è®ºåŸºç¡€"></a>ç†è®ºåŸºç¡€</h3><h4 id="1-ä¸ºä»€ä¹ˆè¦åˆ‡åˆ†ï¼Ÿ"><a href="#1-ä¸ºä»€ä¹ˆè¦åˆ‡åˆ†ï¼Ÿ" class="headerlink" title="1. ä¸ºä»€ä¹ˆè¦åˆ‡åˆ†ï¼Ÿ"></a>1. ä¸ºä»€ä¹ˆè¦åˆ‡åˆ†ï¼Ÿ</h4><ul><li><strong>ä¸Šä¸‹æ–‡çª—å£é™åˆ¶</strong>ï¼šLLMçš„è¾“å…¥æœ‰é•¿åº¦é™åˆ¶ï¼ˆGPT-4çº¦32K tokensï¼ŒClaudeçº¦200K tokensï¼‰</li><li><strong>æ£€ç´¢æ•ˆç‡</strong>ï¼šå°å—æ›´å®¹æ˜“æ‰¾åˆ°ç²¾ç¡®åŒ¹é…</li><li><strong>æˆæœ¬æ§åˆ¶</strong>ï¼šå°å—å‡å°‘tokenæ•°é‡ï¼Œé™ä½APIè°ƒç”¨æˆæœ¬</li></ul><h4 id="2-åˆ‡åˆ†ç­–ç•¥"><a href="#2-åˆ‡åˆ†ç­–ç•¥" class="headerlink" title="2. åˆ‡åˆ†ç­–ç•¥"></a>2. åˆ‡åˆ†ç­–ç•¥</h4><table><thead><tr><th>ç­–ç•¥</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>å›ºå®šé•¿åº¦</td><td>ç®€å•å¿«é€Ÿ</td><td>å¯èƒ½åˆ‡æ–­è¯­ä¹‰</td><td>æ—¥å¿—ã€ä»£ç </td></tr><tr><td>è¯­ä¹‰åˆ‡åˆ†</td><td>ä¿æŒè¯­ä¹‰å®Œæ•´</td><td>å®ç°å¤æ‚</td><td>æ–‡æ¡£ã€è®ºæ–‡</td></tr><tr><td>é€’å½’åˆ‡åˆ†</td><td>å¹³è¡¡é€Ÿåº¦ä¸è´¨é‡</td><td>éœ€è¦è°ƒå‚</td><td>é€šç”¨åœºæ™¯</td></tr></tbody></table><h3 id="å®éªŒæ­¥éª¤"><a href="#å®éªŒæ­¥éª¤" class="headerlink" title="å®éªŒæ­¥éª¤"></a>å®éªŒæ­¥éª¤</h3><h4 id="Step-1-åŸºç¡€æ–‡æœ¬åˆ‡åˆ†"><a href="#Step-1-åŸºç¡€æ–‡æœ¬åˆ‡åˆ†" class="headerlink" title="Step 1: åŸºç¡€æ–‡æœ¬åˆ‡åˆ†"></a>Step 1: åŸºç¡€æ–‡æœ¬åˆ‡åˆ†</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">chunk_text_fixed_length</span>(<span class="hljs-params">text, chunk_size=<span class="hljs-number">200</span>, overlap=<span class="hljs-number">20</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    å›ºå®šé•¿åº¦åˆ‡åˆ†ï¼Œå¸¦é‡å çª—å£</span><br><span class="hljs-string">    :param text: è¾“å…¥æ–‡æœ¬</span><br><span class="hljs-string">    :param chunk_size: æ¯å—å­—ç¬¦æ•°</span><br><span class="hljs-string">    :param overlap: é‡å å­—ç¬¦æ•°</span><br><span class="hljs-string">    :return: æ–‡æœ¬å—åˆ—è¡¨</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    chunks = []<br>    start = <span class="hljs-number">0</span><br><br>    <span class="hljs-keyword">while</span> start &lt; <span class="hljs-built_in">len</span>(text):<br>        end = start + chunk_size<br>        chunk = text[start:end]<br>        chunks.append(chunk)<br><br>        <span class="hljs-comment"># ä¸‹ä¸€å—ä» end-overlap å¼€å§‹</span><br>        start = end - overlap<br><br>        <span class="hljs-comment"># é˜²æ­¢æ— é™å¾ªç¯</span><br>        <span class="hljs-keyword">if</span> start &gt;= <span class="hljs-built_in">len</span>(text):<br>            <span class="hljs-keyword">break</span><br><br>        <span class="hljs-keyword">if</span> start &lt;= <span class="hljs-number">0</span>:  <span class="hljs-comment"># å¤„ç†æçŸ­æ–‡æœ¬</span><br>            <span class="hljs-keyword">break</span><br><br>    <span class="hljs-keyword">return</span> chunks<br><br><span class="hljs-comment"># æµ‹è¯•</span><br>sample_text = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">äººå·¥æ™ºèƒ½ï¼ˆArtificial Intelligenceï¼ŒAIï¼‰æ˜¯è®¡ç®—æœºç§‘å­¦çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œ</span><br><span class="hljs-string">å®ƒä¼å›¾äº†è§£æ™ºèƒ½çš„å®è´¨ï¼Œå¹¶ç”Ÿäº§å‡ºä¸€ç§æ–°çš„èƒ½ä»¥äººç±»æ™ºèƒ½ç›¸ä¼¼çš„æ–¹å¼åšå‡ºååº”çš„æ™ºèƒ½æœºå™¨ã€‚</span><br><span class="hljs-string">åŒ…æ‹¬æœºå™¨äººã€è¯­è¨€è¯†åˆ«ã€å›¾åƒè¯†åˆ«ã€è‡ªç„¶è¯­è¨€å¤„ç†å’Œä¸“å®¶ç³»ç»Ÿç­‰ã€‚</span><br><span class="hljs-string">äººå·¥æ™ºèƒ½çš„æ ¸å¿ƒé—®é¢˜åŒ…æ‹¬å»ºæ„èƒ½å¤Ÿè¡¨ç°å‡ºä¸äººç±»æ™ºèƒ½ç›¸å…³çš„èƒ½åŠ›ï¼Œ</span><br><span class="hljs-string">å¦‚æ¨ç†ã€å­¦ä¹ å’Œè§£å†³é—®é¢˜çš„èƒ½åŠ›ã€‚æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œ</span><br><span class="hljs-string">å®ƒä½¿ç”¨ç»Ÿè®¡æŠ€æœ¯è®©è®¡ç®—æœºä»æ•°æ®ä¸­&quot;å­¦ä¹ &quot;ï¼Œè€Œä¸éœ€è¦æ˜ç¡®ç¼–ç¨‹ã€‚</span><br><span class="hljs-string">æ·±åº¦å­¦ä¹ æ˜¯æœºå™¨å­¦ä¹ çš„å­é›†ï¼Œå®ƒä½¿ç”¨å¤šå±‚ç¥ç»ç½‘ç»œæ¥æ¨¡æ‹Ÿäººç±»å¤§è„‘çš„å­¦ä¹ è¿‡ç¨‹ã€‚</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br>chunks = chunk_text_fixed_length(sample_text, chunk_size=<span class="hljs-number">100</span>, overlap=<span class="hljs-number">20</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;åŸå§‹æ–‡æœ¬é•¿åº¦: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(sample_text)&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;åˆ‡åˆ†æˆ <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(chunks)&#125;</span> ä¸ªç‰‡æ®µ:&quot;</span>)<br><span class="hljs-keyword">for</span> i, chunk <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(chunks):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n--- ç‰‡æ®µ <span class="hljs-subst">&#123;i+<span class="hljs-number">1</span>&#125;</span> ---&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;é•¿åº¦: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(chunk)&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(chunk)<br></code></pre></td></tr></table></figure><pre><code class="hljs">åŸå§‹æ–‡æœ¬é•¿åº¦: 244åˆ‡åˆ†æˆ 4 ä¸ªç‰‡æ®µ:--- ç‰‡æ®µ 1 ---é•¿åº¦: 100äººå·¥æ™ºèƒ½ï¼ˆArtificial Intelligenceï¼ŒAIï¼‰æ˜¯è®¡ç®—æœºç§‘å­¦çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œå®ƒä¼å›¾äº†è§£æ™ºèƒ½çš„å®è´¨ï¼Œå¹¶ç”Ÿäº§å‡ºä¸€ç§æ–°çš„èƒ½ä»¥äººç±»æ™ºèƒ½ç›¸ä¼¼çš„æ–¹å¼åšå‡ºååº”çš„æ™ºèƒ½æœºå™¨ã€‚åŒ…æ‹¬æœºå™¨äººã€è¯­è¨€è¯†åˆ«ã€å›¾åƒ--- ç‰‡æ®µ 2 ---é•¿åº¦: 100çš„æ™ºèƒ½æœºå™¨ã€‚åŒ…æ‹¬æœºå™¨äººã€è¯­è¨€è¯†åˆ«ã€å›¾åƒè¯†åˆ«ã€è‡ªç„¶è¯­è¨€å¤„ç†å’Œä¸“å®¶ç³»ç»Ÿç­‰ã€‚äººå·¥æ™ºèƒ½çš„æ ¸å¿ƒé—®é¢˜åŒ…æ‹¬å»ºæ„èƒ½å¤Ÿè¡¨ç°å‡ºä¸äººç±»æ™ºèƒ½ç›¸å…³çš„èƒ½åŠ›ï¼Œå¦‚æ¨ç†ã€å­¦ä¹ å’Œè§£å†³é—®é¢˜çš„èƒ½åŠ›ã€‚æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œå®ƒä½¿--- ç‰‡æ®µ 3 ---é•¿åº¦: 84åŠ›ã€‚æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œå®ƒä½¿ç”¨ç»Ÿè®¡æŠ€æœ¯è®©è®¡ç®—æœºä»æ•°æ®ä¸­&quot;å­¦ä¹ &quot;ï¼Œè€Œä¸éœ€è¦æ˜ç¡®ç¼–ç¨‹ã€‚æ·±åº¦å­¦ä¹ æ˜¯æœºå™¨å­¦ä¹ çš„å­é›†ï¼Œå®ƒä½¿ç”¨å¤šå±‚ç¥ç»ç½‘ç»œæ¥æ¨¡æ‹Ÿäººç±»å¤§è„‘çš„å­¦ä¹ è¿‡ç¨‹ã€‚--- ç‰‡æ®µ 4 ---é•¿åº¦: 4è¿‡ç¨‹ã€‚</code></pre><p><strong>Step 2</strong>: é«˜çº§è¯­ä¹‰åˆ‡åˆ†ï¼ˆè¿›é˜¶ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">chunk_text_sentence_aware</span>(<span class="hljs-params">text, max_chars=<span class="hljs-number">200</span>, max_sentences=<span class="hljs-number">3</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    åŸºäºå¥å­çš„æ™ºèƒ½åˆ‡åˆ†</span><br><span class="hljs-string">    :param text: è¾“å…¥æ–‡æœ¬</span><br><span class="hljs-string">    :param max_chars: æœ€å¤§å­—ç¬¦æ•°</span><br><span class="hljs-string">    :param max_sentences: æœ€å¤§å¥å­æ•°</span><br><span class="hljs-string">    :return: æ–‡æœ¬å—åˆ—è¡¨</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># æŒ‰å¥å­åˆ†å‰²ï¼ˆä½¿ç”¨æ›´æ™ºèƒ½çš„æ­£åˆ™ï¼‰</span><br>    sentences = re.split(<span class="hljs-string">r&#x27;[ã€‚ï¼ï¼Ÿ.!?]\s*&#x27;</span>, text)<br>    sentences = [s.strip() <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> sentences <span class="hljs-keyword">if</span> s.strip()]<br><br>    chunks = []<br>    current_chunk = <span class="hljs-string">&quot;&quot;</span><br><br>    <span class="hljs-keyword">for</span> sentence <span class="hljs-keyword">in</span> sentences:<br>        <span class="hljs-comment"># å¦‚æœåŠ ä¸Šè¿™ä¸ªå¥å­ä¼šè¶…å‡ºé™åˆ¶ï¼Œä¸”å½“å‰chunkä¸ä¸ºç©º</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(current_chunk + sentence) &gt; max_chars <span class="hljs-keyword">and</span> current_chunk:<br>            chunks.append(current_chunk)<br>            current_chunk = sentence<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">if</span> current_chunk:<br>                current_chunk += <span class="hljs-string">&quot;ã€‚&quot;</span> + sentence<br>            <span class="hljs-keyword">else</span>:<br>                current_chunk = sentence<br><br>        <span class="hljs-comment"># å¦‚æœchunkä¸­çš„å¥å­æ•°å·²ç»è¾¾åˆ°ä¸Šé™</span><br>        <span class="hljs-keyword">if</span> current_chunk.count(<span class="hljs-string">&#x27;ã€‚&#x27;</span>) + current_chunk.count(<span class="hljs-string">&#x27;!&#x27;</span>) + current_chunk.count(<span class="hljs-string">&#x27;?&#x27;</span>) &gt;= max_sentences:<br>            chunks.append(current_chunk)<br>            current_chunk = <span class="hljs-string">&quot;&quot;</span><br><br>    <span class="hljs-comment"># æ·»åŠ æœ€åä¸€ä¸ªchunk</span><br>    <span class="hljs-keyword">if</span> current_chunk:<br>        chunks.append(current_chunk)<br><br>    <span class="hljs-keyword">return</span> chunks<br><br><span class="hljs-comment"># æµ‹è¯•</span><br>chunks = chunk_text_sentence_aware(sample_text, max_chars=<span class="hljs-number">150</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;è¯­ä¹‰åˆ‡åˆ†æˆ <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(chunks)&#125;</span> ä¸ªç‰‡æ®µ&quot;</span>)<br><span class="hljs-keyword">for</span> i, chunk <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(chunks):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n--- ç‰‡æ®µ <span class="hljs-subst">&#123;i+<span class="hljs-number">1</span>&#125;</span> ---&quot;</span>)<br>    <span class="hljs-built_in">print</span>(chunk)<br></code></pre></td></tr></table></figure><pre><code class="hljs">è¯­ä¹‰åˆ‡åˆ†æˆ 2 ä¸ªç‰‡æ®µ--- ç‰‡æ®µ 1 ---äººå·¥æ™ºèƒ½ï¼ˆArtificial Intelligenceï¼ŒAIï¼‰æ˜¯è®¡ç®—æœºç§‘å­¦çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œå®ƒä¼å›¾äº†è§£æ™ºèƒ½çš„å®è´¨ï¼Œå¹¶ç”Ÿäº§å‡ºä¸€ç§æ–°çš„èƒ½ä»¥äººç±»æ™ºèƒ½ç›¸ä¼¼çš„æ–¹å¼åšå‡ºååº”çš„æ™ºèƒ½æœºå™¨ã€‚åŒ…æ‹¬æœºå™¨äººã€è¯­è¨€è¯†åˆ«ã€å›¾åƒè¯†åˆ«ã€è‡ªç„¶è¯­è¨€å¤„ç†å’Œä¸“å®¶ç³»ç»Ÿç­‰--- ç‰‡æ®µ 2 ---äººå·¥æ™ºèƒ½çš„æ ¸å¿ƒé—®é¢˜åŒ…æ‹¬å»ºæ„èƒ½å¤Ÿè¡¨ç°å‡ºä¸äººç±»æ™ºèƒ½ç›¸å…³çš„èƒ½åŠ›ï¼Œå¦‚æ¨ç†ã€å­¦ä¹ å’Œè§£å†³é—®é¢˜çš„èƒ½åŠ›ã€‚æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œå®ƒä½¿ç”¨ç»Ÿè®¡æŠ€æœ¯è®©è®¡ç®—æœºä»æ•°æ®ä¸­&quot;å­¦ä¹ &quot;ï¼Œè€Œä¸éœ€è¦æ˜ç¡®ç¼–ç¨‹ã€‚æ·±åº¦å­¦ä¹ æ˜¯æœºå™¨å­¦ä¹ çš„å­é›†ï¼Œå®ƒä½¿ç”¨å¤šå±‚ç¥ç»ç½‘ç»œæ¥æ¨¡æ‹Ÿäººç±»å¤§è„‘çš„å­¦ä¹ è¿‡ç¨‹</code></pre><p><strong>Step 3</strong>: æ–‡æœ¬å‘é‡åŒ–</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># experiment_1_embedding.py</span><br><span class="hljs-keyword">from</span> sentence_transformers <span class="hljs-keyword">import</span> SentenceTransformer<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><span class="hljs-comment"># åŠ è½½é¢„è®­ç»ƒæ¨¡å‹</span><br>model = SentenceTransformer(<span class="hljs-string">&#x27;all-MiniLM-L6-v2&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">embed_chunks</span>(<span class="hljs-params">chunks</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    å°†æ–‡æœ¬å—è½¬æ¢ä¸ºå‘é‡</span><br><span class="hljs-string">    :param chunks: æ–‡æœ¬å—åˆ—è¡¨</span><br><span class="hljs-string">    :return: å‘é‡æ•°ç»„ (numpy array)</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    embeddings = model.encode(chunks)<br>    <span class="hljs-keyword">return</span> embeddings<br><br><span class="hljs-comment"># å®éªŒ</span><br>chunks = chunk_text_fixed_length(sample_text, chunk_size=<span class="hljs-number">100</span>, overlap=<span class="hljs-number">20</span>)<br>embeddings = embed_chunks(chunks)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æ–‡æœ¬å—æ•°é‡: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(chunks)&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;å‘é‡ç»´åº¦: <span class="hljs-subst">&#123;embeddings.shape&#125;</span>&quot;</span>)  <span class="hljs-comment"># åº”è¯¥æ˜¯ (chunk_count, 384)</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;å‘é‡ç±»å‹: <span class="hljs-subst">&#123;<span class="hljs-built_in">type</span>(embeddings)&#125;</span>&quot;</span>)<br><br><span class="hljs-comment"># æŸ¥çœ‹ç¬¬ä¸€ä¸ªå‘é‡çš„å‰5ä¸ªç»´åº¦</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\nç¬¬ä¸€ä¸ªå‘é‡ (å‰5ç»´): <span class="hljs-subst">&#123;embeddings[<span class="hljs-number">0</span>][:<span class="hljs-number">5</span>]&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure><pre><code class="hljs">æ–‡æœ¬å—æ•°é‡: 4å‘é‡ç»´åº¦: (4, 384)å‘é‡ç±»å‹: &lt;class &#39;numpy.ndarray&#39;&gt;ç¬¬ä¸€ä¸ªå‘é‡ (å‰5ç»´): [ 0.01680778  0.04001119 -0.03224989 -0.01100226 -0.02571571]</code></pre><h3 id="å®éªŒä¸€ç»ƒä¹ é¢˜"><a href="#å®éªŒä¸€ç»ƒä¹ é¢˜" class="headerlink" title="å®éªŒä¸€ç»ƒä¹ é¢˜"></a>å®éªŒä¸€ç»ƒä¹ é¢˜</h3><ol><li><strong>åŠ¨æ‰‹å®è·µ</strong>ï¼šå°†ã€Šè¥¿æ¸¸è®°ã€‹å‰ä¸‰å›å†…å®¹ï¼ˆå¯ä»¥ä»ç½‘ç»œè·å–txtæ–‡ä»¶ï¼‰åˆ‡åˆ†æˆ200å­—ç¬¦çš„å—ï¼Œé‡å 50å­—ç¬¦ï¼Œç»Ÿè®¡åˆ‡åˆ†ç»“æœã€‚</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">chunk_xyj_fixed_length</span>(<span class="hljs-params">text, chunk_size=<span class="hljs-number">200</span>, overlap=<span class="hljs-number">50</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    å›ºå®šé•¿åº¦åˆ‡åˆ†ï¼Œå¸¦é‡å çª—å£</span><br><span class="hljs-string">    :param text: è¾“å…¥æ–‡æœ¬</span><br><span class="hljs-string">    :param chunk_size: æ¯å—å­—ç¬¦æ•°</span><br><span class="hljs-string">    :param overlap: é‡å å­—ç¬¦æ•°</span><br><span class="hljs-string">    :return: æ–‡æœ¬å—åˆ—è¡¨</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    chunks = []<br>    start = <span class="hljs-number">0</span><br><br>    <span class="hljs-keyword">while</span> start &lt; <span class="hljs-built_in">len</span>(text):<br>        end = start + chunk_size<br>        chunk = text[start:end]<br>        chunks.append(chunk)<br><br>        <span class="hljs-comment"># ä¸‹ä¸€å—ä» end-overlap å¼€å§‹</span><br>        start = end - overlap<br><br>        <span class="hljs-comment"># é˜²æ­¢æ— é™å¾ªç¯</span><br>        <span class="hljs-keyword">if</span> start &gt;= <span class="hljs-built_in">len</span>(text):<br>            <span class="hljs-keyword">break</span><br><br>        <span class="hljs-keyword">if</span> start &lt;= <span class="hljs-number">0</span>:  <span class="hljs-comment"># å¤„ç†æçŸ­æ–‡æœ¬</span><br>            <span class="hljs-keyword">break</span><br><br>    <span class="hljs-keyword">return</span> chunks<br><br><br><span class="hljs-comment"># è¯»å–ã€Šè¥¿æ¸¸è®°ã€‹,æ–‡æ¡£å·²ç»æå‰å°†å‰ä¸‰å›çš„å†…å®¹æ‹†å‡ºæ¥äº†</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;xyj.txt&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    sample_text = <span class="hljs-string">&#x27;&#x27;</span>.join(f.readlines())<br><br><br>chunks = chunk_text_fixed_length(sample_text, chunk_size=<span class="hljs-number">100</span>, overlap=<span class="hljs-number">20</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;åŸå§‹æ–‡æœ¬é•¿åº¦: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(sample_text)&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;åˆ‡åˆ†æˆ <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(chunks)&#125;</span> ä¸ªç‰‡æ®µ:&quot;</span>)<br><span class="hljs-keyword">for</span> i, chunk <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(chunks):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n--- ç‰‡æ®µ <span class="hljs-subst">&#123;i+<span class="hljs-number">1</span>&#125;</span> ---&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;é•¿åº¦: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(chunk)&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(chunk)<br></code></pre></td></tr></table></figure><pre><code class="hljs">åŸå§‹æ–‡æœ¬é•¿åº¦: 22856åˆ‡åˆ†æˆ 286 ä¸ªç‰‡æ®µ:--- ç‰‡æ®µ 1 ---é•¿åº¦: 100========ç®€ä»‹========ã€Šè¥¿æ¸¸è®°ã€‹æ˜¯ä¸€éƒ¨ä¸­å›½å¤å…¸ç¥é­”å°è¯´ï¼Œä¸ºä¸­å›½â€œå››å¤§åè‘—â€ä¹‹ä¸€ã€‚ä¹¦ä¸­è®²è¿°å”æœæ³•å¸ˆè¥¿å¤©å–ç»çš„æ•…äº‹ï¼Œè¡¨ç°äº†æƒ©æ¶æ‰¬å–„çš„å¤è€ä¸»é¢˜ã€‚ã€Šè¥¿æ¸¸è®°ã€‹æˆä¹¦äº16ä¸–çºªæ˜æœä¸­å¶ï¼Œè‡ªé—®ä¸–ä»¥æ¥åœ¨--- ç‰‡æ®µ 2 ---é•¿åº¦: 100è®°ã€‹æˆä¹¦äº16ä¸–çºªæ˜æœä¸­å¶ï¼Œè‡ªé—®ä¸–ä»¥æ¥åœ¨ä¸­å›½åŠä¸–ç•Œå„åœ°å¹¿ä¸ºæµä¼ ï¼Œè¢«ç¿»è¯‘æˆå¤šç§è¯­è¨€ã€‚è¥¿æ¸¸è®°æ˜¯ä¸­å›½å¤å…¸å››å¤§åè‘—ä¹‹ä¸€ï¼Œæ˜¯æœ€ä¼˜ç§€çš„ç¥è¯å°è¯´ï¼Œä¹Ÿæ˜¯ä¸€éƒ¨ç¾¤ä¼—åˆ›ä½œå’Œæ–‡äººåˆ›ä½œç›¸ç»“åˆçš„ä½œå“ã€‚å°è¯´ä»¥æ•´æ•´ä¸ƒå›çš„â€œå¤§é—¹å¤©å®«â€ã€‚ã€‚--- ç‰‡æ®µ 286 ---é•¿åº¦: 56&lt;/p&gt;&lt;p&gt;  é«˜è¿ä¸Šå“å¤©ä»™ä½ï¼Œååˆ—äº‘ç­å®å½•ä¸­ã€‚&lt;/p&gt;&lt;p&gt;  æ¯•ç«Ÿä¸çŸ¥æˆä¸ªç”šä¹ˆå®˜çˆµï¼Œä¸”å¬ä¸‹å›åˆ†è§£ã€‚&lt;/p&gt;</code></pre><ol start="2"><li><strong>å¯¹æ¯”å®éªŒ</strong>ï¼šä½¿ç”¨å›ºå®šé•¿åº¦åˆ‡åˆ†å’Œè¯­ä¹‰åˆ‡åˆ†å¯¹æ¯”ï¼Œåˆ†æå“ªä¸ªåœ¨ä¿æŒè¯­ä¹‰å®Œæ•´æ€§æ–¹é¢æ›´å¥½ã€‚</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ä½¿ç”¨è¯­ä¹‰åˆ‡åˆ†</span><br><span class="hljs-keyword">import</span> re<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">chunk_text_sentence_aware</span>(<span class="hljs-params">text, max_chars=<span class="hljs-number">200</span>, max_sentences=<span class="hljs-number">3</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    åŸºäºå¥å­çš„æ™ºèƒ½åˆ‡åˆ†</span><br><span class="hljs-string">    :param text: è¾“å…¥æ–‡æœ¬</span><br><span class="hljs-string">    :param max_chars: æœ€å¤§å­—ç¬¦æ•°</span><br><span class="hljs-string">    :param max_sentences: æœ€å¤§å¥å­æ•°</span><br><span class="hljs-string">    :return: æ–‡æœ¬å—åˆ—è¡¨</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># æŒ‰å¥å­åˆ†å‰²ï¼ˆä½¿ç”¨æ›´æ™ºèƒ½çš„æ­£åˆ™ï¼‰</span><br>    sentences = re.split(<span class="hljs-string">r&#x27;[ã€‚ï¼ï¼Ÿ.!?]\s*&#x27;</span>, text)<br>    sentences = [s.strip() <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> sentences <span class="hljs-keyword">if</span> s.strip()]<br><br>    chunks = []<br>    current_chunk = <span class="hljs-string">&quot;&quot;</span><br><br>    <span class="hljs-keyword">for</span> sentence <span class="hljs-keyword">in</span> sentences:<br>        <span class="hljs-comment"># å¦‚æœåŠ ä¸Šè¿™ä¸ªå¥å­ä¼šè¶…å‡ºé™åˆ¶ï¼Œä¸”å½“å‰chunkä¸ä¸ºç©º</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(current_chunk + sentence) &gt; max_chars <span class="hljs-keyword">and</span> current_chunk:<br>            chunks.append(current_chunk)<br>            current_chunk = sentence<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">if</span> current_chunk:<br>                current_chunk += <span class="hljs-string">&quot;ã€‚&quot;</span> + sentence<br>            <span class="hljs-keyword">else</span>:<br>                current_chunk = sentence<br><br>        <span class="hljs-comment"># å¦‚æœchunkä¸­çš„å¥å­æ•°å·²ç»è¾¾åˆ°ä¸Šé™</span><br>        <span class="hljs-keyword">if</span> current_chunk.count(<span class="hljs-string">&#x27;ã€‚&#x27;</span>) + current_chunk.count(<span class="hljs-string">&#x27;!&#x27;</span>) + current_chunk.count(<span class="hljs-string">&#x27;?&#x27;</span>) &gt;= max_sentences:<br>            chunks.append(current_chunk)<br>            current_chunk = <span class="hljs-string">&quot;&quot;</span><br><br>    <span class="hljs-comment"># æ·»åŠ æœ€åä¸€ä¸ªchunk</span><br>    <span class="hljs-keyword">if</span> current_chunk:<br>        chunks.append(current_chunk)<br><br>    <span class="hljs-keyword">return</span> chunks<br><br><span class="hljs-comment"># æµ‹è¯•</span><br>chunks = chunk_text_sentence_aware(sample_text, max_chars=<span class="hljs-number">150</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;è¯­ä¹‰åˆ‡åˆ†æˆ <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(chunks)&#125;</span> ä¸ªç‰‡æ®µ&quot;</span>)<br><span class="hljs-keyword">for</span> i, chunk <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(chunks):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n--- ç‰‡æ®µ <span class="hljs-subst">&#123;i+<span class="hljs-number">1</span>&#125;</span> ---&quot;</span>)<br>    <span class="hljs-built_in">print</span>(chunk)<br></code></pre></td></tr></table></figure><pre><code class="hljs">è¯­ä¹‰åˆ‡åˆ†æˆ 254 ä¸ªç‰‡æ®µ--- ç‰‡æ®µ 1 ---========ç®€ä»‹========ã€Šè¥¿æ¸¸è®°ã€‹æ˜¯ä¸€éƒ¨ä¸­å›½å¤å…¸ç¥é­”å°è¯´ï¼Œä¸ºä¸­å›½â€œå››å¤§åè‘—â€ä¹‹ä¸€ã€‚ä¹¦ä¸­è®²è¿°å”æœæ³•å¸ˆè¥¿å¤©å–ç»çš„æ•…äº‹ï¼Œè¡¨ç°äº†æƒ©æ¶æ‰¬å–„çš„å¤è€ä¸»é¢˜ã€‚ã€Šè¥¿æ¸¸è®°ã€‹æˆä¹¦äº16ä¸–çºªæ˜æœä¸­å¶ï¼Œè‡ªé—®ä¸–ä»¥æ¥åœ¨ä¸­å›½åŠä¸–ç•Œå„åœ°å¹¿ä¸ºæµä¼ ï¼Œè¢«ç¿»è¯‘æˆå¤šç§è¯­è¨€--- ç‰‡æ®µ 2 ---è¥¿æ¸¸è®°æ˜¯ä¸­å›½å¤å…¸å››å¤§åè‘—ä¹‹ä¸€ï¼Œæ˜¯æœ€ä¼˜ç§€çš„ç¥è¯å°è¯´ï¼Œä¹Ÿæ˜¯ä¸€éƒ¨ç¾¤ä¼—åˆ›ä½œå’Œæ–‡äººåˆ›ä½œç›¸ç»“åˆçš„ä½œå“ã€‚å°è¯´ä»¥æ•´æ•´ä¸ƒå›çš„â€œå¤§é—¹å¤©å®«â€æ•…äº‹å¼€å§‹ï¼ŒæŠŠå­™æ‚Ÿç©ºçš„å½¢è±¡æåˆ°å…¨ä¹¦é¦–è¦çš„åœ°ä½ã€‚ç¬¬å…«è‡³åäºŒå›å†™å¦‚æ¥è¯´æ³•ï¼Œè§‚éŸ³è®¿åƒ§ï¼Œé­å¾µæ–©é¾™ï¼Œå”åƒ§å‡ºä¸–ç­‰æ•…äº‹ï¼Œäº¤å¾…å–ç»çš„ç¼˜èµ·--- ç‰‡æ®µ 3 ---ä»åå››å›åˆ°å…¨ä¹¦ç»“æŸï¼Œå†™å­™æ‚Ÿç©ºè¢«è¿«çšˆä¾ä½›æ•™ï¼Œä¿æŠ¤å”åƒ§å–ç»ï¼Œåœ¨å…«æˆ’ã€æ²™åƒ§ååŠ©ä¸‹ï¼Œä¸€è·¯æ–©å¦–é™¤é­”ï¼Œåˆ°è¥¿å¤©æˆäº†â€œæ­£æœâ€ã€‚åœ¨ä¸­å›½ï¼Œä¹ƒè‡³äºšæ´²éƒ¨åˆ†åœ°åŒºè¥¿æ¸¸è®°å®¶å–»æˆ·æ™“ï¼Œå…¶ä¸­å­™æ‚Ÿç©ºã€å”åƒ§ã€çŒªå…«æˆ’ã€æ²™åƒ§ç­‰äººç‰©å’Œâ€œå¤§é—¹å¤©å®«â€ã€â€œä¸‰æ‰“ç™½éª¨ç²¾â€ã€â€œç«ç„°å±±â€ç­‰æ•…äº‹å°¤å…¶ä¸ºäººç†Ÿæ‚‰ã€‚ã€‚--- ç‰‡æ®µ 254 ---è¿™çŒ´ç‹ä¸é‡‘æ˜Ÿçºµèµ·äº‘å¤´ï¼Œå‡åœ¨ç©ºéœ„ä¹‹ä¸Šï¼Œæ­£æ˜¯é‚£ï¼š&lt;/p&gt;&lt;p&gt;  é«˜è¿ä¸Šå“å¤©ä»™ä½ï¼Œååˆ—äº‘ç­å®å½•ä¸­ã€‚&lt;/p&gt;&lt;p&gt;  æ¯•ç«Ÿä¸çŸ¥æˆä¸ªç”šä¹ˆå®˜çˆµï¼Œä¸”å¬ä¸‹å›åˆ†è§£ã€‚&lt;/p&gt;</code></pre><p>å¯ä»¥å‘ç°è¯­ä¹‰åˆ‡åˆ†åœ¨ä¿æŒè¯­ä¹‰å®Œæ•´æ€§æ–¹é¢æ›´å¥½ã€‚</p><blockquote><p>è¿™ä¸æ˜¯åºŸè¯å—qwq</p></blockquote><ol start="3"><li><strong>æ€è€ƒé¢˜</strong>ï¼šå¦‚æœchunk_sizeè®¾ç½®è¿‡å¤§ï¼ˆå¦‚2000å­—ç¬¦ï¼‰ï¼Œä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜ï¼Ÿè¿‡å°ï¼ˆå¦‚50å­—ç¬¦ï¼‰åˆä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜ï¼Ÿ</li></ol><ul><li>chunk_sizeè¿‡å¤§ï¼šæ£€ç´¢ç›¸å…³æ€§é™ä½ï¼Œå¯èƒ½åŒ…å«è¿‡å¤šæ— å…³ä¿¡æ¯ï¼Œå¯¼è‡´LLMéš¾ä»¥èšç„¦ï¼Œä¸”å¢åŠ APIè°ƒç”¨æˆæœ¬ã€‚</li><li>chunk_sizeè¿‡å°ï¼šä¸Šä¸‹æ–‡ä¿¡æ¯ä¸¢å¤±ï¼Œè¯­ä¹‰ä¸å®Œæ•´ï¼Œæ£€ç´¢ç»“æœç¢ç‰‡åŒ–ï¼Œå¯èƒ½å½±å“å›ç­”å‡†ç¡®æ€§ï¼Œä½†æ£€ç´¢é€Ÿåº¦æ›´å¿«ã€å†…å­˜å ç”¨æ›´ä½ã€‚</li><li>éœ€è¦æ ¹æ®å®é™…åœºæ™¯æƒè¡¡æ£€ç´¢è´¨é‡ã€æ€§èƒ½å’Œæˆæœ¬ï¼Œåˆç†è®¾ç½®chunk_sizeå’Œoverlapå‚æ•°ã€‚</li></ul><h2 id="å®éªŒäºŒï¼šå‘é‡å­˜å‚¨ä¸æ£€ç´¢"><a href="#å®éªŒäºŒï¼šå‘é‡å­˜å‚¨ä¸æ£€ç´¢" class="headerlink" title="å®éªŒäºŒï¼šå‘é‡å­˜å‚¨ä¸æ£€ç´¢"></a>å®éªŒäºŒï¼šå‘é‡å­˜å‚¨ä¸æ£€ç´¢</h2><h3 id="å®éªŒç›®æ ‡ï¼š-1"><a href="#å®éªŒç›®æ ‡ï¼š-1" class="headerlink" title="å®éªŒç›®æ ‡ï¼š"></a>å®éªŒç›®æ ‡ï¼š</h3><p>å°†å‘é‡å­˜å‚¨åˆ°æ•°æ®åº“ï¼Œå®ç°é«˜æ•ˆçš„ç›¸ä¼¼åº¦æœç´¢ã€‚</p><h3 id="ç†è®ºåŸºç¡€-1"><a href="#ç†è®ºåŸºç¡€-1" class="headerlink" title="ç†è®ºåŸºç¡€"></a>ç†è®ºåŸºç¡€</h3><h4 id="1-å‘é‡æ•°æ®åº“-vs-ä¼ ç»Ÿæ•°æ®åº“"><a href="#1-å‘é‡æ•°æ®åº“-vs-ä¼ ç»Ÿæ•°æ®åº“" class="headerlink" title="1. å‘é‡æ•°æ®åº“ vs ä¼ ç»Ÿæ•°æ®åº“"></a>1. å‘é‡æ•°æ®åº“ vs ä¼ ç»Ÿæ•°æ®åº“</h4><table><thead><tr><th>ç‰¹æ€§</th><th>ä¼ ç»Ÿæ•°æ®åº“</th><th>å‘é‡æ•°æ®åº“</th></tr></thead><tbody><tr><td>ç´¢å¼•ç±»å‹</td><td>B-Tree, Hash</td><td>HNSW, IVF, LSH</td></tr><tr><td>æŸ¥è¯¢æ–¹å¼</td><td>ç²¾ç¡®åŒ¹é…</td><td>ç›¸ä¼¼åº¦è®¡ç®—</td></tr><tr><td>è·ç¦»åº¦é‡</td><td>&#x3D;, &gt;, &lt;</td><td>ä½™å¼¦ç›¸ä¼¼åº¦ã€æ¬§æ°è·ç¦»</td></tr><tr><td>åº”ç”¨åœºæ™¯</td><td>ç»“æ„åŒ–æ•°æ®</td><td>æ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘ç­‰éç»“æ„åŒ–æ•°æ®</td></tr></tbody></table><h4 id="2-è·ç¦»åº¦é‡"><a href="#2-è·ç¦»åº¦é‡" class="headerlink" title="2. è·ç¦»åº¦é‡"></a>2. è·ç¦»åº¦é‡</h4><ul><li><strong>ä½™å¼¦ç›¸ä¼¼åº¦ (Cosine Similarity)</strong>ï¼šæœ€å¸¸ç”¨ï¼Œå…³æ³¨è§’åº¦è€Œéç»å¯¹å€¼</li><li><strong>æ¬§æ°è·ç¦» (Euclidean Distance)</strong>ï¼šå…³æ³¨ç»å¯¹å·®å€¼</li><li><strong>ç‚¹ç§¯ (Dot Product)</strong>ï¼šè®¡ç®—é€Ÿåº¦å¿«ï¼Œä»‹äºä¸¤è€…ä¹‹é—´</li></ul><h3 id="å®éªŒæ­¥éª¤-1"><a href="#å®éªŒæ­¥éª¤-1" class="headerlink" title="å®éªŒæ­¥éª¤"></a>å®éªŒæ­¥éª¤</h3><h4 id="Step-1-ä½¿ç”¨-Faiss-æ„å»ºç®€å•å‘é‡æ•°æ®åº“"><a href="#Step-1-ä½¿ç”¨-Faiss-æ„å»ºç®€å•å‘é‡æ•°æ®åº“" class="headerlink" title="Step 1: ä½¿ç”¨ Faiss æ„å»ºç®€å•å‘é‡æ•°æ®åº“"></a>Step 1: ä½¿ç”¨ Faiss æ„å»ºç®€å•å‘é‡æ•°æ®åº“</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sentence_transformers <span class="hljs-keyword">import</span> SentenceTransformer<br><span class="hljs-keyword">import</span> faiss<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleVectorDB</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, dimension</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        åˆå§‹åŒ–å‘é‡æ•°æ®åº“</span><br><span class="hljs-string">        :param dimension: å‘é‡ç»´åº¦</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-variable language_">self</span>.dimension = dimension<br>        <span class="hljs-comment"># åˆ›å»ºFAISSç´¢å¼• (L2è·ç¦»ï¼Œä½™å¼¦ç›¸ä¼¼åº¦=1-è·ç¦»)</span><br>        <span class="hljs-variable language_">self</span>.index = faiss.IndexFlatL2(dimension)<br>        <span class="hljs-comment"># å­˜å‚¨åŸå§‹æ–‡æœ¬å—</span><br>        <span class="hljs-variable language_">self</span>.texts = []<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_vectors</span>(<span class="hljs-params">self, vectors, texts</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        æ·»åŠ å‘é‡å’Œæ–‡æœ¬</span><br><span class="hljs-string">        :param vectors: numpy array of vectors</span><br><span class="hljs-string">        :param texts: å¯¹åº”çš„æ–‡æœ¬åˆ—è¡¨</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-comment"># ç¡®ä¿å‘é‡æ˜¯float32ç±»å‹</span><br>        vectors = np.array(vectors).astype(<span class="hljs-string">&#x27;float32&#x27;</span>)<br>        <span class="hljs-comment"># æ·»åŠ åˆ°ç´¢å¼•</span><br>        <span class="hljs-variable language_">self</span>.index.add(vectors)<br>        <span class="hljs-variable language_">self</span>.texts.extend(texts)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">search</span>(<span class="hljs-params">self, query_vector, k=<span class="hljs-number">3</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        æœç´¢æœ€ç›¸ä¼¼çš„kä¸ªå‘é‡</span><br><span class="hljs-string">        :param query_vector: æŸ¥è¯¢å‘é‡ (numpy array)</span><br><span class="hljs-string">        :param k: è¿”å›top-kç»“æœ</span><br><span class="hljs-string">        :return: ( distances, indices, texts )</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        query_vector = np.array([query_vector]).astype(<span class="hljs-string">&#x27;float32&#x27;</span>)<br><br>        <span class="hljs-comment"># æœç´¢</span><br>        distances, indices = <span class="hljs-variable language_">self</span>.index.search(query_vector, k)<br><br>        <span class="hljs-comment"># è·å–å¯¹åº”çš„æ–‡æœ¬</span><br>        retrieved_texts = [<span class="hljs-variable language_">self</span>.texts[idx] <span class="hljs-keyword">for</span> idx <span class="hljs-keyword">in</span> indices[<span class="hljs-number">0</span>]]<br><br>        <span class="hljs-keyword">return</span> distances[<span class="hljs-number">0</span>], indices[<span class="hljs-number">0</span>], retrieved_texts<br><br><span class="hljs-comment"># å®éªŒ</span><br>model = SentenceTransformer(<span class="hljs-string">&#x27;all-MiniLM-L6-v2&#x27;</span>)<br><br><span class="hljs-comment"># å‡†å¤‡æ•°æ®</span><br>documents = [<br>    <span class="hljs-string">&quot;äººå·¥æ™ºèƒ½æ˜¯è®¡ç®—æœºç§‘å­¦çš„é‡è¦åˆ†æ”¯&quot;</span>,<br>    <span class="hljs-string">&quot;æ·±åº¦å­¦ä¹ ä½¿ç”¨å¤šå±‚ç¥ç»ç½‘ç»œ&quot;</span>,<br>    <span class="hljs-string">&quot;æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„å­é›†&quot;</span>,<br>    <span class="hljs-string">&quot;Pythonæ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€&quot;</span>,<br>    <span class="hljs-string">&quot;å¤§æ•°æ®éœ€è¦é«˜æ•ˆçš„æ•°æ®å¤„ç†æŠ€æœ¯&quot;</span><br>]<br><br><span class="hljs-comment"># å‘é‡åŒ–</span><br>embeddings = model.encode(documents)<br><br><span class="hljs-comment"># æ„å»ºæ•°æ®åº“</span><br>vector_db = SimpleVectorDB(dimension=embeddings.shape[<span class="hljs-number">1</span>])<br>vector_db.add_vectors(embeddings, documents)<br><br><span class="hljs-comment"># æ¨¡æ‹Ÿç”¨æˆ·æŸ¥è¯¢</span><br>query = <span class="hljs-string">&quot;ä»€ä¹ˆæ˜¯æ·±åº¦å­¦ä¹ ï¼Ÿ&quot;</span><br>query_embedding = model.encode([query])<br><br><span class="hljs-comment"># æœç´¢</span><br>distances, indices, retrieved_texts = vector_db.search(query_embedding[<span class="hljs-number">0</span>], k=<span class="hljs-number">3</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æŸ¥è¯¢: <span class="hljs-subst">&#123;query&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\nTop-3 æ£€ç´¢ç»“æœ:&quot;</span>)<br><span class="hljs-keyword">for</span> i, (dist, text) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(<span class="hljs-built_in">zip</span>(distances, retrieved_texts)):<br>    <span class="hljs-comment"># è½¬æ¢ä¸ºç›¸ä¼¼åº¦åˆ†æ•° (0-1, 1ä¸ºå®Œå…¨ç›¸ä¼¼)</span><br>    similarity = <span class="hljs-number">1</span> / (<span class="hljs-number">1</span> + dist)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\nç»“æœ <span class="hljs-subst">&#123;i+<span class="hljs-number">1</span>&#125;</span>:&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  ç›¸ä¼¼åº¦åˆ†æ•°: <span class="hljs-subst">&#123;similarity:<span class="hljs-number">.4</span>f&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  è·ç¦»: <span class="hljs-subst">&#123;dist:<span class="hljs-number">.4</span>f&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  æ–‡æœ¬: <span class="hljs-subst">&#123;text&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure><pre><code class="hljs">æŸ¥è¯¢: ä»€ä¹ˆæ˜¯æ·±åº¦å­¦ä¹ ï¼ŸTop-3 æ£€ç´¢ç»“æœ:ç»“æœ 1:  ç›¸ä¼¼åº¦åˆ†æ•°: 0.6253  è·ç¦»: 0.5991  æ–‡æœ¬: æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„å­é›†ç»“æœ 2:  ç›¸ä¼¼åº¦åˆ†æ•°: 0.6068  è·ç¦»: 0.6480  æ–‡æœ¬: æ·±åº¦å­¦ä¹ ä½¿ç”¨å¤šå±‚ç¥ç»ç½‘ç»œç»“æœ 3:  ç›¸ä¼¼åº¦åˆ†æ•°: 0.5897  è·ç¦»: 0.6957  æ–‡æœ¬: äººå·¥æ™ºèƒ½æ˜¯è®¡ç®—æœºç§‘å­¦çš„é‡è¦åˆ†æ”¯</code></pre><h4 id="Step-2-æ€§èƒ½å¯¹æ¯”å®éªŒ"><a href="#Step-2-æ€§èƒ½å¯¹æ¯”å®éªŒ" class="headerlink" title="Step 2: æ€§èƒ½å¯¹æ¯”å®éªŒ"></a>Step 2: æ€§èƒ½å¯¹æ¯”å®éªŒ</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PerformanceBenchmark</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, vector_db</span>):<br>        <span class="hljs-variable language_">self</span>.vector_db = vector_db<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">benchmark_search</span>(<span class="hljs-params">self, query_embeddings, k=<span class="hljs-number">5</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        åŸºå‡†æµ‹è¯•æ£€ç´¢æ€§èƒ½</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        latencies = []<br><br>        <span class="hljs-keyword">for</span> query_emb <span class="hljs-keyword">in</span> query_embeddings:<br>            start_time = time.time()<br>            distances, indices, texts = <span class="hljs-variable language_">self</span>.vector_db.search(query_emb, k=k)<br>            end_time = time.time()<br><br>            latency = (end_time - start_time) * <span class="hljs-number">1000</span>  <span class="hljs-comment"># è½¬æ¢ä¸ºæ¯«ç§’</span><br>            latencies.append(latency)<br><br>        avg_latency = np.mean(latencies)<br>        p95_latency = np.percentile(latencies, <span class="hljs-number">95</span>)<br>        p99_latency = np.percentile(latencies, <span class="hljs-number">99</span>)<br><br>        <span class="hljs-keyword">return</span> &#123;<br>            <span class="hljs-string">&#x27;avg_latency_ms&#x27;</span>: avg_latency,<br>            <span class="hljs-string">&#x27;p95_latency_ms&#x27;</span>: p95_latency,<br>            <span class="hljs-string">&#x27;p99_latency_ms&#x27;</span>: p99_latency,<br>            <span class="hljs-string">&#x27;min_latency_ms&#x27;</span>: <span class="hljs-built_in">min</span>(latencies),<br>            <span class="hljs-string">&#x27;max_latency_ms&#x27;</span>: <span class="hljs-built_in">max</span>(latencies)<br>        &#125;<br><br><span class="hljs-comment"># ç”Ÿæˆæµ‹è¯•æ•°æ®</span><br>test_queries = [<span class="hljs-string">&quot;äººå·¥æ™ºèƒ½å‘å±•&quot;</span>, <span class="hljs-string">&quot;æœºå™¨å­¦ä¹ ç®—æ³•&quot;</span>, <span class="hljs-string">&quot;æ·±åº¦ç¥ç»ç½‘ç»œ&quot;</span>, <span class="hljs-string">&quot;Pythonç¼–ç¨‹&quot;</span>] * <span class="hljs-number">10</span>  <span class="hljs-comment"># 40ä¸ªæŸ¥è¯¢</span><br>test_embeddings = model.encode(test_queries)<br><br><span class="hljs-comment"># åŸºå‡†æµ‹è¯•</span><br>benchmark = PerformanceBenchmark(vector_db)<br>results = benchmark.benchmark_search(test_embeddings, k=<span class="hljs-number">5</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=== æ£€ç´¢æ€§èƒ½åŸºå‡†æµ‹è¯• ===&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;å¹³å‡å»¶è¿Ÿ: <span class="hljs-subst">&#123;results[<span class="hljs-string">&#x27;avg_latency_ms&#x27;</span>]:<span class="hljs-number">.2</span>f&#125;</span> ms&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;P95 å»¶è¿Ÿ: <span class="hljs-subst">&#123;results[<span class="hljs-string">&#x27;p95_latency_ms&#x27;</span>]:<span class="hljs-number">.2</span>f&#125;</span> ms&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;P99 å»¶è¿Ÿ: <span class="hljs-subst">&#123;results[<span class="hljs-string">&#x27;p99_latency_ms&#x27;</span>]:<span class="hljs-number">.2</span>f&#125;</span> ms&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æœ€å°å»¶è¿Ÿ: <span class="hljs-subst">&#123;results[<span class="hljs-string">&#x27;min_latency_ms&#x27;</span>]:<span class="hljs-number">.2</span>f&#125;</span> ms&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æœ€å¤§å»¶è¿Ÿ: <span class="hljs-subst">&#123;results[<span class="hljs-string">&#x27;max_latency_ms&#x27;</span>]:<span class="hljs-number">.2</span>f&#125;</span> ms&quot;</span>)<br></code></pre></td></tr></table></figure><pre><code class="hljs">=== æ£€ç´¢æ€§èƒ½åŸºå‡†æµ‹è¯• ===å¹³å‡å»¶è¿Ÿ: 0.02 msP95 å»¶è¿Ÿ: 0.00 msP99 å»¶è¿Ÿ: 0.61 msæœ€å°å»¶è¿Ÿ: 0.00 msæœ€å¤§å»¶è¿Ÿ: 1.00 ms</code></pre><h3 id="å®éªŒäºŒç»ƒä¹ é¢˜"><a href="#å®éªŒäºŒç»ƒä¹ é¢˜" class="headerlink" title="å®éªŒäºŒç»ƒä¹ é¢˜"></a>å®éªŒäºŒç»ƒä¹ é¢˜</h3><ol><li><p><strong>æ•°æ®è§„æ¨¡å®éªŒ</strong>ï¼šåˆ†åˆ«å­˜å‚¨100ã€1000ã€10000ä¸ªæ–‡æ¡£ï¼Œæµ‹è¯•æ£€ç´¢å»¶è¿Ÿçš„å˜åŒ–è¶‹åŠ¿ã€‚</p></li><li><p><strong>Top-K å®éªŒ</strong>ï¼šå¯¹åŒä¸€ä¸ªæŸ¥è¯¢ï¼Œåˆ†åˆ«è®¾ç½®k&#x3D;1, 3, 5, 10ï¼Œåˆ†æç»“æœè´¨é‡çš„å˜åŒ–ã€‚</p></li><li><p><strong>æ£€ç´¢è´¨é‡è¯„ä¼°</strong>ï¼šæ‰‹åŠ¨å‡†å¤‡10ä¸ªé—®é¢˜å’Œæ ‡å‡†ç­”æ¡ˆï¼Œæµ‹è¯•ä½ çš„å‘é‡æ•°æ®åº“èƒ½å¦è¿”å›æ­£ç¡®å†…å®¹ã€‚</p></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> faiss<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> sentence_transformers <span class="hljs-keyword">import</span> SentenceTransformer<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleVectorDB</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, dimension</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        åˆå§‹åŒ–å‘é‡æ•°æ®åº“</span><br><span class="hljs-string">        :param dimension: å‘é‡ç»´åº¦</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-variable language_">self</span>.dimension = dimension<br>        <span class="hljs-comment"># åˆ›å»ºFAISSç´¢å¼• (L2è·ç¦»ï¼Œä½™å¼¦ç›¸ä¼¼åº¦=1-è·ç¦»)</span><br>        <span class="hljs-variable language_">self</span>.index = faiss.IndexFlatL2(dimension)<br>        <span class="hljs-comment"># å­˜å‚¨åŸå§‹æ–‡æœ¬å—</span><br>        <span class="hljs-variable language_">self</span>.texts = []<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_vectors</span>(<span class="hljs-params">self, vectors, texts</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        æ·»åŠ å‘é‡å’Œæ–‡æœ¬</span><br><span class="hljs-string">        :param vectors: numpy array of vectors</span><br><span class="hljs-string">        :param texts: å¯¹åº”çš„æ–‡æœ¬åˆ—è¡¨</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-comment"># ç¡®ä¿å‘é‡æ˜¯float32ç±»å‹</span><br>        vectors = np.array(vectors).astype(<span class="hljs-string">&#x27;float32&#x27;</span>)<br>        <span class="hljs-comment"># æ·»åŠ åˆ°ç´¢å¼•</span><br>        <span class="hljs-variable language_">self</span>.index.add(vectors)<br>        <span class="hljs-variable language_">self</span>.texts.extend(texts)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">search</span>(<span class="hljs-params">self, query_vector, k=<span class="hljs-number">3</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        æœç´¢æœ€ç›¸ä¼¼çš„kä¸ªå‘é‡</span><br><span class="hljs-string">        :param query_vector: æŸ¥è¯¢å‘é‡ (numpy array)</span><br><span class="hljs-string">        :param k: è¿”å›top-kç»“æœ</span><br><span class="hljs-string">        :return: ( distances, indices, texts )</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        query_vector = np.array([query_vector]).astype(<span class="hljs-string">&#x27;float32&#x27;</span>)<br><br>        <span class="hljs-comment"># æœç´¢</span><br>        distances, indices = <span class="hljs-variable language_">self</span>.index.search(query_vector, k)<br><br>        <span class="hljs-comment"># è·å–å¯¹åº”çš„æ–‡æœ¬</span><br>        retrieved_texts = [<span class="hljs-variable language_">self</span>.texts[idx] <span class="hljs-keyword">for</span> idx <span class="hljs-keyword">in</span> indices[<span class="hljs-number">0</span>]]<br><br>        <span class="hljs-keyword">return</span> distances[<span class="hljs-number">0</span>], indices[<span class="hljs-number">0</span>], retrieved_texts<br><br><span class="hljs-comment"># å®éªŒ</span><br>model = SentenceTransformer(<span class="hljs-string">&#x27;all-MiniLM-L6-v2&#x27;</span>)<br><br><span class="hljs-comment"># å‡†å¤‡æ•°æ®</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;anthropic.txt&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    anthropic = <span class="hljs-string">&#x27;&#x27;</span>.join(f.readlines())<br>documents = anthropic.split(<span class="hljs-string">&#x27;\n&#x27;</span>)  <span class="hljs-comment"># ä½¿ç”¨ Anthropic ç™¾ç§‘æ–‡æœ¬è¿›è¡Œå®éªŒ </span><br><br><span class="hljs-comment"># å‘é‡åŒ–</span><br>embeddings = model.encode(documents)<br><br><span class="hljs-comment"># æ„å»ºæ•°æ®åº“</span><br>vector_db = SimpleVectorDB(dimension=embeddings.shape[<span class="hljs-number">1</span>])<br>vector_db.add_vectors(embeddings, documents)<br><br><span class="hljs-comment"># æ¨¡æ‹Ÿç”¨æˆ·æŸ¥è¯¢</span><br>query = <span class="hljs-string">&quot;Claudeæ˜¯å“ªä¸ªå…¬å¸å¼€å‘çš„ï¼Ÿ&quot;</span><br>query_embedding = model.encode([query])<br><br><span class="hljs-comment"># æœç´¢</span><br>distances, indices, retrieved_texts = vector_db.search(query_embedding[<span class="hljs-number">0</span>], k=<span class="hljs-number">3</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æŸ¥è¯¢: <span class="hljs-subst">&#123;query&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\nTop-3 æ£€ç´¢ç»“æœ:&quot;</span>)<br><span class="hljs-keyword">for</span> i, (dist, text) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(<span class="hljs-built_in">zip</span>(distances, retrieved_texts)):<br>    <span class="hljs-comment"># è½¬æ¢ä¸ºç›¸ä¼¼åº¦åˆ†æ•° (0-1, 1ä¸ºå®Œå…¨ç›¸ä¼¼)</span><br>    similarity = <span class="hljs-number">1</span> / (<span class="hljs-number">1</span> + dist)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\nç»“æœ <span class="hljs-subst">&#123;i+<span class="hljs-number">1</span>&#125;</span>:&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  ç›¸ä¼¼åº¦åˆ†æ•°: <span class="hljs-subst">&#123;similarity:<span class="hljs-number">.4</span>f&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  è·ç¦»: <span class="hljs-subst">&#123;dist:<span class="hljs-number">.4</span>f&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  æ–‡æœ¬: <span class="hljs-subst">&#123;text&#125;</span>&quot;</span>)<br>    <br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n--------------------------------\n&quot;</span>)<br><span class="hljs-comment"># æ¨¡æ‹Ÿç”¨æˆ·æŸ¥è¯¢</span><br>query2 = <span class="hljs-string">&quot;Anthropicåˆ›å§‹äººæ˜¯è°ï¼Ÿ&quot;</span><br>query_embedding2 = model.encode([query2])<br><br><span class="hljs-comment"># æœç´¢</span><br>distances, indices, retrieved_texts = vector_db.search(query_embedding2[<span class="hljs-number">0</span>], k=<span class="hljs-number">3</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æŸ¥è¯¢: <span class="hljs-subst">&#123;query2&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\nTop-3 æ£€ç´¢ç»“æœ:&quot;</span>)<br><span class="hljs-keyword">for</span> i, (dist, text) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(<span class="hljs-built_in">zip</span>(distances, retrieved_texts)):<br>    <span class="hljs-comment"># è½¬æ¢ä¸ºç›¸ä¼¼åº¦åˆ†æ•° (0-1, 1ä¸ºå®Œå…¨ç›¸ä¼¼)</span><br>    similarity = <span class="hljs-number">1</span> / (<span class="hljs-number">1</span> + dist)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\nç»“æœ <span class="hljs-subst">&#123;i+<span class="hljs-number">1</span>&#125;</span>:&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  ç›¸ä¼¼åº¦åˆ†æ•°: <span class="hljs-subst">&#123;similarity:<span class="hljs-number">.4</span>f&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  è·ç¦»: <span class="hljs-subst">&#123;dist:<span class="hljs-number">.4</span>f&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  æ–‡æœ¬: <span class="hljs-subst">&#123;text&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure><pre><code class="hljs">æŸ¥è¯¢: Claudeæ˜¯å“ªä¸ªå…¬å¸å¼€å‘çš„ï¼ŸTop-3 æ£€ç´¢ç»“æœ:ç»“æœ 1:  ç›¸ä¼¼åº¦åˆ†æ•°: 0.6002  è·ç¦»: 0.6662  æ–‡æœ¬: Anthropicæ˜¯ä¸€å®¶ä½äºç¾å›½åŠ å·æ—§é‡‘å±±çš„äººå·¥æ™ºèƒ½è‚¡ä»½æœ‰é™å…¬å¸ï¼Œ æˆç«‹äº2021å¹´ã€‚ è¯¥å…¬å¸ç”±è¾¾é‡Œå¥¥Â·é˜¿è«è¿ª å’Œä¸¹å¦®æ‹‰Â·é˜¿è«è¿ªå…„å¦¹åˆ›ç«‹ï¼Œ ç°ä»»é¦–å¸­æ‰§è¡Œå®˜è¾¾é‡Œå¥¥Â·é˜¿è«è¿ªã€‚ æ˜¯ä¸€å®¶äººå·¥æ™ºèƒ½å®‰å…¨å’Œç ”ç©¶å…¬å¸ï¼Œè‡´åŠ›äºæ„å»ºå¯é ã€å¯è§£é‡Šå’Œå¯æ“çºµçš„AIç³»ç»Ÿã€‚ Anthropicå…¬å¸å¼€å‘äº†èŠå¤©æœºå™¨äººClaudeï¼Œæå‡ºçš„â€œå®ªæ³•AIåŸåˆ™â€ã€‚ ç»“æœ 2:  ç›¸ä¼¼åº¦åˆ†æ•°: 0.4727  è·ç¦»: 1.1155  æ–‡æœ¬: 2021å¹´ï¼ŒAnthropicæˆç«‹ã€‚2021å¹´5æœˆï¼ŒAnthropicè·å¾—1.24äº¿ç¾å…ƒAè½®èèµ„ï¼Œç”±Skypeè”åˆåˆ›å§‹äººJaan Tallinné¢†æŠ•ï¼ŒFacebookè”åˆåˆ›å§‹äººDustin Moskovitzç­‰æŠ•èµ„è€…å‚ä¸ã€‚ 2022å¹´4æœˆ29æ—¥ï¼ŒAnthropicåœ¨Bè½®èèµ„ä¸­ç­¹é›†äº†5.8äº¿ç¾å…ƒï¼Œé¢†æŠ•è€…ä¸ºFTX é¦–å¸­æ‰§è¡Œå®˜ Sam Bankman-Friedã€‚ 2023å¹´2æœˆï¼Œè·å¾—GoogleæŠ•èµ„3äº¿ç¾å…ƒï¼ŒGoogleæŒè‚¡10%ã€‚ 2023å¹´7æœˆ11æ—¥ï¼ŒAnthropic å‘å¸ƒäº†å…¨æ–°çš„ Claude 2 å¤§è¯­è¨€æ¨¡å‹ã€‚ 2024å¹´3æœˆ4æ—¥æ¶ˆæ¯ï¼ŒAnthropicå‘å¸ƒClaude 3æ¨¡å‹å®¶æ—ã€‚ 2024å¹´10æœˆ22æ—¥ï¼Œç¾å›½äººå·¥æ™ºèƒ½åˆåˆ›å…¬å¸Anthropicå®£å¸ƒæ¨å‡ºå‡çº§ç‰ˆçš„Claude 3.5 Sonnetæ¨¡å‹ï¼Œå‡çº§åçš„Claude 3.5å¤§è¯­è¨€æ¨¡å‹ï¼ŒAnthropicå£°ç§°ä¼šè¾¾åˆ°â€œä»¿ä½›ä¸€ä¸ªäººåœ¨ç”µè„‘å‰å·¥ä½œâ€çš„æ•ˆæœã€‚ 2025å¹´2æœˆ25æ—¥ï¼ŒAnthropicå®£å¸ƒæ¨å‡ºClaude 3.7 Sonnetï¼Œç§°è¿™æ˜¯å…¶è¿„ä»Šä¸ºæ­¢æœ€æ™ºèƒ½çš„æ¨¡å‹ï¼Œä¹Ÿæ˜¯å¸‚åœºä¸Šé¦–æ¬¾æ··åˆæ¨ç†æ¨¡å‹ï¼›å½“åœ°æ—¶é—´11æœˆ24æ—¥ï¼ŒAnthropicæ­£å¼å‘å¸ƒå…¶æœ€æ–°æ¨¡å‹Claude Opus 4.5ã€‚ ç»“æœ 3:  ç›¸ä¼¼åº¦åˆ†æ•°: 0.4151  è·ç¦»: 1.4090  æ–‡æœ¬: 2023å¹´4æœˆï¼ŒAnthropicå…¥é€‰ç¦å¸ƒæ–¯AI 50æ¦œå•ã€‚ 2023å¹´8æœˆï¼Œå…¥é€‰ç¦å¸ƒæ–¯å‘å¸ƒ2023äº‘è®¡ç®—100å¼ºæ¦œå•ååˆ—73ä½ã€‚ 2024å¹´4æœˆ16æ—¥ï¼Œå…¥é€‰ã€Š2024ç¦å¸ƒæ–¯AI 50æ¦œå•ã€‹æ’å4ä½ã€‚ 2025å¹´4æœˆï¼Œå…¥é€‰ã€Š2025ç¦å¸ƒæ–¯AI 50æ¦œå•ã€‹ã€‚--------------------------------æŸ¥è¯¢: Anthropicåˆ›å§‹äººæ˜¯è°ï¼ŸTop-3 æ£€ç´¢ç»“æœ:ç»“æœ 1:  ç›¸ä¼¼åº¦åˆ†æ•°: 0.4567  è·ç¦»: 1.1897  æ–‡æœ¬: 2023å¹´4æœˆï¼ŒAnthropicå…¥é€‰ç¦å¸ƒæ–¯AI 50æ¦œå•ã€‚ 2023å¹´8æœˆï¼Œå…¥é€‰ç¦å¸ƒæ–¯å‘å¸ƒ2023äº‘è®¡ç®—100å¼ºæ¦œå•ååˆ—73ä½ã€‚ 2024å¹´4æœˆ16æ—¥ï¼Œå…¥é€‰ã€Š2024ç¦å¸ƒæ–¯AI 50æ¦œå•ã€‹æ’å4ä½ã€‚ 2025å¹´4æœˆï¼Œå…¥é€‰ã€Š2025ç¦å¸ƒæ–¯AI 50æ¦œå•ã€‹ã€‚ç»“æœ 2:  ç›¸ä¼¼åº¦åˆ†æ•°: 0.4469  è·ç¦»: 1.2377  æ–‡æœ¬: 2021å¹´ï¼ŒAnthropicæˆç«‹ã€‚2021å¹´5æœˆï¼ŒAnthropicè·å¾—1.24äº¿ç¾å…ƒAè½®èèµ„ï¼Œç”±Skypeè”åˆåˆ›å§‹äººJaan Tallinné¢†æŠ•ï¼ŒFacebookè”åˆåˆ›å§‹äººDustin Moskovitzç­‰æŠ•èµ„è€…å‚ä¸ã€‚ 2022å¹´4æœˆ29æ—¥ï¼ŒAnthropicåœ¨Bè½®èèµ„ä¸­ç­¹é›†äº†5.8äº¿ç¾å…ƒï¼Œé¢†æŠ•è€…ä¸ºFTX é¦–å¸­æ‰§è¡Œå®˜ Sam Bankman-Friedã€‚ 2023å¹´2æœˆï¼Œè·å¾—GoogleæŠ•èµ„3äº¿ç¾å…ƒï¼ŒGoogleæŒè‚¡10%ã€‚ 2023å¹´7æœˆ11æ—¥ï¼ŒAnthropic å‘å¸ƒäº†å…¨æ–°çš„ Claude 2 å¤§è¯­è¨€æ¨¡å‹ã€‚ 2024å¹´3æœˆ4æ—¥æ¶ˆæ¯ï¼ŒAnthropicå‘å¸ƒClaude 3æ¨¡å‹å®¶æ—ã€‚ 2024å¹´10æœˆ22æ—¥ï¼Œç¾å›½äººå·¥æ™ºèƒ½åˆåˆ›å…¬å¸Anthropicå®£å¸ƒæ¨å‡ºå‡çº§ç‰ˆçš„Claude 3.5 Sonnetæ¨¡å‹ï¼Œå‡çº§åçš„Claude 3.5å¤§è¯­è¨€æ¨¡å‹ï¼ŒAnthropicå£°ç§°ä¼šè¾¾åˆ°â€œä»¿ä½›ä¸€ä¸ªäººåœ¨ç”µè„‘å‰å·¥ä½œâ€çš„æ•ˆæœã€‚ 2025å¹´2æœˆ25æ—¥ï¼ŒAnthropicå®£å¸ƒæ¨å‡ºClaude 3.7 Sonnetï¼Œç§°è¿™æ˜¯å…¶è¿„ä»Šä¸ºæ­¢æœ€æ™ºèƒ½çš„æ¨¡å‹ï¼Œä¹Ÿæ˜¯å¸‚åœºä¸Šé¦–æ¬¾æ··åˆæ¨ç†æ¨¡å‹ï¼›å½“åœ°æ—¶é—´11æœˆ24æ—¥ï¼ŒAnthropicæ­£å¼å‘å¸ƒå…¶æœ€æ–°æ¨¡å‹Claude Opus 4.5ã€‚ ç»“æœ 3:  ç›¸ä¼¼åº¦åˆ†æ•°: 0.4362  è·ç¦»: 1.2923  æ–‡æœ¬: Anthropicæ˜¯ä¸€å®¶ä½äºç¾å›½åŠ å·æ—§é‡‘å±±çš„äººå·¥æ™ºèƒ½è‚¡ä»½æœ‰é™å…¬å¸ï¼Œ æˆç«‹äº2021å¹´ã€‚ è¯¥å…¬å¸ç”±è¾¾é‡Œå¥¥Â·é˜¿è«è¿ª å’Œä¸¹å¦®æ‹‰Â·é˜¿è«è¿ªå…„å¦¹åˆ›ç«‹ï¼Œ ç°ä»»é¦–å¸­æ‰§è¡Œå®˜è¾¾é‡Œå¥¥Â·é˜¿è«è¿ªã€‚ æ˜¯ä¸€å®¶äººå·¥æ™ºèƒ½å®‰å…¨å’Œç ”ç©¶å…¬å¸ï¼Œè‡´åŠ›äºæ„å»ºå¯é ã€å¯è§£é‡Šå’Œå¯æ“çºµçš„AIç³»ç»Ÿã€‚ Anthropicå…¬å¸å¼€å‘äº†èŠå¤©æœºå™¨äººClaudeï¼Œæå‡ºçš„â€œå®ªæ³•AIåŸåˆ™â€ã€‚ </code></pre><h2 id="å®éªŒä¸‰ï¼šPrompt-æ‹¼æ¥ä¸ç­”æ¡ˆç”Ÿæˆ"><a href="#å®éªŒä¸‰ï¼šPrompt-æ‹¼æ¥ä¸ç­”æ¡ˆç”Ÿæˆ" class="headerlink" title="å®éªŒä¸‰ï¼šPrompt æ‹¼æ¥ä¸ç­”æ¡ˆç”Ÿæˆ"></a>å®éªŒä¸‰ï¼šPrompt æ‹¼æ¥ä¸ç­”æ¡ˆç”Ÿæˆ</h2><h3 id="å®éªŒç›®æ ‡-1"><a href="#å®éªŒç›®æ ‡-1" class="headerlink" title="å®éªŒç›®æ ‡"></a>å®éªŒç›®æ ‡</h3><p>å°†æ£€ç´¢åˆ°çš„å†…å®¹ä¸ç”¨æˆ·é—®é¢˜æ‹¼æ¥ï¼Œæ„å»ºå®Œæ•´çš„Promptå‘é€ç»™LLMã€‚</p><h3 id="ç†è®ºåŸºç¡€-2"><a href="#ç†è®ºåŸºç¡€-2" class="headerlink" title="ç†è®ºåŸºç¡€"></a>ç†è®ºåŸºç¡€</h3><h4 id="Prompt-å·¥ç¨‹æ ¸å¿ƒåŸåˆ™"><a href="#Prompt-å·¥ç¨‹æ ¸å¿ƒåŸåˆ™" class="headerlink" title="Prompt å·¥ç¨‹æ ¸å¿ƒåŸåˆ™"></a>Prompt å·¥ç¨‹æ ¸å¿ƒåŸåˆ™</h4><ol><li><strong>æ˜ç¡®æ€§</strong>ï¼šæ¸…æ™°æŒ‡å®šè§’è‰²å’Œä»»åŠ¡</li><li><strong>ç»“æ„åŒ–</strong>ï¼šä½¿ç”¨æ ¼å¼åŒ–çš„æ¨¡æ¿</li><li><strong>çº¦æŸæ€§</strong>ï¼šé™åˆ¶å›ç­”èŒƒå›´åœ¨æ£€ç´¢å†…å®¹å†…</li><li><strong>ç¤ºä¾‹é©±åŠ¨</strong>ï¼šæä¾›Few-shotç¤ºä¾‹</li></ol><h4 id="å…¸å‹-RAG-Prompt-æ¨¡æ¿"><a href="#å…¸å‹-RAG-Prompt-æ¨¡æ¿" class="headerlink" title="å…¸å‹ RAG Prompt æ¨¡æ¿"></a>å…¸å‹ RAG Prompt æ¨¡æ¿</h4><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs markdown">ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„é—®ç­”åŠ©æ‰‹ã€‚è¯·åŸºäºæä¾›çš„ä¸Šä¸‹æ–‡ä¿¡æ¯å›ç­”ç”¨æˆ·é—®é¢˜ã€‚<br><br>ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼š<br>&#123;context&#125;<br><br>ç”¨æˆ·é—®é¢˜ï¼š&#123;question&#125;<br><br>å›ç­”è¦æ±‚ï¼š<br><span class="hljs-bullet">1.</span> ä»…åŸºäºä¸Šä¸‹æ–‡ä¿¡æ¯å›ç­”ï¼Œä¸è¦æ·»åŠ ä¸Šä¸‹æ–‡å¤–çš„ä¿¡æ¯<br><span class="hljs-bullet">2.</span> å¦‚æœä¸Šä¸‹æ–‡ä¿¡æ¯ä¸è¶³ä»¥å›ç­”é—®é¢˜ï¼Œè¯·æ˜ç¡®è¯´æ˜<br><span class="hljs-bullet">3.</span> å›ç­”è¦ç®€æ´ã€å‡†ç¡®ã€æœ‰æ¡ç†<br><span class="hljs-bullet">4.</span> å¦‚æœæ¶‰åŠæ•°å­—æˆ–äº‹å®ï¼Œè¯·ç¡®ä¿å‡†ç¡®æ€§<br><br>å›ç­”ï¼š<br></code></pre></td></tr></table></figure><h3 id="å®éªŒæ­¥éª¤-2"><a href="#å®éªŒæ­¥éª¤-2" class="headerlink" title="å®éªŒæ­¥éª¤"></a>å®éªŒæ­¥éª¤</h3><h4 id="Step-1-åŸºç¡€-Prompt-æ‹¼æ¥"><a href="#Step-1-åŸºç¡€-Prompt-æ‹¼æ¥" class="headerlink" title="Step 1: åŸºç¡€ Prompt æ‹¼æ¥"></a>Step 1: åŸºç¡€ Prompt æ‹¼æ¥</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> openai <span class="hljs-keyword">import</span> OpenAI<br><span class="hljs-keyword">import</span> os<br><br><span class="hljs-comment"># è®¾ç½®API Keyï¼ˆéœ€è¦æ‚¨è‡ªå·±çš„API Keyï¼Œæœ¬ä¾‹å­ä½¿ç”¨deepseekï¼‰</span><br><span class="hljs-comment"># os.environ[&#x27;API_KEY&#x27;] = &#x27;your-api-key-here&#x27;</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleVectorDB</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, dimension</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        åˆå§‹åŒ–å‘é‡æ•°æ®åº“</span><br><span class="hljs-string">        :param dimension: å‘é‡ç»´åº¦</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-variable language_">self</span>.dimension = dimension<br>        <span class="hljs-comment"># åˆ›å»ºFAISSç´¢å¼• (L2è·ç¦»ï¼Œä½™å¼¦ç›¸ä¼¼åº¦=1-è·ç¦»)</span><br>        <span class="hljs-variable language_">self</span>.index = faiss.IndexFlatL2(dimension)<br>        <span class="hljs-comment"># å­˜å‚¨åŸå§‹æ–‡æœ¬å—</span><br>        <span class="hljs-variable language_">self</span>.texts = []<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_vectors</span>(<span class="hljs-params">self, vectors, texts</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        æ·»åŠ å‘é‡å’Œæ–‡æœ¬</span><br><span class="hljs-string">        :param vectors: numpy array of vectors</span><br><span class="hljs-string">        :param texts: å¯¹åº”çš„æ–‡æœ¬åˆ—è¡¨</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-comment"># ç¡®ä¿å‘é‡æ˜¯float32ç±»å‹</span><br>        vectors = np.array(vectors).astype(<span class="hljs-string">&#x27;float32&#x27;</span>)<br>        <span class="hljs-comment"># æ·»åŠ åˆ°ç´¢å¼•</span><br>        <span class="hljs-variable language_">self</span>.index.add(vectors)<br>        <span class="hljs-variable language_">self</span>.texts.extend(texts)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">search</span>(<span class="hljs-params">self, query_vector, k=<span class="hljs-number">3</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        æœç´¢æœ€ç›¸ä¼¼çš„kä¸ªå‘é‡</span><br><span class="hljs-string">        :param query_vector: æŸ¥è¯¢å‘é‡ (numpy array)</span><br><span class="hljs-string">        :param k: è¿”å›top-kç»“æœ</span><br><span class="hljs-string">        :return: ( distances, indices, texts )</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        query_vector = np.array([query_vector]).astype(<span class="hljs-string">&#x27;float32&#x27;</span>)<br><br>        <span class="hljs-comment"># æœç´¢</span><br>        distances, indices = <span class="hljs-variable language_">self</span>.index.search(query_vector, k)<br><br>        <span class="hljs-comment"># è·å–å¯¹åº”çš„æ–‡æœ¬</span><br>        retrieved_texts = [<span class="hljs-variable language_">self</span>.texts[idx] <span class="hljs-keyword">for</span> idx <span class="hljs-keyword">in</span> indices[<span class="hljs-number">0</span>]]<br><br>        <span class="hljs-keyword">return</span> distances[<span class="hljs-number">0</span>], indices[<span class="hljs-number">0</span>], retrieved_texts<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleRAG</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, vector_db, model_name=<span class="hljs-string">&quot;deepseek-chat&quot;</span></span>):<br>        <span class="hljs-variable language_">self</span>.vector_db = vector_db<br>        <span class="hljs-variable language_">self</span>.model_name = model_name<br>        <span class="hljs-comment"># ä½¿ç”¨æœ¬åœ°æ¨¡å‹æ›¿ä»£ï¼ˆå¦‚æœæ— æ³•è®¿é—®OpenAI APIï¼‰</span><br>        <span class="hljs-variable language_">self</span>.use_local = <span class="hljs-literal">False</span><br>        <span class="hljs-variable language_">self</span>.local_model = SentenceTransformer(<span class="hljs-string">&#x27;all-MiniLM-L6-v2&#x27;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">build_prompt</span>(<span class="hljs-params">self, query, retrieved_texts, max_context_length=<span class="hljs-number">2000</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        æ„å»º RAG Prompt</span><br><span class="hljs-string">        :param query: ç”¨æˆ·é—®é¢˜</span><br><span class="hljs-string">        :param retrieved_texts: æ£€ç´¢åˆ°çš„æ–‡æœ¬åˆ—è¡¨</span><br><span class="hljs-string">        :param max_context_length: æœ€å¤§ä¸Šä¸‹æ–‡é•¿åº¦ï¼ˆå­—ç¬¦ï¼‰</span><br><span class="hljs-string">        :return: å®Œæ•´çš„Prompt</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-comment"># æ‹¼æ¥ä¸Šä¸‹æ–‡</span><br>        context = <span class="hljs-string">&quot;,&quot;</span>.join(retrieved_texts)<br><br>        <span class="hljs-comment"># é™åˆ¶ä¸Šä¸‹æ–‡é•¿åº¦</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(context) &gt; max_context_length:<br>            context = context[:max_context_length]<br><br>        prompt = <span class="hljs-string">f&quot;&quot;&quot;ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„é—®ç­”åŠ©æ‰‹ã€‚è¯·åŸºäºæä¾›çš„ä¸Šä¸‹æ–‡ä¿¡æ¯å›ç­”ç”¨æˆ·é—®é¢˜ã€‚</span><br><span class="hljs-string">                    ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼š<span class="hljs-subst">&#123;context&#125;</span></span><br><span class="hljs-string">                    ç”¨æˆ·é—®é¢˜ï¼š<span class="hljs-subst">&#123;query&#125;</span></span><br><span class="hljs-string">                    å›ç­”è¦æ±‚ï¼š</span><br><span class="hljs-string">                    1. ä»…åŸºäºä¸Šä¸‹æ–‡ä¿¡æ¯å›ç­”ï¼Œä¸è¦æ·»åŠ ä¸Šä¸‹æ–‡å¤–çš„ä¿¡æ¯</span><br><span class="hljs-string">                    2. å¦‚æœä¸Šä¸‹æ–‡ä¿¡æ¯ä¸è¶³ä»¥å›ç­”é—®é¢˜ï¼Œè¯·æ˜ç¡®è¯´æ˜</span><br><span class="hljs-string">                    3. å›ç­”è¦ç®€æ´ã€å‡†ç¡®ã€æœ‰æ¡ç†</span><br><span class="hljs-string">                    4. å¦‚æœæ¶‰åŠæ•°å­—æˆ–äº‹å®ï¼Œè¯·ç¡®ä¿å‡†ç¡®æ€§</span><br><span class="hljs-string">                    å›ç­”ï¼š</span><br><span class="hljs-string">                &quot;&quot;&quot;</span><br><br>        <span class="hljs-keyword">return</span> prompt<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">call_llm</span>(<span class="hljs-params">self, prompt</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        è°ƒç”¨ LLM ç”Ÿæˆå›ç­”</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.use_local:<br>            <span class="hljs-comment"># ä½¿ç”¨ç®€å•è§„åˆ™å¼•æ“æ¨¡æ‹ŸLLMå›ç­”ï¼ˆä»…ç”¨äºæµ‹è¯•ï¼‰</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.simple_rule_based_answer(prompt)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-comment"># è°ƒç”¨ DeepSeek API</span><br>            client = OpenAI(<br>                api_key=os.getenv(<span class="hljs-string">&#x27;DEEPSEEK_API&#x27;</span>),<br>                base_url=<span class="hljs-string">&quot;https://api.deepseek.com/v1&quot;</span>  <span class="hljs-comment"># DeepSeek API ç«¯ç‚¹</span><br>            )<br><br>            response = client.chat.completions.create(<br>                model=<span class="hljs-string">&quot;deepseek-chat&quot;</span>,  <span class="hljs-comment"># ä¾‹å¦‚ &quot;deepseek-chat&quot;</span><br>                messages=[<br>                    &#123;<span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;content&quot;</span>: prompt&#125;<br>                ],<br>                temperature=<span class="hljs-number">0.7</span>,<br>                max_tokens=<span class="hljs-number">1000</span><br>            )<br>            <span class="hljs-keyword">return</span> response.choices[<span class="hljs-number">0</span>].message.content<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">simple_rule_based_answer</span>(<span class="hljs-params">self, prompt</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        ç®€å•çš„åŸºäºè§„åˆ™çš„é—®ç­”ï¼ˆä»…ç”¨äºæµ‹è¯•ç¯å¢ƒï¼‰</span><br><span class="hljs-string">        å®é™…ç”Ÿäº§ç¯å¢ƒåº”ä½¿ç”¨çœŸæ­£çš„ LLM</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-comment"># æå–é—®é¢˜å’Œä¸Šä¸‹æ–‡</span><br>        lines = prompt.split(<span class="hljs-string">&#x27;\n&#x27;</span>)<br>        question = <span class="hljs-string">&quot;&quot;</span><br>        context = <span class="hljs-string">&quot;&quot;</span><br><br>        in_question = <span class="hljs-literal">False</span><br>        in_context = <span class="hljs-literal">False</span><br><br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines:<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;ç”¨æˆ·é—®é¢˜ï¼š&quot;</span> <span class="hljs-keyword">in</span> line:<br>                in_question = <span class="hljs-literal">True</span><br>                in_context = <span class="hljs-literal">False</span><br>                question = line.replace(<span class="hljs-string">&quot;ç”¨æˆ·é—®é¢˜ï¼š&quot;</span>, <span class="hljs-string">&quot;&quot;</span>).strip()<br>            <span class="hljs-keyword">elif</span> <span class="hljs-string">&quot;ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼š&quot;</span> <span class="hljs-keyword">in</span> line:<br>                in_context = <span class="hljs-literal">True</span><br>                in_question = <span class="hljs-literal">False</span><br>            <span class="hljs-keyword">elif</span> line.startswith(<span class="hljs-string">&quot;å›ç­”ï¼š&quot;</span>):<br>                <span class="hljs-keyword">break</span><br>            <span class="hljs-keyword">elif</span> in_context:<br>                context += line + <span class="hljs-string">&quot;\n&quot;</span><br><br>        <br>        <span class="hljs-keyword">for</span> keyword, answer <span class="hljs-keyword">in</span> keywords.items():<br>            <span class="hljs-keyword">if</span> keyword <span class="hljs-keyword">in</span> question <span class="hljs-keyword">or</span> keyword <span class="hljs-keyword">in</span> context:<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;åŸºäºä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œ<span class="hljs-subst">&#123;answer&#125;</span>&quot;</span><br><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;æŠ±æ­‰ï¼ŒåŸºäºæä¾›çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œæˆ‘æ— æ³•å›ç­”è¿™ä¸ªé—®é¢˜ã€‚&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">query</span>(<span class="hljs-params">self, question, k=<span class="hljs-number">3</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        å®Œæ•´çš„RAGæŸ¥è¯¢æµç¨‹</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-comment"># 1. å‘é‡åŒ–é—®é¢˜</span><br>        query_embedding = <span class="hljs-variable language_">self</span>.local_model.encode([question])[<span class="hljs-number">0</span>]<br><br>        <span class="hljs-comment"># 2. æ£€ç´¢ç›¸å…³å†…å®¹</span><br>        distances, indices, retrieved_texts = <span class="hljs-variable language_">self</span>.vector_db.search(query_embedding, k=k)<br><br>        <span class="hljs-comment"># 3. æ„å»ºPrompt</span><br>        prompt = <span class="hljs-variable language_">self</span>.build_prompt(question, retrieved_texts)<br><br>        <span class="hljs-comment"># 4. ç”Ÿæˆå›ç­”</span><br>        answer = <span class="hljs-variable language_">self</span>.call_llm(prompt)<br><br>        <span class="hljs-keyword">return</span> &#123;<br>            <span class="hljs-string">&#x27;question&#x27;</span>: question,<br>            <span class="hljs-string">&#x27;retrieved_texts&#x27;</span>: retrieved_texts,<br>            <span class="hljs-string">&#x27;distances&#x27;</span>: distances.tolist(),<br>            <span class="hljs-string">&#x27;prompt&#x27;</span>: prompt,<br>            <span class="hljs-string">&#x27;answer&#x27;</span>: answer<br>        &#125;<br><br><span class="hljs-comment"># ç®€å•çš„å…³é”®è¯åŒ¹é…å›ç­”</span><br><br>documents = [<br>    <span class="hljs-string">&quot;äººå·¥æ™ºèƒ½æ˜¯è®¡ç®—æœºç§‘å­¦çš„é‡è¦åˆ†æ”¯&quot;</span>,<br>    <span class="hljs-string">&quot;æ·±åº¦å­¦ä¹ ä½¿ç”¨å¤šå±‚ç¥ç»ç½‘ç»œ&quot;</span>,<br>    <span class="hljs-string">&quot;æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„å­é›†&quot;</span>,<br>    <span class="hljs-string">&quot;Pythonæ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€&quot;</span>,<br>    <span class="hljs-string">&quot;å¤§æ•°æ®éœ€è¦é«˜æ•ˆçš„æ•°æ®å¤„ç†æŠ€æœ¯&quot;</span><br>]<br><br>keywords = &#123;<br>    <span class="hljs-string">&quot;äººå·¥æ™ºèƒ½&quot;</span>: <span class="hljs-string">&quot;äººå·¥æ™ºèƒ½æ˜¯è®¡ç®—æœºç§‘å­¦çš„é‡è¦åˆ†æ”¯ï¼Œå®ƒä¼å›¾äº†è§£æ™ºèƒ½çš„å®è´¨ã€‚&quot;</span>,<br>    <span class="hljs-string">&quot;æœºå™¨å­¦ä¹ &quot;</span>: <span class="hljs-string">&quot;æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œä½¿ç”¨ç»Ÿè®¡æŠ€æœ¯è®©è®¡ç®—æœºä»æ•°æ®ä¸­å­¦ä¹ ã€‚&quot;</span>,<br>    <span class="hljs-string">&quot;æ·±åº¦å­¦ä¹ &quot;</span>: <span class="hljs-string">&quot;æ·±åº¦å­¦ä¹ æ˜¯æœºå™¨å­¦ä¹ çš„å­é›†ï¼Œä½¿ç”¨å¤šå±‚ç¥ç»ç½‘ç»œæ¨¡æ‹Ÿäººè„‘å­¦ä¹ ã€‚&quot;</span>,<br>    <span class="hljs-string">&quot;Python&quot;</span>: <span class="hljs-string">&quot;Pythonæ˜¯ä¸€ç§é«˜çº§ç¼–ç¨‹è¯­è¨€ï¼Œå¹¿æ³›ç”¨äºæ•°æ®ç§‘å­¦å’ŒAIé¢†åŸŸã€‚&quot;</span><br>&#125;<br><br><span class="hljs-comment"># å‘é‡åŒ–</span><br>embeddings = model.encode(documents)<br><br><span class="hljs-comment"># æ„å»ºæ•°æ®åº“</span><br>vector_db = SimpleVectorDB(dimension=embeddings.shape[<span class="hljs-number">1</span>])<br>vector_db.add_vectors(embeddings, documents)<br><br><span class="hljs-comment"># å®éªŒ</span><br>rag = SimpleRAG(vector_db)<br><br><span class="hljs-comment"># æµ‹è¯•æŸ¥è¯¢</span><br>query = <span class="hljs-string">&quot;äººå·¥æ™ºèƒ½åŒ…æ‹¬å“ªäº›åˆ†æ”¯ï¼Ÿ&quot;</span><br>result = rag.query(query, k=<span class="hljs-number">2</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;=&quot;</span> * <span class="hljs-number">80</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ç”¨æˆ·é—®é¢˜: <span class="hljs-subst">&#123;result[<span class="hljs-string">&#x27;question&#x27;</span>]&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;=&quot;</span> * <span class="hljs-number">80</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\næ£€ç´¢åˆ°çš„æ–‡æ¡£:&quot;</span>)<br><span class="hljs-keyword">for</span> i, (text, dist) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(<span class="hljs-built_in">zip</span>(result[<span class="hljs-string">&#x27;retrieved_texts&#x27;</span>], result[<span class="hljs-string">&#x27;distances&#x27;</span>])):<br>    similarity = <span class="hljs-number">1</span> / (<span class="hljs-number">1</span> + dist)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\næ–‡æ¡£ <span class="hljs-subst">&#123;i+<span class="hljs-number">1</span>&#125;</span> (ç›¸ä¼¼åº¦: <span class="hljs-subst">&#123;similarity:<span class="hljs-number">.4</span>f&#125;</span>):&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  <span class="hljs-subst">&#123;text&#125;</span>&quot;</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">80</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ç”Ÿæˆçš„Prompt:&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;=&quot;</span> * <span class="hljs-number">80</span>)<br><span class="hljs-built_in">print</span>(result[<span class="hljs-string">&#x27;prompt&#x27;</span>])<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">80</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;LLM å›ç­”:&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;=&quot;</span> * <span class="hljs-number">80</span>)<br><span class="hljs-built_in">print</span>(result[<span class="hljs-string">&#x27;answer&#x27;</span>])<br></code></pre></td></tr></table></figure><pre><code class="hljs">================================================================================ç”¨æˆ·é—®é¢˜: äººå·¥æ™ºèƒ½åŒ…æ‹¬å“ªäº›åˆ†æ”¯ï¼Ÿ================================================================================æ£€ç´¢åˆ°çš„æ–‡æ¡£:æ–‡æ¡£ 1 (ç›¸ä¼¼åº¦: 0.8471):  äººå·¥æ™ºèƒ½æ˜¯è®¡ç®—æœºç§‘å­¦çš„é‡è¦åˆ†æ”¯æ–‡æ¡£ 2 (ç›¸ä¼¼åº¦: 0.6984):  æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„å­é›†================================================================================ç”Ÿæˆçš„Prompt:================================================================================ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„é—®ç­”åŠ©æ‰‹ã€‚è¯·åŸºäºæä¾›çš„ä¸Šä¸‹æ–‡ä¿¡æ¯å›ç­”ç”¨æˆ·é—®é¢˜ã€‚                    ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼šäººå·¥æ™ºèƒ½æ˜¯è®¡ç®—æœºç§‘å­¦çš„é‡è¦åˆ†æ”¯,æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„å­é›†                    ç”¨æˆ·é—®é¢˜ï¼šäººå·¥æ™ºèƒ½åŒ…æ‹¬å“ªäº›åˆ†æ”¯ï¼Ÿ                    å›ç­”è¦æ±‚ï¼š                    1. ä»…åŸºäºä¸Šä¸‹æ–‡ä¿¡æ¯å›ç­”ï¼Œä¸è¦æ·»åŠ ä¸Šä¸‹æ–‡å¤–çš„ä¿¡æ¯                    2. å¦‚æœä¸Šä¸‹æ–‡ä¿¡æ¯ä¸è¶³ä»¥å›ç­”é—®é¢˜ï¼Œè¯·æ˜ç¡®è¯´æ˜                    3. å›ç­”è¦ç®€æ´ã€å‡†ç¡®ã€æœ‰æ¡ç†                    4. å¦‚æœæ¶‰åŠæ•°å­—æˆ–äº‹å®ï¼Œè¯·ç¡®ä¿å‡†ç¡®æ€§                    å›ç­”ï¼š                ================================================================================LLM å›ç­”:================================================================================æ ¹æ®ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œäººå·¥æ™ºèƒ½åŒ…æ‹¬æœºå™¨å­¦ä¹ è¿™ä¸€åˆ†æ”¯ã€‚ä¸Šä¸‹æ–‡æœªæä¾›å…¶ä»–åˆ†æ”¯ä¿¡æ¯ã€‚</code></pre><h4 id="Step-2-é«˜çº§-Prompt-ä¼˜åŒ–"><a href="#Step-2-é«˜çº§-Prompt-ä¼˜åŒ–" class="headerlink" title="Step 2: é«˜çº§ Prompt ä¼˜åŒ–"></a>Step 2: é«˜çº§ Prompt ä¼˜åŒ–</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> openai<br><span class="hljs-keyword">import</span> os<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">AdvancedRAG</span>(<span class="hljs-title class_ inherited__">SimpleRAG</span>):<br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, vector_db, model_name=<span class="hljs-string">&quot;deepseek-chat&quot;</span></span>):<br>        <span class="hljs-variable language_">self</span>.vector_db = vector_db<br>        <span class="hljs-variable language_">self</span>.model_name = model_name<br>        <span class="hljs-comment"># ä½¿ç”¨æœ¬åœ°æ¨¡å‹æ›¿ä»£ï¼ˆå¦‚æœæ— æ³•è®¿é—®OpenAI APIï¼‰</span><br>        <span class="hljs-variable language_">self</span>.use_local = <span class="hljs-literal">False</span><br>        <span class="hljs-variable language_">self</span>.local_model = SentenceTransformer(<span class="hljs-string">&#x27;all-MiniLM-L6-v2&#x27;</span>)<br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">build_prompt</span>(<span class="hljs-params">self, query, retrieved_texts, metadata_list=<span class="hljs-literal">None</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        æ„å»ºæ›´é«˜çº§çš„Promptï¼ˆåŒ…å«å…ƒæ•°æ®ã€ç»“æ„åŒ–è¾“å‡ºç­‰ï¼‰</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">if</span> metadata_list <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>            metadata_list = [&#123;&#125;] * <span class="hljs-built_in">len</span>(retrieved_texts)<br><br>        <span class="hljs-comment"># æ„å»ºå¸¦ç¼–å·çš„ä¸Šä¸‹æ–‡</span><br>        numbered_context = []<br>        <span class="hljs-keyword">for</span> i, (text, metadata) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(<span class="hljs-built_in">zip</span>(retrieved_texts, metadata_list)):<br>            source_info = <span class="hljs-string">&quot;&quot;</span><br>            <span class="hljs-keyword">if</span> metadata.get(<span class="hljs-string">&#x27;source&#x27;</span>):<br>                source_info = <span class="hljs-string">f&quot; [æ¥æº: <span class="hljs-subst">&#123;metadata[<span class="hljs-string">&#x27;source&#x27;</span>]&#125;</span>]&quot;</span><br>            numbered_context.append(<span class="hljs-string">f&quot;[<span class="hljs-subst">&#123;i+<span class="hljs-number">1</span>&#125;</span>] <span class="hljs-subst">&#123;text&#125;</span><span class="hljs-subst">&#123;source_info&#125;</span>&quot;</span>)<br><br>        context = <span class="hljs-string">&quot;,&quot;</span>.join(numbered_context)<br><br>        prompt = <span class="hljs-string">f&quot;&quot;&quot;ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„é—®ç­”åŠ©æ‰‹ï¼Œæ“…é•¿åŸºäºæä¾›çš„æ–‡æ¡£å†…å®¹å›ç­”é—®é¢˜ã€‚</span><br><span class="hljs-string">                    ## ä»»åŠ¡è¯´æ˜</span><br><span class="hljs-string">                    åŸºäºä»¥ä¸‹æ£€ç´¢åˆ°çš„æ–‡æ¡£ç‰‡æ®µå›ç­”ç”¨æˆ·é—®é¢˜ã€‚æ–‡æ¡£å·²æŒ‰ç›¸å…³æ€§æ’åºï¼Œç¼–å·[1]è¡¨ç¤ºæœ€ç›¸å…³ã€‚</span><br><span class="hljs-string">                    ## æ–‡æ¡£å†…å®¹</span><br><span class="hljs-string">                    <span class="hljs-subst">&#123;context&#125;</span></span><br><span class="hljs-string">                    ## ç”¨æˆ·é—®é¢˜</span><br><span class="hljs-string">                    <span class="hljs-subst">&#123;query&#125;</span></span><br><span class="hljs-string">                    ## å›ç­”è¦æ±‚</span><br><span class="hljs-string">                    1. **ä¸¥æ ¼åŸºäºæ–‡æ¡£**ï¼šä»…ä½¿ç”¨æä¾›çš„æ–‡æ¡£å†…å®¹ï¼Œä¸è¦æ·»åŠ ä»»ä½•å¤–éƒ¨çŸ¥è¯†</span><br><span class="hljs-string">                    2. **å¼•ç”¨æ¥æº**ï¼šåœ¨å›ç­”ä¸­æ ‡æ³¨ä½¿ç”¨çš„æ–‡æ¡£ç¼–å·ï¼Œå¦‚ [1][2]</span><br><span class="hljs-string">                    3. **å®Œæ•´æ€§**ï¼šå¦‚æœå•ä¸ªæ–‡æ¡£æ— æ³•å®Œæ•´å›ç­”ï¼Œè¯·ç»¼åˆå¤šä¸ªæ–‡æ¡£çš„ä¿¡æ¯</span><br><span class="hljs-string">                    4. **è¯šå®æ€§**ï¼šå¦‚æœæ–‡æ¡£ä¸­æ²¡æœ‰ç­”æ¡ˆï¼Œæ˜ç¡®è¯´æ˜&quot;æ–‡æ¡£ä¸­æ²¡æœ‰ç›¸å…³ä¿¡æ¯&quot;</span><br><span class="hljs-string">                    5. **æ ¼å¼**ï¼šä½¿ç”¨æ¸…æ™°çš„æ®µè½å’Œè¦ç‚¹ç»„ç»‡ç­”æ¡ˆ</span><br><span class="hljs-string">                    ## å›ç­”æ ¼å¼</span><br><span class="hljs-string">                    **ç­”æ¡ˆï¼š**</span><br><span class="hljs-string">                    [ä½ çš„å›ç­”]</span><br><span class="hljs-string">                    **å‚è€ƒæ–‡æ¡£ï¼š** [åˆ—å‡ºä½¿ç”¨çš„æ–‡æ¡£ç¼–å·]</span><br><span class="hljs-string">                    ---&quot;&quot;&quot;</span><br><br>        <span class="hljs-keyword">return</span> prompt<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">query_with_metadata</span>(<span class="hljs-params">self, question, k=<span class="hljs-number">3</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        å¸¦å…ƒæ•°æ®çš„æŸ¥è¯¢</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        query_embedding = <span class="hljs-variable language_">self</span>.local_model.encode([question])[<span class="hljs-number">0</span>]<br>        distances, indices, retrieved_texts = <span class="hljs-variable language_">self</span>.vector_db.search(query_embedding, k=k)<br><br>        <span class="hljs-comment"># æ¨¡æ‹Ÿå…ƒæ•°æ®ï¼ˆå®é™…åº”ç”¨ä¸­åº”ä»æ•°æ®åº“è·å–ï¼‰</span><br>        metadata_list = [<br>            &#123;<span class="hljs-string">&#x27;source&#x27;</span>: <span class="hljs-string">f&#x27;doc_<span class="hljs-subst">&#123;idx&#125;</span>.txt&#x27;</span>, <span class="hljs-string">&#x27;page&#x27;</span>: <span class="hljs-number">1</span>&#125;<br>            <span class="hljs-keyword">for</span> idx <span class="hljs-keyword">in</span> indices<br>        ]<br><br>        prompt = <span class="hljs-variable language_">self</span>.build_prompt(question, retrieved_texts, metadata_list)<br>        answer = <span class="hljs-variable language_">self</span>.call_llm(prompt)<br><br>        <span class="hljs-keyword">return</span> &#123;<br>            <span class="hljs-string">&#x27;question&#x27;</span>: question,<br>            <span class="hljs-string">&#x27;retrieved_texts&#x27;</span>: retrieved_texts,<br>            <span class="hljs-string">&#x27;metadata_list&#x27;</span>: metadata_list,<br>            <span class="hljs-string">&#x27;prompt&#x27;</span>: prompt,<br>            <span class="hljs-string">&#x27;answer&#x27;</span>: answer<br>        &#125;<br>        <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">call_llm</span>(<span class="hljs-params">self, prompt</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        è°ƒç”¨ LLM ç”Ÿæˆå›ç­”</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.use_local:<br>            <span class="hljs-comment"># ä½¿ç”¨ç®€å•è§„åˆ™å¼•æ“æ¨¡æ‹ŸLLMå›ç­”ï¼ˆä»…ç”¨äºæµ‹è¯•ï¼‰</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.simple_rule_based_answer(prompt)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-comment"># è°ƒç”¨ DeepSeek API</span><br>            client = OpenAI(<br>                api_key=os.getenv(<span class="hljs-string">&#x27;DEEPSEEK_API&#x27;</span>),<br>                base_url=<span class="hljs-string">&quot;https://api.deepseek.com/v1&quot;</span>  <span class="hljs-comment"># DeepSeek API ç«¯ç‚¹</span><br>            )<br><br>            response = client.chat.completions.create(<br>                model=<span class="hljs-string">&quot;deepseek-chat&quot;</span>,  <span class="hljs-comment"># ä¾‹å¦‚ &quot;deepseek-chat&quot;</span><br>                messages=[<br>                    &#123;<span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;content&quot;</span>: prompt&#125;<br>                ],<br>                temperature=<span class="hljs-number">0.7</span>,<br>                max_tokens=<span class="hljs-number">1000</span><br>            )<br>            <span class="hljs-keyword">return</span> response.choices[<span class="hljs-number">0</span>].message.content<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">simple_rule_based_answer</span>(<span class="hljs-params">self, prompt</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        ç®€å•çš„åŸºäºè§„åˆ™çš„é—®ç­”ï¼ˆä»…ç”¨äºæµ‹è¯•ç¯å¢ƒï¼‰</span><br><span class="hljs-string">        å®é™…ç”Ÿäº§ç¯å¢ƒåº”ä½¿ç”¨çœŸæ­£çš„ LLM</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-comment"># æå–é—®é¢˜å’Œä¸Šä¸‹æ–‡</span><br>        lines = prompt.split(<span class="hljs-string">&#x27;\n&#x27;</span>)<br>        question = <span class="hljs-string">&quot;&quot;</span><br>        context = <span class="hljs-string">&quot;&quot;</span><br><br>        in_question = <span class="hljs-literal">False</span><br>        in_context = <span class="hljs-literal">False</span><br><br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines:<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;ç”¨æˆ·é—®é¢˜ï¼š&quot;</span> <span class="hljs-keyword">in</span> line:<br>                in_question = <span class="hljs-literal">True</span><br>                in_context = <span class="hljs-literal">False</span><br>                question = line.replace(<span class="hljs-string">&quot;ç”¨æˆ·é—®é¢˜ï¼š&quot;</span>, <span class="hljs-string">&quot;&quot;</span>).strip()<br>            <span class="hljs-keyword">elif</span> <span class="hljs-string">&quot;ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼š&quot;</span> <span class="hljs-keyword">in</span> line:<br>                in_context = <span class="hljs-literal">True</span><br>                in_question = <span class="hljs-literal">False</span><br>            <span class="hljs-keyword">elif</span> line.startswith(<span class="hljs-string">&quot;å›ç­”ï¼š&quot;</span>):<br>                <span class="hljs-keyword">break</span><br>            <span class="hljs-keyword">elif</span> in_context:<br>                context += line + <span class="hljs-string">&quot;\n&quot;</span><br><br>        <br>        <span class="hljs-keyword">for</span> keyword, answer <span class="hljs-keyword">in</span> keywords.items():<br>            <span class="hljs-keyword">if</span> keyword <span class="hljs-keyword">in</span> question <span class="hljs-keyword">or</span> keyword <span class="hljs-keyword">in</span> context:<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;åŸºäºä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œ<span class="hljs-subst">&#123;answer&#125;</span>&quot;</span><br><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;æŠ±æ­‰ï¼ŒåŸºäºæä¾›çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œæˆ‘æ— æ³•å›ç­”è¿™ä¸ªé—®é¢˜ã€‚&quot;</span><br><br><br><span class="hljs-comment"># å®éªŒ</span><br>rag = AdvancedRAG(vector_db)<br><br><span class="hljs-comment"># æµ‹è¯•æŸ¥è¯¢</span><br>query = <span class="hljs-string">&quot;äººå·¥æ™ºèƒ½åŒ…æ‹¬å“ªäº›åˆ†æ”¯ï¼Ÿ&quot;</span><br>result = rag.query_with_metadata(query, k=<span class="hljs-number">2</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;=&quot;</span> * <span class="hljs-number">80</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ç”¨æˆ·é—®é¢˜: <span class="hljs-subst">&#123;result[<span class="hljs-string">&#x27;question&#x27;</span>]&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;=&quot;</span> * <span class="hljs-number">80</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\næ£€ç´¢åˆ°çš„æ–‡æ¡£:&quot;</span>)<br><span class="hljs-keyword">for</span> i, (text, <span class="hljs-built_in">list</span>) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(<span class="hljs-built_in">zip</span>(result[<span class="hljs-string">&#x27;retrieved_texts&#x27;</span>], result[<span class="hljs-string">&#x27;metadata_list&#x27;</span>])):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  <span class="hljs-subst">&#123;text&#125;</span>&quot;</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">80</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ç”Ÿæˆçš„Prompt:&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;=&quot;</span> * <span class="hljs-number">80</span>)<br><span class="hljs-built_in">print</span>(result[<span class="hljs-string">&#x27;prompt&#x27;</span>])<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">80</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;LLM å›ç­”:&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;=&quot;</span> * <span class="hljs-number">80</span>)<br><span class="hljs-built_in">print</span>(result[<span class="hljs-string">&#x27;answer&#x27;</span>])<br></code></pre></td></tr></table></figure><pre><code class="hljs">================================================================================ç”¨æˆ·é—®é¢˜: äººå·¥æ™ºèƒ½åŒ…æ‹¬å“ªäº›åˆ†æ”¯ï¼Ÿ================================================================================æ£€ç´¢åˆ°çš„æ–‡æ¡£:  äººå·¥æ™ºèƒ½æ˜¯è®¡ç®—æœºç§‘å­¦çš„é‡è¦åˆ†æ”¯  æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„å­é›†================================================================================ç”Ÿæˆçš„Prompt:================================================================================ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„é—®ç­”åŠ©æ‰‹ï¼Œæ“…é•¿åŸºäºæä¾›çš„æ–‡æ¡£å†…å®¹å›ç­”é—®é¢˜ã€‚                    ## ä»»åŠ¡è¯´æ˜                    åŸºäºä»¥ä¸‹æ£€ç´¢åˆ°çš„æ–‡æ¡£ç‰‡æ®µå›ç­”ç”¨æˆ·é—®é¢˜ã€‚æ–‡æ¡£å·²æŒ‰ç›¸å…³æ€§æ’åºï¼Œç¼–å·[1]è¡¨ç¤ºæœ€ç›¸å…³ã€‚                    ## æ–‡æ¡£å†…å®¹                    [1] äººå·¥æ™ºèƒ½æ˜¯è®¡ç®—æœºç§‘å­¦çš„é‡è¦åˆ†æ”¯ [æ¥æº: doc_0.txt],[2] æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„å­é›† [æ¥æº: doc_2.txt]                    ## ç”¨æˆ·é—®é¢˜                    äººå·¥æ™ºèƒ½åŒ…æ‹¬å“ªäº›åˆ†æ”¯ï¼Ÿ                    ## å›ç­”è¦æ±‚                    1. **ä¸¥æ ¼åŸºäºæ–‡æ¡£**ï¼šä»…ä½¿ç”¨æä¾›çš„æ–‡æ¡£å†…å®¹ï¼Œä¸è¦æ·»åŠ ä»»ä½•å¤–éƒ¨çŸ¥è¯†                    2. **å¼•ç”¨æ¥æº**ï¼šåœ¨å›ç­”ä¸­æ ‡æ³¨ä½¿ç”¨çš„æ–‡æ¡£ç¼–å·ï¼Œå¦‚ [1][2]                    3. **å®Œæ•´æ€§**ï¼šå¦‚æœå•ä¸ªæ–‡æ¡£æ— æ³•å®Œæ•´å›ç­”ï¼Œè¯·ç»¼åˆå¤šä¸ªæ–‡æ¡£çš„ä¿¡æ¯                    4. **è¯šå®æ€§**ï¼šå¦‚æœæ–‡æ¡£ä¸­æ²¡æœ‰ç­”æ¡ˆï¼Œæ˜ç¡®è¯´æ˜&quot;æ–‡æ¡£ä¸­æ²¡æœ‰ç›¸å…³ä¿¡æ¯&quot;                    5. **æ ¼å¼**ï¼šä½¿ç”¨æ¸…æ™°çš„æ®µè½å’Œè¦ç‚¹ç»„ç»‡ç­”æ¡ˆ                    ## å›ç­”æ ¼å¼                    **ç­”æ¡ˆï¼š**                    [ä½ çš„å›ç­”]                    **å‚è€ƒæ–‡æ¡£ï¼š** [åˆ—å‡ºä½¿ç”¨çš„æ–‡æ¡£ç¼–å·]                    ---================================================================================LLM å›ç­”:================================================================================**ç­”æ¡ˆï¼š**æ ¹æ®æä¾›çš„æ–‡æ¡£å†…å®¹ï¼Œäººå·¥æ™ºèƒ½æ˜¯è®¡ç®—æœºç§‘å­¦çš„é‡è¦åˆ†æ”¯ [1]ã€‚æ–‡æ¡£ä¸­æ˜ç¡®æåŠï¼Œæœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„ä¸€ä¸ªå­é›† [2]ã€‚å› æ­¤ï¼ŒåŸºäºç°æœ‰ä¿¡æ¯ï¼Œäººå·¥æ™ºèƒ½çš„ä¸€ä¸ªåˆ†æ”¯æ˜¯æœºå™¨å­¦ä¹ ã€‚**å‚è€ƒæ–‡æ¡£ï¼š** [1][2]</code></pre><h3 id="å®éªŒä¸‰ç»ƒä¹ é¢˜"><a href="#å®éªŒä¸‰ç»ƒä¹ é¢˜" class="headerlink" title="å®éªŒä¸‰ç»ƒä¹ é¢˜"></a>å®éªŒä¸‰ç»ƒä¹ é¢˜</h3><ol><li><p><strong>Prompt A&#x2F;B æµ‹è¯•</strong>ï¼šè®¾è®¡ä¸¤ä¸ªä¸åŒçš„Promptæ¨¡æ¿ï¼Œå¯¹æ¯”å›ç­”è´¨é‡ã€‚</p></li><li><p><strong>ä¸Šä¸‹æ–‡é•¿åº¦å®éªŒ</strong>ï¼šæµ‹è¯•ä¸åŒmax_context_lengthå¯¹å›ç­”è´¨é‡çš„å½±å“ã€‚</p></li><li><p><strong>æ‹’ç»èƒ½åŠ›æµ‹è¯•</strong>ï¼šæå‡ºä¸€ä¸ªæ–‡æ¡£ä¸­ä¸å­˜åœ¨çš„é—®é¢˜ï¼Œæ£€æŸ¥æ¨¡å‹æ˜¯å¦è¯šå®å›ç­”ã€‚</p></li></ol><h2 id="ç»¼åˆå®éªŒï¼šå®Œæ•´-RAG-ç³»ç»Ÿ"><a href="#ç»¼åˆå®éªŒï¼šå®Œæ•´-RAG-ç³»ç»Ÿ" class="headerlink" title="ç»¼åˆå®éªŒï¼šå®Œæ•´ RAG ç³»ç»Ÿ"></a>ç»¼åˆå®éªŒï¼šå®Œæ•´ RAG ç³»ç»Ÿ</h2><h3 id="å®éªŒç›®æ ‡-2"><a href="#å®éªŒç›®æ ‡-2" class="headerlink" title="å®éªŒç›®æ ‡"></a>å®éªŒç›®æ ‡</h3><p>æ•´åˆå‰ä¸‰ä¸ªå®éªŒï¼Œæ„å»ºä¸€ä¸ªå®Œæ•´ã€å¯ç”¨çš„RAGç³»ç»Ÿã€‚</p><h3 id="å®éªŒä»»åŠ¡"><a href="#å®éªŒä»»åŠ¡" class="headerlink" title="å®éªŒä»»åŠ¡"></a>å®éªŒä»»åŠ¡</h3><h4 id="ä»»åŠ¡æè¿°"><a href="#ä»»åŠ¡æè¿°" class="headerlink" title="ä»»åŠ¡æè¿°"></a>ä»»åŠ¡æè¿°</h4><p>æ„å»ºä¸€ä¸ª<strong>å°è¯´çŸ¥è¯†é—®ç­”ç³»ç»Ÿ</strong>ï¼Œèƒ½å¤Ÿå›ç­”å…³äºã€Šçº¢æ¥¼æ¢¦ã€‹äººç‰©å…³ç³»ã€æƒ…èŠ‚å‘å±•ç­‰é—®é¢˜ã€‚</p><h4 id="æ•°æ®å‡†å¤‡"><a href="#æ•°æ®å‡†å¤‡" class="headerlink" title="æ•°æ®å‡†å¤‡"></a>æ•°æ®å‡†å¤‡</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">from</span> openai <span class="hljs-keyword">import</span> OpenAI<br><span class="hljs-keyword">from</span> sentence_transformers <span class="hljs-keyword">import</span> SentenceTransformer<br><br><span class="hljs-comment"># åŠ è½½é¢„è®­ç»ƒæ¨¡å‹</span><br>model = SentenceTransformer(<span class="hljs-string">&#x27;all-MiniLM-L6-v2&#x27;</span>)<br><br><span class="hljs-keyword">import</span> faiss<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleVectorDB</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, dimension</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        åˆå§‹åŒ–å‘é‡æ•°æ®åº“</span><br><span class="hljs-string">        :param dimension: å‘é‡ç»´åº¦</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-variable language_">self</span>.dimension = dimension<br>        <span class="hljs-comment"># åˆ›å»ºFAISSç´¢å¼• (L2è·ç¦»ï¼Œä½™å¼¦ç›¸ä¼¼åº¦=1-è·ç¦»)</span><br>        <span class="hljs-variable language_">self</span>.index = faiss.IndexFlatL2(dimension)<br>        <span class="hljs-comment"># å­˜å‚¨åŸå§‹æ–‡æœ¬å—</span><br>        <span class="hljs-variable language_">self</span>.texts = []<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_vectors</span>(<span class="hljs-params">self, vectors, texts</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        æ·»åŠ å‘é‡å’Œæ–‡æœ¬</span><br><span class="hljs-string">        :param vectors: numpy array of vectors</span><br><span class="hljs-string">        :param texts: å¯¹åº”çš„æ–‡æœ¬åˆ—è¡¨</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-comment"># ç¡®ä¿å‘é‡æ˜¯float32ç±»å‹</span><br>        vectors = np.array(vectors).astype(<span class="hljs-string">&#x27;float32&#x27;</span>)<br>        <span class="hljs-comment"># æ·»åŠ åˆ°ç´¢å¼•</span><br>        <span class="hljs-variable language_">self</span>.index.add(vectors)<br>        <span class="hljs-variable language_">self</span>.texts.extend(texts)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">search</span>(<span class="hljs-params">self, query_vector, k=<span class="hljs-number">3</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        æœç´¢æœ€ç›¸ä¼¼çš„kä¸ªå‘é‡</span><br><span class="hljs-string">        :param query_vector: æŸ¥è¯¢å‘é‡ (numpy array)</span><br><span class="hljs-string">        :param k: è¿”å›top-kç»“æœ</span><br><span class="hljs-string">        :return: ( distances, indices, texts )</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        query_vector = np.array([query_vector]).astype(<span class="hljs-string">&#x27;float32&#x27;</span>)<br><br>        <span class="hljs-comment"># æœç´¢</span><br>        distances, indices = <span class="hljs-variable language_">self</span>.index.search(query_vector, k)<br><br>        <span class="hljs-comment"># è·å–å¯¹åº”çš„æ–‡æœ¬</span><br>        retrieved_texts = [<span class="hljs-variable language_">self</span>.texts[idx] <span class="hljs-keyword">for</span> idx <span class="hljs-keyword">in</span> indices[<span class="hljs-number">0</span>]]<br><br>        <span class="hljs-keyword">return</span> distances[<span class="hljs-number">0</span>], indices[<span class="hljs-number">0</span>], retrieved_texts<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">chunk_text_fixed_length</span>(<span class="hljs-params">text, chunk_size=<span class="hljs-number">300</span>, overlap=<span class="hljs-number">50</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        å›ºå®šé•¿åº¦åˆ‡åˆ†ï¼Œå¸¦é‡å çª—å£</span><br><span class="hljs-string">        :param text: è¾“å…¥æ–‡æœ¬</span><br><span class="hljs-string">        :param chunk_size: æ¯å—å­—ç¬¦æ•°</span><br><span class="hljs-string">        :param overlap: é‡å å­—ç¬¦æ•°</span><br><span class="hljs-string">        :return: æ–‡æœ¬å—åˆ—è¡¨</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        chunks = []<br>        start = <span class="hljs-number">0</span><br><br>        <span class="hljs-keyword">while</span> start &lt; <span class="hljs-built_in">len</span>(text):<br>            end = start + chunk_size<br>            chunk = text[start:end]<br>            chunks.append(chunk)<br><br>            <span class="hljs-comment"># ä¸‹ä¸€å—ä» end-overlap å¼€å§‹</span><br>            start = end - overlap<br><br>            <span class="hljs-comment"># é˜²æ­¢æ— é™å¾ªç¯</span><br>            <span class="hljs-keyword">if</span> start &gt;= <span class="hljs-built_in">len</span>(text):<br>                <span class="hljs-keyword">break</span><br><br>            <span class="hljs-keyword">if</span> start &lt;= <span class="hljs-number">0</span>:  <span class="hljs-comment"># å¤„ç†æçŸ­æ–‡æœ¬</span><br>                <span class="hljs-keyword">break</span><br><br>        <span class="hljs-keyword">return</span> chunks<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">NovelRAGSystem</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-variable language_">self</span>.vector_db = <span class="hljs-literal">None</span><br>        <span class="hljs-variable language_">self</span>.embeddings = <span class="hljs-literal">None</span><br>        <span class="hljs-variable language_">self</span>.chunks = []<br>        <span class="hljs-variable language_">self</span>.metadata = []<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">load_novel_data</span>(<span class="hljs-params">self, file_path</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        åŠ è½½å°è¯´æ–‡æœ¬æ–‡ä»¶ï¼ˆtxtæ ¼å¼ï¼‰</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>            text = f.read()<br><br>        <span class="hljs-comment"># åˆ‡åˆ†ç« èŠ‚ï¼ˆå‡è®¾ç”¨&quot;ç¬¬Xå›&quot;åˆ†éš”ï¼‰</span><br>        <span class="hljs-keyword">import</span> re<br>        chapters = re.split(<span class="hljs-string">r&#x27;ç¬¬\d+å›&#x27;</span>, text)<br>        chapters = [ch.strip() <span class="hljs-keyword">for</span> ch <span class="hljs-keyword">in</span> chapters <span class="hljs-keyword">if</span> ch.strip()]<br><br>        <span class="hljs-keyword">return</span> chapters<br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">call_llm</span>(<span class="hljs-params">self, prompt</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        è°ƒç”¨ LLM ç”Ÿæˆå›ç­”</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-comment"># è°ƒç”¨ DeepSeek API</span><br>        client = OpenAI(<br>            api_key=os.getenv(<span class="hljs-string">&#x27;DEEPSEEK_API&#x27;</span>),<br>            base_url=<span class="hljs-string">&quot;https://api.deepseek.com/v1&quot;</span>  <span class="hljs-comment"># DeepSeek API ç«¯ç‚¹</span><br>        )<br><br>        response = client.chat.completions.create(<br>            model=<span class="hljs-string">&quot;deepseek-chat&quot;</span>,  <span class="hljs-comment"># ä¾‹å¦‚ &quot;deepseek-chat&quot;</span><br>            messages=[<br>                &#123;<span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;content&quot;</span>: prompt&#125;<br>            ],<br>            temperature=<span class="hljs-number">0.7</span>,<br>            max_tokens=<span class="hljs-number">2000</span><br>        )<br>        <span class="hljs-keyword">return</span> response.choices[<span class="hljs-number">0</span>].message.content<br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">preprocess_and_index</span>(<span class="hljs-params">self, text_chunks, chunk_size=<span class="hljs-number">300</span>, overlap=<span class="hljs-number">50</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        é¢„å¤„ç†å’Œç´¢å¼•æ–‡æ¡£</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-comment"># 1. åˆ‡åˆ†æ–‡æœ¬</span><br>        all_chunks = []<br><br>        <span class="hljs-keyword">for</span> chapter_num, chapter <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(text_chunks):<br>            chunks = chunk_text_fixed_length(chapter, chunk_size, overlap)<br><br>            <span class="hljs-comment"># ä¸ºæ¯ä¸ªchunkæ·»åŠ å…ƒæ•°æ®</span><br>            <span class="hljs-keyword">for</span> chunk_idx, chunk <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(chunks):<br>                all_chunks.append(&#123;<br>                    <span class="hljs-string">&#x27;text&#x27;</span>: chunk,<br>                    <span class="hljs-string">&#x27;chapter&#x27;</span>: chapter_num + <span class="hljs-number">1</span>,<br>                    <span class="hljs-string">&#x27;chunk_id&#x27;</span>: chunk_idx + <span class="hljs-number">1</span><br>                &#125;)<br><br>        <span class="hljs-variable language_">self</span>.chunks = all_chunks<br><br>        <span class="hljs-comment"># 2. å‘é‡åŒ–</span><br>        chunk_texts = [chunk[<span class="hljs-string">&#x27;text&#x27;</span>] <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> all_chunks]<br>        <span class="hljs-variable language_">self</span>.embeddings = model.encode(chunk_texts)<br><br>        <span class="hljs-comment"># 3. æ„å»ºå‘é‡æ•°æ®åº“</span><br>        <span class="hljs-variable language_">self</span>.vector_db = SimpleVectorDB(dimension=<span class="hljs-variable language_">self</span>.embeddings.shape[<span class="hljs-number">1</span>])<br>        <span class="hljs-variable language_">self</span>.vector_db.add_vectors(<br>            <span class="hljs-variable language_">self</span>.embeddings,<br>            chunk_texts<br>        )<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   -ç´¢å¼•å®Œæˆï¼&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   - æ€»chunkæ•°: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(all_chunks)&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   - å‘é‡ç»´åº¦: <span class="hljs-subst">&#123;self.embeddings.shape[<span class="hljs-number">1</span>]&#125;</span>&quot;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">query</span>(<span class="hljs-params">self, question, top_k=<span class="hljs-number">5</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        æŸ¥è¯¢å›ç­”</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.vector_db <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>            <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&quot;è¯·å…ˆè¿è¡Œ preprocess_and_index() æ„å»ºç´¢å¼•&quot;</span>)<br><br>        query_embedding = model.encode([question])[<span class="hljs-number">0</span>]<br>        distances, indices, retrieved_texts = <span class="hljs-variable language_">self</span>.vector_db.search(query_embedding, top_k)<br><br>        <span class="hljs-comment"># æ„å»ºprompt</span><br>        prompt = <span class="hljs-variable language_">self</span>.build_prompt(question, retrieved_texts)<br><br>        <span class="hljs-comment"># è°ƒç”¨LLM</span><br>        answer = <span class="hljs-variable language_">self</span>.call_llm(prompt)<br><br>        <span class="hljs-keyword">return</span> &#123;<br>            <span class="hljs-string">&#x27;question&#x27;</span>: question,<br>            <span class="hljs-string">&#x27;answer&#x27;</span>: answer,<br>            <span class="hljs-string">&#x27;prompt&#x27;</span>: prompt,<br>            <span class="hljs-string">&#x27;retrieved_chunks&#x27;</span>: [<br>                &#123;<br>                    <span class="hljs-string">&#x27;text&#x27;</span>: retrieved_texts[i],<br>                    <span class="hljs-string">&#x27;distance&#x27;</span>: distances[i],<br>                    <span class="hljs-string">&#x27;metadata&#x27;</span>: <span class="hljs-variable language_">self</span>.chunks[indices[i]]<br>                &#125;<br>                <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(retrieved_texts))<br>            ]<br>        &#125;<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">build_prompt</span>(<span class="hljs-params">self, question, retrieved_texts</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        æ„å»ºå°è¯´é—®ç­”çš„ä¸“ç”¨Prompt</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        context = <span class="hljs-string">&quot;\n\n&quot;</span>.join([<br>            <span class="hljs-string">f&quot;[ç‰‡æ®µ<span class="hljs-subst">&#123;i+<span class="hljs-number">1</span>&#125;</span>] <span class="hljs-subst">&#123;text&#125;</span>&quot;</span><br>            <span class="hljs-keyword">for</span> i, text <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(retrieved_texts)<br>        ])<br><br>        prompt = <span class="hljs-string">f&quot;&quot;&quot;ä½ æ˜¯ä¸€ä¸ªçº¢å­¦ä¸“å®¶ï¼Œå¯¹ã€Šçº¢æ¥¼æ¢¦ã€‹æœ‰æ·±å…¥ç ”ç©¶ã€‚è¯·åŸºäºæä¾›çš„æ–‡æœ¬ç‰‡æ®µå›ç­”ç”¨æˆ·å…³äºçº¢æ¥¼æ¢¦çš„é—®é¢˜ã€‚</span><br><span class="hljs-string">                ## é‡è¦åŸåˆ™</span><br><span class="hljs-string">                1. ä¸¥æ ¼åŸºäºæä¾›çš„æ–‡æœ¬ç‰‡æ®µå›ç­”</span><br><span class="hljs-string">                2. å¦‚æœéœ€è¦å¼•ç”¨æƒ…èŠ‚ï¼Œè¯·è¯´æ˜åœ¨å“ªä¸ªç‰‡æ®µä¸­æ‰¾åˆ°</span><br><span class="hljs-string">                3. å¯¹äºäººç‰©å…³ç³»ï¼Œè¦å‡†ç¡®å¼•ç”¨åŸæ–‡æè¿°</span><br><span class="hljs-string">                4. å¦‚æœç‰‡æ®µä¸­æ²¡æœ‰ç›¸å…³ä¿¡æ¯ï¼Œæ˜ç¡®è¯´æ˜</span><br><span class="hljs-string">                ## æ–‡æœ¬ç‰‡æ®µ</span><br><span class="hljs-string">                <span class="hljs-subst">&#123;context&#125;</span></span><br><span class="hljs-string">                ## é—®é¢˜</span><br><span class="hljs-string">                <span class="hljs-subst">&#123;question&#125;</span></span><br><span class="hljs-string">                ## å›ç­”</span><br><span class="hljs-string">                &quot;&quot;&quot;</span><br><br>        <span class="hljs-keyword">return</span> prompt<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">evaluate</span>(<span class="hljs-params">self, test_queries</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        è¯„ä¼°ç³»ç»Ÿæ€§èƒ½</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        results = []<br><br>        <span class="hljs-keyword">for</span> query_info <span class="hljs-keyword">in</span> test_queries:<br>            query = query_info[<span class="hljs-string">&#x27;question&#x27;</span>]<br>            expected = query_info.get(<span class="hljs-string">&#x27;expected_answer&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br><br>            result = <span class="hljs-variable language_">self</span>.query(query)<br>            result[<span class="hljs-string">&#x27;expected&#x27;</span>] = expected<br><br>            results.append(result)<br><br>        <span class="hljs-keyword">return</span> results<br></code></pre></td></tr></table></figure><h3 id="å¼€å§‹å®éªŒ"><a href="#å¼€å§‹å®éªŒ" class="headerlink" title="å¼€å§‹å®éªŒ"></a>å¼€å§‹å®éªŒ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å®éªŒ</span><br>rag = NovelRAGSystem()<br>rag.preprocess_and_index(rag.load_novel_data(<span class="hljs-string">&#x27;hlm.txt&#x27;</span>))<br></code></pre></td></tr></table></figure><pre><code class="hljs">   -ç´¢å¼•å®Œæˆï¼   - æ€»chunkæ•°: 3307   - å‘é‡ç»´åº¦: 384</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python">question = <span class="hljs-string">&quot;ã€Šäº”ç¾åŸã€‹çš„å†…å®¹æ˜¯ä»€ä¹ˆï¼Ÿ&quot;</span><br>result = rag.query(question, top_k=<span class="hljs-number">5</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;=&quot;</span> * <span class="hljs-number">80</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ç”¨æˆ·é—®é¢˜: <span class="hljs-subst">&#123;result[<span class="hljs-string">&#x27;question&#x27;</span>]&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;=&quot;</span> * <span class="hljs-number">80</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\næ£€ç´¢åˆ°çš„å—:&quot;</span>)<br><span class="hljs-built_in">print</span>(result[<span class="hljs-string">&#x27;retrieved_chunks&#x27;</span>])<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">80</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ç”Ÿæˆçš„Prompt:&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;=&quot;</span> * <span class="hljs-number">80</span>)<br><span class="hljs-built_in">print</span>(result[<span class="hljs-string">&#x27;prompt&#x27;</span>])<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">80</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;LLM å›ç­”:&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;=&quot;</span> * <span class="hljs-number">80</span>)<br><span class="hljs-built_in">print</span>(result[<span class="hljs-string">&#x27;answer&#x27;</span>])<br><br><br></code></pre></td></tr></table></figure><pre><code class="hljs">================================================================================ç”¨æˆ·é—®é¢˜: ã€Šäº”ç¾åŸã€‹çš„å†…å®¹æ˜¯ä»€ä¹ˆï¼Ÿ================================================================================æ£€ç´¢åˆ°çš„å—:[{&#39;text&#39;: &#39;å¨‡å¨†ï¼Ÿéƒ½ç¼˜é¡½ç¦å‰ç”Ÿé€ ï¼Œæ›´æœ‰åŒå½’æ…°å¯‚å¯¥ã€‚\nçº¢æ‹‚\né•¿å‰‘é›„è°ˆæ€è‡ªæ®Šï¼Œç¾äººå·¨çœ¼è¯†ç©·é€”ã€‚å°¸å±…ä½™æ°”æ¨å…¬å¹•ï¼Œå²‚å¾—ç¾ç¸»å¥³ä¸ˆå¤«ï¼Ÿ\nå®ç‰çœ‹äº†ï¼Œèµä¸ç»å£ã€‚åˆè¯´é“ï¼šâ€œå¦¹å¦¹è¿™è¯—ï¼Œæ°å¥½åªåšäº†äº”é¦–ï¼Œä½•ä¸å°±å‘½æ›°ã€Šäº”ç¾åŸã€‹ï¼Ÿâ€äºæ˜¯ä¸å®¹åˆ†è¯´ï¼Œä¾¿æç¬”å†™åœ¨åé¢ã€‚å®é’—äº¦è¯´é“ï¼šâ€œåšè¯—ä¸è®ºä½•é¢˜ï¼Œåªè¦å–„ç¿»å¤äººä¹‹æ„ã€‚è‹¥è¦éšäººè„šè¸ªèµ°å»ï¼Œçºµä½¿å­—å¥ç²¾å·¥ï¼Œå·²è½ç¬¬äºŒä¹‰ï¼Œç©¶ç«Ÿç®—ä¸å¾—å¥½è¯—ã€‚å³å¦‚å‰äººæ‰€å’æ˜­å›ä¹‹è¯—ç”šå¤šï¼Œæœ‰æ‚²æŒ½æ˜­å›çš„ï¼Œæœ‰æ€¨æ¨å»¶å¯¿çš„ï¼Œåˆæœ‰è®¥æ±‰å¸ä¸èƒ½ä½¿ç”»å·¥å›¾è²Œè´¤è‡£è€Œç”»ç¾äººçš„ï¼Œçº·çº·ä¸ä¸€ã€‚åæ¥ç‹è†å…¬å¤æœ‰â€œæ„æ€ç”±æ¥ç”»ä¸æˆï¼Œå½“æ—¶æ‰æ€æ¯›å»¶å¯¿â€ï¼›æ¬§é˜³æ°¸å”æœ‰â€œè€³ç›®æ‰€è§å°šå¦‚æ­¤ï¼Œä¸‡ç‘å®‰èƒ½åˆ¶å¤·ç‹„â€ï¼šäºŒè¯—ä¿±èƒ½å„å‡ºå·±è§ï¼Œä¸ä¸äººåŒã€‚ä»Šæ—¥æ—å¦¹å¦¹è¿™äº”é¦–è¯—ï¼Œäº¦å¯è°“å‘½æ„æ–°å¥‡ï¼Œåˆ«å¼€ç”Ÿé¢&#39;, &#39;distance&#39;: np.float32(0.8879534), &#39;metadata&#39;: {&#39;text&#39;: &#39;å¨‡å¨†ï¼Ÿéƒ½ç¼˜é¡½ç¦å‰ç”Ÿé€ ï¼Œæ›´æœ‰åŒå½’æ…°å¯‚å¯¥ã€‚\nçº¢æ‹‚\né•¿å‰‘é›„è°ˆæ€è‡ªæ®Šï¼Œç¾äººå·¨çœ¼è¯†ç©·é€”ã€‚å°¸å±…ä½™æ°”æ¨å…¬å¹•ï¼Œå²‚å¾—ç¾ç¸»å¥³ä¸ˆå¤«ï¼Ÿ\nå®ç‰çœ‹äº†ï¼Œèµä¸ç»å£ã€‚åˆè¯´é“ï¼šâ€œå¦¹å¦¹è¿™è¯—ï¼Œæ°å¥½åªåšäº†äº”é¦–ï¼Œä½•ä¸å°±å‘½æ›°ã€Šäº”ç¾åŸã€‹ï¼Ÿâ€äºæ˜¯ä¸å®¹åˆ†è¯´ï¼Œä¾¿æç¬”å†™åœ¨åé¢ã€‚å®é’—äº¦è¯´é“ï¼šâ€œåšè¯—ä¸è®ºä½•é¢˜ï¼Œåªè¦å–„ç¿»å¤äººä¹‹æ„ã€‚è‹¥è¦éšäººè„šè¸ªèµ°å»ï¼Œçºµä½¿å­—å¥ç²¾å·¥ï¼Œå·²è½ç¬¬äºŒä¹‰ï¼Œç©¶ç«Ÿç®—ä¸å¾—å¥½è¯—ã€‚å³å¦‚å‰äººæ‰€å’æ˜­å›ä¹‹è¯—ç”šå¤šï¼Œæœ‰æ‚²æŒ½æ˜­å›çš„ï¼Œæœ‰æ€¨æ¨å»¶å¯¿çš„ï¼Œåˆæœ‰è®¥æ±‰å¸ä¸èƒ½ä½¿ç”»å·¥å›¾è²Œè´¤è‡£è€Œç”»ç¾äººçš„ï¼Œçº·çº·ä¸ä¸€ã€‚åæ¥ç‹è†å…¬å¤æœ‰â€œæ„æ€ç”±æ¥ç”»ä¸æˆï¼Œå½“æ—¶æ‰æ€æ¯›å»¶å¯¿â€ï¼›æ¬§é˜³æ°¸å”æœ‰â€œè€³ç›®æ‰€è§å°šå¦‚æ­¤ï¼Œä¸‡ç‘å®‰èƒ½åˆ¶å¤·ç‹„â€ï¼šäºŒè¯—ä¿±èƒ½å„å‡ºå·±è§ï¼Œä¸ä¸äººåŒã€‚ä»Šæ—¥æ—å¦¹å¦¹è¿™äº”é¦–è¯—ï¼Œäº¦å¯è°“å‘½æ„æ–°å¥‡ï¼Œåˆ«å¼€ç”Ÿé¢&#39;, &#39;chapter&#39;: 1, &#39;chunk_id&#39;: 1694}}, {&#39;text&#39;: &#39;æ–‡ã€‚åŠè‡³ç¬¬ä¸‰å‡ºï¼Œåªè§é‡‘ç«¥ç‰å¥³ï¼Œæ——æ—›å®å¹¢ï¼Œå¼•ç€ä¸€ä¸ªéœ“è£³ç¾½è¡£çš„å°æ—¦ï¼Œå¤´ä¸ŠæŠ«ç€ä¸€æ¡é»‘å¸•ï¼Œå”±äº†å‡ å¥å„¿è¿›å»äº†ã€‚ä¼—çš†ä¸çŸ¥ã€‚å¬è§å¤–é¢äººè¯´ï¼šâ€œè¿™æ˜¯æ–°æ‰“çš„è•Šç è®°é‡Œçš„â€œå†¥å‡â€ã€‚å°æ—¦æ‰®çš„æ˜¯å«¦å¨¥ï¼Œå‰å› å •è½äººå¯°ï¼Œå‡ ä¹ç»™äººä¸ºé…ï¼›å¹¸äºè§‚éŸ³ç‚¹åŒ–ï¼Œä»–å°±æœªå«è€Œé€ã€‚æ­¤æ—¶å‡å¼•æœˆå®«ã€‚ä¸å¬è§é‡Œå¤´å”±çš„ï¼šâ€œäººé—´åªé“é£æƒ…å¥½ï¼Œé‚£çŸ¥é“ç§‹æœˆæ˜¥èŠ±å®¹æ˜“æŠ›ï¼Ÿå‡ ä¹ä¸æŠŠå¹¿å¯’å®«å¿˜å´äº†ï¼â€â€ç¬¬å››å‡ºæ˜¯â€œåƒç³ â€ã€‚ç¬¬äº”å‡ºæ˜¯â€œè¾¾æ‘©å¸¦ç€å¾’å¼Ÿè¿‡æ±Ÿå›å»â€ã€‚æ­£æ‰®å‡ºäº›æµ·å¸‚èœƒæ¥¼ï¼Œå¥½ä¸çƒ­é—¹ã€‚\nä¼—äººæ­£åœ¨é«˜å…´æ—¶ï¼Œå¿½è§è–›å®¶çš„äººæ»¡å¤´æ±—é—¯è¿›æ¥ï¼Œå‘è–›èŒè¯´é“ï¼šâ€œäºŒçˆ·å¿«å›å»ï¼ä¸€å¹¶é‡Œå¤´å›æ˜å¤ªå¤ªï¼Œä¹Ÿè¯·å›å»ï¼å®¶é‡Œæœ‰è¦ç´§äº‹ã€‚â€è–›èŒé“ï¼šä»€ä¹ˆäº‹ï¼Ÿâ€å®¶äººé“ï¼šâ€œå®¶å»è¯´ç½¢ã€‚â€è–›èŒä¹Ÿä¸åŠå‘Šè¾ï¼Œå°±èµ°äº†ã€‚è–›å§¨å¦ˆè§é‡Œå¤´ä¸«å¤´ä¼ &#39;, &#39;distance&#39;: np.float32(0.9940808), &#39;metadata&#39;: {&#39;text&#39;: &#39;æ–‡ã€‚åŠè‡³ç¬¬ä¸‰å‡ºï¼Œåªè§é‡‘ç«¥ç‰å¥³ï¼Œæ——æ—›å®å¹¢ï¼Œå¼•ç€ä¸€ä¸ªéœ“è£³ç¾½è¡£çš„å°æ—¦ï¼Œå¤´ä¸ŠæŠ«ç€ä¸€æ¡é»‘å¸•ï¼Œå”±äº†å‡ å¥å„¿è¿›å»äº†ã€‚ä¼—çš†ä¸çŸ¥ã€‚å¬è§å¤–é¢äººè¯´ï¼šâ€œè¿™æ˜¯æ–°æ‰“çš„è•Šç è®°é‡Œçš„â€œå†¥å‡â€ã€‚å°æ—¦æ‰®çš„æ˜¯å«¦å¨¥ï¼Œå‰å› å •è½äººå¯°ï¼Œå‡ ä¹ç»™äººä¸ºé…ï¼›å¹¸äºè§‚éŸ³ç‚¹åŒ–ï¼Œä»–å°±æœªå«è€Œé€ã€‚æ­¤æ—¶å‡å¼•æœˆå®«ã€‚ä¸å¬è§é‡Œå¤´å”±çš„ï¼šâ€œäººé—´åªé“é£æƒ…å¥½ï¼Œé‚£çŸ¥é“ç§‹æœˆæ˜¥èŠ±å®¹æ˜“æŠ›ï¼Ÿå‡ ä¹ä¸æŠŠå¹¿å¯’å®«å¿˜å´äº†ï¼â€â€ç¬¬å››å‡ºæ˜¯â€œåƒç³ â€ã€‚ç¬¬äº”å‡ºæ˜¯â€œè¾¾æ‘©å¸¦ç€å¾’å¼Ÿè¿‡æ±Ÿå›å»â€ã€‚æ­£æ‰®å‡ºäº›æµ·å¸‚èœƒæ¥¼ï¼Œå¥½ä¸çƒ­é—¹ã€‚\nä¼—äººæ­£åœ¨é«˜å…´æ—¶ï¼Œå¿½è§è–›å®¶çš„äººæ»¡å¤´æ±—é—¯è¿›æ¥ï¼Œå‘è–›èŒè¯´é“ï¼šâ€œäºŒçˆ·å¿«å›å»ï¼ä¸€å¹¶é‡Œå¤´å›æ˜å¤ªå¤ªï¼Œä¹Ÿè¯·å›å»ï¼å®¶é‡Œæœ‰è¦ç´§äº‹ã€‚â€è–›èŒé“ï¼šä»€ä¹ˆäº‹ï¼Ÿâ€å®¶äººé“ï¼šâ€œå®¶å»è¯´ç½¢ã€‚â€è–›èŒä¹Ÿä¸åŠå‘Šè¾ï¼Œå°±èµ°äº†ã€‚è–›å§¨å¦ˆè§é‡Œå¤´ä¸«å¤´ä¼ &#39;, &#39;chapter&#39;: 1, &#39;chunk_id&#39;: 2339}}, {&#39;text&#39;: &#39;çš„èººä¸‹äº†ã€‚åŸæ¥å®é’—è¢­äººå› æ˜¨å¤œä¸æ›¾ç¡ï¼Œåˆå…¼æ—¥é—´åŠ³ä¹äº†ä¸€å¤©ï¼Œæ‰€ä»¥ç¡å»ï¼Œéƒ½ä¸æ›¾å¬è§ä»–ä»¬è¯´è¯ï¼Œæ­¤æ—¶é™¢ä¸­ä¸€å“ï¼ŒçŒ›ç„¶æƒŠé†’ï¼Œå¬äº†å¬ï¼Œä¹Ÿæ— åŠ¨é™ã€‚å®ç‰æ­¤æ—¶èººåœ¨åºŠä¸Šï¼Œå¿ƒé‡Œç–‘æƒ‘ï¼šâ€œè«éæ—å¦¹å¦¹æ¥äº†ï¼Œå¬è§æˆ‘å’Œäº”å„¿è¯´è¯ï¼Œæ•…æ„å“æˆ‘ä»¬çš„ï¼Ÿâ€¦â€¦â€ç¿»æ¥è¦†å»ï¼Œèƒ¡æ€ä¹±æƒ³ï¼Œäº”æ›´ä»¥åï¼Œæ‰æœ¦èƒ§ç¡å»ã€‚\nå´è¯´äº”å„¿è¢«å®ç‰é¬¼æ··äº†åŠå¤œï¼Œåˆå…¼å®é’—å’³å—½ï¼Œè‡ªå·±æ€€ç€é¬¼èƒï¼Œç”Ÿæ€•å®é’—å¬è§äº†ï¼Œä¹Ÿæ˜¯æ€å‰æƒ³åï¼Œä¸€å¤œæ— çœ ã€‚æ¬¡æ—¥ä¸€æ—©èµ·æ¥ï¼Œè§å®ç‰å°šè‡ªæ˜æ˜ç¡ç€ï¼Œä¾¿è½»è½»å„¿çš„æ”¶æ‹¾äº†å±‹å­ã€‚é‚£é‡Œéºæœˆå·²é†’ï¼Œä¾¿é“ï¼šâ€œä½ æ€ä¹ˆè¿™ä¹ˆæ—©èµ·æ¥äº†ï¼Ÿä½ éš¾é“ä¸€å¤œæ²¡ç¡å—ï¼Ÿâ€äº”å„¿å¬è¿™è¯åˆä¼¼éºæœˆçŸ¥é“äº†çš„å…‰æ™¯ï¼Œä¾¿åªæ˜¯è®ªç¬‘ï¼Œä¹Ÿä¸ç­”è¨€ã€‚\nä¸€æ—¶ï¼Œå®é’—è¢­äººä¹Ÿéƒ½èµ·æ¥ã€‚å¼€äº†é—¨ï¼Œè§å®ç‰å°šç¡ï¼Œå´ä¹Ÿçº³é—·ï¼šâ€œæ€ä¹ˆåœ¨å¤–å¤´ä¸¤å¤œç¡çš„å€’&#39;, &#39;distance&#39;: np.float32(1.0152805), &#39;metadata&#39;: {&#39;text&#39;: &#39;çš„èººä¸‹äº†ã€‚åŸæ¥å®é’—è¢­äººå› æ˜¨å¤œä¸æ›¾ç¡ï¼Œåˆå…¼æ—¥é—´åŠ³ä¹äº†ä¸€å¤©ï¼Œæ‰€ä»¥ç¡å»ï¼Œéƒ½ä¸æ›¾å¬è§ä»–ä»¬è¯´è¯ï¼Œæ­¤æ—¶é™¢ä¸­ä¸€å“ï¼ŒçŒ›ç„¶æƒŠé†’ï¼Œå¬äº†å¬ï¼Œä¹Ÿæ— åŠ¨é™ã€‚å®ç‰æ­¤æ—¶èººåœ¨åºŠä¸Šï¼Œå¿ƒé‡Œç–‘æƒ‘ï¼šâ€œè«éæ—å¦¹å¦¹æ¥äº†ï¼Œå¬è§æˆ‘å’Œäº”å„¿è¯´è¯ï¼Œæ•…æ„å“æˆ‘ä»¬çš„ï¼Ÿâ€¦â€¦â€ç¿»æ¥è¦†å»ï¼Œèƒ¡æ€ä¹±æƒ³ï¼Œäº”æ›´ä»¥åï¼Œæ‰æœ¦èƒ§ç¡å»ã€‚\nå´è¯´äº”å„¿è¢«å®ç‰é¬¼æ··äº†åŠå¤œï¼Œåˆå…¼å®é’—å’³å—½ï¼Œè‡ªå·±æ€€ç€é¬¼èƒï¼Œç”Ÿæ€•å®é’—å¬è§äº†ï¼Œä¹Ÿæ˜¯æ€å‰æƒ³åï¼Œä¸€å¤œæ— çœ ã€‚æ¬¡æ—¥ä¸€æ—©èµ·æ¥ï¼Œè§å®ç‰å°šè‡ªæ˜æ˜ç¡ç€ï¼Œä¾¿è½»è½»å„¿çš„æ”¶æ‹¾äº†å±‹å­ã€‚é‚£é‡Œéºæœˆå·²é†’ï¼Œä¾¿é“ï¼šâ€œä½ æ€ä¹ˆè¿™ä¹ˆæ—©èµ·æ¥äº†ï¼Ÿä½ éš¾é“ä¸€å¤œæ²¡ç¡å—ï¼Ÿâ€äº”å„¿å¬è¿™è¯åˆä¼¼éºæœˆçŸ¥é“äº†çš„å…‰æ™¯ï¼Œä¾¿åªæ˜¯è®ªç¬‘ï¼Œä¹Ÿä¸ç­”è¨€ã€‚\nä¸€æ—¶ï¼Œå®é’—è¢­äººä¹Ÿéƒ½èµ·æ¥ã€‚å¼€äº†é—¨ï¼Œè§å®ç‰å°šç¡ï¼Œå´ä¹Ÿçº³é—·ï¼šâ€œæ€ä¹ˆåœ¨å¤–å¤´ä¸¤å¤œç¡çš„å€’&#39;, &#39;chapter&#39;: 1, &#39;chunk_id&#39;: 2967}}, {&#39;text&#39;: &#39;ç¬‘å˜»å˜»çš„é—®é“ï¼šâ€œä½ å’Œæ™´é›¯å§å§å¥½ä¸æ˜¯å•Šï¼Ÿâ€\näº”å„¿å¬äº†ï¼Œæ‘¸ä¸ç€å¤´è„‘ï¼Œä¾¿é“ï¼šâ€œéƒ½æ˜¯å§Šå¦¹ï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆä¸å¥½çš„ã€‚â€å®ç‰åˆæ‚„æ‚„çš„é—®é“ï¼šâ€œæ™´é›¯ç—…é‡äº†ï¼Œæˆ‘çœ‹ä»–å»ï¼Œä¸æ˜¯ä½ ä¹Ÿå»äº†ä¹ˆï¼Ÿâ€äº”å„¿å¾®å¾®ç¬‘ç€ç‚¹å¤´å„¿ã€‚å®ç‰é“ï¼šâ€œä½ å¬è§ä»–è¯´ä»€ä¹ˆäº†æ²¡æœ‰ï¼Ÿâ€äº”å„¿æ‘‡ç€å¤´å„¿é“ï¼šâ€œæ²¡æœ‰ã€‚â€å®ç‰å·²ç»å¿˜ç¥ï¼Œä¾¿æŠŠäº”å„¿çš„æ‰‹ä¸€æ‹‰ã€‚äº”å„¿æ€¥çš„çº¢äº†è„¸ï¼Œå¿ƒé‡Œä¹±è·³ï¼Œä¾¿æ‚„æ‚„è¯´é“ï¼šâ€œäºŒçˆ·ï¼Œæœ‰ä»€ä¹ˆè¯åªç®¡è¯´ï¼Œåˆ«æ‹‰æ‹‰æ‰¯æ‰¯çš„ã€‚â€å®ç‰æ‰æ’’äº†æ‰‹ï¼Œè¯´é“ï¼šâ€œä»–å’Œæˆ‘è¯´æ¥ç€ï¼šâ€œæ—©çŸ¥æ‹…äº†ä¸ªè™šåï¼Œä¹Ÿå°±æ‰“æ­£ç»ä¸»æ„äº†ï¼â€ä½ æ€ä¹ˆæ²¡å¬è§ä¹ˆï¼Ÿâ€\näº”å„¿å¬äº†è¿™è¯æ˜æ˜æ˜¯æ’©æ‹¨è‡ªå·±çš„æ„æ€ï¼Œåˆä¸æ•¢æ€ä¹ˆæ ·ï¼Œä¾¿è¯´é“ï¼šâ€œé‚£æ˜¯ä»–è‡ªå·±æ²¡è„¸ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¥³å­©å„¿å®¶è¯´å¾—çš„å—ï¼Ÿâ€å®ç‰ç€æ€¥é“ï¼šâ€œä½ æ€ä¹ˆä¹Ÿæ˜¯è¿™ä¹ˆä¸ªé“å­¦å…ˆç”Ÿï¼æˆ‘çœ‹ä½ é•¿çš„&#39;, &#39;distance&#39;: np.float32(1.0164812), &#39;metadata&#39;: {&#39;text&#39;: &#39;ç¬‘å˜»å˜»çš„é—®é“ï¼šâ€œä½ å’Œæ™´é›¯å§å§å¥½ä¸æ˜¯å•Šï¼Ÿâ€\näº”å„¿å¬äº†ï¼Œæ‘¸ä¸ç€å¤´è„‘ï¼Œä¾¿é“ï¼šâ€œéƒ½æ˜¯å§Šå¦¹ï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆä¸å¥½çš„ã€‚â€å®ç‰åˆæ‚„æ‚„çš„é—®é“ï¼šâ€œæ™´é›¯ç—…é‡äº†ï¼Œæˆ‘çœ‹ä»–å»ï¼Œä¸æ˜¯ä½ ä¹Ÿå»äº†ä¹ˆï¼Ÿâ€äº”å„¿å¾®å¾®ç¬‘ç€ç‚¹å¤´å„¿ã€‚å®ç‰é“ï¼šâ€œä½ å¬è§ä»–è¯´ä»€ä¹ˆäº†æ²¡æœ‰ï¼Ÿâ€äº”å„¿æ‘‡ç€å¤´å„¿é“ï¼šâ€œæ²¡æœ‰ã€‚â€å®ç‰å·²ç»å¿˜ç¥ï¼Œä¾¿æŠŠäº”å„¿çš„æ‰‹ä¸€æ‹‰ã€‚äº”å„¿æ€¥çš„çº¢äº†è„¸ï¼Œå¿ƒé‡Œä¹±è·³ï¼Œä¾¿æ‚„æ‚„è¯´é“ï¼šâ€œäºŒçˆ·ï¼Œæœ‰ä»€ä¹ˆè¯åªç®¡è¯´ï¼Œåˆ«æ‹‰æ‹‰æ‰¯æ‰¯çš„ã€‚â€å®ç‰æ‰æ’’äº†æ‰‹ï¼Œè¯´é“ï¼šâ€œä»–å’Œæˆ‘è¯´æ¥ç€ï¼šâ€œæ—©çŸ¥æ‹…äº†ä¸ªè™šåï¼Œä¹Ÿå°±æ‰“æ­£ç»ä¸»æ„äº†ï¼â€ä½ æ€ä¹ˆæ²¡å¬è§ä¹ˆï¼Ÿâ€\näº”å„¿å¬äº†è¿™è¯æ˜æ˜æ˜¯æ’©æ‹¨è‡ªå·±çš„æ„æ€ï¼Œåˆä¸æ•¢æ€ä¹ˆæ ·ï¼Œä¾¿è¯´é“ï¼šâ€œé‚£æ˜¯ä»–è‡ªå·±æ²¡è„¸ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¥³å­©å„¿å®¶è¯´å¾—çš„å—ï¼Ÿâ€å®ç‰ç€æ€¥é“ï¼šâ€œä½ æ€ä¹ˆä¹Ÿæ˜¯è¿™ä¹ˆä¸ªé“å­¦å…ˆç”Ÿï¼æˆ‘çœ‹ä½ é•¿çš„&#39;, &#39;chapter&#39;: 1, &#39;chunk_id&#39;: 2963}}, {&#39;text&#39;: &#39;äº”ç¥–å®å¿åœ¨é»„æ¢…ï¼Œä»–ä¾¿å……ä½œç«å¤´åƒ§ã€‚äº”ç¥–æ¬²æ±‚æ³•å—£ï¼Œä»¤è¯¸åƒ§å„å‡ºä¸€åˆã€‚åº§ç¥ç§€è¯´é“ï¼šâ€œèº«æ˜¯è©ææ ‘ï¼Œå¿ƒå¦‚æ˜é•œå°ã€‚æ—¶æ—¶å‹¤æ‹‚æ‹­ï¼Œè«ä½¿æœ‰å°˜åŸƒã€‚â€æƒ èƒ½åœ¨å¨æˆ¿èˆ‚ç±³ï¼Œå¬äº†ï¼Œé“ï¼šâ€œç¾åˆ™ç¾çŸ£ï¼Œäº†åˆ™æœªäº†ï¼Œâ€å› è‡ªå¿µä¸€åˆæ›°ï¼šâ€œè©ææœ¬éæ ‘ï¼Œæ˜é•œäº¦éå°ã€‚æœ¬æ¥æ— ä¸€ç‰©ï¼Œä½•å¤„æŸ“å°˜åŸƒï¼Ÿâ€äº”ç¥–ä¾¿å°†è¡£é’µä¼ ç»™äº†ä»–ã€‚ä»Šå„¿è¿™åˆè¯­ï¼Œäº¦åŒæ­¤æ„äº†ã€‚åªæ˜¯æ–¹æ‰è¿™å¥æœºé”‹ï¼Œå°šæœªå®Œå…¨äº†ç»“ï¼Œè¿™ä¾¿ä¸¢å¼€æ‰‹ä¸æˆï¼Ÿâ€é»›ç‰ç¬‘é“ï¼šâ€œä»–ä¸èƒ½ç­”ï¼Œå°±ç®—è¾“äº†ã€‚è¿™ä¼šå­ç­”ä¸Šäº†ï¼Œä¹Ÿä¸ä¸ºå‡ºå¥‡äº†ã€‚åªæ˜¯ä»¥åå†ä¸è®¸è°ˆç¦…äº†ã€‚è¿æˆ‘ä»¬ä¸¤ä¸ªæ‰€çŸ¥æ‰€èƒ½çš„ï¼Œä½ è¿˜ä¸çŸ¥ä¸èƒ½å‘¢ï¼Œè¿˜å»å‚ä»€ä¹ˆç¦…å‘¢ï¼â€\nå®ç‰è‡ªå·±ä»¥ä¸ºè§‰æ‚Ÿï¼Œä¸æƒ³å¿½è¢«é»›ç‰ä¸€é—®ï¼Œä¾¿ä¸èƒ½ç­”ï¼›å®é’—åˆæ¯”å‡ºè¯­å½•æ¥ï¼šæ­¤çš†ç´ ä¸è§ä»–ä»¬æ‰€èƒ½çš„ã€‚è‡ªå·±æƒ³äº†ä¸€æƒ³ï¼šâ€œåŸæ¥ä»–ä»¬æ¯”æˆ‘çš„çŸ¥è§‰åœ¨&#39;, &#39;distance&#39;: np.float32(1.0209681), &#39;metadata&#39;: {&#39;text&#39;: &#39;äº”ç¥–å®å¿åœ¨é»„æ¢…ï¼Œä»–ä¾¿å……ä½œç«å¤´åƒ§ã€‚äº”ç¥–æ¬²æ±‚æ³•å—£ï¼Œä»¤è¯¸åƒ§å„å‡ºä¸€åˆã€‚åº§ç¥ç§€è¯´é“ï¼šâ€œèº«æ˜¯è©ææ ‘ï¼Œå¿ƒå¦‚æ˜é•œå°ã€‚æ—¶æ—¶å‹¤æ‹‚æ‹­ï¼Œè«ä½¿æœ‰å°˜åŸƒã€‚â€æƒ èƒ½åœ¨å¨æˆ¿èˆ‚ç±³ï¼Œå¬äº†ï¼Œé“ï¼šâ€œç¾åˆ™ç¾çŸ£ï¼Œäº†åˆ™æœªäº†ï¼Œâ€å› è‡ªå¿µä¸€åˆæ›°ï¼šâ€œè©ææœ¬éæ ‘ï¼Œæ˜é•œäº¦éå°ã€‚æœ¬æ¥æ— ä¸€ç‰©ï¼Œä½•å¤„æŸ“å°˜åŸƒï¼Ÿâ€äº”ç¥–ä¾¿å°†è¡£é’µä¼ ç»™äº†ä»–ã€‚ä»Šå„¿è¿™åˆè¯­ï¼Œäº¦åŒæ­¤æ„äº†ã€‚åªæ˜¯æ–¹æ‰è¿™å¥æœºé”‹ï¼Œå°šæœªå®Œå…¨äº†ç»“ï¼Œè¿™ä¾¿ä¸¢å¼€æ‰‹ä¸æˆï¼Ÿâ€é»›ç‰ç¬‘é“ï¼šâ€œä»–ä¸èƒ½ç­”ï¼Œå°±ç®—è¾“äº†ã€‚è¿™ä¼šå­ç­”ä¸Šäº†ï¼Œä¹Ÿä¸ä¸ºå‡ºå¥‡äº†ã€‚åªæ˜¯ä»¥åå†ä¸è®¸è°ˆç¦…äº†ã€‚è¿æˆ‘ä»¬ä¸¤ä¸ªæ‰€çŸ¥æ‰€èƒ½çš„ï¼Œä½ è¿˜ä¸çŸ¥ä¸èƒ½å‘¢ï¼Œè¿˜å»å‚ä»€ä¹ˆç¦…å‘¢ï¼â€\nå®ç‰è‡ªå·±ä»¥ä¸ºè§‰æ‚Ÿï¼Œä¸æƒ³å¿½è¢«é»›ç‰ä¸€é—®ï¼Œä¾¿ä¸èƒ½ç­”ï¼›å®é’—åˆæ¯”å‡ºè¯­å½•æ¥ï¼šæ­¤çš†ç´ ä¸è§ä»–ä»¬æ‰€èƒ½çš„ã€‚è‡ªå·±æƒ³äº†ä¸€æƒ³ï¼šâ€œåŸæ¥ä»–ä»¬æ¯”æˆ‘çš„çŸ¥è§‰åœ¨&#39;, &#39;chapter&#39;: 1, &#39;chunk_id&#39;: 536}}]================================================================================ç”Ÿæˆçš„Prompt:================================================================================ä½ æ˜¯ä¸€ä¸ªçº¢å­¦ä¸“å®¶ï¼Œå¯¹ã€Šçº¢æ¥¼æ¢¦ã€‹æœ‰æ·±å…¥ç ”ç©¶ã€‚è¯·åŸºäºæä¾›çš„æ–‡æœ¬ç‰‡æ®µå›ç­”ç”¨æˆ·å…³äºçº¢æ¥¼æ¢¦çš„é—®é¢˜ã€‚                ## é‡è¦åŸåˆ™                1. ä¸¥æ ¼åŸºäºæä¾›çš„æ–‡æœ¬ç‰‡æ®µå›ç­”                2. å¦‚æœéœ€è¦å¼•ç”¨æƒ…èŠ‚ï¼Œè¯·è¯´æ˜åœ¨å“ªä¸ªç‰‡æ®µä¸­æ‰¾åˆ°                3. å¯¹äºäººç‰©å…³ç³»ï¼Œè¦å‡†ç¡®å¼•ç”¨åŸæ–‡æè¿°                4. å¦‚æœç‰‡æ®µä¸­æ²¡æœ‰ç›¸å…³ä¿¡æ¯ï¼Œæ˜ç¡®è¯´æ˜                ## æ–‡æœ¬ç‰‡æ®µ[ç‰‡æ®µ1] å¨‡å¨†ï¼Ÿéƒ½ç¼˜é¡½ç¦å‰ç”Ÿé€ ï¼Œæ›´æœ‰åŒå½’æ…°å¯‚å¯¥ã€‚çº¢æ‹‚é•¿å‰‘é›„è°ˆæ€è‡ªæ®Šï¼Œç¾äººå·¨çœ¼è¯†ç©·é€”ã€‚å°¸å±…ä½™æ°”æ¨å…¬å¹•ï¼Œå²‚å¾—ç¾ç¸»å¥³ä¸ˆå¤«ï¼Ÿå®ç‰çœ‹äº†ï¼Œèµä¸ç»å£ã€‚åˆè¯´é“ï¼šâ€œå¦¹å¦¹è¿™è¯—ï¼Œæ°å¥½åªåšäº†äº”é¦–ï¼Œä½•ä¸å°±å‘½æ›°ã€Šäº”ç¾åŸã€‹ï¼Ÿâ€äºæ˜¯ä¸å®¹åˆ†è¯´ï¼Œä¾¿æç¬”å†™åœ¨åé¢ã€‚å®é’—äº¦è¯´é“ï¼šâ€œåšè¯—ä¸è®ºä½•é¢˜ï¼Œåªè¦å–„ç¿»å¤äººä¹‹æ„ã€‚è‹¥è¦éšäººè„šè¸ªèµ°å»ï¼Œçºµä½¿å­—å¥ç²¾å·¥ï¼Œå·²è½ç¬¬äºŒä¹‰ï¼Œç©¶ç«Ÿç®—ä¸å¾—å¥½è¯—ã€‚å³å¦‚å‰äººæ‰€å’æ˜­å›ä¹‹è¯—ç”šå¤šï¼Œæœ‰æ‚²æŒ½æ˜­å›çš„ï¼Œæœ‰æ€¨æ¨å»¶å¯¿çš„ï¼Œåˆæœ‰è®¥æ±‰å¸ä¸èƒ½ä½¿ç”»å·¥å›¾è²Œè´¤è‡£è€Œç”»ç¾äººçš„ï¼Œçº·çº·ä¸ä¸€ã€‚åæ¥ç‹è†å…¬å¤æœ‰â€œæ„æ€ç”±æ¥ç”»ä¸æˆï¼Œå½“æ—¶æ‰æ€æ¯›å»¶å¯¿â€ï¼›æ¬§é˜³æ°¸å”æœ‰â€œè€³ç›®æ‰€è§å°šå¦‚æ­¤ï¼Œä¸‡ç‘å®‰èƒ½åˆ¶å¤·ç‹„â€ï¼šäºŒè¯—ä¿±èƒ½å„å‡ºå·±è§ï¼Œä¸ä¸äººåŒã€‚ä»Šæ—¥æ—å¦¹å¦¹è¿™äº”é¦–è¯—ï¼Œäº¦å¯è°“å‘½æ„æ–°å¥‡ï¼Œåˆ«å¼€ç”Ÿé¢[ç‰‡æ®µ2] æ–‡ã€‚åŠè‡³ç¬¬ä¸‰å‡ºï¼Œåªè§é‡‘ç«¥ç‰å¥³ï¼Œæ——æ—›å®å¹¢ï¼Œå¼•ç€ä¸€ä¸ªéœ“è£³ç¾½è¡£çš„å°æ—¦ï¼Œå¤´ä¸ŠæŠ«ç€ä¸€æ¡é»‘å¸•ï¼Œå”±äº†å‡ å¥å„¿è¿›å»äº†ã€‚ä¼—çš†ä¸çŸ¥ã€‚å¬è§å¤–é¢äººè¯´ï¼šâ€œè¿™æ˜¯æ–°æ‰“çš„è•Šç è®°é‡Œçš„â€œå†¥å‡â€ã€‚å°æ—¦æ‰®çš„æ˜¯å«¦å¨¥ï¼Œå‰å› å •è½äººå¯°ï¼Œå‡ ä¹ç»™äººä¸ºé…ï¼›å¹¸äºè§‚éŸ³ç‚¹åŒ–ï¼Œä»–å°±æœªå«è€Œé€ã€‚æ­¤æ—¶å‡å¼•æœˆå®«ã€‚ä¸å¬è§é‡Œå¤´å”±çš„ï¼šâ€œäººé—´åªé“é£æƒ…å¥½ï¼Œé‚£çŸ¥é“ç§‹æœˆæ˜¥èŠ±å®¹æ˜“æŠ›ï¼Ÿå‡ ä¹ä¸æŠŠå¹¿å¯’å®«å¿˜å´äº†ï¼â€â€ç¬¬å››å‡ºæ˜¯â€œåƒç³ â€ã€‚ç¬¬äº”å‡ºæ˜¯â€œè¾¾æ‘©å¸¦ç€å¾’å¼Ÿè¿‡æ±Ÿå›å»â€ã€‚æ­£æ‰®å‡ºäº›æµ·å¸‚èœƒæ¥¼ï¼Œå¥½ä¸çƒ­é—¹ã€‚ä¼—äººæ­£åœ¨é«˜å…´æ—¶ï¼Œå¿½è§è–›å®¶çš„äººæ»¡å¤´æ±—é—¯è¿›æ¥ï¼Œå‘è–›èŒè¯´é“ï¼šâ€œäºŒçˆ·å¿«å›å»ï¼ä¸€å¹¶é‡Œå¤´å›æ˜å¤ªå¤ªï¼Œä¹Ÿè¯·å›å»ï¼å®¶é‡Œæœ‰è¦ç´§äº‹ã€‚â€è–›èŒé“ï¼šä»€ä¹ˆäº‹ï¼Ÿâ€å®¶äººé“ï¼šâ€œå®¶å»è¯´ç½¢ã€‚â€è–›èŒä¹Ÿä¸åŠå‘Šè¾ï¼Œå°±èµ°äº†ã€‚è–›å§¨å¦ˆè§é‡Œå¤´ä¸«å¤´ä¼ [ç‰‡æ®µ3] çš„èººä¸‹äº†ã€‚åŸæ¥å®é’—è¢­äººå› æ˜¨å¤œä¸æ›¾ç¡ï¼Œåˆå…¼æ—¥é—´åŠ³ä¹äº†ä¸€å¤©ï¼Œæ‰€ä»¥ç¡å»ï¼Œéƒ½ä¸æ›¾å¬è§ä»–ä»¬è¯´è¯ï¼Œæ­¤æ—¶é™¢ä¸­ä¸€å“ï¼ŒçŒ›ç„¶æƒŠé†’ï¼Œå¬äº†å¬ï¼Œä¹Ÿæ— åŠ¨é™ã€‚å®ç‰æ­¤æ—¶èººåœ¨åºŠä¸Šï¼Œå¿ƒé‡Œç–‘æƒ‘ï¼šâ€œè«éæ—å¦¹å¦¹æ¥äº†ï¼Œå¬è§æˆ‘å’Œäº”å„¿è¯´è¯ï¼Œæ•…æ„å“æˆ‘ä»¬çš„ï¼Ÿâ€¦â€¦â€ç¿»æ¥è¦†å»ï¼Œèƒ¡æ€ä¹±æƒ³ï¼Œäº”æ›´ä»¥åï¼Œæ‰æœ¦èƒ§ç¡å»ã€‚å´è¯´äº”å„¿è¢«å®ç‰é¬¼æ··äº†åŠå¤œï¼Œåˆå…¼å®é’—å’³å—½ï¼Œè‡ªå·±æ€€ç€é¬¼èƒï¼Œç”Ÿæ€•å®é’—å¬è§äº†ï¼Œä¹Ÿæ˜¯æ€å‰æƒ³åï¼Œä¸€å¤œæ— çœ ã€‚æ¬¡æ—¥ä¸€æ—©èµ·æ¥ï¼Œè§å®ç‰å°šè‡ªæ˜æ˜ç¡ç€ï¼Œä¾¿è½»è½»å„¿çš„æ”¶æ‹¾äº†å±‹å­ã€‚é‚£é‡Œéºæœˆå·²é†’ï¼Œä¾¿é“ï¼šâ€œä½ æ€ä¹ˆè¿™ä¹ˆæ—©èµ·æ¥äº†ï¼Ÿä½ éš¾é“ä¸€å¤œæ²¡ç¡å—ï¼Ÿâ€äº”å„¿å¬è¿™è¯åˆä¼¼éºæœˆçŸ¥é“äº†çš„å…‰æ™¯ï¼Œä¾¿åªæ˜¯è®ªç¬‘ï¼Œä¹Ÿä¸ç­”è¨€ã€‚ä¸€æ—¶ï¼Œå®é’—è¢­äººä¹Ÿéƒ½èµ·æ¥ã€‚å¼€äº†é—¨ï¼Œè§å®ç‰å°šç¡ï¼Œå´ä¹Ÿçº³é—·ï¼šâ€œæ€ä¹ˆåœ¨å¤–å¤´ä¸¤å¤œç¡çš„å€’[ç‰‡æ®µ4] ç¬‘å˜»å˜»çš„é—®é“ï¼šâ€œä½ å’Œæ™´é›¯å§å§å¥½ä¸æ˜¯å•Šï¼Ÿâ€äº”å„¿å¬äº†ï¼Œæ‘¸ä¸ç€å¤´è„‘ï¼Œä¾¿é“ï¼šâ€œéƒ½æ˜¯å§Šå¦¹ï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆä¸å¥½çš„ã€‚â€å®ç‰åˆæ‚„æ‚„çš„é—®é“ï¼šâ€œæ™´é›¯ç—…é‡äº†ï¼Œæˆ‘çœ‹ä»–å»ï¼Œä¸æ˜¯ä½ ä¹Ÿå»äº†ä¹ˆï¼Ÿâ€äº”å„¿å¾®å¾®ç¬‘ç€ç‚¹å¤´å„¿ã€‚å®ç‰é“ï¼šâ€œä½ å¬è§ä»–è¯´ä»€ä¹ˆäº†æ²¡æœ‰ï¼Ÿâ€äº”å„¿æ‘‡ç€å¤´å„¿é“ï¼šâ€œæ²¡æœ‰ã€‚â€å®ç‰å·²ç»å¿˜ç¥ï¼Œä¾¿æŠŠäº”å„¿çš„æ‰‹ä¸€æ‹‰ã€‚äº”å„¿æ€¥çš„çº¢äº†è„¸ï¼Œå¿ƒé‡Œä¹±è·³ï¼Œä¾¿æ‚„æ‚„è¯´é“ï¼šâ€œäºŒçˆ·ï¼Œæœ‰ä»€ä¹ˆè¯åªç®¡è¯´ï¼Œåˆ«æ‹‰æ‹‰æ‰¯æ‰¯çš„ã€‚â€å®ç‰æ‰æ’’äº†æ‰‹ï¼Œè¯´é“ï¼šâ€œä»–å’Œæˆ‘è¯´æ¥ç€ï¼šâ€œæ—©çŸ¥æ‹…äº†ä¸ªè™šåï¼Œä¹Ÿå°±æ‰“æ­£ç»ä¸»æ„äº†ï¼â€ä½ æ€ä¹ˆæ²¡å¬è§ä¹ˆï¼Ÿâ€äº”å„¿å¬äº†è¿™è¯æ˜æ˜æ˜¯æ’©æ‹¨è‡ªå·±çš„æ„æ€ï¼Œåˆä¸æ•¢æ€ä¹ˆæ ·ï¼Œä¾¿è¯´é“ï¼šâ€œé‚£æ˜¯ä»–è‡ªå·±æ²¡è„¸ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¥³å­©å„¿å®¶è¯´å¾—çš„å—ï¼Ÿâ€å®ç‰ç€æ€¥é“ï¼šâ€œä½ æ€ä¹ˆä¹Ÿæ˜¯è¿™ä¹ˆä¸ªé“å­¦å…ˆç”Ÿï¼æˆ‘çœ‹ä½ é•¿çš„[ç‰‡æ®µ5] äº”ç¥–å®å¿åœ¨é»„æ¢…ï¼Œä»–ä¾¿å……ä½œç«å¤´åƒ§ã€‚äº”ç¥–æ¬²æ±‚æ³•å—£ï¼Œä»¤è¯¸åƒ§å„å‡ºä¸€åˆã€‚åº§ç¥ç§€è¯´é“ï¼šâ€œèº«æ˜¯è©ææ ‘ï¼Œå¿ƒå¦‚æ˜é•œå°ã€‚æ—¶æ—¶å‹¤æ‹‚æ‹­ï¼Œè«ä½¿æœ‰å°˜åŸƒã€‚â€æƒ èƒ½åœ¨å¨æˆ¿èˆ‚ç±³ï¼Œå¬äº†ï¼Œé“ï¼šâ€œç¾åˆ™ç¾çŸ£ï¼Œäº†åˆ™æœªäº†ï¼Œâ€å› è‡ªå¿µä¸€åˆæ›°ï¼šâ€œè©ææœ¬éæ ‘ï¼Œæ˜é•œäº¦éå°ã€‚æœ¬æ¥æ— ä¸€ç‰©ï¼Œä½•å¤„æŸ“å°˜åŸƒï¼Ÿâ€äº”ç¥–ä¾¿å°†è¡£é’µä¼ ç»™äº†ä»–ã€‚ä»Šå„¿è¿™åˆè¯­ï¼Œäº¦åŒæ­¤æ„äº†ã€‚åªæ˜¯æ–¹æ‰è¿™å¥æœºé”‹ï¼Œå°šæœªå®Œå…¨äº†ç»“ï¼Œè¿™ä¾¿ä¸¢å¼€æ‰‹ä¸æˆï¼Ÿâ€é»›ç‰ç¬‘é“ï¼šâ€œä»–ä¸èƒ½ç­”ï¼Œå°±ç®—è¾“äº†ã€‚è¿™ä¼šå­ç­”ä¸Šäº†ï¼Œä¹Ÿä¸ä¸ºå‡ºå¥‡äº†ã€‚åªæ˜¯ä»¥åå†ä¸è®¸è°ˆç¦…äº†ã€‚è¿æˆ‘ä»¬ä¸¤ä¸ªæ‰€çŸ¥æ‰€èƒ½çš„ï¼Œä½ è¿˜ä¸çŸ¥ä¸èƒ½å‘¢ï¼Œè¿˜å»å‚ä»€ä¹ˆç¦…å‘¢ï¼â€å®ç‰è‡ªå·±ä»¥ä¸ºè§‰æ‚Ÿï¼Œä¸æƒ³å¿½è¢«é»›ç‰ä¸€é—®ï¼Œä¾¿ä¸èƒ½ç­”ï¼›å®é’—åˆæ¯”å‡ºè¯­å½•æ¥ï¼šæ­¤çš†ç´ ä¸è§ä»–ä»¬æ‰€èƒ½çš„ã€‚è‡ªå·±æƒ³äº†ä¸€æƒ³ï¼šâ€œåŸæ¥ä»–ä»¬æ¯”æˆ‘çš„çŸ¥è§‰åœ¨## é—®é¢˜ã€Šäº”ç¾åŸã€‹çš„å†…å®¹æ˜¯ä»€ä¹ˆï¼Ÿ## å›ç­”                ================================================================================LLM å›ç­”:================================================================================æ ¹æ®æä¾›çš„æ–‡æœ¬ç‰‡æ®µï¼Œå…³äºã€Šäº”ç¾åŸã€‹çš„å†…å®¹ï¼Œä»…åœ¨[ç‰‡æ®µ1]ä¸­æœ‰æ‰€æåŠã€‚è¯¥ç‰‡æ®µæ˜¾ç¤ºï¼š1. **ã€Šäº”ç¾åŸã€‹çš„ç”±æ¥**ï¼šå®ç‰çœ‹äº†é»›ç‰çš„è¯—åï¼Œèµä¸ç»å£ï¼Œå¹¶å»ºè®®å°†äº”é¦–è¯—å‘½åä¸ºã€Šäº”ç¾åŸã€‹ï¼ˆç‰‡æ®µ1ä¸­ï¼šâ€œæ°å¥½åªåšäº†äº”é¦–ï¼Œä½•ä¸å°±å‘½æ›°ã€Šäº”ç¾åŸã€‹ï¼Ÿâ€ï¼‰ã€‚2. **éƒ¨åˆ†è¯—å¥å†…å®¹**ï¼šç‰‡æ®µ1ä¸­ç›´æ¥å¼•ç”¨äº†ã€Šäº”ç¾åŸã€‹ä¸­çš„ä¸¤é¦–è¯—ï¼š   - **çº¢æ‹‚**ï¼šè¯—å¥ä¸ºâ€œé•¿å‰‘é›„è°ˆæ€è‡ªæ®Šï¼Œç¾äººå·¨çœ¼è¯†ç©·é€”ã€‚å°¸å±…ä½™æ°”æ¨å…¬å¹•ï¼Œå²‚å¾—ç¾ç¸»å¥³ä¸ˆå¤«ï¼Ÿâ€   - **å¦ä¸€é¦–ï¼ˆæœªæ˜ç¡®äººåï¼‰**ï¼šå‰ä¸¤å¥ä¸ºâ€œå¨‡å¨†ï¼Ÿéƒ½ç¼˜é¡½ç¦å‰ç”Ÿé€ ï¼Œæ›´æœ‰åŒå½’æ…°å¯‚å¯¥ã€‚â€ï¼ˆä»ä¸Šä¸‹æ–‡æ¨æ–­ï¼Œè¿™åº”å±äºäº”é¦–ä¹‹ä¸€ï¼Œä½†å…·ä½“äººç‰©æœªè¯´æ˜ï¼‰ã€‚3. **å…¶ä»–ä¿¡æ¯**ï¼šå®é’—åœ¨ç‰‡æ®µ1ä¸­è¯„è®ºé»›ç‰çš„è¯—â€œå‘½æ„æ–°å¥‡ï¼Œåˆ«å¼€ç”Ÿé¢â€ï¼Œå¹¶æåŠå‰äººå’æ˜­å›çš„è¯—ä½œï¼Œä½†æœªæ¶‰åŠã€Šäº”ç¾åŸã€‹å…¶ä»–ä¸‰é¦–è¯—çš„å…·ä½“å†…å®¹ã€‚**ç»“è®º**ï¼šåŸºäºæä¾›çš„ç‰‡æ®µï¼Œã€Šäº”ç¾åŸã€‹çš„å†…å®¹ä»…çŸ¥åŒ…æ‹¬å’çº¢æ‹‚å’Œå¦ä¸€æœªæŒ‡åå¥³æ€§çš„è¯—ï¼Œå…¶ä½™ä¸‰é¦–çš„å…·ä½“è¯—å¥å’Œäººç‰©å‡æœªå‡ºç°ã€‚ç‰‡æ®µä¸­æ— ã€Šäº”ç¾åŸã€‹å®Œæ•´å†…å®¹çš„æè¿°ã€‚</code></pre><h3 id="è¯„ä¼°æŒ‡æ ‡"><a href="#è¯„ä¼°æŒ‡æ ‡" class="headerlink" title="è¯„ä¼°æŒ‡æ ‡"></a>è¯„ä¼°æŒ‡æ ‡</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># TODO</span><br></code></pre></td></tr></table></figure><h2 id="æ‰©å±•é˜…è¯»"><a href="#æ‰©å±•é˜…è¯»" class="headerlink" title="æ‰©å±•é˜…è¯»"></a>æ‰©å±•é˜…è¯»</h2><h3 id="å¿…è¯»èµ„æº"><a href="#å¿…è¯»èµ„æº" class="headerlink" title="å¿…è¯»èµ„æº"></a>å¿…è¯»èµ„æº</h3><ol><li><p><strong>Faiss å®˜æ–¹æŒ‡å—</strong></p><ul><li><a href="https://github.com/facebookresearch/faiss/wiki/Getting-started">Faiss Wiki - Getting Started</a></li><li>ç†è§£ä¸åŒç´¢å¼•ç±»å‹çš„é€‚ç”¨åœºæ™¯</li></ul></li><li><p><strong>Sentence-Transformers æ–‡æ¡£</strong></p><ul><li><a href="https://www.sbert.net/">å®˜æ–¹æ–‡æ¡£</a></li><li>å­¦ä¹ å¦‚ä½•é€‰æ‹©åˆé€‚çš„é¢„è®­ç»ƒæ¨¡å‹</li></ul></li><li><p><strong>RAG åŸå§‹è®ºæ–‡</strong></p><ul><li><a href="https://arxiv.org/abs/2005.11401">Retrieval-Augmented Generation for Knowledge-Intensive NLP Tasks</a></li><li>ç†è§£RAGçš„è®¾è®¡æ€æƒ³</li></ul></li></ol><h3 id="è¿›é˜¶èµ„æº"><a href="#è¿›é˜¶èµ„æº" class="headerlink" title="è¿›é˜¶èµ„æº"></a>è¿›é˜¶èµ„æº</h3><ol><li><p><strong>Dense Passage Retrieval (DPR)</strong></p><ul><li><a href="https://arxiv.org/abs/2004.04906">DPR Paper</a></li><li>å­¦ä¹ æ›´å¥½çš„å¯†é›†æ£€ç´¢æ–¹æ³•</li></ul></li><li><p><strong>HyDE: Hypothetical Document Embeddings</strong></p><ul><li><a href="https://arxiv.org/abs/2212.10496">HyDE Paper</a></li><li>äº†è§£æŸ¥è¯¢æ”¹å†™æŠ€æœ¯</li></ul></li><li><p><strong>å‘é‡æ•°æ®åº“å¯¹æ¯”</strong></p><ul><li><a href="https://www.pinecone.io/learn/vector-database/">Pinecone: Vector Database Guide</a></li><li>äº†è§£ä¸åŒå‘é‡æ•°æ®åº“çš„ç‰¹ç‚¹</li></ul></li></ol>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Agent </tag>
            
            <tag> RAG </tag>
            
            <tag> æ–‡æœ¬åˆ‡åˆ† </tag>
            
            <tag> å‘é‡åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é’‰é’‰çŸ¥è¯†åº“æ–‡ä»¶åŒæ­¥ä¸é’‰é’‰AIè¡¨æ ¼é™„ä»¶æ–‡ä»¶è§£æ</title>
      <link href="/2025/11/28/DD&amp;Document_Analysis/project_analysis_blog/"/>
      <url>/2025/11/28/DD&amp;Document_Analysis/project_analysis_blog/</url>
      
        <content type="html"><![CDATA[<h1 id="çŸ¥è¯†åº“ç®¡ç†æ™ºèƒ½åŒ–ï¼šä»é’‰é’‰çŸ¥è¯†åº“åŒæ­¥åˆ°é’‰é’‰AIè¡¨æ ¼å†…å®¹æå–"><a href="#çŸ¥è¯†åº“ç®¡ç†æ™ºèƒ½åŒ–ï¼šä»é’‰é’‰çŸ¥è¯†åº“åŒæ­¥åˆ°é’‰é’‰AIè¡¨æ ¼å†…å®¹æå–" class="headerlink" title="çŸ¥è¯†åº“ç®¡ç†æ™ºèƒ½åŒ–ï¼šä»é’‰é’‰çŸ¥è¯†åº“åŒæ­¥åˆ°é’‰é’‰AIè¡¨æ ¼å†…å®¹æå–"></a>çŸ¥è¯†åº“ç®¡ç†æ™ºèƒ½åŒ–ï¼šä»é’‰é’‰çŸ¥è¯†åº“åŒæ­¥åˆ°é’‰é’‰AIè¡¨æ ¼å†…å®¹æå–</h1><p>åœ¨ä¼ä¸šæ•°å­—åŒ–è½¬å‹çš„æµªæ½®ä¸­ï¼ŒçŸ¥è¯†åº“ç®¡ç†å·²æˆä¸ºç»„ç»‡ç«äº‰åŠ›çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚å¦‚ä½•é«˜æ•ˆåŒæ­¥å¤šæºçŸ¥è¯†åº“ï¼Ÿå¦‚ä½•æ™ºèƒ½åŒ–å¤„ç†æ–‡æ¡£å†…å®¹ï¼Ÿè¿™ä¸¤ä¸ªçœ‹ä¼¼ç‹¬ç«‹çš„é—®é¢˜ï¼Œåœ¨å®é™…çš„ä¼ä¸šAIåŠ©æ‰‹æ­å»ºè¿‡ç¨‹ä¸­å¾€å¾€ä¼šäº¤ç»‡åœ¨ä¸€èµ·ã€‚</p><blockquote><p>é¡¹ç›®é“¾æ¥:<br><a href="https://github.com/wjiajian/DingDingZhiKuTong">https://github.com/wjiajian/DingDingZhiKuTong</a><br><a href="https://github.com/wjiajian/LinkContentAI">https://github.com/wjiajian/LinkContentAI</a></p></blockquote><h2 id="èƒŒæ™¯ï¼šçŸ¥è¯†åŒæ­¥çš„è¿«åˆ‡éœ€æ±‚"><a href="#èƒŒæ™¯ï¼šçŸ¥è¯†åŒæ­¥çš„è¿«åˆ‡éœ€æ±‚" class="headerlink" title="èƒŒæ™¯ï¼šçŸ¥è¯†åŒæ­¥çš„è¿«åˆ‡éœ€æ±‚"></a>èƒŒæ™¯ï¼šçŸ¥è¯†åŒæ­¥çš„è¿«åˆ‡éœ€æ±‚</h2><h3 id="ä¼ä¸šçŸ¥è¯†å­¤å²›å›°å¢ƒ"><a href="#ä¼ä¸šçŸ¥è¯†å­¤å²›å›°å¢ƒ" class="headerlink" title="ä¼ä¸šçŸ¥è¯†å­¤å²›å›°å¢ƒ"></a>ä¼ä¸šçŸ¥è¯†å­¤å²›å›°å¢ƒ</h3><p>å½“ä¼ä¸šå¼€å§‹æ­å»ºAIåŠ©æ‰‹æ—¶ï¼Œå¾€å¾€ä¼šé¢ä¸´ä¸€ä¸ªç°å®é—®é¢˜ï¼š<strong>çŸ¥è¯†åˆ†æ•£åœ¨å„ä¸ªå¹³å°</strong>ã€‚é’‰é’‰ä½œä¸ºä¼ä¸šå†…éƒ¨åä½œå¹³å°ï¼Œå…¶çŸ¥è¯†åº“æ‰¿è½½äº†å¤§é‡æœ‰ä»·å€¼çš„æ–‡æ¡£å’Œèµ„æ–™ï¼Œä½†è¿™äº›å†…å®¹å¾€å¾€éœ€è¦ä¸æœ¬åœ°å­˜å‚¨ï¼ˆå¦‚NASï¼‰è¿›è¡ŒåŒæ­¥ï¼Œä»¥ä¾¿è¿›è¡Œæ›´çµæ´»çš„çŸ¥è¯†ç®¡ç†å’ŒAIè®­ç»ƒã€‚</p><p>ä¼ ç»Ÿçš„çŸ¥è¯†åŒæ­¥æ–¹å¼å­˜åœ¨æ˜æ˜¾å¼Šç«¯ï¼š</p><ul><li><strong>å…¨é‡ä¸‹è½½æµªè´¹èµ„æº</strong>ï¼šæ¯æ¬¡åŒæ­¥éƒ½éœ€è¦ä¸‹è½½å…¨éƒ¨æ–‡ä»¶ï¼Œæ•ˆç‡ä½ä¸‹</li><li><strong>æ ¼å¼ä¸å…¼å®¹</strong>ï¼šé’‰é’‰ä¸“æœ‰æ ¼å¼ä¸æ ‡å‡†Officeæ ¼å¼å­˜åœ¨å·®å¼‚</li><li><strong>åŒæ­¥ç²¾åº¦ä¸è¶³</strong>ï¼šéš¾ä»¥å‡†ç¡®è¯†åˆ«å“ªäº›æ–‡ä»¶æ˜¯æ–°å¢æˆ–ä¿®æ”¹è¿‡çš„</li></ul><h3 id="æ–‡æ¡£å¤„ç†è‡ªåŠ¨åŒ–çš„æ–°æŒ‘æˆ˜"><a href="#æ–‡æ¡£å¤„ç†è‡ªåŠ¨åŒ–çš„æ–°æŒ‘æˆ˜" class="headerlink" title="æ–‡æ¡£å¤„ç†è‡ªåŠ¨åŒ–çš„æ–°æŒ‘æˆ˜"></a>æ–‡æ¡£å¤„ç†è‡ªåŠ¨åŒ–çš„æ–°æŒ‘æˆ˜</h3><p>å¦ä¸€æ–¹é¢ï¼Œåœ¨çŸ¥è¯†æ•´ç†è¿‡ç¨‹ä¸­ï¼Œå¦ä¸€ä¸ªé—®é¢˜é€æ¸æµ®å‡ºæ°´é¢ï¼šExcelè¡¨æ ¼ä¸­ç»å¸¸åŒ…å«å¤§é‡å¤–éƒ¨é“¾æ¥ï¼Œé™„ä»¶æ–‡æ¡£ï¼Œé“¾æ¥åˆ°å„ç§æ ¼å¼çš„æ–‡æ¡£ï¼ˆPDFã€Wordã€PPTç­‰ï¼‰ï¼Œç‰¹åˆ«æ˜¯ç°åœ¨è¶Šæ¥è¶Šå¤šçš„ä¼ä¸šéƒ¨é—¨ä½¿ç”¨ç±»ä¼¼<strong>é£ä¹¦å¤šç»´è¡¨æ ¼</strong>ï¼Œ<strong>é’‰é’‰AIè¡¨æ ¼</strong>è¿™æ ·æ–‡æ¡£åµŒå¥—æ–‡æ¡£çš„åœ¨çº¿è¡¨æ ¼ã€‚äººå·¥é€ä¸€æå–è¿™äº›é“¾æ¥æˆ–é™„ä»¶å†…å®¹ä¸ä»…æ•ˆç‡ä½ä¸‹ï¼Œè¿˜å®¹æ˜“å‡ºé”™ã€‚</p><h2 id="æŠ€æœ¯æ¶æ„ï¼šæ¨¡å—åŒ–ä¸åˆ†ç¦»å¼è®¾è®¡çš„æ™ºæ…§"><a href="#æŠ€æœ¯æ¶æ„ï¼šæ¨¡å—åŒ–ä¸åˆ†ç¦»å¼è®¾è®¡çš„æ™ºæ…§" class="headerlink" title="æŠ€æœ¯æ¶æ„ï¼šæ¨¡å—åŒ–ä¸åˆ†ç¦»å¼è®¾è®¡çš„æ™ºæ…§"></a>æŠ€æœ¯æ¶æ„ï¼šæ¨¡å—åŒ–ä¸åˆ†ç¦»å¼è®¾è®¡çš„æ™ºæ…§</h2><h3 id="åˆ†ç¦»å¼åŒæ­¥æ¶æ„"><a href="#åˆ†ç¦»å¼åŒæ­¥æ¶æ„" class="headerlink" title="åˆ†ç¦»å¼åŒæ­¥æ¶æ„"></a>åˆ†ç¦»å¼åŒæ­¥æ¶æ„</h3><p><strong>ä¸‰æ­¥èµ°ç­–ç•¥</strong>ï¼š</p><ol><li><strong>æ™ºèƒ½åˆ†æé˜¶æ®µ</strong>ï¼šé€šè¿‡é’‰é’‰APIè·å–å®Œæ•´çš„çŸ¥è¯†åº“ç›®å½•ç»“æ„ï¼Œä¸æœ¬åœ°æ–‡ä»¶å¤¹è¿›è¡Œç²¾ç¡®æ¯”è¾ƒï¼Œè¯†åˆ«å‡ºçœŸæ­£éœ€è¦æ›´æ–°çš„æ–‡ä»¶<blockquote><p>é’‰é’‰çš„APIæ˜¯çœŸéš¾ç”¨çœŸå¤æ‚<br>ä¸¤è¾¹çš„æ–‡ä»¶å·®å¼‚æ˜¯é€šè¿‡æ„å»ºæ–‡ä»¶æ ‘(å®é™…ä¸Šæ˜¯å­—å…¸ç»„ï¼Œé”®ä¸ºæ–‡ä»¶è·¯å¾„ï¼Œå€¼ä¸ºä¿®æ”¹æ—¥æœŸå’Œæ–‡æ¡£ URL)è¿›è¡Œå¯¹æ¯”</p></blockquote></li><li><strong>çµæ´»ä¸‹è½½é˜¶æ®µ</strong>ï¼šç”Ÿæˆå¢é‡ä¸‹è½½æ¸…å•ï¼Œä½†å°†å…·ä½“çš„ä¸‹è½½æ‰§è¡Œç•™ç»™ç”¨æˆ·é€‰æ‹©åˆé€‚çš„å·¥å…·ï¼ˆRPAã€wgetã€aria2ç­‰ï¼‰<blockquote><p>é’‰é’‰çš„AIè¡¨æ ¼å’ŒçŸ¥è¯†åº“æ— æ³•ç›´æ¥ä¸‹è½½ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™è¾¹æ˜¯ä½¿ç”¨çš„ RPA è‡ªåŠ¨åŒ–æµè§ˆå™¨è¿›è¡Œæ“ä½œ</p></blockquote></li><li><strong>ç²¾ç¡®åŒæ­¥é˜¶æ®µ</strong>ï¼šæ‰§è¡Œæœ€ç»ˆçš„æ–‡ä»¶åŒæ­¥ï¼Œç¡®ä¿æœ¬åœ°å†…å®¹ä¸äº‘ç«¯çŸ¥è¯†åº“å®Œå…¨ä¸€è‡´</li></ol><p>è¿™æ ·åšçš„å¥½å¤„åœ¨äºï¼š</p><ul><li><strong>è§£è€¦å¤æ‚æ€§</strong>ï¼šå°†ç½‘ç»œä¸‹è½½çš„ä¸ç¡®å®šæ€§ä¸åŒæ­¥é€»è¾‘åˆ†ç¦»ï¼Œé™ä½ç³»ç»Ÿå¤æ‚åº¦</li><li><strong>ç”¨æˆ·è‡ªä¸»æ€§</strong>ï¼šå…è®¸ç”¨æˆ·çš„éœ€æ±‚é€‰æ‹©æœ€é€‚åˆçš„ä¸‹è½½å·¥å…·å’Œç­–ç•¥</li><li><strong>ç²¾ç¡®å¯æ§</strong>ï¼šåŒæ­¥è¿‡ç¨‹å¯ä»¥æ”¯æŒæ¼”ç»ƒæ¨¡å¼ï¼Œç¡®ä¿æ“ä½œå®‰å…¨æ€§</li></ul><h3 id="æ¨¡å—åŒ–å¤„ç†å™¨è®¾è®¡ï¼šLinkContentAIçš„æ‰©å±•æ™ºæ…§"><a href="#æ¨¡å—åŒ–å¤„ç†å™¨è®¾è®¡ï¼šLinkContentAIçš„æ‰©å±•æ™ºæ…§" class="headerlink" title="æ¨¡å—åŒ–å¤„ç†å™¨è®¾è®¡ï¼šLinkContentAIçš„æ‰©å±•æ™ºæ…§"></a>æ¨¡å—åŒ–å¤„ç†å™¨è®¾è®¡ï¼šLinkContentAIçš„æ‰©å±•æ™ºæ…§</h3><p><strong>LinkContentAI</strong> åˆ™é‡‡ç”¨äº†<strong>æ¨¡å—åŒ–å¤„ç†å™¨æ¶æ„</strong>ï¼š</p><p><strong>æ ¸å¿ƒæ¨¡å—åˆ’åˆ†</strong>ï¼š</p><ul><li><strong>æ–‡æ¡£è¯»å–å™¨å±‚</strong>ï¼šæ¯ç§æ–‡æ¡£æ ¼å¼éƒ½æœ‰ä¸“é—¨çš„è¯»å–æ¨¡å—ï¼ŒåŸºäºè¯»å–å™¨æ¨¡å¼è®¾è®¡<blockquote><p>ä¸­é—´å°è¯•è¿‡ä½¿ç”¨ unstructured åº“ç»Ÿä¸€å¤„ç†æ–‡æ¡£ï¼Œä½†æ˜¯å„ç§æ–‡æ¡£ä¹‹é—´å…¼å®¹æ€§å¤ªå·®ï¼Œè¿˜æ˜¯é€‰æ‹©åˆ†æ¨¡å—å¤„ç†æ–‡æ¡£</p></blockquote></li><li><strong>è½¬æ¢å¼•æ“å±‚</strong>ï¼šå°†ä¸åŒæ ¼å¼æ–‡æ¡£è½¬æ¢ä¸ºç»Ÿä¸€çš„Markdownè¡¨ç¤º<blockquote><p>Markdown å½¢å¼å¯¹åŒäº‹æ„å»ºå…¬å¸ AI åŠ©ç†æœ‰ç›Šï¼Œå¤§æ¨¡å‹å¯¹ Markdownï¼Œjsonï¼Œxmlç­‰æ ¼å¼é€‚åº”æ€§æ¯”è¾ƒå¥½ï¼Œæƒè¡¡ä¹‹ä¸‹é€‰æ‹© Markdown</p></blockquote></li><li><strong>AIå¢å¼ºå±‚</strong>ï¼šè°ƒç”¨å¤šæ¨¡æ€å¤§æ¨¡å‹å¯¹æ–‡æ¡£ä¸­çš„å›¾ç‰‡è¿›è¡Œæ·±åº¦åˆ†æ<blockquote><p>éœ€è¦å¯¹å›¾ç‰‡åˆ†æåˆ°ä»€ä¹ˆåœ°æ­¥è¿˜ä¸ç¡®å®šï¼Œæš‚æ—¶é€‰æ‹©å¯¹å›¾ç‰‡è¿›è¡Œè¯¦ç»†çš„æè¿°</p></blockquote></li><li><strong>å›å¡«è¾“å‡ºå±‚</strong>ï¼šå°†å¤„ç†åçš„å†…å®¹å†™å›åˆ°Excelå•å…ƒæ ¼ä¸­</li></ul><p>è¿™ç§æ¶æ„çš„ä¼˜åŠ¿åœ¨äºï¼š</p><ul><li><strong>æ ¼å¼æ— å…³æ€§</strong>ï¼šæ–°å¢æ”¯æŒä¸€ç§æ–‡æ¡£æ ¼å¼ï¼Œåªéœ€æ·»åŠ å¯¹åº”çš„è¯»å–å™¨å’Œè½¬æ¢å™¨</li><li><strong>æ¨¡å‹æ— å…³æ€§</strong>ï¼šAIåˆ†ææ¨¡å—å¯ä»¥è½»æ¾é€‚é…ä¸åŒçš„å¤šæ¨¡æ€æ¨¡å‹</li><li><strong>æµç¨‹æ ‡å‡†åŒ–</strong>ï¼šç»Ÿä¸€çš„è½¬æ¢æ ¼å¼è®©æ•´ä¸ªå¤„ç†æµç¨‹å˜å¾—å¯é¢„æµ‹å’Œå¯æ§</li></ul><h2 id="æŠ€æœ¯åˆ›æ–°ï¼šå¤šæ¨¡æ€AIä¸æ™ºèƒ½æ˜ å°„"><a href="#æŠ€æœ¯åˆ›æ–°ï¼šå¤šæ¨¡æ€AIä¸æ™ºèƒ½æ˜ å°„" class="headerlink" title="æŠ€æœ¯åˆ›æ–°ï¼šå¤šæ¨¡æ€AIä¸æ™ºèƒ½æ˜ å°„"></a>æŠ€æœ¯åˆ›æ–°ï¼šå¤šæ¨¡æ€AIä¸æ™ºèƒ½æ˜ å°„</h2><h3 id="å¤šæ¨¡æ€å†…å®¹ç†è§£ï¼šè¶…è¶Šçº¯æ–‡æœ¬çš„ä»·å€¼"><a href="#å¤šæ¨¡æ€å†…å®¹ç†è§£ï¼šè¶…è¶Šçº¯æ–‡æœ¬çš„ä»·å€¼" class="headerlink" title="å¤šæ¨¡æ€å†…å®¹ç†è§£ï¼šè¶…è¶Šçº¯æ–‡æœ¬çš„ä»·å€¼"></a>å¤šæ¨¡æ€å†…å®¹ç†è§£ï¼šè¶…è¶Šçº¯æ–‡æœ¬çš„ä»·å€¼</h3><p><strong>LinkContentAI</strong> é¡¹ç›®çš„ä¸€ä¸ªæ˜¾è‘—åˆ›æ–°ç‚¹åœ¨äºå…¶<strong>å¤šæ¨¡æ€AIå¤„ç†èƒ½åŠ›</strong>ã€‚å®ƒä¸ä»…æå–æ–‡æ¡£çš„æ–‡æœ¬å†…å®¹ï¼Œæ›´é‡è¦çš„æ˜¯ï¼š</p><ol><li><strong>å›¾ç‰‡æ™ºèƒ½åˆ†æ</strong>ï¼šä½¿ç”¨å¤šæ¨¡æ€å¤§æ¨¡å‹å¯¹æ–‡æ¡£ä¸­çš„æ¯å¼ å›¾ç‰‡è¿›è¡Œæ·±åº¦åˆ†æ</li><li><strong>å›¾ç‰‡æè¿°ç”Ÿæˆ</strong>ï¼šå°†å›¾ç‰‡å†…å®¹è½¬æ¢ä¸ºè¯¦ç»†çš„æ–‡æœ¬æè¿°</li><li><strong>å ä½ç¬¦æ›¿æ¢</strong>ï¼šåœ¨Markdownä¸­ç”¨å›¾ç‰‡æè¿°æ›¿æ¢åŸæœ‰å ä½ç¬¦ï¼Œå®ç°å†…å®¹çš„å®Œæ•´è¯­ä¹‰åŒ–</li></ol><p>è¿™ç§è®¾è®¡è§£å†³äº†ä¼ ç»Ÿæ–‡æ¡£å¤„ç†ä¸­çš„ä¸€ä¸ªç›²ç‚¹ï¼šå›¾ç‰‡å¾€å¾€åŒ…å«å…³é”®ä¿¡æ¯ï¼Œä½†ä¼ ç»Ÿçš„æ–‡æœ¬æå–å·¥å…·ä¼šå¿½ç•¥è¿™äº›è§†è§‰å†…å®¹ã€‚é€šè¿‡AIæè¿°ï¼Œå›¾ç‰‡çš„è¯­ä¹‰ä¿¡æ¯å¾—ä»¥ä¿ç•™å’Œä¼ æ’­ã€‚</p><h3 id="æ ¼å¼æ™ºèƒ½æ˜ å°„ï¼šæ— ç¼å…¼å®¹çš„è®¾è®¡ç»†èŠ‚"><a href="#æ ¼å¼æ™ºèƒ½æ˜ å°„ï¼šæ— ç¼å…¼å®¹çš„è®¾è®¡ç»†èŠ‚" class="headerlink" title="æ ¼å¼æ™ºèƒ½æ˜ å°„ï¼šæ— ç¼å…¼å®¹çš„è®¾è®¡ç»†èŠ‚"></a>æ ¼å¼æ™ºèƒ½æ˜ å°„ï¼šæ— ç¼å…¼å®¹çš„è®¾è®¡ç»†èŠ‚</h3><p><strong>DingDingZhiKuTong</strong> é¡¹ç›®åœ¨å¤„ç†æ ¼å¼å…¼å®¹æ€§æ–¹é¢å±•ç°äº†ç»†è‡´çš„å·¥ç¨‹æ€ç»´ï¼š</p><ul><li><strong>é’‰é’‰ä¸“æœ‰æ ¼å¼è¯†åˆ«</strong>ï¼šè‡ªåŠ¨è¯†åˆ«é’‰é’‰ç‰¹æœ‰çš„<code>.adoc</code>ã€<code>.axls</code>åç¼€<blockquote><p>å…¶å®å°±æ˜¯é’‰é’‰çš„åœ¨çº¿è¡¨æ ¼è°ƒç”¨ API è·å–ä¿¡æ¯çš„æ—¶å€™æ˜¯è¿™æ ·çš„åç¼€</p></blockquote></li><li><strong>æ ‡å‡†æ ¼å¼æ˜ å°„</strong>ï¼šå°†è¿™äº›ä¸“æœ‰æ ¼å¼æ™ºèƒ½è½¬æ¢ä¸ºå¯¹åº”çš„æ ‡å‡†Officeæ ¼å¼ï¼ˆ<code>.docx</code>ã€<code>.xlsx</code>ï¼‰<blockquote><p>æ‹…å¿ƒä¼šå­˜åœ¨åŒåä½†æ ¼å¼ä¸åŒçš„æ–‡ä»¶ï¼Œè¿˜æ˜¯é€‰æ‹©æŠŠåç¼€ä¹Ÿè¿›è¡Œæ¯”è¾ƒ</p></blockquote></li><li><strong>ç”¨æˆ·é€æ˜åŒ–</strong>ï¼šæ•´ä¸ªè½¬æ¢è¿‡ç¨‹å¯¹ç”¨æˆ·å®Œå…¨é€æ˜ï¼Œæ— éœ€æ‰‹åŠ¨å¹²é¢„</li></ul><h2 id="å®æˆ˜ç»éªŒï¼šé—®é¢˜é©±åŠ¨çš„æŒç»­ä¼˜åŒ–"><a href="#å®æˆ˜ç»éªŒï¼šé—®é¢˜é©±åŠ¨çš„æŒç»­ä¼˜åŒ–" class="headerlink" title="å®æˆ˜ç»éªŒï¼šé—®é¢˜é©±åŠ¨çš„æŒç»­ä¼˜åŒ–"></a>å®æˆ˜ç»éªŒï¼šé—®é¢˜é©±åŠ¨çš„æŒç»­ä¼˜åŒ–</h2><h3 id="æ•…éšœæ’é™¤ï¼šé¡¹ç›®æˆç†Ÿçš„æ ‡å¿—"><a href="#æ•…éšœæ’é™¤ï¼šé¡¹ç›®æˆç†Ÿçš„æ ‡å¿—" class="headerlink" title="æ•…éšœæ’é™¤ï¼šé¡¹ç›®æˆç†Ÿçš„æ ‡å¿—"></a>æ•…éšœæ’é™¤ï¼šé¡¹ç›®æˆç†Ÿçš„æ ‡å¿—</h3><p><strong>å…¸å‹é—®é¢˜è§£å†³æ¡ˆä¾‹</strong>ï¼š</p><ol><li><p><strong>PDFå­—ä½“è­¦å‘Šå¤„ç†</strong></p><ul><li>é—®é¢˜ï¼šPDFå¤„ç†è¿‡ç¨‹ä¸­çš„å­—ä½“è­¦å‘Šå¹²æ‰°ç”¨æˆ·ä½“éªŒ</li><li>è§£å†³ï¼šè‡ªåŠ¨æŠ‘åˆ¶è¿™äº›è­¦å‘Šï¼Œä¿æŒè¾“å‡ºæ•´æ´</li></ul></li><li><p><strong>å›¾ç‰‡è§£æå®Œæ•´æ€§</strong></p><ul><li>é—®é¢˜ï¼šæ‰¹é‡å¤„ç†å›¾ç‰‡æ—¶å¯èƒ½å‡ºç°é—æ¼</li><li>è§£å†³ï¼šæ”¹ä¸ºé€ä¸ªè°ƒç”¨LLMï¼Œç¡®ä¿æ¯å¼ å›¾ç‰‡éƒ½å¾—åˆ°100%å‡†ç¡®çš„åˆ†æ</li></ul></li><li><p><strong>å‘½åç©ºé—´é”™è¯¯</strong></p><ul><li>é—®é¢˜ï¼šä¸åŒæ–‡æ¡£æ ¼å¼çš„å‘½åç©ºé—´æ˜ å°„ä¸ä¸€è‡´</li><li>è§£å†³ï¼šå®Œå–„å‘½åç©ºé—´æ˜ å°„æœºåˆ¶ï¼Œæé«˜å…¼å®¹æ€§</li></ul></li><li><p><strong>APIé…ç½®æŒ‡å¯¼</strong></p><ul><li>é—®é¢˜ï¼šç”¨æˆ·é…ç½®APIå¯†é’¥æ—¶å®¹æ˜“å‡ºé”™</li><li>è§£å†³ï¼šæä¾›è¯¦ç»†çš„é…ç½®æŒ‡å¯¼å’Œé”™è¯¯æç¤º</li></ul></li></ol><h3 id="å¢é‡æ›´æ–°ï¼šæ•ˆç‡ä¸ç²¾ç¡®æ€§çš„å¹³è¡¡"><a href="#å¢é‡æ›´æ–°ï¼šæ•ˆç‡ä¸ç²¾ç¡®æ€§çš„å¹³è¡¡" class="headerlink" title="å¢é‡æ›´æ–°ï¼šæ•ˆç‡ä¸ç²¾ç¡®æ€§çš„å¹³è¡¡"></a>å¢é‡æ›´æ–°ï¼šæ•ˆç‡ä¸ç²¾ç¡®æ€§çš„å¹³è¡¡</h3><p><strong>DingDingZhiKuTong</strong> é¡¹ç›®çš„<strong>å¢é‡æ›´æ–°æœºåˆ¶</strong>è§£å†³äº†ä¼ä¸šçº§åº”ç”¨ä¸­çš„æ ¸å¿ƒæ€§èƒ½é—®é¢˜ï¼š</p><ul><li><strong>æ™ºèƒ½æ–‡ä»¶æ¯”è¾ƒ</strong>ï¼šä¸ä»…æ¯”è¾ƒæ–‡ä»¶åç§°ï¼Œè¿˜æ¯”è¾ƒæ–‡ä»¶å¤§å°ã€ä¿®æ”¹æ—¶é—´ç­‰å¤šç»´åº¦ä¿¡æ¯</li><li><strong>URLç²¾å‡†ç”Ÿæˆ</strong>ï¼šåªä¸ºçœŸæ­£éœ€è¦ä¸‹è½½çš„æ–‡ä»¶ç”ŸæˆURLï¼Œé¿å…èµ„æºæµªè´¹</li><li><strong>å…¨é‡ä¸€è‡´æ€§éªŒè¯</strong>ï¼šæœ€ç»ˆåŒæ­¥æ—¶è¿›è¡Œå…¨é‡éªŒè¯ï¼Œç¡®ä¿æ•°æ®å®Œæ•´æ€§</li></ul><p>è¿™ç§è®¾è®¡åœ¨ä¿è¯ç²¾ç¡®æ€§çš„åŒæ—¶ï¼Œæ˜¾è‘—æå‡äº†åŒæ­¥æ•ˆç‡ï¼Œç‰¹åˆ«é€‚åˆå¤§å‹çŸ¥è¯†åº“çš„æ—¥å¸¸ç»´æŠ¤åœºæ™¯ã€‚</p><h2 id="æœªæ¥å±•æœ›ï¼šçŸ¥è¯†ç®¡ç†çš„æŠ€æœ¯æ¼”è¿›æ–¹å‘"><a href="#æœªæ¥å±•æœ›ï¼šçŸ¥è¯†ç®¡ç†çš„æŠ€æœ¯æ¼”è¿›æ–¹å‘" class="headerlink" title="æœªæ¥å±•æœ›ï¼šçŸ¥è¯†ç®¡ç†çš„æŠ€æœ¯æ¼”è¿›æ–¹å‘"></a>æœªæ¥å±•æœ›ï¼šçŸ¥è¯†ç®¡ç†çš„æŠ€æœ¯æ¼”è¿›æ–¹å‘</h2><h3 id="æ™ºèƒ½åŒ–ç¨‹åº¦æŒç»­æå‡"><a href="#æ™ºèƒ½åŒ–ç¨‹åº¦æŒç»­æå‡" class="headerlink" title="æ™ºèƒ½åŒ–ç¨‹åº¦æŒç»­æå‡"></a>æ™ºèƒ½åŒ–ç¨‹åº¦æŒç»­æå‡</h3><p>éšç€AIæŠ€æœ¯çš„å¿«é€Ÿå‘å±•ï¼Œè¿™ä¸¤ä¸ªé¡¹ç›®éƒ½é¢ä¸´ç€å‘æ›´é«˜æ™ºèƒ½åŒ–æ°´å¹³æ¼”è¿›çš„æœºä¼šï¼š</p><p><strong>æŠ€æœ¯å‘å±•æ–¹å‘</strong>ï¼š</p><ul><li><strong>è¯­ä¹‰ç†è§£å¢å¼º</strong>ï¼šä¸ä»…æå–æ–‡æ¡£å†…å®¹ï¼Œæ›´ç†è§£æ–‡æ¡£çš„è¯­ä¹‰ç»“æ„å’ŒçŸ¥è¯†å›¾è°±</li><li><strong>æ™ºèƒ½åˆ†ç±»æ ‡ç­¾</strong>ï¼šè‡ªåŠ¨ä¸ºæ–‡æ¡£ç”Ÿæˆè¯­ä¹‰æ ‡ç­¾ï¼Œæå‡çŸ¥è¯†æ£€ç´¢æ•ˆç‡</li><li><strong>å…³è”æ€§å‘ç°</strong>ï¼šè¯†åˆ«ä¸åŒæ–‡æ¡£ä¹‹é—´çš„å…³è”å…³ç³»ï¼Œæ„å»ºçŸ¥è¯†ç½‘ç»œ</li></ul><h3 id="å¹³å°åŒ–ä¸ç”Ÿæ€åŒ–"><a href="#å¹³å°åŒ–ä¸ç”Ÿæ€åŒ–" class="headerlink" title="å¹³å°åŒ–ä¸ç”Ÿæ€åŒ–"></a>å¹³å°åŒ–ä¸ç”Ÿæ€åŒ–</h3><p><strong>æœªæ¥æ„¿æ™¯</strong>ï¼š</p><ul><li><strong>ç»Ÿä¸€çŸ¥è¯†ä¸­å°</strong>ï¼šå°†é’‰é’‰ã€é£ä¹¦ã€ä¼ä¸šå¾®ä¿¡ç­‰å¤šå¹³å°çŸ¥è¯†åº“ç»Ÿä¸€ç®¡ç†</li><li><strong>æ’ä»¶åŒ–æ¶æ„</strong>ï¼šå…è®¸ç¬¬ä¸‰æ–¹å¼€å‘è€…æ‰©å±•æ”¯æŒæ›´å¤šæ–‡æ¡£æ ¼å¼å’Œæ•°æ®æº</li><li><strong>äº‘åŸç”Ÿéƒ¨ç½²</strong>ï¼šæ”¯æŒå®¹å™¨åŒ–éƒ¨ç½²å’Œäº‘åŸç”Ÿæ¶æ„ï¼Œé€‚åº”ä¼ä¸šçº§éœ€æ±‚</li></ul><h3 id="ç”¨æˆ·ä½“éªŒçš„æè‡´ä¼˜åŒ–"><a href="#ç”¨æˆ·ä½“éªŒçš„æè‡´ä¼˜åŒ–" class="headerlink" title="ç”¨æˆ·ä½“éªŒçš„æè‡´ä¼˜åŒ–"></a>ç”¨æˆ·ä½“éªŒçš„æè‡´ä¼˜åŒ–</h3><p><strong>ä½“éªŒæå‡æ–¹å‘</strong>ï¼š</p><ul><li><strong>å¯è§†åŒ–ç•Œé¢</strong>ï¼šä»å‘½ä»¤è¡Œå·¥å…·å‘å›¾å½¢ç•Œé¢æ¼”è¿›ï¼Œé™ä½ä½¿ç”¨é—¨æ§›</li><li><strong>å®æ—¶åŒæ­¥</strong>ï¼šä»å®šæ—¶åŒæ­¥å‘å®æ—¶åŒæ­¥æ¼”è¿›ï¼Œä¿æŒæ•°æ®æ—¶æ•ˆæ€§<br>â€¦</li></ul><h2 id="æŠ€æœ¯å¯ç¤ºä¸æ€è€ƒ"><a href="#æŠ€æœ¯å¯ç¤ºä¸æ€è€ƒ" class="headerlink" title="æŠ€æœ¯å¯ç¤ºä¸æ€è€ƒ"></a>æŠ€æœ¯å¯ç¤ºä¸æ€è€ƒ</h2><h3 id="åˆ†ç¦»å¼æ¶æ„çš„ä»·å€¼"><a href="#åˆ†ç¦»å¼æ¶æ„çš„ä»·å€¼" class="headerlink" title="åˆ†ç¦»å¼æ¶æ„çš„ä»·å€¼"></a>åˆ†ç¦»å¼æ¶æ„çš„ä»·å€¼</h3><p><strong>DingDingZhiKuTong</strong> çš„åˆ†ç¦»å¼æ¶æ„è®¾è®¡ç»™æˆ‘ä¸€ä¸ªé‡è¦å¯ç¤ºï¼šåœ¨å¤æ‚çš„ç³»ç»Ÿè®¾è®¡ä¸­ï¼Œ<strong>é€‚å½“çš„è§£è€¦</strong>å¾€å¾€èƒ½å¸¦æ¥æ„æƒ³ä¸åˆ°çš„çµæ´»æ€§ã€‚å°†ä¸‹è½½ä¸åŒæ­¥åˆ†ç¦»ï¼Œä¸ä»…é™ä½äº†ç³»ç»Ÿå¤æ‚åº¦ï¼Œè¿˜ä¸ºç”¨æˆ·æä¾›äº†æ›´å¤šé€‰æ‹©æƒã€‚</p><p>è¿™ç§è®¾è®¡æ€ç»´å¯ä»¥åº”ç”¨åˆ°æ›´å¤šåœºæ™¯ï¼š</p><ul><li>æ•°æ®é‡‡é›†ä¸æ•°æ®å¤„ç†çš„åˆ†ç¦»</li><li>è®¡ç®—èµ„æºä¸å­˜å‚¨èµ„æºçš„åˆ†ç¦»</li><li>æ ¸å¿ƒé€»è¾‘ä¸å‘¨è¾¹å·¥å…·çš„åˆ†ç¦»</li></ul><h3 id="æ¨¡å—åŒ–è®¾è®¡çš„æ‰©å±•æ€§"><a href="#æ¨¡å—åŒ–è®¾è®¡çš„æ‰©å±•æ€§" class="headerlink" title="æ¨¡å—åŒ–è®¾è®¡çš„æ‰©å±•æ€§"></a>æ¨¡å—åŒ–è®¾è®¡çš„æ‰©å±•æ€§</h3><p><strong>LinkContentAI</strong> çš„æ¨¡å—åŒ–è®¾è®¡è¯æ˜äº†<strong>è‰¯å¥½æŠ½è±¡</strong>çš„ä»·å€¼ã€‚å½“ç³»ç»Ÿè®¾è®¡éµå¾ªå•ä¸€èŒè´£åŸåˆ™å’Œå¼€é—­åŸåˆ™æ—¶ï¼Œæ‰©å±•æ–°åŠŸèƒ½å¾€å¾€åªéœ€è¦å¢é‡å¼€å‘ï¼Œè€Œä¸éœ€è¦é‡æ„ç°æœ‰ä»£ç ã€‚</p><p>è¿™ç§è®¾è®¡ç†å¿µç‰¹åˆ«é€‚ç”¨äºï¼š</p><ul><li>å¤šæ ¼å¼æ–‡æ¡£å¤„ç†ç³»ç»Ÿ</li><li>å¤šæ•°æ®æºé›†æˆå¹³å°</li><li>AIèƒ½åŠ›é›†æˆæ¡†æ¶</li></ul><h3 id="æ–‡æ¡£é©±åŠ¨å¼€å‘çš„é‡è¦æ€§"><a href="#æ–‡æ¡£é©±åŠ¨å¼€å‘çš„é‡è¦æ€§" class="headerlink" title="æ–‡æ¡£é©±åŠ¨å¼€å‘çš„é‡è¦æ€§"></a>æ–‡æ¡£é©±åŠ¨å¼€å‘çš„é‡è¦æ€§</h3><p>ä¸¤ä¸ªé¡¹ç›®éƒ½å±•ç°äº†<strong>å®Œå–„æ–‡æ¡£</strong>çš„ä»·å€¼ã€‚ä»å¿«é€Ÿå¼€å§‹æŒ‡å—åˆ°æ•…éšœæ’é™¤FAQï¼Œä»æŠ€æœ¯æ”¹è¿›è®°å½•åˆ°å¼€å‘æ–‡æ¡£ï¼Œè¿™äº›çœ‹ä¼¼â€é¢å¤–â€çš„å·¥ä½œå®é™…ä¸Šå¤§å¤§é™ä½äº†ç”¨æˆ·çš„å­¦ä¹ æˆæœ¬å’Œé¡¹ç›®çš„æ¨å¹¿éš¾åº¦ã€‚</p><p>æ–‡æ¡£ä¸ä»…æ˜¯ç”¨æˆ·çš„æŒ‡å—ï¼Œæ›´æ˜¯ï¼š</p><ul><li>é¡¹ç›®çš„æŠ€æœ¯åç‰‡</li><li>å›¢é˜Ÿåä½œçš„å¥‘çº¦</li><li>çŸ¥è¯†ä¼ æ‰¿çš„è½½ä½“</li></ul><hr>]]></content>
      
      
      <categories>
          
          <category> é¡¹ç›®è®°å½• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é’‰é’‰çŸ¥è¯†åº“ </tag>
            
            <tag> æ–‡æ¡£è§£æ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Unstructured åŠå…¶ä½¿ç”¨å…¥é—¨</title>
      <link href="/2025/11/21/Unstructured/Unstructured/"/>
      <url>/2025/11/21/Unstructured/Unstructured/</url>
      
        <content type="html"><![CDATA[<h2 id="Unstructured"><a href="#Unstructured" class="headerlink" title="Unstructured"></a>Unstructured</h2><p>è¿™æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å¼€æºåº“ï¼Œæ—¨åœ¨ä»ä»»æ„æ ¼å¼ï¼ˆPDF, Word, PPT, HTML, Images, Emoilsâ€¦ï¼‰ä¸­æå–å¹²å‡€çš„æ–‡æœ¬, è‡ªåŠ¨è¯†åˆ«æ–‡ä»¶ç±»å‹ï¼Œè‡ªåŠ¨å¤„ç†åˆ†å—ï¼ˆpartitionï¼‰ï¼Œè‡ªåŠ¨ OCRã€‚</p><p>å®ƒçš„æ ¸å¿ƒç†å¿µæ˜¯ï¼š<strong>â€œä½ ä¸éœ€è¦å…³å¿ƒæ–‡ä»¶æ ¼å¼ï¼Œåªéœ€ç»™æˆ‘æ–‡ä»¶ï¼Œæˆ‘è¿˜ä½ ç»“æ„åŒ–çš„æ•°æ®ã€‚â€</strong></p><h3 id="1-æ ¸å¿ƒä¼˜åŠ¿ï¼šä¸ºä»€ä¹ˆé€‰-Unstructuredï¼Ÿ"><a href="#1-æ ¸å¿ƒä¼˜åŠ¿ï¼šä¸ºä»€ä¹ˆé€‰-Unstructuredï¼Ÿ" class="headerlink" title="1. æ ¸å¿ƒä¼˜åŠ¿ï¼šä¸ºä»€ä¹ˆé€‰ Unstructuredï¼Ÿ"></a>1. æ ¸å¿ƒä¼˜åŠ¿ï¼šä¸ºä»€ä¹ˆé€‰ Unstructuredï¼Ÿ</h3><p>ä¼ ç»Ÿçš„åº“ï¼ˆå¦‚ <code>PyPDF2</code> æˆ– <code>python-docx</code>ï¼‰é€šå¸¸åªç»™ä½ ä¸€å †æ··ä¹±çš„å­—ç¬¦ä¸²ã€‚è€Œ <code>Unstructured</code> ä¼šåšä»¥ä¸‹å‡ ä»¶é«˜çº§çš„äº‹ï¼š</p><ol><li><strong>å½’ä¸€åŒ–æ¥å£</strong>ï¼šæ— è®ºæ˜¯ <code>.pdf</code>, <code>.docx</code>, <code>.html</code>, <code>.ppt</code>, <code>.jpg</code>, ç”šè‡³ <code>.eml</code> (é‚®ä»¶)ï¼Œéƒ½ç”¨åŒä¸€ä¸ªå‡½æ•° <code>partition()</code> å¤„ç†ã€‚</li><li><strong>è¯­ä¹‰åˆ†å— (Semantic Elements)</strong>ï¼šå®ƒä¸ä¼šæŠŠæ•´ä¸ªæ–‡æ¡£è¯»æˆä¸€ä¸ªé•¿å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯å°†å…¶æ‹†åˆ†ä¸ºæœ‰æ„ä¹‰çš„â€œå…ƒç´  (Elements)â€ï¼Œä¾‹å¦‚ï¼š<ul><li><code>Title</code> (æ ‡é¢˜)</li><li><code>NarrativeText</code> (æ­£æ–‡æ®µè½)</li><li><code>ListItem</code> (åˆ—è¡¨é¡¹)</li><li><code>Table</code> (è¡¨æ ¼)</li></ul></li><li><strong>æ™ºèƒ½ç­–ç•¥</strong>ï¼šé’ˆå¯¹ PDFï¼Œå®ƒæ”¯æŒ OCRï¼ˆå…‰å­¦å­—ç¬¦è¯†åˆ«ï¼‰å’Œå¯¹è±¡æ£€æµ‹ï¼ˆè¯†åˆ«å›¾ç‰‡ä¸­çš„è¡¨æ ¼ï¼‰ã€‚</li><li><strong>å…ƒæ•°æ® (Metadata)</strong>ï¼šæ¯ä¸ªæå–å‡ºçš„å…ƒç´ éƒ½åŒ…å«é¡µç ã€æ–‡ä»¶åã€åæ ‡ä½ç½®ç­‰ä¿¡æ¯ï¼ˆè¿™å¯¹ RAG çš„â€œå¼•ç”¨æº¯æºâ€è‡³å…³é‡è¦ï¼‰ã€‚</li></ol><hr><blockquote><p>Unstructured åŠŸèƒ½å¼ºå¤§ï¼Œå› æ­¤ä¾èµ–åŒ…éå¸¸é‡ã€‚å¦‚æœä¸æ­£ç¡®å®‰è£…ï¼Œå¤„ç† PDF å’Œå›¾åƒæ—¶å¾ˆå®¹æ˜“æŠ¥é”™ã€‚<br>ä¸ºäº†å¤„ç† PDF å’Œå›¾ç‰‡ï¼ˆOCRï¼‰ï¼Œéœ€è¦å®‰è£…é Python çš„å·¥å…·ï¼š<strong>Tesseract å’Œ Poppler</strong></p></blockquote><h2 id="ğŸ› ï¸-Windows-ä¸‹çš„ç¯å¢ƒé…ç½®æŒ‡å—-Scoop-æ–¹æ¡ˆ"><a href="#ğŸ› ï¸-Windows-ä¸‹çš„ç¯å¢ƒé…ç½®æŒ‡å—-Scoop-æ–¹æ¡ˆ" class="headerlink" title="ğŸ› ï¸ Windows ä¸‹çš„ç¯å¢ƒé…ç½®æŒ‡å— (Scoop æ–¹æ¡ˆ)"></a>ğŸ› ï¸ Windows ä¸‹çš„ç¯å¢ƒé…ç½®æŒ‡å— (Scoop æ–¹æ¡ˆ)</h2><p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong> ä¸º Python çš„ <code>Unstructured</code>ã€<code>PaddleOCR</code> æˆ– <code>pdf2image</code> åº“é…ç½®åº•å±‚çš„ Tesseract (OCR) å’Œ Poppler (PDF æ¸²æŸ“) ä¾èµ–ã€‚</p><h3 id="1-å®‰è£…åŒ…ç®¡ç†å™¨-Scoop"><a href="#1-å®‰è£…åŒ…ç®¡ç†å™¨-Scoop" class="headerlink" title="1. å®‰è£…åŒ…ç®¡ç†å™¨ Scoop"></a>1. å®‰è£…åŒ…ç®¡ç†å™¨ Scoop</h3><p>æ‰“å¼€ <strong>PowerShell</strong>ï¼ˆæ— éœ€ç®¡ç†å‘˜æƒé™ï¼‰ï¼Œä¾æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># 1. è®¾ç½®å…è®¸æ‰§è¡Œè„šæœ¬</span><br><span class="hljs-built_in">Set-ExecutionPolicy</span> RemoteSigned <span class="hljs-literal">-Scope</span> CurrentUser<br><br><span class="hljs-comment"># 2. ä¸‹è½½å¹¶å®‰è£… Scoop</span><br><span class="hljs-built_in">irm</span> get.scoop.sh | <span class="hljs-built_in">iex</span><br></code></pre></td></tr></table></figure><h3 id="2-ä¸€é”®å®‰è£…ä¾èµ–å·¥å…·"><a href="#2-ä¸€é”®å®‰è£…ä¾èµ–å·¥å…·" class="headerlink" title="2. ä¸€é”®å®‰è£…ä¾èµ–å·¥å…·"></a>2. ä¸€é”®å®‰è£…ä¾èµ–å·¥å…·</h3><p>ç»§ç»­åœ¨ PowerShell ä¸­æ‰§è¡Œï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># 1. æ·»åŠ æ‰©å±•åº“ (extras bucket åŒ…å«æˆ‘ä»¬è¦çš„å·¥å…·)</span><br>scoop bucket add extras<br><br><span class="hljs-comment"># 2. åŒæ—¶å®‰è£… Tesseract å’Œ Poppler</span><br>scoop install tesseract poppler<br></code></pre></td></tr></table></figure><h3 id="3-é…ç½®ä¸­æ–‡-OCR-æ”¯æŒ-å…³é”®æ­¥éª¤"><a href="#3-é…ç½®ä¸­æ–‡-OCR-æ”¯æŒ-å…³é”®æ­¥éª¤" class="headerlink" title="3. é…ç½®ä¸­æ–‡ OCR æ”¯æŒ (å…³é”®æ­¥éª¤)"></a>3. é…ç½®ä¸­æ–‡ OCR æ”¯æŒ (å…³é”®æ­¥éª¤)</h3><p>é»˜è®¤ Tesseract åªæœ‰è‹±æ–‡åº“ï¼Œè§£æä¸­æ–‡ PDF&#x2F;å›¾ç‰‡éœ€è¦æ‰‹åŠ¨æ·»åŠ ä¸­æ–‡æ•°æ®åŒ…ã€‚</p><ol><li><strong>ä¸‹è½½æ•°æ®åŒ…ï¼š</strong><br>ä¸‹è½½ <code>chi_sim.traineddata</code> (ç®€ä½“ä¸­æ–‡)ï¼š<ul><li>å®˜æ–¹ä¸‹è½½åœ°å€: <a href="https://github.com/tesseract-ocr/tessdata_best/blob/main/chi_sim.traineddata">GitHub - tessdata_best</a></li></ul></li><li><strong>æ”¾å…¥æŒ‡å®šç›®å½•ï¼š</strong><br>å°†ä¸‹è½½çš„æ–‡ä»¶æ”¾å…¥ä»¥ä¸‹æ–‡ä»¶å¤¹ï¼ˆ<code>&lt;ä½ çš„ç”¨æˆ·å&gt;</code> éœ€æ›¿æ¢ï¼‰ï¼š<br><code>C:\Users\&lt;ä½ çš„ç”¨æˆ·å&gt;\scoop\apps\tesseract\current\tessdata</code></li></ol><h3 id="4-éªŒè¯å®‰è£…"><a href="#4-éªŒè¯å®‰è£…" class="headerlink" title="4. éªŒè¯å®‰è£…"></a>4. éªŒè¯å®‰è£…</h3><p><strong>æ³¨æ„ï¼š</strong> å®‰è£…å®Œæˆåï¼ŒåŠ¡å¿… <strong>é‡å¯</strong> ç»ˆç«¯ï¼ˆPowerShell æˆ– CMDï¼‰ä»¥åŠ è½½ç¯å¢ƒå˜é‡ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># 1. æ£€æŸ¥ Tesseract ç‰ˆæœ¬</span><br>tesseract <span class="hljs-literal">--version</span><br><span class="hljs-comment"># è¾“å‡ºåº”åŒ…å« tesseract v5.x.x</span><br><br><span class="hljs-comment"># 2. æ£€æŸ¥ä¸­æ–‡åº“æ˜¯å¦è¯†åˆ«</span><br>tesseract <span class="hljs-literal">--list-langs</span><br><span class="hljs-comment"># è¾“å‡ºåˆ—è¡¨åº”åŒ…å« chi_sim</span><br><br><span class="hljs-comment"># 3. æ£€æŸ¥ Poppler (pdftoppm)</span><br>pdftoppm <span class="hljs-literal">-h</span><br><span class="hljs-comment"># è¾“å‡ºåº”æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯</span><br></code></pre></td></tr></table></figure><hr><h3 id="é™„å½•-partition-æ–¹æ³•å¸¸ç”¨å‚æ•°è¯´æ˜"><a href="#é™„å½•-partition-æ–¹æ³•å¸¸ç”¨å‚æ•°è¯´æ˜" class="headerlink" title="é™„å½•: partition()æ–¹æ³•å¸¸ç”¨å‚æ•°è¯´æ˜"></a>é™„å½•: partition()æ–¹æ³•å¸¸ç”¨å‚æ•°è¯´æ˜</h3><p><code>unstructured.partition</code> æ¨¡å—æ˜¯ Unstructured åº“çš„æ ¸å¿ƒï¼Œç”¨äºä»å„ç§æ–‡æ¡£ç±»å‹ä¸­æå–ç»“æ„åŒ–å…ƒç´ ã€‚ä»¥ä¸‹æ˜¯ <code>partition</code> æ–¹æ³•çš„ä¸€äº›å¸¸ç”¨å‚æ•°ï¼š</p><ul><li><code>filename</code> (str, optional): æœ¬åœ°æ–‡ä»¶çš„è·¯å¾„ã€‚å½“å¤„ç†æœ¬åœ°å­˜å‚¨çš„æ–‡æ¡£æ—¶ä½¿ç”¨ã€‚</li><li><code>url</code> (str, optional): è¿œç¨‹æ–‡ä»¶çš„ URLã€‚å½“å¤„ç†ç½‘ç»œä¸Šçš„æ–‡æ¡£æ—¶ä½¿ç”¨ã€‚</li><li><code>text</code> (str, optional): ç›´æ¥ä½œä¸ºå­—ç¬¦ä¸²ä¼ å…¥çš„æ–‡æœ¬å†…å®¹ã€‚é€‚ç”¨äºå¤„ç†å†…å­˜ä¸­çš„æ–‡æœ¬ã€‚</li><li><code>content_type</code> (str, optional): æ–‡ä»¶çš„ MIME ç±»å‹ï¼Œä¾‹å¦‚ <code>application/pdf</code>, <code>text/html</code>ã€‚æœ‰åŠ©äº Unstructured æ›´å‡†ç¡®åœ°è¯†åˆ«æ–‡ä»¶ç±»å‹ã€‚</li><li><code>strategy</code> (str, optional): æå–ç­–ç•¥ï¼Œå¯é€‰å€¼åŒ…æ‹¬ <code>&quot;fast&quot;</code>, <code>&quot;hi_res&quot;</code>ã€‚<ul><li><code>&quot;fast&quot;</code>: é€Ÿåº¦è¾ƒå¿«ï¼Œä½†å¯èƒ½åœ¨å¤æ‚å¸ƒå±€çš„æ–‡æ¡£ä¸Šè¡¨ç°ä¸ä½³ã€‚</li><li><code>&quot;hi_res&quot;</code>: ä½¿ç”¨æ›´å¤æ‚çš„æ¨¡å‹ï¼ˆå¦‚ detectron2ï¼‰ï¼Œåœ¨å¤„ç†å¤æ‚æ–‡æ¡£ï¼ˆå¦‚æ‰«æçš„ PDFã€å›¾åƒï¼‰æ—¶æ•ˆæœæ›´å¥½ï¼Œä½†é€Ÿåº¦è¾ƒæ…¢ã€‚</li></ul></li><li><code>languages</code> (list of str, optional): æŒ‡å®š OCR è¯†åˆ«æ—¶ä½¿ç”¨çš„è¯­è¨€åˆ—è¡¨ï¼Œä¾‹å¦‚ <code>[&quot;eng&quot;, &quot;chi_sim&quot;]</code>ã€‚åœ¨ä½¿ç”¨ OCR ç­–ç•¥æ—¶éå¸¸é‡è¦ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ–‡æ¡£è§£æ </tag>
            
            <tag> Python </tag>
            
            <tag> Scoop </tag>
            
            <tag> Unstructured </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windows ä¸Šå®‰è£… OpenCode å¹¶æ¥å…¥ Minimax M2</title>
      <link href="/2025/11/21/OpenCode/OpenCode/"/>
      <url>/2025/11/21/OpenCode/OpenCode/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Claude Code çš„ä½¿ç”¨å¤§å·®ä¸å·®ï¼Œå¦‚æœä½¿ç”¨ Claude Codeï¼Œå¼ºçƒˆæ¨è Claude Code Switch æ¥é›†ä¸­ç®¡ç† API_KEY</p></blockquote><h1 id="OpenCode"><a href="#OpenCode" class="headerlink" title="OpenCode"></a>OpenCode</h1><p>OpenCode æ—¢æ˜¯ä¸€æ¬¾åœ¨ç»ˆç«¯ä¸­è¿è¡Œçš„ CLI + TUI AI ç¼–ç¨‹ä»£ç†å·¥å…·ï¼Œä¹Ÿæä¾› IDE çš„æ’ä»¶é›†æˆï¼Œèƒ½å¤Ÿåœ¨ä¸åŒå¼€å‘ç¯å¢ƒä¸‹å®Œæˆå¿«é€Ÿä»£ç ç”Ÿæˆã€è°ƒè¯•ã€é¡¹ç›®åˆ†æã€æ–‡ä»¶æ“ä½œä¸è·¨é¡¹ç›®åä½œç­‰ä»»åŠ¡ã€‚<br>æ­é…å„å‚å•†çš„ Coding Planï¼Œå¼€å‘æ•ˆç‡ï¼Œå¼€å‘ç¨³å®šæ€§å’Œå¼€å‘ä½“éªŒéƒ½èƒ½å¾—åˆ°å…¨é¢æå‡</p><h2 id="å®‰è£…-OpenCode"><a href="#å®‰è£…-OpenCode" class="headerlink" title="å®‰è£… OpenCode"></a>å®‰è£… OpenCode</h2><ul><li>ä½¿ç”¨ curl å®‰è£… OpenCode<br><code>curl -fsSL https://opencode.ai/install | bash</code></li><li>ä½¿ç”¨ npm å®‰è£… OpenCode<br><code>npm i -g opencode-ai</code></li></ul><h1 id="MiniMax-M2"><a href="#MiniMax-M2" class="headerlink" title="MiniMax M2"></a>MiniMax M2</h1><p>MiniMax M2 æ˜¯ç”± MiniMax å…¬å¸å¼€å‘çš„å…ˆè¿›å¤§è¯­è¨€æ¨¡å‹ã€‚å®ƒèƒ½å¤Ÿç†è§£å’Œç”Ÿæˆé«˜åº¦å¤æ‚å’Œè¿è´¯çš„æ–‡æœ¬ï¼Œå…·å¤‡å¼ºå¤§çš„å¯¹è¯ã€æ¨ç†å’Œä»£ç ç”Ÿæˆèƒ½åŠ›ï¼Œé€‚ç”¨äºå¤šç§åº”ç”¨åœºæ™¯ï¼Œå¦‚æ™ºèƒ½åŠ©ç†ã€å†…å®¹åˆ›ä½œå’Œè½¯ä»¶å¼€å‘ã€‚</p><h2 id="åœ¨-OpenCode-ä¸­ä½¿ç”¨-MiniMax-M2"><a href="#åœ¨-OpenCode-ä¸­ä½¿ç”¨-MiniMax-M2" class="headerlink" title="åœ¨ OpenCode ä¸­ä½¿ç”¨ MiniMax-M2"></a>åœ¨ OpenCode ä¸­ä½¿ç”¨ MiniMax-M2</h2><ul><li>è¿è¡Œè®¤è¯å‘½ä»¤<br><code>opencode auth login</code></li><li>é€‰æ‹© minimax</li><li>è¾“å…¥ä½ çš„ <strong>MiniMax API Key</strong></li><li>è¿›å…¥é¡¹ç›®ç›®å½•ï¼Œå¯åŠ¨ opencode</li><li>è¾“å…¥ &#x2F;modelsï¼Œé€‰æ‹© â€œMiniMax-M2â€</li></ul><h1 id="Oh-My-Posh"><a href="#Oh-My-Posh" class="headerlink" title="Oh My Posh"></a>Oh My Posh</h1><p>Oh My Posh æ˜¯ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„ã€å¯å®šåˆ¶çš„è·¨å¹³å°ç»ˆç«¯æç¤ºç¬¦ä¸»é¢˜å¼•æ“ã€‚å®ƒå…è®¸ç”¨æˆ·é€šè¿‡é…ç½®ä¸åŒçš„ä¸»é¢˜å’Œæ’ä»¶ï¼Œæå¤§åœ°ç¾åŒ–ç»ˆç«¯ç•Œé¢ï¼Œå¹¶èƒ½æ˜¾ç¤º Git çŠ¶æ€ã€è·¯å¾„ä¿¡æ¯ã€æ—¶é—´ç­‰å¤šç§å®ç”¨ä¿¡æ¯ï¼Œæå‡å¼€å‘ä½“éªŒã€‚</p><h2 id="ä½¿ç”¨-Oh-My-Posh-ç¾åŒ–ç»ˆç«¯"><a href="#ä½¿ç”¨-Oh-My-Posh-ç¾åŒ–ç»ˆç«¯" class="headerlink" title="ä½¿ç”¨ Oh My Posh ç¾åŒ–ç»ˆç«¯"></a>ä½¿ç”¨ Oh My Posh ç¾åŒ–ç»ˆç«¯</h2><blockquote><p>æ­¤å¤„é»˜è®¤å·²å®‰è£… Powershell å’Œ Terminal</p></blockquote><ul><li>å®‰è£… Oh My Posh æœ¬ä½“<br><code>winget install JanDeDobbeleer.OhMyPosh -s winget</code></li><li>å®‰è£…å­—ä½“æ”¯æŒ<br><code>oh-my-posh font install meslo</code></li><li>åœ¨ Terminal ä¸­è®¾ç½® Powershell å­—ä½“</li></ul><h1 id="å¯èƒ½é‡åˆ°çš„é—®é¢˜"><a href="#å¯èƒ½é‡åˆ°çš„é—®é¢˜" class="headerlink" title="å¯èƒ½é‡åˆ°çš„é—®é¢˜"></a>å¯èƒ½é‡åˆ°çš„é—®é¢˜</h1><h3 id="1-OpenCode-å®‰è£…é—®é¢˜"><a href="#1-OpenCode-å®‰è£…é—®é¢˜" class="headerlink" title="1. OpenCode å®‰è£…é—®é¢˜"></a>1. OpenCode å®‰è£…é—®é¢˜</h3><ul><li><strong>ç½‘ç»œé—®é¢˜</strong>ï¼š<code>curl</code> æˆ– <code>npm</code> ä¸‹è½½é€Ÿåº¦æ…¢æˆ–å¤±è´¥ã€‚è¿™é€šå¸¸æ˜¯ç½‘ç»œç¯å¢ƒé—®é¢˜ï¼Œå¯ä»¥å°è¯•åˆ‡æ¢ç½‘ç»œã€ä½¿ç”¨ä»£ç†æˆ–åœ¨ç½‘ç»œçŠ¶å†µè‰¯å¥½çš„æ—¶å€™é‡è¯•ã€‚</li><li><strong>æƒé™é—®é¢˜</strong>ï¼šä½¿ç”¨ <code>npm i -g</code> å…¨å±€å®‰è£…æ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°æƒé™ä¸è¶³çš„é”™è¯¯ã€‚åœ¨ macOS æˆ– Linux ä¸Šï¼Œå¯ä»¥å°è¯•åœ¨å‘½ä»¤å‰åŠ ä¸Š <code>sudo</code> (<code>sudo npm i -g opencode-ai</code>)ã€‚åœ¨ Windows ä¸Šï¼Œè¯·ç¡®ä¿ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œç»ˆç«¯ã€‚</li><li><strong>å‘½ä»¤æœªæ‰¾åˆ°</strong>ï¼šå®‰è£…åï¼Œè¾“å…¥ <code>opencode</code> æç¤ºå‘½ä»¤æœªæ‰¾åˆ°ã€‚è¿™é€šå¸¸æ˜¯ç”±äºç³»ç»Ÿçš„ <code>PATH</code> ç¯å¢ƒå˜é‡æ²¡æœ‰è¢«æ­£ç¡®é…ç½®ã€‚å¯ä»¥å°è¯•é‡å¯ç»ˆç«¯ï¼Œæˆ–è€…æ‰‹åŠ¨å°† <code>opencode</code> çš„å®‰è£…è·¯å¾„æ·»åŠ åˆ° <code>PATH</code> ç¯å¢ƒå˜é‡ä¸­ã€‚</li></ul><h3 id="2-MiniMax-API-Key-é—®é¢˜"><a href="#2-MiniMax-API-Key-é—®é¢˜" class="headerlink" title="2. MiniMax API Key é—®é¢˜"></a>2. MiniMax API Key é—®é¢˜</h3><ul><li><strong>æ— æ•ˆçš„ API Key</strong>ï¼šè¾“å…¥çš„ API Key ä¸æ­£ç¡®æˆ–å·²å¤±æ•ˆã€‚è¯·æ£€æŸ¥ Key æ˜¯å¦å¤åˆ¶å®Œæ•´ï¼Œæˆ–åœ¨ MiniMax å®˜ç½‘é‡æ–°ç”Ÿæˆã€‚</li><li><strong>ç½‘ç»œç­–ç•¥é™åˆ¶</strong>ï¼šå…¬å¸æˆ–æœ¬åœ°é˜²ç«å¢™å¯èƒ½ä¼šé˜»æ­¢å¯¹ MiniMax API æœåŠ¡å™¨çš„è®¿é—®ã€‚è¯·æ£€æŸ¥ä½ çš„ç½‘ç»œç­–ç•¥ï¼Œç¡®ä¿ <code>api.minimax.com</code> ç­‰åœ°å€æ²¡æœ‰è¢«å±è”½ã€‚</li><li><strong>è´¦æˆ·ä½™é¢ä¸è¶³</strong>ï¼šAPI Key å…³è”çš„è´¦æˆ·ä½™é¢ä¸è¶³ï¼Œå¯¼è‡´è¯·æ±‚å¤±è´¥ã€‚</li></ul><h3 id="3-Oh-My-Posh-ç¾åŒ–é—®é¢˜"><a href="#3-Oh-My-Posh-ç¾åŒ–é—®é¢˜" class="headerlink" title="3. Oh My Posh ç¾åŒ–é—®é¢˜"></a>3. Oh My Posh ç¾åŒ–é—®é¢˜</h3><ul><li><strong>winget å‘½ä»¤ä¸å­˜åœ¨</strong>ï¼šåœ¨è¾ƒæ—§çš„ Windows ç‰ˆæœ¬ä¸­ï¼Œ<code>winget</code> å¯èƒ½æœªè¢«å®‰è£…ã€‚è¯·å…ˆä» Microsoft Store å®‰è£… â€œåº”ç”¨å®‰è£…ç¨‹åºâ€ æ¥è·å– <code>winget</code>ã€‚</li><li><strong>å­—ä½“æ˜¾ç¤ºå¼‚å¸¸</strong>ï¼šå®‰è£…å¹¶è®¾ç½® <code>meslo</code> å­—ä½“åï¼Œç»ˆç«¯ä¾ç„¶å‡ºç°ä¹±ç æˆ–æ— æ³•æ˜¾ç¤ºå›¾æ ‡ã€‚è¯·ç¡®ä¿ï¼š<ol><li>åœ¨ Windows Terminal çš„è®¾ç½®ä¸­ï¼Œå·²å°† Powershell çš„ â€œå¤–è§‚â€ -&gt; â€œå­—ä½“â€ æ­£ç¡®è®¾ç½®ä¸º <code>MesloLGM NF</code>ã€‚</li><li>é‡å¯ç»ˆç«¯ä»¥ä½¿å­—ä½“è®¾ç½®ç”Ÿæ•ˆã€‚</li></ol></li><li><strong>Oh My Posh æœªè‡ªåŠ¨å¯åŠ¨</strong>ï¼šæ¯æ¬¡æ‰“å¼€æ–°çš„ Powershell çª—å£ï¼Œéƒ½éœ€è¦æ‰‹åŠ¨å¯åŠ¨ Oh My Poshã€‚è¿™éœ€è¦å°†åˆå§‹åŒ–è„šæœ¬æ·»åŠ åˆ°ä½ çš„ Powershell é…ç½®æ–‡ä»¶ä¸­ã€‚å¯ä»¥è¿è¡Œ <code>notepad $PROFILE</code>ï¼Œåœ¨æ‰“å¼€çš„æ–‡ä»¶ä¸­æ·»åŠ  <code>oh-my-posh init pwsh | Invoke-Expression</code> å¹¶ä¿å­˜ã€‚å¦‚æœæç¤ºæ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¯·å…ˆè¿è¡Œ <code>New-Item -Path $PROFILE -Type File -Force</code> åˆ›å»ºå®ƒã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Terminal </tag>
            
            <tag> OpenCode </tag>
            
            <tag> Claude Code </tag>
            
            <tag> Vibe Coding </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é€šè¿‡Docker+Koishi+NapCatæ­å»ºQQæœºå™¨äºº</title>
      <link href="/2025/11/12/Koishi/Koishi/"/>
      <url>/2025/11/12/Koishi/Koishi/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸ“–-ç®€ä»‹"><a href="#ğŸ“–-ç®€ä»‹" class="headerlink" title="ğŸ“– ç®€ä»‹"></a>ğŸ“– ç®€ä»‹</h2><p><a href="https://koishi.chat/zh-CN/">Koishi</a> æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ã€å¯æ‰©å±•çš„è·¨å¹³å°æœºå™¨äººæ¡†æ¶ã€‚æœ¬æŒ‡å—å°†å¼•å¯¼ä½ å¦‚ä½•åœ¨ Ubuntu æœåŠ¡å™¨ä¸Šï¼Œé€šè¿‡ Docker å¿«é€Ÿéƒ¨ç½² Koishiï¼Œå¹¶ä½¿ç”¨ <a href="https://github.com/NapNeko/NapCat-Installer">NapCat</a> ä½œä¸º QQ é€‚é…å™¨ï¼Œæœ€ç»ˆæ­å»ºä¸€ä¸ªç¨³å®šã€é«˜æ•ˆçš„ QQ æœºå™¨äººã€‚</p><hr><h2 id="âš ï¸-å‡†å¤‡å·¥ä½œ"><a href="#âš ï¸-å‡†å¤‡å·¥ä½œ" class="headerlink" title="âš ï¸ å‡†å¤‡å·¥ä½œ"></a>âš ï¸ å‡†å¤‡å·¥ä½œ</h2><p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿ä½ å·²å‡†å¤‡å¥½ä»¥ä¸‹ç¯å¢ƒï¼š</p><ol><li>ä¸€å°æ‹¥æœ‰å…¬ç½‘ IP çš„ Ubuntu æœåŠ¡å™¨ã€‚</li><li>ä¸€ä¸ªç”¨äºç™»å½•çš„ QQ å°å·ã€‚</li><li>ç¡®ä¿æœåŠ¡å™¨é˜²ç«å¢™æˆ–äº‘æœåŠ¡å•†å®‰å…¨ç»„å·²å¼€æ”¾ä»¥ä¸‹ç«¯å£ï¼š</li></ol><table><thead><tr><th align="left">ç«¯å£</th><th align="left">ç”¨é€”</th><th align="left">è¯´æ˜</th></tr></thead><tbody><tr><td align="left"><code>5140</code></td><td align="left"><strong>Koishi æ§åˆ¶å°</strong></td><td align="left">ç”¨äºè®¿é—® Koishi çš„ç½‘é¡µç®¡ç†é¢æ¿ã€‚</td></tr><tr><td align="left"><code>6099</code></td><td align="left"><strong>NapCat WebUI</strong></td><td align="left">ç”¨äºè®¿é—® NapCat çš„ç½‘é¡µç®¡ç†é¢æ¿ï¼ˆæ‰«ç ç™»å½•ï¼‰ã€‚</td></tr><tr><td align="left"><code>3001</code></td><td align="left"><strong>NapCat HTTP API</strong></td><td align="left">NapCat æä¾›çš„ HTTP API ç«¯å£ã€‚</td></tr><tr><td align="left"><code>3000</code></td><td align="left"><strong>NapCat æ­£å‘ WebSocket API</strong></td><td align="left">Koishi è¿æ¥ NapCat æ‰€ä½¿ç”¨çš„ç«¯å£ã€‚</td></tr></tbody></table><hr><h2 id="æ­¥éª¤ä¸€ï¼šå®‰è£…-Docker-ç¯å¢ƒ"><a href="#æ­¥éª¤ä¸€ï¼šå®‰è£…-Docker-ç¯å¢ƒ" class="headerlink" title="æ­¥éª¤ä¸€ï¼šå®‰è£… Docker ç¯å¢ƒ"></a>æ­¥éª¤ä¸€ï¼šå®‰è£… Docker ç¯å¢ƒ</h2><p>æœ¬éƒ¨åˆ†å‚è€ƒè‡ªåšå®¢ <a href="https://www.cnblogs.com/lanyusky/p/19187095">è“ç¾½å¤©ç©º</a>ï¼Œå¹¶å·²é€‚é…å›½å†…ç½‘ç»œç¯å¢ƒã€‚</p><h4 id="1-æ£€æŸ¥æ—§ç‰ˆæœ¬"><a href="#1-æ£€æŸ¥æ—§ç‰ˆæœ¬" class="headerlink" title="1. æ£€æŸ¥æ—§ç‰ˆæœ¬"></a>1. æ£€æŸ¥æ—§ç‰ˆæœ¬</h4><p>éªŒè¯å½“å‰ç¯å¢ƒæ˜¯å¦å·²å®‰è£…æ—§ç‰ˆæœ¬ Dockerã€‚å¦‚æœå·²å®‰è£…ï¼Œå»ºè®®å…ˆå¸è½½ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker -v<br></code></pre></td></tr></table></figure><h4 id="2-æ›´æ–°è½¯ä»¶åŒ…ç´¢å¼•å¹¶å®‰è£…ä¾èµ–"><a href="#2-æ›´æ–°è½¯ä»¶åŒ…ç´¢å¼•å¹¶å®‰è£…ä¾èµ–" class="headerlink" title="2. æ›´æ–°è½¯ä»¶åŒ…ç´¢å¼•å¹¶å®‰è£…ä¾èµ–"></a>2. æ›´æ–°è½¯ä»¶åŒ…ç´¢å¼•å¹¶å®‰è£…ä¾èµ–</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> apt update<br><span class="hljs-built_in">sudo</span> apt install -y ca-certificates curl<br></code></pre></td></tr></table></figure><h4 id="3-æ·»åŠ -Docker-çš„-GPG-å¯†é’¥"><a href="#3-æ·»åŠ -Docker-çš„-GPG-å¯†é’¥" class="headerlink" title="3. æ·»åŠ  Docker çš„ GPG å¯†é’¥"></a>3. æ·»åŠ  Docker çš„ GPG å¯†é’¥</h4><p>GPG å¯†é’¥ç”¨äºéªŒè¯è½¯ä»¶åŒ…çš„å®Œæ•´æ€§ï¼Œç¡®ä¿å…¶æ¥æºå¯ä¿¡ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># åˆ›å»ºç”¨äºå­˜å‚¨ GPG å¯†é’¥çš„ç›®å½•</span><br><span class="hljs-built_in">sudo</span> install -m 0755 -d /etc/apt/keyrings<br><br><span class="hljs-comment"># ä¸‹è½½ GPG å¯†é’¥ï¼ˆä½¿ç”¨é˜¿é‡Œäº‘é•œåƒï¼‰</span><br><span class="hljs-built_in">sudo</span> curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc<br><br><span class="hljs-comment"># æ›´æ”¹å¯†é’¥æ–‡ä»¶çš„æƒé™ï¼Œç¡®ä¿ apt å¯ä»¥è¯»å–</span><br><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chmod</span> a+r /etc/apt/keyrings/docker.asc<br></code></pre></td></tr></table></figure><h4 id="4-æ·»åŠ -Docker-è½¯ä»¶æº"><a href="#4-æ·»åŠ -Docker-è½¯ä»¶æº" class="headerlink" title="4. æ·»åŠ  Docker è½¯ä»¶æº"></a>4. æ·»åŠ  Docker è½¯ä»¶æº</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> \<br>  <span class="hljs-string">&quot;deb [arch=<span class="hljs-subst">$(dpkg --print-architecture)</span> signed-by=/etc/apt/keyrings/docker.asc] http://mirrors.aliyun.com/docker-ce/linux/ubuntu \</span><br><span class="hljs-string">  <span class="hljs-subst">$(. /etc/os-release &amp;&amp; echo <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;UBUNTU_CODENAME:-<span class="hljs-variable">$VERSION_CODENAME</span>&#125;</span>&quot;</span>)</span> stable&quot;</span> | \<br>  <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">tee</span> /etc/apt/sources.list.d/docker.list &gt; /dev/null<br></code></pre></td></tr></table></figure><h4 id="5-å®‰è£…-Docker"><a href="#5-å®‰è£…-Docker" class="headerlink" title="5. å®‰è£… Docker"></a>5. å®‰è£… Docker</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ›´æ–°è½¯ä»¶åŒ…ç´¢å¼•</span><br><span class="hljs-built_in">sudo</span> apt update<br><br><span class="hljs-comment"># å®‰è£… Docker æœ€æ–°ç‰ˆæœ¬</span><br><span class="hljs-built_in">sudo</span> apt install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin<br></code></pre></td></tr></table></figure><h4 id="6-é…ç½®å›½å†…é•œåƒæº"><a href="#6-é…ç½®å›½å†…é•œåƒæº" class="headerlink" title="6. é…ç½®å›½å†…é•œåƒæº"></a>6. é…ç½®å›½å†…é•œåƒæº</h4><p>ä¸ºäº†æå‡æ‹‰å– Docker é•œåƒçš„é€Ÿåº¦ï¼Œå»ºè®®é…ç½®å›½å†…é•œåƒæºã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">tee</span> /etc/docker/daemon.json &gt; /dev/null &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">&#123;</span><br><span class="hljs-string">  &quot;registry-mirrors&quot;: [</span><br><span class="hljs-string">    &quot;https://docker.m.daocloud.io&quot;,</span><br><span class="hljs-string">    &quot;http://hub-mirror.c.163.com&quot;,</span><br><span class="hljs-string">    &quot;https://docker.nju.edu.cn&quot;</span><br><span class="hljs-string">  ]</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure><h4 id="7-é‡å¯å¹¶éªŒè¯-Docker"><a href="#7-é‡å¯å¹¶éªŒè¯-Docker" class="headerlink" title="7. é‡å¯å¹¶éªŒè¯ Docker"></a>7. é‡å¯å¹¶éªŒè¯ Docker</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># é‡å¯ Docker æœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆ</span><br><span class="hljs-built_in">sudo</span> systemctl restart docker<br><br><span class="hljs-comment"># è®¾ç½® Docker å¼€æœºè‡ªå¯</span><br><span class="hljs-built_in">sudo</span> systemctl <span class="hljs-built_in">enable</span> docker<br><br><span class="hljs-comment"># éªŒè¯ Docker æ˜¯å¦å®‰è£…æˆåŠŸå¹¶å¯ä»¥æ­£å¸¸è¿è¡Œ</span><br><span class="hljs-built_in">sudo</span> docker run hello-world<br></code></pre></td></tr></table></figure><p>å¦‚æœèƒ½çœ‹åˆ° â€œHello from Docker!â€ å­—æ ·ï¼Œè¯´æ˜ Docker å·²æˆåŠŸå®‰è£…ã€‚</p><hr><h2 id="æ­¥éª¤äºŒï¼šä½¿ç”¨-Docker-å®‰è£…-Koishi"><a href="#æ­¥éª¤äºŒï¼šä½¿ç”¨-Docker-å®‰è£…-Koishi" class="headerlink" title="æ­¥éª¤äºŒï¼šä½¿ç”¨ Docker å®‰è£… Koishi"></a>æ­¥éª¤äºŒï¼šä½¿ç”¨ Docker å®‰è£… Koishi</h2><p>è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å¯åŠ¨ Koishi å®¹å™¨ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -d \<br>  --name koishi \<br>  --restart always \<br>  -p 5140:5140 \<br>  -v /root/koishi_data:/koishi \<br>  -e TZ=Asia/Shanghai \<br>  koishijs/koishi<br></code></pre></td></tr></table></figure><p><strong>å‚æ•°è¯´æ˜:</strong></p><ul><li><code>-d</code>: åå°è¿è¡Œå®¹å™¨ã€‚</li><li><code>--name koishi</code>: å°†å®¹å™¨å‘½åä¸º <code>koishi</code>ï¼Œæ–¹ä¾¿ç®¡ç†ã€‚</li><li><code>--restart always</code>: å®¹å™¨é€€å‡ºæ—¶æ€»æ˜¯è‡ªåŠ¨é‡å¯ã€‚</li><li><code>-p 5140:5140</code>: å°†å®¿ä¸»æœºçš„ 5140 ç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„ 5140 ç«¯å£ã€‚</li><li><code>-v /root/koishi_data:/koishi</code>: å°† Koishi çš„æ•°æ®ï¼ˆé…ç½®ã€æ’ä»¶ç­‰ï¼‰æŒä¹…åŒ–åˆ°å®¿ä¸»æœºçš„ <code>/root/koishi_data</code> ç›®å½•ã€‚</li><li><code>-e TZ=Asia/Shanghai</code>: è®¾ç½®æ—¶åŒºä¸ºä¸œå…«åŒºï¼Œç¡®ä¿æ—¥å¿—æ—¶é—´æ­£ç¡®ã€‚</li></ul><blockquote><p>å®¹å™¨è¿è¡Œåï¼Œç¨ç­‰ç‰‡åˆ»å³å¯é€šè¿‡æµè§ˆå™¨è®¿é—® <code>http://&lt;ä½ çš„æœåŠ¡å™¨IP&gt;:5140</code> è¿›å…¥ Koishi æ§åˆ¶å°ã€‚</p></blockquote><hr><h2 id="æ­¥éª¤ä¸‰ï¼šå®‰è£…å¹¶è¿è¡Œ-NapCat"><a href="#æ­¥éª¤ä¸‰ï¼šå®‰è£…å¹¶è¿è¡Œ-NapCat" class="headerlink" title="æ­¥éª¤ä¸‰ï¼šå®‰è£…å¹¶è¿è¡Œ NapCat"></a>æ­¥éª¤ä¸‰ï¼šå®‰è£…å¹¶è¿è¡Œ NapCat</h2><h4 id="1-ä¸€é”®å®‰è£…-NapCat"><a href="#1-ä¸€é”®å®‰è£…-NapCat" class="headerlink" title="1. ä¸€é”®å®‰è£… NapCat"></a>1. ä¸€é”®å®‰è£… NapCat</h4><p>ä½¿ç”¨å®˜æ–¹æä¾›çš„ä¸€é”®å®‰è£…è„šæœ¬ï¼Œä»¥ TUI (ç»ˆç«¯å›¾å½¢ç•Œé¢) æ¨¡å¼è¿›è¡Œå®‰è£…ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -o napcat.sh https://nclatest.znin.net/NapNeko/NapCat-Installer/main/script/install.sh &amp;&amp; <span class="hljs-built_in">sudo</span> bash napcat.sh --tui<br></code></pre></td></tr></table></figure><p>æ ¹æ®æç¤ºå®Œæˆå®‰è£…å³å¯ã€‚</p><h4 id="2-åå°è¿è¡Œ-NapCat"><a href="#2-åå°è¿è¡Œ-NapCat" class="headerlink" title="2. åå°è¿è¡Œ NapCat"></a>2. åå°è¿è¡Œ NapCat</h4><p>ä¸ºäº†è®© NapCat èƒ½åœ¨å…³é—­ SSH è¿æ¥åä¾ç„¶ä¿æŒè¿è¡Œï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>screen</code> å·¥å…·ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å¯åŠ¨ä¸€ä¸ªåä¸º napcat çš„åå°ä¼šè¯ï¼Œå¹¶è¿è¡Œ NapCat</span><br>screen -dmS napcat bash -c <span class="hljs-string">&quot;xvfb-run -a /root/Napcat/opt/QQ/qq --no-sandbox&quot;</span><br><br><span class="hljs-comment"># å¦‚æœéœ€è¦é™„åŠ åˆ°ä¼šè¯æŸ¥çœ‹æ—¥å¿—æˆ–æ‰«ç </span><br>screen -r napcat<br></code></pre></td></tr></table></figure><blockquote><p><strong>æç¤º</strong>ï¼šåœ¨ <code>screen</code> ä¼šè¯ä¸­ï¼ŒæŒ‰ <code>Ctrl+A</code> ç„¶åæŒ‰ <code>D</code> å¯ä»¥åˆ†ç¦»ä¼šè¯ï¼ˆä½¿å…¶åœ¨åå°ç»§ç»­è¿è¡Œï¼‰ã€‚</p></blockquote><h4 id="3-ç™»å½•-QQ"><a href="#3-ç™»å½•-QQ" class="headerlink" title="3. ç™»å½• QQ"></a>3. ç™»å½• QQ</h4><p>è®¿é—® <code>http://&lt;ä½ çš„æœåŠ¡å™¨IP&gt;:6099/webui</code>ï¼Œè¿›å…¥ NapCat çš„ WebUIï¼Œä½¿ç”¨æ‰‹æœº QQ æ‰«æäºŒç»´ç ç™»å½•ã€‚</p><hr><h2 id="æ­¥éª¤å››ï¼šè¿æ¥-Koishi-ä¸-NapCat"><a href="#æ­¥éª¤å››ï¼šè¿æ¥-Koishi-ä¸-NapCat" class="headerlink" title="æ­¥éª¤å››ï¼šè¿æ¥ Koishi ä¸ NapCat"></a>æ­¥éª¤å››ï¼šè¿æ¥ Koishi ä¸ NapCat</h2><h4 id="1-NapCat-ä¸­å¼€å¯-WebSocket-æœåŠ¡"><a href="#1-NapCat-ä¸­å¼€å¯-WebSocket-æœåŠ¡" class="headerlink" title="1. NapCat ä¸­å¼€å¯ WebSocket æœåŠ¡"></a>1. NapCat ä¸­å¼€å¯ WebSocket æœåŠ¡</h4><p>è¿›å…¥ NapCat WebUI (<code>http://&lt;ä½ çš„æœåŠ¡å™¨IP&gt;:6099/webui</code>) åï¼š</p><ol><li>ç‚¹å‡»å·¦ä¾§çš„ã€Œ<strong>ç½‘ç»œé…ç½®</strong>ã€ã€‚</li><li>ç‚¹å‡»å·¦ä¸Šè§’çš„ã€Œ<strong>æ·»åŠ é…ç½®</strong>ã€ã€‚</li><li>æ–°å»ºä¸€ä¸ªã€Œ<strong>æ­£å‘ Websocket æœåŠ¡å™¨</strong>ã€ï¼Œæ ¼å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç„¶åä¿å­˜ã€‚</li></ol><p><img src="/images/Koishi/websocket_server.png" alt="NapCat WebSocket é…ç½®"></p><h4 id="2-Koishi-ä¸­å®‰è£…-OneBot-é€‚é…å™¨"><a href="#2-Koishi-ä¸­å®‰è£…-OneBot-é€‚é…å™¨" class="headerlink" title="2. Koishi ä¸­å®‰è£… OneBot é€‚é…å™¨"></a>2. Koishi ä¸­å®‰è£… OneBot é€‚é…å™¨</h4><p>NapCat å…¼å®¹ OneBot v11 åè®®ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨ Koishi ä¸­å®‰è£…ç›¸åº”çš„é€‚é…å™¨ã€‚</p><ol><li>è¿›å…¥ Koishi æ§åˆ¶å° (<code>http://&lt;ä½ çš„æœåŠ¡å™¨IP&gt;:5140</code>)ã€‚</li><li>åœ¨å·¦ä¾§èœå•ä¸­ç‚¹å‡»ã€Œ<strong>æ’ä»¶å¸‚åœº</strong>ã€ã€‚</li><li>æœç´¢ <code>adapter-onebot</code> å¹¶å®‰è£…å®ƒã€‚</li></ol><h4 id="3-é…ç½®-OneBot-é€‚é…å™¨"><a href="#3-é…ç½®-OneBot-é€‚é…å™¨" class="headerlink" title="3. é…ç½® OneBot é€‚é…å™¨"></a>3. é…ç½® OneBot é€‚é…å™¨</h4><p>å®‰è£…å®Œæˆåï¼ŒKoishi ä¼šè‡ªåŠ¨è·³è½¬åˆ°é…ç½®é¡µé¢ï¼ˆæˆ–åœ¨ã€Œæ’ä»¶é…ç½®ã€ä¸­æ‰¾åˆ° <code>adapter-onebot</code>ï¼‰ã€‚</p><ol><li>ç‚¹å‡»ã€Œ<strong>æ·»åŠ æœºå™¨äºº</strong>ã€ã€‚</li><li>åœ¨å¼¹å‡ºçš„è¡¨å•ä¸­ï¼Œå…³é”®é…ç½®å¦‚ä¸‹ï¼š<ul><li><strong><code>protocol</code></strong>: é€‰æ‹© <code>ws</code> (æ­£å‘ WebSocket)ã€‚</li><li><strong><code>endpoint</code></strong>: å¡«å†™ NapCat çš„ WebSocket åœ°å€ï¼Œå³ <code>ws://127.0.0.1:3000</code>ã€‚<blockquote><p><strong>æ³¨æ„</strong>ï¼šå› ä¸º Koishi å’Œ NapCat è¿è¡Œåœ¨åŒä¸€å°æœåŠ¡å™¨çš„ Docker ç½‘ç»œä¸­ï¼Œæ­¤å¤„å»ºè®®ä½¿ç”¨ <code>ws://host.docker.internal:3000</code> æˆ–å®¿ä¸»æœºå†…ç½‘IPï¼Œ<code>127.0.0.1</code> å¯èƒ½æ— æ³•è®¿é—®ã€‚æœ€ç¨³å¦¥çš„æ–¹å¼æ˜¯ç›´æ¥ä½¿ç”¨æœåŠ¡å™¨çš„å…¬ç½‘IPï¼Œä¾‹å¦‚ <code>ws://&lt;ä½ çš„æœåŠ¡å™¨IP&gt;:3000</code>ã€‚</p></blockquote></li></ul></li><li>ä¿å­˜é…ç½®å¹¶å¯ç”¨è¯¥æ’ä»¶ã€‚</li></ol><p>å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œä½ åº”è¯¥èƒ½åœ¨ Koishi æ§åˆ¶å°çš„ã€Œè¿æ¥ã€é¡µé¢çœ‹åˆ°çŠ¶æ€ä¸ºã€ŒONLINEã€çš„æœºå™¨äººã€‚</p><hr><h2 id="âœ…-å®Œæˆ"><a href="#âœ…-å®Œæˆ" class="headerlink" title="âœ… å®Œæˆ"></a>âœ… å®Œæˆ</h2><p>è‡³æ­¤ï¼ŒKoishi å’Œ NapCat çš„é…ç½®å·²å…¨éƒ¨å®Œæˆã€‚ä½ çš„ QQ æœºå™¨äººå·²ç»å¯ä»¥æ¥æ”¶å’Œå‘é€æ¶ˆæ¯äº†ã€‚æ¥ä¸‹æ¥ï¼Œä½ å¯ä»¥åœ¨ Koishi çš„æ’ä»¶å¸‚åœºä¸­æ¢ç´¢å’Œå®‰è£…å„ç§æœ‰è¶£çš„åŠŸèƒ½æ’ä»¶ï¼Œæ‰“é€ å±äºä½ è‡ªå·±çš„å¼ºå¤§æœºå™¨äººï¼</p><hr><h2 id="é™„å½•ï¼šå¸¸ç”¨-Docker-å‘½ä»¤"><a href="#é™„å½•ï¼šå¸¸ç”¨-Docker-å‘½ä»¤" class="headerlink" title="é™„å½•ï¼šå¸¸ç”¨ Docker å‘½ä»¤"></a>é™„å½•ï¼šå¸¸ç”¨ Docker å‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æŸ¥çœ‹æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨</span><br>docker ps<br><br><span class="hljs-comment"># æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬å·²åœæ­¢çš„ï¼‰</span><br>docker ps -a<br><br><span class="hljs-comment"># å¯åŠ¨ä¸€ä¸ªå·²åœæ­¢çš„å®¹å™¨</span><br>docker start &lt;å®¹å™¨IDæˆ–åç§°&gt;<br><br><span class="hljs-comment"># åœæ­¢ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨</span><br>docker stop &lt;å®¹å™¨IDæˆ–åç§°&gt;<br><br><span class="hljs-comment"># é‡å¯ä¸€ä¸ªå®¹å™¨</span><br>docker restart &lt;å®¹å™¨IDæˆ–åç§°&gt;<br><br><span class="hljs-comment"># è¿›å…¥ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨çš„å‘½ä»¤è¡Œ</span><br>docker <span class="hljs-built_in">exec</span> -it &lt;å®¹å™¨IDæˆ–åç§°&gt; /bin/sh<br></code></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> èŠå¤©æœºå™¨äºº </tag>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨Hexoé€šè¿‡GitHub Pagesæ­å»ºåšå®¢</title>
      <link href="/2025/10/30/Blogs/Blogs/"/>
      <url>/2025/10/30/Blogs/Blogs/</url>
      
        <content type="html"><![CDATA[<h1 id="ä½¿ç”¨-Hexo-æ­å»ºä¸ªäººåšå®¢"><a href="#ä½¿ç”¨-Hexo-æ­å»ºä¸ªäººåšå®¢" class="headerlink" title="ä½¿ç”¨ Hexo æ­å»ºä¸ªäººåšå®¢"></a>ä½¿ç”¨ Hexo æ­å»ºä¸ªäººåšå®¢</h1><p>ä½¿ç”¨ Hexo å¿«é€Ÿæ­å»ºä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ä¸ªäººåšå®¢ã€‚</p><h2 id="1-ç¯å¢ƒå‡†å¤‡"><a href="#1-ç¯å¢ƒå‡†å¤‡" class="headerlink" title="1. ç¯å¢ƒå‡†å¤‡"></a>1. ç¯å¢ƒå‡†å¤‡</h2><p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿ç”µè„‘ä¸Šå·²ç»å®‰è£…äº† <a href="https://nodejs.org/">Node.js</a> (æ¨èä½¿ç”¨ LTS ç‰ˆæœ¬) å’Œ <a href="https://git-scm.com/">Git</a>ã€‚</p><h2 id="2-Hexo-å®‰è£…ä¸åˆå§‹åŒ–"><a href="#2-Hexo-å®‰è£…ä¸åˆå§‹åŒ–" class="headerlink" title="2. Hexo å®‰è£…ä¸åˆå§‹åŒ–"></a>2. Hexo å®‰è£…ä¸åˆå§‹åŒ–</h2><ol><li><p><strong>åˆ›å»ºåšå®¢æ ¹ç›®å½•</strong><br>åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ä½œä¸ºåšå®¢çš„æ ¹ç›®å½•ï¼Œä¾‹å¦‚ <code>myblogs</code>ã€‚</p></li><li><p><strong>å…¨å±€å®‰è£… Hexo CLI</strong><br>æ‰“å¼€ç»ˆç«¯ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£… Hexo å‘½ä»¤è¡Œå·¥å…·ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install -g hexo-cli<br></code></pre></td></tr></table></figure></li><li><p><strong>åˆå§‹åŒ–åšå®¢é¡¹ç›®</strong><br>è¿›å…¥åˆ›å»ºçš„åšå®¢æ ¹ç›®å½•ï¼Œç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ Hexo é¡¹ç›®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">hexo init myblogs<br><span class="hljs-built_in">cd</span> myblogs<br>npm install<br></code></pre></td></tr></table></figure><ul><li><code>hexo init myblogs</code> ä¼šåœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º <code>myblogs</code> çš„æ–°æ–‡ä»¶å¤¹ï¼Œå¹¶ä¸‹è½½ Hexo çš„åŸºæœ¬æ–‡ä»¶ã€‚</li><li><code>cd myblogs</code> è¿›å…¥åšå®¢é¡¹ç›®ç›®å½•ã€‚</li><li><code>npm install</code> ä¼šæ ¹æ® <code>package.json</code> æ–‡ä»¶å®‰è£…é¡¹ç›®æ‰€éœ€çš„ä¾èµ–ã€‚</li></ul></li></ol><h2 id="3-æœ¬åœ°é¢„è§ˆ"><a href="#3-æœ¬åœ°é¢„è§ˆ" class="headerlink" title="3. æœ¬åœ°é¢„è§ˆ"></a>3. æœ¬åœ°é¢„è§ˆ</h2><p>æœ¬åœ°é¢„è§ˆåšå®¢æ•ˆæœï¼Œåªéœ€ä¸€è¡Œå‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">hexo server<br></code></pre></td></tr></table></figure><p>ç„¶åç”¨æµè§ˆå™¨è®¿é—® <code>http://localhost:4000</code>ï¼Œå³å¯çœ‹åˆ°é»˜è®¤ä¸»é¢˜ä¸‹çš„åšå®¢äº†ã€‚</p><h2 id="4-éƒ¨ç½²åˆ°-GitHub-Pages"><a href="#4-éƒ¨ç½²åˆ°-GitHub-Pages" class="headerlink" title="4. éƒ¨ç½²åˆ° GitHub Pages"></a>4. éƒ¨ç½²åˆ° GitHub Pages</h2><ol><li><p><strong>å®‰è£… Git éƒ¨ç½²æ’ä»¶</strong><br>ä¸ºäº†èƒ½å°†åšå®¢éƒ¨ç½²åˆ° GitHub Pagesï¼Œéœ€è¦å®‰è£… <code>hexo-deployer-git</code> æ’ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install hexo-deployer-git --save<br></code></pre></td></tr></table></figure></li><li><p><strong>é…ç½® <code>_config.yml</code></strong><br>æ‰“å¼€åšå®¢æ ¹ç›®å½•ä¸‹çš„ <code>_config.yml</code> æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶æœ«å°¾æ‰¾åˆ° <code>deploy</code> é…ç½®é¡¹ï¼Œå¹¶ä¿®æ”¹ä¸ºå¯¹åº”çš„ GitHub ä»“åº“åœ°å€ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">deploy:</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">git</span><br>  <span class="hljs-attr">repo:</span> <span class="hljs-string">&lt;GitHub</span> <span class="hljs-string">ä»“åº“åœ°å€&gt;</span> <span class="hljs-comment"># ä¾‹å¦‚: https://github.com/user/repo.git</span><br>  <span class="hljs-attr">branch:</span> [<span class="hljs-string">branch</span>] <span class="hljs-comment"># ä¾‹å¦‚: main</span><br></code></pre></td></tr></table></figure></li><li><p><strong>ä¸€é”®éƒ¨ç½²</strong><br>ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå®Œæˆéƒ¨ç½²ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">hexo clean      <span class="hljs-comment"># æ¸…ç†ç¼“å­˜</span><br>hexo generate   <span class="hljs-comment"># ç”Ÿæˆé™æ€æ–‡ä»¶</span><br>hexo deploy     <span class="hljs-comment"># éƒ¨ç½²åˆ°è¿œç«¯</span><br></code></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œè®¿é—® GitHub Pages åœ°å€ï¼Œå°±èƒ½çœ‹åˆ°åšå®¢äº†ï¼</p></li></ol><h2 id="5-æ’°å†™æ–°æ–‡ç« "><a href="#5-æ’°å†™æ–°æ–‡ç« " class="headerlink" title="5. æ’°å†™æ–°æ–‡ç« "></a>5. æ’°å†™æ–°æ–‡ç« </h2><ol><li><p><strong>åˆ›å»ºæ–°æ–‡ç« </strong><br>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥åˆ›å»ºä¸€ç¯‡æ–°çš„æ–‡ç« ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">hexo new <span class="hljs-string">&quot;æˆ‘çš„ç¬¬ä¸€ç¯‡æ–‡ç« &quot;</span><br></code></pre></td></tr></table></figure><p>è¿™ä¼šåœ¨ <code>source/_posts</code> ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª <code>æˆ‘çš„ç¬¬ä¸€ç¯‡æ–‡ç« .md</code> æ–‡ä»¶ã€‚</p></li><li><p><strong>å¼€å§‹å†™ä½œ</strong><br>ä½¿ç”¨ Markdown ç¼–è¾‘å™¨æ‰“å¼€è¯¥æ–‡ä»¶ï¼Œå³å¯å¼€å§‹åˆ›ä½œã€‚</p></li></ol><hr>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blogs </tag>
            
            <tag> Hexo </tag>
            
            <tag> Github Pages </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gemini CLI é…ç½®</title>
      <link href="/2025/10/30/Gmini%20CLI/Gemini%20CLI/"/>
      <url>/2025/10/30/Gmini%20CLI/Gemini%20CLI/</url>
      
        <content type="html"><![CDATA[<h1 id="Gemini-CLI-å®‰è£…æŒ‡å—"><a href="#Gemini-CLI-å®‰è£…æŒ‡å—" class="headerlink" title="Gemini CLI å®‰è£…æŒ‡å—"></a>Gemini CLI å®‰è£…æŒ‡å—</h1><h2 id="1-å®‰è£…-Node-js"><a href="#1-å®‰è£…-Node-js" class="headerlink" title="1. å®‰è£… Node.js"></a>1. å®‰è£… Node.js</h2><p>Gemini CLI éœ€è¦ Node.js è¿è¡Œç¯å¢ƒã€‚æ¨èä½¿ç”¨ <code>nvm</code> (Node Version Manager) æ¥å®‰è£…å’Œç®¡ç† Node.js ç‰ˆæœ¬ã€‚</p><h3 id="1-1-å®‰è£…-nvm"><a href="#1-1-å®‰è£…-nvm" class="headerlink" title="1.1. å®‰è£… nvm"></a>1.1. å®‰è£… nvm</h3><ul><li><strong>Windows:</strong><ul><li>ä» <a href="https://github.com/coreybutler/nvm-windows/releases">nvm-windows</a> ä¸‹è½½å¹¶è¿è¡Œæœ€æ–°çš„å®‰è£…ç¨‹åºã€‚</li></ul></li><li><strong>macOS &#x2F; Linux:</strong><ul><li>æ‰“å¼€ç»ˆç«¯å¹¶è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash<br></code></pre></td></tr></table></figure></li><li>å…³é—­å¹¶é‡æ–°æ‰“å¼€ç»ˆç«¯ã€‚</li></ul></li></ul><h3 id="1-2-ä½¿ç”¨-nvm-å®‰è£…-Node-js"><a href="#1-2-ä½¿ç”¨-nvm-å®‰è£…-Node-js" class="headerlink" title="1.2. ä½¿ç”¨ nvm å®‰è£… Node.js"></a>1.2. ä½¿ç”¨ nvm å®‰è£… Node.js</h3><p>å®‰è£… <code>nvm</code> åï¼Œåœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…æœ€æ–°çš„ Node.js LTS ç‰ˆæœ¬ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">nvm install --lts<br>nvm use --lts<br></code></pre></td></tr></table></figure><p>éªŒè¯ Node.js æ˜¯å¦å®‰è£…æˆåŠŸï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">node --version<br>npm --version<br></code></pre></td></tr></table></figure><h2 id="2-å®‰è£…-Gemini-CLI"><a href="#2-å®‰è£…-Gemini-CLI" class="headerlink" title="2. å®‰è£… Gemini CLI"></a>2. å®‰è£… Gemini CLI</h2><p>ä½¿ç”¨ <code>npm</code> (Node Package Manager) å…¨å±€å®‰è£… Gemini CLIï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install -g @google/gemini-cli<br></code></pre></td></tr></table></figure><p>å®‰è£…å®Œæˆåï¼ŒéªŒè¯ Gemini CLI æ˜¯å¦å®‰è£…æˆåŠŸï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gemini --version<br></code></pre></td></tr></table></figure><h2 id="3-å®‰è£…-VS-Code-æ‹“å±•"><a href="#3-å®‰è£…-VS-Code-æ‹“å±•" class="headerlink" title="3. å®‰è£… VS Code æ‹“å±•"></a>3. å®‰è£… VS Code æ‹“å±•</h2><p>ä¸ºäº†åœ¨ VS Code ä¸­è·å¾—æ›´å¥½çš„ä½“éªŒï¼Œå¯ä»¥å®‰è£…å®˜æ–¹çš„ Gemini CLI è¾…åŠ©æ‹“å±•ã€‚</p><p>åœ¨ VS Code çš„æ‹“å±•å¸‚åœºä¸­æœç´¢å¹¶å®‰è£… â€œGemini CLI Companionâ€ã€‚</p><h2 id="4-é…ç½®-Google-Cloud-ç¯å¢ƒ"><a href="#4-é…ç½®-Google-Cloud-ç¯å¢ƒ" class="headerlink" title="4. é…ç½® Google Cloud ç¯å¢ƒ"></a>4. é…ç½® Google Cloud ç¯å¢ƒ</h2><p>Gemini CLI éœ€è¦ä¸€ä¸ª Google Cloud é¡¹ç›®æ¥è¿›è¡Œèº«ä»½éªŒè¯å’Œè®¡è´¹ã€‚</p><h3 id="4-1-åˆ›å»ºæˆ–é€‰æ‹©-Google-Cloud-é¡¹ç›®"><a href="#4-1-åˆ›å»ºæˆ–é€‰æ‹©-Google-Cloud-é¡¹ç›®" class="headerlink" title="4.1. åˆ›å»ºæˆ–é€‰æ‹© Google Cloud é¡¹ç›®"></a>4.1. åˆ›å»ºæˆ–é€‰æ‹© Google Cloud é¡¹ç›®</h3><ol><li>è®¿é—® <a href="https://console.cloud.google.com/">Google Cloud Console</a>ã€‚</li><li>å¦‚æœæ‚¨è¿˜æ²¡æœ‰é¡¹ç›®ï¼Œè¯·åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ã€‚</li><li>è®°ä¸‹æ‚¨çš„ <strong>Project ID</strong>ã€‚</li></ol><h3 id="4-2-å¯ç”¨æ‰€éœ€çš„-API"><a href="#4-2-å¯ç”¨æ‰€éœ€çš„-API" class="headerlink" title="4.2. å¯ç”¨æ‰€éœ€çš„ API"></a>4.2. å¯ç”¨æ‰€éœ€çš„ API</h3><p>æ‚¨éœ€è¦ä¸ºæ‚¨çš„é¡¹ç›®å¯ç”¨ â€œGemini for Google Cloudâ€ã€‚</p><ol><li>åœ¨ Google Cloud Console ä¸­ï¼Œå¯¼èˆªåˆ° â€œAPIs &amp; Servicesâ€ &gt; â€œLibraryâ€ã€‚</li><li>æœç´¢ â€œGemini for Google Cloudâ€ å¹¶å¯ç”¨å®ƒã€‚</li></ol><h3 id="4-3-é…ç½®æœ¬åœ°ç¯å¢ƒ"><a href="#4-3-é…ç½®æœ¬åœ°ç¯å¢ƒ" class="headerlink" title="4.3. é…ç½®æœ¬åœ°ç¯å¢ƒ"></a>4.3. é…ç½®æœ¬åœ°ç¯å¢ƒ</h3><p>é…ç½®ç³»ç»Ÿç¯å¢ƒå˜é‡ GOOGLE_CLOUD_PROJECTï¼Œå€¼ä¸º <strong>Project ID</strong>ã€‚</p><h2 id="5-å¼€å§‹ä½¿ç”¨-Gemini-CLI"><a href="#5-å¼€å§‹ä½¿ç”¨-Gemini-CLI" class="headerlink" title="5. å¼€å§‹ä½¿ç”¨ Gemini CLI"></a>5. å¼€å§‹ä½¿ç”¨ Gemini CLI</h2><p>ç°åœ¨æ‚¨å¯ä»¥å¼€å§‹ä½¿ç”¨ Gemini CLI äº†ã€‚åœ¨ç»ˆç«¯ä¸­è¿è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gemini<br></code></pre></td></tr></table></figure><p>è¿™ä¼šå¯åŠ¨ä¸€ä¸ªäº¤äº’å¼çš„ä¼šè¯ã€‚æ‚¨ä¹Ÿå¯ä»¥ç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ <code>gemini</code> å‘½ä»¤ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gemini <span class="hljs-string">&quot;ä½ å¥½&quot;</span><br></code></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Gemini CLI </tag>
            
            <tag> VS Code </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MCP Serverå…¥é—¨ä½“éªŒ</title>
      <link href="/2025/10/30/MCP/MCP/"/>
      <url>/2025/10/30/MCP/MCP/</url>
      
        <content type="html"><![CDATA[<h1 id="MCP-æ¨¡å‹ä¸Šä¸‹æ–‡åè®®-ç®€ä»‹"><a href="#MCP-æ¨¡å‹ä¸Šä¸‹æ–‡åè®®-ç®€ä»‹" class="headerlink" title="MCP (æ¨¡å‹ä¸Šä¸‹æ–‡åè®®) ç®€ä»‹"></a>MCP (æ¨¡å‹ä¸Šä¸‹æ–‡åè®®) ç®€ä»‹</h1><p>MCP èµ·æºäº 2024 å¹´ 11 æœˆ 25 æ—¥ Anthropic å‘å¸ƒçš„æ–‡ç« ï¼š<a href="https://www.anthropic.com/news/model-context-protocol">Introducing the Model Context Protocol</a><br>MCP æ˜¯ä¸€ä¸ªå¼€æ”¾åè®®ï¼Œå®ƒä¸ºåº”ç”¨ç¨‹åºå‘ LLM æä¾›ä¸Šä¸‹æ–‡çš„æ–¹å¼è¿›è¡Œäº†æ ‡å‡†åŒ–ã€‚ä½ å¯ä»¥å°† MCP æƒ³è±¡æˆ AI åº”ç”¨ç¨‹åºçš„ USB-C æ¥å£ã€‚å°±åƒ USB-C ä¸ºè®¾å¤‡è¿æ¥å„ç§å¤–è®¾å’Œé…ä»¶æä¾›äº†æ ‡å‡†åŒ–çš„æ–¹å¼ä¸€æ ·ï¼ŒMCP ä¸º AI æ¨¡å‹è¿æ¥å„ç§æ•°æ®æºå’Œå·¥å…·æä¾›äº†æ ‡å‡†åŒ–çš„æ¥å£ã€‚<br>MCP æœåŠ¡å™¨å¯ä»¥ï¼š</p><ul><li>é€šè¿‡ <strong>Resources</strong> å…¬å¼€æ•°æ®ï¼ˆå¯ä»¥å°†å…¶è§†ä¸ºç±»ä¼¼ GET ç«¯ç‚¹ï¼›ç”¨äºå°†ä¿¡æ¯åŠ è½½åˆ° LLM çš„ä¸Šä¸‹æ–‡ä¸­ï¼‰</li><li>é€šè¿‡ <strong>Tools</strong> æä¾›åŠŸèƒ½ï¼ˆç±»ä¼¼ POST ç«¯ç‚¹ï¼›ç”¨äºæ‰§è¡Œä»£ç æˆ–äº§ç”Ÿå‰¯ä½œç”¨ï¼‰</li><li>é€šè¿‡ <strong>Prompts</strong> å®šä¹‰äº¤äº’æ¨¡å¼ï¼ˆLLM äº¤äº’çš„å¯é‡ç”¨æ¨¡æ¿ï¼‰</li></ul><h1 id="ä¸ºä»€ä¹ˆé€‰æ‹©-MCPï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆé€‰æ‹©-MCPï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆé€‰æ‹© MCPï¼Ÿ"></a>ä¸ºä»€ä¹ˆé€‰æ‹© MCPï¼Ÿ</h1><p>æˆ‘è®¤ä¸º MCP çš„å‡ºç°æ˜¯ prompt engineering å‘å±•çš„äº§ç‰©ã€‚æ›´ç»“æ„åŒ–çš„ä¸Šä¸‹æ–‡ä¿¡æ¯å¯¹æ¨¡å‹çš„æ•ˆæœæå‡æ˜¯æ˜¾è‘—çš„ã€‚æˆ‘ä»¬åœ¨æ„é€  prompt æ—¶ï¼Œå¸Œæœ›èƒ½æä¾›ä¸€äº›æ›´ç‰¹æ®Šçš„ä¿¡æ¯ï¼ˆæ¯”å¦‚æœ¬åœ°æ–‡ä»¶ï¼Œæ•°æ®åº“ï¼Œä¸€äº›ç½‘ç»œå®æ—¶ä¿¡æ¯ç­‰ï¼‰ç»™æ¨¡å‹ï¼Œè¿™æ ·æ¨¡å‹æ›´å®¹æ˜“ç†è§£çœŸå®åœºæ™¯ä¸­çš„é—®é¢˜ã€‚</p><p><strong>æƒ³è±¡ä¸€ä¸‹æ²¡æœ‰ MCP ä¹‹å‰æˆ‘ä»¬ä¼šæ€ä¹ˆåšï¼Ÿ</strong> æˆ‘ä»¬å¯èƒ½ä¼šäººå·¥ä»æ•°æ®åº“ä¸­ç­›é€‰æˆ–è€…ä½¿ç”¨å·¥å…·æ£€ç´¢å¯èƒ½éœ€è¦çš„ä¿¡æ¯ï¼Œæ‰‹åŠ¨çš„ç²˜è´´åˆ° prompt ä¸­ã€‚éšç€æˆ‘ä»¬è¦è§£å†³çš„é—®é¢˜è¶Šæ¥è¶Šå¤æ‚ï¼Œæ‰‹å·¥æŠŠä¿¡æ¯å¼•å…¥åˆ° prompt ä¸­ä¼šå˜å¾—è¶Šæ¥è¶Šå›°éš¾ã€‚</p><p>ä¸ºäº†å…‹æœæ‰‹å·¥ prompt çš„å±€é™æ€§ï¼Œè®¸å¤š LLM å¹³å°ï¼ˆå¦‚ OpenAIã€Googleï¼‰å¼•å…¥äº† function callï¼ˆå°†è‡ªç„¶è¯­è¨€è½¬æ¢ä¸º API è°ƒç”¨ï¼‰ åŠŸèƒ½ã€‚è¿™ä¸€æœºåˆ¶å…è®¸æ¨¡å‹åœ¨éœ€è¦æ—¶è°ƒç”¨é¢„å®šä¹‰çš„å‡½æ•°æ¥è·å–æ•°æ®æˆ–æ‰§è¡Œæ“ä½œï¼Œæ˜¾è‘—æå‡äº†è‡ªåŠ¨åŒ–æ°´å¹³ã€‚</p><p>å¯¹æ¯”ä¹‹ä¸‹ MCP çš„ä¼˜åŠ¿åœ¨äºï¼š<br><strong>ç”Ÿæ€</strong> - MCP æä¾›å¾ˆå¤šç°æˆçš„æ’ä»¶ <a href="https://mcpmarket.cn/">MCP Market</a>ï¼Œä½ çš„ AI å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚<br><strong>ç»Ÿä¸€æ€§</strong> - ä¸é™åˆ¶äºç‰¹å®šçš„ AI æ¨¡å‹ï¼Œä»»ä½•æ”¯æŒ MCP çš„æ¨¡å‹éƒ½å¯ä»¥çµæ´»åˆ‡æ¢ã€‚<br><strong>æ•°æ®å®‰å…¨</strong> - ä½ çš„æ•æ„Ÿæ•°æ®ç•™åœ¨è‡ªå·±çš„ç”µè„‘ä¸Šï¼Œä¸å¿…å…¨éƒ¨ä¸Šä¼ ã€‚ï¼ˆå› ä¸ºæˆ‘ä»¬å¯ä»¥è‡ªè¡Œè®¾è®¡æ¥å£ç¡®å®šä¼ è¾“å“ªäº›æ•°æ®ï¼‰</p><h1 id="é€šç”¨æ¶æ„"><a href="#é€šç”¨æ¶æ„" class="headerlink" title="é€šç”¨æ¶æ„"></a>é€šç”¨æ¶æ„</h1><p><img src="/images/mcp/jiagou.png" alt="MCPé€šç”¨æ¶æ„"><br>MCP æ ¸å¿ƒé‡‡ç”¨å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¶æ„ï¼Œä¸»æœºåº”ç”¨å¯ä»¥è¿æ¥å¤šä¸ªæœåŠ¡å™¨ï¼š</p><ul><li><strong>MCP Hosts</strong>: å¦‚ Claude Desktopã€IDE(VS Code, Pycharm) æˆ– AI å·¥å…·ï¼Œå¸Œæœ›é€šè¿‡ MCP è®¿é—®æ•°æ®çš„ç¨‹åº</li><li><strong>MCP Clients</strong>: ç»´æŠ¤ä¸æœåŠ¡å™¨ä¸€å¯¹ä¸€è¿æ¥çš„åè®®å®¢æˆ·ç«¯</li><li><strong>MCP Servers</strong>: è½»é‡çº§ç¨‹åºï¼Œé€šè¿‡æ ‡å‡†çš„ Model Context Protocol æä¾›ç‰¹å®šèƒ½åŠ›</li><li><strong>æœ¬åœ°æ•°æ®æº</strong>: MCP æœåŠ¡å™¨å¯å®‰å…¨è®¿é—®çš„è®¡ç®—æœºæ–‡ä»¶ã€æ•°æ®åº“å’ŒæœåŠ¡</li><li><strong>è¿œç¨‹æœåŠ¡</strong>: MCP æœåŠ¡å™¨å¯è¿æ¥çš„äº’è”ç½‘ä¸Šçš„å¤–éƒ¨ç³»ç»Ÿï¼ˆå¦‚é€šè¿‡ APIsï¼‰</li></ul><p>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå®é™…åœºæ™¯æ¥ç†è§£è¿™äº›ç»„ä»¶å¦‚ä½•ååŒå·¥ä½œï¼š<br>å‡è®¾ä½ æ­£åœ¨ä½¿ç”¨ VS Code (Host) è¯¢é—®ï¼šâ€æ›¼å“ˆé¡¿çš„å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿâ€</p><ul><li><strong>Host</strong>ï¼šVS Code ä½œä¸º Hostï¼Œè´Ÿè´£æ¥æ”¶ä½ çš„æé—®å¹¶ä¸ LLM äº¤äº’ã€‚</li><li><strong>Client</strong>ï¼šå½“ LLM æ¨¡å‹å†³å®šéœ€è¦è·å–å¤©æ°”ä¿¡æ¯æ—¶ï¼ŒHost ä¸­å†…ç½®çš„ MCP Client ä¼šè¢«æ¿€æ´»ã€‚è¿™ä¸ª Client è´Ÿè´£ä¸é€‚å½“çš„ MCP Server å»ºç«‹è¿æ¥ã€‚</li><li><strong>Server</strong>ï¼šåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ–‡ä»¶ç³»ç»Ÿ MCP Server ä¼šè¢«è°ƒç”¨ã€‚å®ƒè´Ÿè´£æŸ¥è¯¢å’Œæ ¼å¼åŒ–æ¥è‡ª National Weather Service API çš„æ•°æ®ã€‚</li></ul><p>æ•´ä¸ªæµç¨‹æ˜¯è¿™æ ·çš„ï¼šä½ çš„é—®é¢˜ â†’ VS Code(Host) â†’ LLM æ¨¡å‹ â†’ éœ€è¦å¤©æ°”ä¿¡æ¯ â†’ MCP Client è¿æ¥ â†’ å¤©æ°”ç³»ç»Ÿ MCP Server â†’ æ‰§è¡Œæ“ä½œ â†’ è¿”å›ç»“æœ â†’ LLM ç”Ÿæˆå›ç­” â†’ æ˜¾ç¤ºåœ¨ VS Code ä¸Šã€‚</p><p>è¿™ç§æ¶æ„è®¾è®¡ä½¿å¾— LLM å¯ä»¥åœ¨ä¸åŒåœºæ™¯ä¸‹çµæ´»è°ƒç”¨å„ç§å·¥å…·å’Œæ•°æ®æºï¼Œè€Œå¼€å‘è€…åªéœ€ä¸“æ³¨äºå¼€å‘å¯¹åº”çš„ MCP Serverï¼Œæ— éœ€å…³å¿ƒ Host å’Œ Client çš„å®ç°ç»†èŠ‚ã€‚</p><h1 id="é¢å‘æœåŠ¡å™¨å¼€å‘è€…"><a href="#é¢å‘æœåŠ¡å™¨å¼€å‘è€…" class="headerlink" title="é¢å‘æœåŠ¡å™¨å¼€å‘è€…"></a>é¢å‘æœåŠ¡å™¨å¼€å‘è€…</h1><p>ä½¿ç”¨ MCP ä½¿ LLM è·å–å¤©æ°”é¢„æŠ¥å’Œæ¶åŠ£å¤©æ°”è­¦æŠ¥çš„èƒ½åŠ›ã€‚</p><p>å¯¼å…¥ packages å¹¶è®¾ç½® instance</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Any</span><br><span class="hljs-keyword">import</span> httpx<br><span class="hljs-keyword">from</span> mcp.server.fastmcp <span class="hljs-keyword">import</span> FastMCP<br><br><span class="hljs-comment"># åˆå§‹åŒ– FastMCP server</span><br>mcp = FastMCP(<span class="hljs-string">&quot;weather&quot;</span>)<br><br><span class="hljs-comment"># Constants</span><br>NWS_API_BASE = <span class="hljs-string">&quot;https://api.weather.gov&quot;</span><br>USER_AGENT = <span class="hljs-string">&quot;weather-app/1.0&quot;</span><br></code></pre></td></tr></table></figure><h3 id="Helper-Functions"><a href="#Helper-Functions" class="headerlink" title="Helper Functions"></a>Helper Functions</h3><p>æ·»åŠ  Helper Functionsï¼Œç”¨äºæŸ¥è¯¢å’Œæ ¼å¼åŒ–æ¥è‡ª National Weather Service API çš„æ•°æ®ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">make_nws_request</span>(<span class="hljs-params">url: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>] | <span class="hljs-literal">None</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;å‘ NWS API å‘é€è¯·æ±‚ï¼Œå¹¶è¿›è¡Œé€‚å½“çš„é”™è¯¯å¤„ç†ã€‚&quot;&quot;&quot;</span><br>    headers = &#123;<br>        <span class="hljs-string">&quot;User-Agent&quot;</span>: USER_AGENT,<br>        <span class="hljs-string">&quot;Accept&quot;</span>: <span class="hljs-string">&quot;application/geo+json&quot;</span><br>    &#125;<br>    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> httpx.AsyncClient() <span class="hljs-keyword">as</span> client:<br>        <span class="hljs-keyword">try</span>:<br>            response = <span class="hljs-keyword">await</span> client.get(url, headers=headers, timeout=<span class="hljs-number">30.0</span>)<br>            response.raise_for_status()<br>            <span class="hljs-keyword">return</span> response.json()<br>        <span class="hljs-keyword">except</span> Exception:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">format_alert</span>(<span class="hljs-params">feature: <span class="hljs-built_in">dict</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;å°†è­¦æŠ¥ feature æ ¼å¼åŒ–ä¸ºå¯è¯»çš„å­—ç¬¦ä¸²ã€‚&quot;&quot;&quot;</span><br>    props = feature[<span class="hljs-string">&quot;properties&quot;</span>]<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;&quot;&quot;</span><br><span class="hljs-string">äº‹ä»¶: <span class="hljs-subst">&#123;props.get(<span class="hljs-string">&#x27;event&#x27;</span>, <span class="hljs-string">&#x27;Unknown&#x27;</span>)&#125;</span></span><br><span class="hljs-string">åŒºåŸŸ: <span class="hljs-subst">&#123;props.get(<span class="hljs-string">&#x27;areaDesc&#x27;</span>, <span class="hljs-string">&#x27;Unknown&#x27;</span>)&#125;</span></span><br><span class="hljs-string">ä¸¥é‡æ€§: <span class="hljs-subst">&#123;props.get(<span class="hljs-string">&#x27;severity&#x27;</span>, <span class="hljs-string">&#x27;Unknown&#x27;</span>)&#125;</span></span><br><span class="hljs-string">æè¿°: <span class="hljs-subst">&#123;props.get(<span class="hljs-string">&#x27;description&#x27;</span>, <span class="hljs-string">&#x27;No description available&#x27;</span>)&#125;</span></span><br><span class="hljs-string">æŒ‡ç¤º: <span class="hljs-subst">&#123;props.get(<span class="hljs-string">&#x27;instruction&#x27;</span>, <span class="hljs-string">&#x27;No specific instructions provided&#x27;</span>)&#125;</span></span><br><span class="hljs-string">&quot;&quot;&quot;</span><br></code></pre></td></tr></table></figure><h3 id="Tool-Execution"><a href="#Tool-Execution" class="headerlink" title="Tool Execution"></a>Tool Execution</h3><p>Tool Execution Handler è´Ÿè´£å®é™…æ‰§è¡Œæ¯ä¸ª tool çš„é€»è¾‘</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@mcp.tool()</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_alerts</span>(<span class="hljs-params">state: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;è·å–ç¾å›½å·çš„å¤©æ°”è­¦æŠ¥ã€‚</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Args:</span><br><span class="hljs-string">        state: ä¸¤ä¸ªå­—æ¯çš„ç¾å›½å·ä»£ç ï¼ˆä¾‹å¦‚ CAã€NYï¼‰</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    url = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;NWS_API_BASE&#125;</span>/alerts/active/area/<span class="hljs-subst">&#123;state&#125;</span>&quot;</span><br>    data = <span class="hljs-keyword">await</span> make_nws_request(url)<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> data <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;features&quot;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> data:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;æ— æ³•è·å–è­¦æŠ¥æˆ–æœªæ‰¾åˆ°è­¦æŠ¥ã€‚&quot;</span><br><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> data[<span class="hljs-string">&quot;features&quot;</span>]:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;è¯¥å·æ²¡æœ‰æ´»è·ƒçš„è­¦æŠ¥ã€‚&quot;</span><br><br>    alerts = [format_alert(feature) <span class="hljs-keyword">for</span> feature <span class="hljs-keyword">in</span> data[<span class="hljs-string">&quot;features&quot;</span>]]<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;\n---\n&quot;</span>.join(alerts)<br><br><span class="hljs-meta">@mcp.tool()</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_forecast</span>(<span class="hljs-params">latitude: <span class="hljs-built_in">float</span>, longitude: <span class="hljs-built_in">float</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;è·å–æŸä¸ªä½ç½®çš„å¤©æ°”é¢„æŠ¥ã€‚</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Args:</span><br><span class="hljs-string">        latitude: ä½ç½®çš„çº¬åº¦</span><br><span class="hljs-string">        longitude: ä½ç½®çš„ç»åº¦</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># é¦–å…ˆè·å–é¢„æŠ¥ç½‘æ ¼ endpoint</span><br>    points_url = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;NWS_API_BASE&#125;</span>/points/<span class="hljs-subst">&#123;latitude&#125;</span>,<span class="hljs-subst">&#123;longitude&#125;</span>&quot;</span><br>    points_data = <span class="hljs-keyword">await</span> make_nws_request(points_url)<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> points_data:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;æ— æ³•è·å–æ­¤ä½ç½®çš„é¢„æŠ¥æ•°æ®ã€‚&quot;</span><br><br>    <span class="hljs-comment"># ä» points response ä¸­è·å–é¢„æŠ¥ URL</span><br>    forecast_url = points_data[<span class="hljs-string">&quot;properties&quot;</span>][<span class="hljs-string">&quot;forecast&quot;</span>]<br>    forecast_data = <span class="hljs-keyword">await</span> make_nws_request(forecast_url)<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> forecast_data:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;æ— æ³•è·å–è¯¦ç»†é¢„æŠ¥ã€‚&quot;</span><br><br>    <span class="hljs-comment"># å°† periods æ ¼å¼åŒ–ä¸ºå¯è¯»çš„é¢„æŠ¥</span><br>    periods = forecast_data[<span class="hljs-string">&quot;properties&quot;</span>][<span class="hljs-string">&quot;periods&quot;</span>]<br>    forecasts = []<br>    <span class="hljs-keyword">for</span> period <span class="hljs-keyword">in</span> periods[:<span class="hljs-number">5</span>]:  <span class="hljs-comment"># ä»…æ˜¾ç¤ºæ¥ä¸‹æ¥çš„ 5 ä¸ª periods</span><br>        forecast = <span class="hljs-string">f&quot;&quot;&quot;</span><br><span class="hljs-string"><span class="hljs-subst">&#123;period[<span class="hljs-string">&#x27;name&#x27;</span>]&#125;</span>:</span><br><span class="hljs-string">æ¸©åº¦: <span class="hljs-subst">&#123;period[<span class="hljs-string">&#x27;temperature&#x27;</span>]&#125;</span>Â°<span class="hljs-subst">&#123;period[<span class="hljs-string">&#x27;temperatureUnit&#x27;</span>]&#125;</span></span><br><span class="hljs-string">é£: <span class="hljs-subst">&#123;period[<span class="hljs-string">&#x27;windSpeed&#x27;</span>]&#125;</span> <span class="hljs-subst">&#123;period[<span class="hljs-string">&#x27;windDirection&#x27;</span>]&#125;</span></span><br><span class="hljs-string">é¢„æŠ¥: <span class="hljs-subst">&#123;period[<span class="hljs-string">&#x27;detailedForecast&#x27;</span>]&#125;</span></span><br><span class="hljs-string">&quot;&quot;&quot;</span><br>        forecasts.append(forecast)<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;\n---\n&quot;</span>.join(forecasts)<br></code></pre></td></tr></table></figure><p>åˆå§‹åŒ–å¹¶è¿è¡Œ serverï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>() -&gt; <span class="hljs-literal">None</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;æ¨¡å—å…¥å£ï¼Œä¾› `python -m weather` æˆ– `weather:main` è„šæœ¬è°ƒç”¨ã€‚</span><br><span class="hljs-string"></span><br><span class="hljs-string">    è¯¥å‡½æ•°ä¼šå¯åŠ¨ MCP server å¹¶é˜»å¡ï¼Œä½¿ç”¨ stdio ä½œä¸ºä¼ è¾“å±‚ï¼ˆç”¨äº VS Code MCP é›†æˆï¼‰ã€‚</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    mcp.run(transport=<span class="hljs-string">&quot;stdio&quot;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-comment"># ç›´æ¥è¿è¡Œæ—¶æ‰“å°é”™è¯¯å†æŠ›å‡ºï¼Œä¾¿äºè°ƒè¯•ä¾èµ–æˆ–è¿è¡Œæ—¶é—®é¢˜</span><br>    <span class="hljs-keyword">try</span>:<br>        main()<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-keyword">import</span> sys<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;å¯åŠ¨ MCP æœåŠ¡å¤±è´¥: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>, file=sys.stderr)<br>        <span class="hljs-keyword">raise</span><br></code></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">uv <span class="hljs-built_in">run</span> weather.py<br></code></pre></td></tr></table></figure><h1 id="åœ¨-VS-Code-ä¸Šçš„ä½¿ç”¨æ•ˆæœ"><a href="#åœ¨-VS-Code-ä¸Šçš„ä½¿ç”¨æ•ˆæœ" class="headerlink" title="åœ¨ VS Code ä¸Šçš„ä½¿ç”¨æ•ˆæœ"></a>åœ¨ VS Code ä¸Šçš„ä½¿ç”¨æ•ˆæœ</h1><p><img src="/images/mcp/result.png" alt="Copilot"><br><img src="/images/mcp/server.png" alt="Server"></p><h1 id="é™„å½•ä¸€ï¼šä½¿ç”¨-uv-åˆ›å»º-MCP-è™šæ‹Ÿç¯å¢ƒ"><a href="#é™„å½•ä¸€ï¼šä½¿ç”¨-uv-åˆ›å»º-MCP-è™šæ‹Ÿç¯å¢ƒ" class="headerlink" title="é™„å½•ä¸€ï¼šä½¿ç”¨ uv åˆ›å»º MCP è™šæ‹Ÿç¯å¢ƒ"></a>é™„å½•ä¸€ï¼šä½¿ç”¨ uv åˆ›å»º MCP è™šæ‹Ÿç¯å¢ƒ</h1><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">uv</span> venv     <span class="hljs-comment">//åœ¨å½“å‰å·¥ä½œç›®å½•åˆ›å»ºuvè™šæ‹Ÿç¯å¢ƒ</span><br><span class="hljs-symbol">.venv</span>\Scripts\activate      <span class="hljs-comment">//å¯åŠ¨è™šæ‹Ÿç¯å¢ƒ</span><br><span class="hljs-symbol">uv</span> <span class="hljs-keyword">add</span> mcp[cli] httpx       <span class="hljs-comment">//å®‰è£…ä¾èµ–åŒ…</span><br></code></pre></td></tr></table></figure><h1 id="é™„å½•äºŒï¼šVS-Code-ä¸­é…ç½®-MCP-æœåŠ¡"><a href="#é™„å½•äºŒï¼šVS-Code-ä¸­é…ç½®-MCP-æœåŠ¡" class="headerlink" title="é™„å½•äºŒï¼šVS Code ä¸­é…ç½® MCP æœåŠ¡"></a>é™„å½•äºŒï¼šVS Code ä¸­é…ç½® MCP æœåŠ¡</h1><p><code>chat.mcp.access </code> è®¾ç½®æ§åˆ¶å“ªäº› MCP æœåŠ¡å™¨å¯ä»¥åœ¨ VS Code ä¸­å®‰è£…å’Œè¿è¡Œ<br><code>all</code>ï¼ˆé»˜è®¤ï¼‰ï¼šå…è®¸æ‰€æœ‰ MCP æœåŠ¡å™¨<br><code>registry</code>ï¼šåªå…è®¸æ¥è‡ªæ³¨å†Œè¡¨çš„ MCP æœåŠ¡å™¨<br><code>none</code>ï¼šä¸å…è®¸ä»»ä½• MCP æœåŠ¡å™¨</p><blockquote><p>MCP æœåŠ¡å™¨å¯ä»¥åœ¨ä½ çš„æœºå™¨ä¸Šè¿è¡Œä»»æ„ä»£ç ã€‚åªæ·»åŠ æ¥è‡ªå—ä¿¡ä»»æ¥æºçš„æœåŠ¡å™¨ï¼Œå¹¶åœ¨å¯åŠ¨å‰å®¡æŸ¥å‘å¸ƒè€…å’ŒæœåŠ¡å™¨é…ç½®ã€‚</p></blockquote><h3 id="å°†-MCP-æœåŠ¡å™¨æ·»åŠ åˆ°å·¥ä½œåŒº-mcp-json-æ–‡ä»¶"><a href="#å°†-MCP-æœåŠ¡å™¨æ·»åŠ åˆ°å·¥ä½œåŒº-mcp-json-æ–‡ä»¶" class="headerlink" title="å°† MCP æœåŠ¡å™¨æ·»åŠ åˆ°å·¥ä½œåŒº mcp.json æ–‡ä»¶"></a>å°† MCP æœåŠ¡å™¨æ·»åŠ åˆ°å·¥ä½œåŒº <code>mcp.json</code> æ–‡ä»¶</h3><ul><li>åœ¨ä½ çš„å·¥ä½œåŒºä¸­åˆ›å»º .VS Codeode&#x2F;mcp.json æ–‡ä»¶ã€‚</li><li>é€‰æ‹©ç¼–è¾‘å™¨ä¸­çš„æ·»åŠ æœåŠ¡å™¨æŒ‰é’®ä»¥æ·»åŠ æ–°æœåŠ¡å™¨çš„æ¨¡æ¿ã€‚VS Code ä¸º MCP æœåŠ¡å™¨é…ç½®æ–‡ä»¶æä¾›äº†æ™ºèƒ½æ„ŸçŸ¥ã€‚</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;servers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;weather&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;stdio&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;command&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;uv&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;args&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                <span class="hljs-string">&quot;--directory&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-string">&quot;C:\\Users\\Admin\\Desktop\\MCP&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-string">&quot;run&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-string">&quot;weather.py&quot;</span><br>            <span class="hljs-punctuation">]</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="åœ¨ä»£ç†æ¨¡å¼ä¸­ä½¿ç”¨-MCP-å·¥å…·"><a href="#åœ¨ä»£ç†æ¨¡å¼ä¸­ä½¿ç”¨-MCP-å·¥å…·" class="headerlink" title="åœ¨ä»£ç†æ¨¡å¼ä¸­ä½¿ç”¨ MCP å·¥å…·"></a>åœ¨ä»£ç†æ¨¡å¼ä¸­ä½¿ç”¨ MCP å·¥å…·</h3><p>æ·»åŠ  MCP æœåŠ¡å™¨åï¼Œåœ¨ä»£ç†æ¨¡å¼ä¸‹ä½¿ç”¨å®ƒæä¾›çš„å·¥å…·ã€‚</p><ul><li>æ‰“å¼€èŠå¤©è§†å›¾ï¼ˆCtrl+Alt+Iï¼‰ï¼Œç„¶åä»ä¸‹æ‹‰åˆ—è¡¨ä¸­é€‰æ‹©ä»£ç†æ¨¡å¼<br><img src="/images/mcp/mode.png" alt="MCP"></li><li>é€‰æ‹©å·¥å…·æŒ‰é’®ä»¥æŸ¥çœ‹å¯ç”¨å·¥å…·åˆ—è¡¨ã€‚<br><img src="/images/mcp/vsc_mcp.png" alt="Agent"></li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> VS Code </tag>
            
            <tag> MCP </tag>
            
            <tag> LLM </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
